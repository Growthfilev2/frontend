function conversation(e,t){t&&history.pushState(["conversation",e],null,null),fetchAddendumForComment(e)}function fetchAddendumForComment(e){var t=firebase.auth().currentUser,a=window.indexedDB.open(t.uid);a.onsuccess=function(){var n=a.result,i=n.transaction("addendum","readonly").objectStore("addendum").index("activityId");createHeaderContent(n,e),commentPanel(n,e),statusChange(n,e),sendCurrentViewNameToAndroid("conversation"),reinitCount(n,e);i.openCursor(e).onsuccess=function(e){var a=e.target.result;return a?void(!document.getElementById(a.value.addendumId)&&createComment(n,a.value,t).then(function(e){document.getElementById("chat-container").appendChild(e)}),a.continue()):void(document.querySelector(".activity--chat-card-container").scrollTop=document.querySelector(".activity--chat-card-container").scrollHeight)}}}function commentPanel(e,t){if(!document.querySelector(".activity--chat-card-container")){var a=document.createElement("div");a.className="activity--chat-card-container  mdc-top-app-bar--fixed-adjust panel-card";var n=document.createElement("div");n.id="chat-container",n.className="mdc-card reverser-parent";var i=document.createElement("div");i.className="user-comment--container";var l=document.createElement("div");l.className="status--change-cont";var r=document.createElement("div");r.className="comment--container";var c=document.createElement("div");c.className="input--text-padding mdc-text-field mdc-text-field--dense",c.id="write--comment",c.style.width="100%";var d=document.createElement("input");d.className="mdc-text-field__input comment-field mdc-elevation--z4",d.type="text",c.appendChild(d),r.appendChild(c);var s=document.createElement("button");s.classList.add("mdc-fab","mdc-fab--mini","hidden"),s.id="send-chat--input";var o=document.createElement("span");o.classList.add("mdc-fac__icon","material-icons"),o.textContent="send",s.appendChild(o),r.appendChild(s),a.appendChild(n),i.appendChild(r),document.getElementById("app-current-panel").innerHTML=a.outerHTML+l.outerHTML+i.outerHTML,document.querySelector(".comment-field").oninput=function(e){e.target.value&&" "!==e.target.value?(document.getElementById("send-chat--input").classList.remove("hidden"),document.getElementById("write--comment").style.width="80%",document.querySelector(".status--change-cont").style.opacity="0"):(document.getElementById("send-chat--input").classList.add("hidden"),document.getElementById("write--comment").style.width="100%",document.getElementById("write--comment").style.transition="0.3s ease",document.querySelector(".status--change-cont").style.transition="0.3s ease",document.querySelector(".status--change-cont").style.opacity="1")},document.getElementById("send-chat--input").onclick=function(){if("Android"===localStorage.getItem("deviceType")){try{if(!IsGpsEnabled.gpsEnabled())return void enableGps("Please turn on GPS to use this application");sendComment(t)}catch(t){console.log(t)}return}sendComment(t)}}}function sendComment(e){var t={activityId:e,comment:document.querySelector(".comment-field").value};requestCreator("comment",t),document.querySelector(".comment-field").value="",document.querySelector(".status--change-cont").style.opacity="1"}function statusChange(e,t){var a=document.createElement("label");a.setAttribute("for","toggle-status"),a.textContent="Confirm Completion";var n=e.transaction("activity").objectStore("activity");n.get(t).onsuccess=function(e){var t=e.target.result;if(!t.canEdit||"CANCELLED"===t.status){var n=document.createElement("span"),i=e.target.result;return n.textContent="Activity "+i.status.toLowerCase(),document.querySelector(".status--change-cont").innerHTML=n.outerHTML,void(document.querySelector(".status--change-cont").style.textAlign="center")}if(0==t.editable)return void(document.querySelector(".status--change-cont").innerHTML=a.outerHTML+loader("status-loader").outerHTML);if(!document.querySelector(".status-check")){var l=document.createElement("div");l.className="mdc-form-field form-field-status";var r=document.createElement("div");r.className="mdc-checkbox status-check";var c=document.createElement("input");c.className="mdc-checkbox__native-control",c.id="toggle-status",c.type="checkbox";var d=document.createElement("div");d.className="mdc-checkbox__background";var s=document.createElement("div");s.className="mdc-checkbox__mixedmark",d.innerHTML="<svg class=\"mdc-checkbox__checkmark\"\n      viewBox=\"0 0 24 24\">\n      <path class=\"mdc-checkbox__checkmark-path\"\n      fill=\"none\"\n      d=\"M1.73,12.91 8.1,19.28 22.79,4.59\"/>\n      </svg>\n      <div class=\"mdc-checkbox__mixedmark\"></div>",r.appendChild(c),r.appendChild(d),l.appendChild(r),document.querySelector(".status--change-cont").innerHTML=l.outerHTML+a.outerHTML}var o=new mdc.checkbox.MDCCheckbox.attachTo(document.querySelector(".mdc-checkbox"));"CONFIRMED"===t.status&&(o.checked=!0),document.querySelector(".mdc-checkbox").onclick=function(){if(document.querySelector(".form-field-status").classList.add("hidden"),document.querySelector(".status--change-cont").appendChild(loader("status-loader")),"Android"===localStorage.getItem("deviceType")){try{IsGpsEnabled.gpsEnabled()||(enableGps(),resetStatusConfirmation(o,t)),changeStatusRequest(o,t)}catch(t){console.log(t)}return}changeStatusRequest(o,t)}}}function resetStatusConfirmation(e,t){document.querySelector(".form-field-status").classList.remove("hidden"),document.querySelector(".status--change-cont .status-loader").remove(),e.checked=!("CONFIRMED"!==t.status)}function changeStatusRequest(e,t){e.checked?requestCreator("statusChange",{activityId:t.activityId,status:"CONFIRMED"}):requestCreator("statusChange",{activityId:t.activityId,status:"PENDING"})}function createComment(e,t,a){var n=!1;return new Promise(function(i){document.getElementById(t.addendumId)&&i(document.getElementById(t.addendumId).outerHTML);var l=document.createElement("div");l.classList.add("comment-box","talk-bubble","tri-right","round","btm-left"),a.phoneNumber===t.user?l.classList.add("current-user--comment","secondary-color-light"):l.classList.add("other-user--comment","mdc-theme--primary-bg"),l.id=t.addendumId;var r=document.createElement("div");r.classList.add("talktext");var c=document.createElement("p");c.classList.add("user-name--comment","mdc-typography--subtitle2"),readNameFromNumber(e,t.user).then(function(e){c.textContent=e;var a=document.createElement("p");a.classList.add("comment","mdc-typography--subtitle2"),a.textContent=t.comment;var d=document.createElement("span");d.className="comment--info";var s=document.createElement("span");s.textContent=moment(t.timestamp).format("DD-MM-YY H:mm"),s.classList.add("comment-date","mdc-typography--caption");var o=document.createElement("div"),m=document.createElement("i");m.classList.add("user-map--span","material-icons"),m.appendChild(document.createTextNode("location_on")),o.onclick=function(e){n=!n;var a={lat:t.location._latitude,lng:t.location._longitude};maps(e,n,t.addendumId,a)},m.dataset.latitude=t.location._latitude,m.dataset.longitude=t.location._longitude,o.appendChild(m);var p=document.createElement("div");p.className="map-convo",d.appendChild(s),d.appendChild(o),r.appendChild(c),r.appendChild(a),r.appendChild(d),l.appendChild(r),l.appendChild(p),i(l)}).catch(console.log)})}function readNameFromNumber(e,t){return new Promise(function(a,n){var i=e.transaction("users").objectStore("users");i.get(t).onsuccess=function(e){var n=e.target.result;return n?n.displayName?a(n.displayName):void a(t):a(t)},i.get(t).onerror=function(e){n(e)}})}function maps(e,t,a,n){var i="";if(i=e?document.getElementById(a).querySelector(".map-convo"):document.querySelector(".map-detail."+a),console.log(t),!t)return i.style.height="0px",void(e?e.target.textContent="location_on":"");if(0!==i.children.length)return i.style.height="200px",void(e?e.target.textContent="arrow_drop_down":"");e?e.target.textContent="arrow_drop_down":"",i.style.height="200px";var l=new google.maps.Map(i,{zoom:16,center:n,disableDefaultUI:!0});if(!e){var r=document.createElement("div"),c=new MapsCustomControl(r,l,n.lat,n.lng);r.index=1,l.controls[google.maps.ControlPosition.TOP_LEFT].push(r)}new google.maps.Marker({position:n,map:l})}function MapsCustomControl(e,t,a,n){var i=document.createElement("div");i.style.backgroundColor="#fff",i.style.border="2px solid #fff",i.style.borderRadius="3px",i.style.boxShadow="0 2px 6px rgba(0,0,0,.3)",i.style.cursor="pointer",i.style.marginBottom="22px",i.style.textAlign="center",i.style.padding="0px 5px 0px 5px",e.appendChild(i);var l=document.createElement("a");l.href="https://www.google.com/maps?q="+a+","+n,l.className="material-icons",l.style.color="rgb(25,25,25)",l.style.fontSize="16px",l.style.lineHeight="38px",l.style.paddingLeft="5px",l.style.paddingRight="5px",l.style.textDecoration="none",l.innerHTML="open_in_new",i.appendChild(l)}function createHeaderContent(e,t){var a=e.transaction("activity").objectStore("activity"),n=document.createElement("div"),i=document.createElement("div");i.className="back-icon",i.id="back-conv",i.style.float="left";var l=document.createElement("i");l.style.marginRight="5px",l.className="material-icons back-icon--large",l.textContent="arrow_back",i.appendChild(l),a.get(t).onsuccess=function(t){var a=t.target.result;getImageFromNumber(e,a.creator).then(function(e){console.log(e);var t=document.createElement("img");t.className="header--icon-creator",t.dataset.number=a.creator,t.src=e,t.setAttribute("onerror","handleImageError(this)"),i.appendChild(t);var l=document.createElement("div");l.className="mdc-list-item__text comment-header-primary mdc-typography--subtitle2",l.textContent=a.activityName;var r=document.createElement("span");r.className="mdc-list-item__secondary-text",r.textContent="Click here to see details",l.appendChild(r),n.appendChild(i),n.appendChild(l),header(n.outerHTML,""),document.getElementById("back-conv").addEventListener("click",function(){backNav()}),document.querySelector(".comment-header-primary").addEventListener("click",function(){updateCreateActivity(a,!0)})})}}function reinitCount(e,t){var a=e.transaction("activityCount","readwrite").objectStore("activityCount");a.get(t).onsuccess=function(e){var t=e.target.result;t&&(t.count=0,a.put(t))}}function getImageFromNumber(e,t){return new Promise(function(a){var n=e.transaction("users").objectStore("users");n.get(t).onsuccess=function(e){var n=e.target.result;t===firebase.auth().currentUser.phoneNumber?a(firebase.auth().currentUser.photoURL||"./img/empty-user.jpg"):a(n?n.photoURL:"./img/empty-user.jpg")}})}function selectorUI(e,t){sendCurrentViewNameToAndroid("selector");var a=document.createElement("aside");a.id="dialog--component",a.className="mdc-dialog",a.role="alertdialog";var n=document.createElement("div");n.className="mdc-dialog__surface";var i=document.createElement("span");i.className="material-icons",i.textContent="search",i.id="selector--search";var l=document.createElement("span");l.className="material-icons dialog--header-back selector--type-"+t.store,l.textContent="arrow_back";var r=document.createElement("section");r.className="mdc-dialog__body--scrollable mdc-top-app-bar--fixed-adjust";var c=document.createElement("ul");c.id="data-list--container",c.className="mdc-list ",r.appendChild(c);var d=document.createElement("footer");d.className="mdc-dialog__footer";var s=document.createElement("button");s.className="mdc-fab mdc-dialog__footer__button mdc-dialog__footer__button--accept selector-send",s.type="button";var o=document.createElement("span");o.className="mdc-fab__icon material-icons","users"===t.store?(o.textContent="add",s.dataset.clicktype="numpad"):o.textContent="send",s.appendChild(o),d.appendChild(s),"subscriptions"===t.store||"children"===t.store?n.appendChild(header(l.outerHTML,"","selector")):n.appendChild(header(l.outerHTML,i.outerHTML,"selector")),n.appendChild(r),n.appendChild(d),a.appendChild(n);var m=document.createElement("div");m.className="mdc-dialog__backdrop",a.appendChild(m),document.body.appendChild(a),document.querySelector(".dialog--header-back").addEventListener("click",function(a){return a.target.classList.contains("selector--type-users")&&"users-list-back"===a.target.dataset.state?void resetSelectedContacts().then(function(){removeDialog(a,t)}):void removeDialog(a,t)}),initializeSelectorWithData(e,t)}function removeDialog(e,t){document.getElementById("dialog--component")&&(e&&"back-list"===e.target.dataset.type?resetSelectorUI(t):(document.getElementById("dialog--component").remove(),document.getElementById("growthfile").classList.remove("mdc-dialog-scroll-lock")))}function initializeSelectorWithData(e,t){console.log(t);var a=new mdc.dialog.MDCDialog(document.querySelector("#dialog--component")),n=t.record,i=void 0,l=firebase.auth().currentUser.uid,r=indexedDB.open(l);r.onsuccess=function(){var e=r.result;if("map"===t.store){var l=e.transaction(t.store).objectStore(t.store);i=l.index("location"),fillMapInSelector(e,i,a,t)}if("subscriptions"===t.store){var c=e.transaction(t.store).objectStore(t.store);fillSubscriptionInSelector(e,c,a,t)}"users"===t.store&&(i=e.transaction(t.store).objectStore(t.store),resetSelectedContacts().then(function(){fillUsersInSelector(t,a)})),"children"===t.store&&(i=e.transaction(t.store).objectStore(t.store),fillChildrenInSelector(i,n,a,t))},a.lastFocusedTarget=e.target,a.show()}function fillUsersInSelector(e,t){var a=document.getElementById("data-list--container"),n={},i=e.record.assignees;i.forEach(function(e){n[e]=""});var l=indexedDB.open(firebase.auth().currentUser.uid);l.onsuccess=function(){var i=l.result,r=i.transaction("users").objectStore("users");r.openCursor().onsuccess=function(t){var i=t.target.result;if(!i){var l=document.querySelectorAll("[data-selected=\"true\"]");return void l.forEach(function(e){var t=new mdc.checkbox.MDCCheckbox.attachTo(e);t.checked=!0,e.children[1].style.animation="none",e.children[1].children[0].children[0].style.animation="none"})}var r=i.value;e.attachment.present?a.appendChild(createSimpleAssigneeLi(r,!0,!1)):!n.hasOwnProperty(i.value.mobile)&&a.appendChild(createSimpleAssigneeLi(r,!0,!0)),i.continue()},document.getElementById("selector--search").addEventListener("click",function(){initSearchForSelectors(i,"users",e)}),t.acceptButton_.onclick=function(){if("numpad"===t.acceptButton_.dataset.clicktype)return document.getElementById("selector--search").style.display="none",document.getElementById("data-list--container").innerHTML="",document.querySelector(".mdc-dialog__footer").style.display="none",void addNewNumber(e,t);if(e.attachment.present){var a=new mdc.radio.MDCRadio(document.querySelector(".mdc-radio.radio-selected"));return console.log(a),console.log("run"),updateDomFromIDB(e.record,{hash:"",key:e.attachment.key},{primary:JSON.parse(a.value)}),void removeDialog()}if(e.record.hasOwnProperty("create"))return void resetSelectedContacts().then(function(t){updateDomFromIDB(e.record,{hash:"addOnlyAssignees"},{primary:t}),removeDialog()});if("Android"===localStorage.getItem("deviceType")){try{if(!IsGpsEnabled.gpsEnabled())return void enableGps();shareReq(e)}catch(t){console.log(t)}return}shareReq(e)}}}function shareReq(e){document.querySelector(".add--assignee-loader").appendChild(loader("user-loader")),document.querySelector(".add--assignee-loader .add--assignee-icon").style.display="none",resetSelectedContacts().then(function(t){console.log(t);var a={activityId:e.record.activityId,share:t};requestCreator("share",a),removeDialog()})}function addNewNumber(e){var t=document.createElement("div");t.className="custom-number--container";var a=document.createElement("input");a.className="mdc-text-field__input",a.id="number-field",a.type="number",a.setAttribute("maxlength","10"),a.setAttribute("size","10"),a.required=!0,a.onkeypress=function(e){return 48<=e.charCode&&57>=e.charCode},a.oninput=function(){this.value.length>this.maxLength?(console.log(this),this.value=this.value.slice(0,this.maxLength)):this.value.length===this.maxLength?(document.querySelector(".message-field").classList.remove("error-message"),this.classList.add("valid-input"),document.querySelector(".message-field").textContent="",document.getElementById("new-contact").disabled=!1):(document.querySelector(".message-field").classList.add("error-message"),document.querySelector(".message-field").textContent="* Please Enter a valid Number",document.getElementById("new-contact").disabled=!0)};var n=document.createElement("button");n.className="mdc-button",n.textContent="Add Contact",n.id="new-contact",n.onclick=function(){var t=document.getElementById("number-field").value,a=formatNumber(t);checkNumber(a)?numberNotExist(a).then(function(t){if(t)return document.getElementById("new-contact").disabled=!0,document.querySelector(".message-field").classList.add("error-message"),void(document.querySelector(".message-field").textContent="* Contact already exist");if(e.attachment.present)return updateDomFromIDB(e.record,{hash:"",key:e.attachment.key},{primary:[a]}),void removeDialog();if(e.record.hasOwnProperty("create"))return updateDomFromIDB(e.record,{hash:"addOnlyAssignees"},{primary:[a]}),void removeDialog();if("Android"===localStorage.getItem("deviceType")){try{if(!IsGpsEnabled.gpsEnabled())return void enableGps();newNumberReq(e,a)}catch(t){console.log(t)}return}newNumberReq(e,a)}):(document.querySelector(".message-field").classList.add("error-message"),document.querySelector(".message-field").textContent="* Please Enter a valid Number",document.getElementById("new-contact").disabled=!0)};var i=document.createElement("p");i.className="mdc-typography--subtitle2 message-field",i.textContent="Enter new phone contact without country code",i.id="helper-message",t.appendChild(a),t.appendChild(i),t.appendChild(n),document.querySelector("#dialog--component section.mdc-dialog__body--scrollable").appendChild(t);new mdc.ripple.MDCRipple.attachTo(document.getElementById("new-contact"))}function newNumberReq(e,t){requestCreator("share",{activityId:e.record.activityId,share:[t]}),removeDialog()}function numberNotExist(e){return new Promise(function(t){var a=firebase.auth().currentUser.uid,n=indexedDB.open(a);n.onsuccess=function(){var a=n.result,i=a.transaction("users").objectStore("users");i.get(e).onsuccess=function(e){var a=e.target.result;a?t(!0):t(!1)}}})}function resetSelectedContacts(){return new Promise(function(e){var t=[],a=firebase.auth().currentUser.uid,n=indexedDB.open(a);n.onsuccess=function(){var a=n.result,i=a.transaction(["users"],"readwrite"),l=i.objectStore("users");l.openCursor().onsuccess=function(a){var n=a.target.result;return n?void(n.value.isSelected&&(t.push(n.value.mobile),n.value.isSelected=!1,l.put(n.value)),n.continue()):void e(t)}}})}function fillMapInSelector(e,t,a,n){var i=document.getElementById("data-list--container");t.openCursor(null,"nextunique").onsuccess=function(e){var t=e.target.result;t&&(t.value.location&&i.appendChild(createVenueLi(t.value,!1,n.record,!0)),t.continue())},document.getElementById("selector--search").addEventListener("click",function(){initSearchForSelectors(e,"map",n)}),a.acceptButton_.onclick=function(){var e=new mdc.radio.MDCRadio(document.querySelector(".mdc-radio.radio-selected")),t=JSON.parse(e.value);updateDomFromIDB(n.record,{hash:"venue",key:n.key},{primary:t.location,secondary:{address:t.address,geopoint:t.geopoint}}),removeDialog()}}function fillChildrenInSelector(e,t,a,n){var i=document.getElementById("data-list--container");console.log(n),e.openCursor().onsuccess=function(e){var t=e.target.result;t&&(t.value.template===n.attachment.template&&t.value.office===n.attachment.office&&"CANCELLED"!=n.attachment.status&&i.appendChild(createSimpleLi("children",t.value.attachment.Name.value)),t.continue())},a.acceptButton_.onclick=function(){var e=new mdc.radio.MDCRadio(document.querySelector(".mdc-radio.radio-selected")),a=JSON.parse(e.value);updateDomFromIDB(t,{hash:"children",key:n.attachment.key},{primary:a.name}),removeDialog()}}function fillSubscriptionInSelector(e,t,a,n){var i=document.getElementById("data-list--container"),l=document.createElement("div");l.className="mdc-list-group";var r=[],c=t.index("office");c.openCursor(null,"nextunique").onsuccess=function(e){var t=e.target.result;if(!t)return void insertTemplateByOffice(r);var a=document.createElement("h3");a.className="mdc-list-group__subheader subheader--group-small",a.textContent=t.value.office,a.dataset.groupOffice=t.value.office;var n=document.createElement("ul");n.className="mdc-list",n.dataset.selection=t.value.office,n.setAttribute("aria-orientation","vertical"),r.push(t.value.office),l.appendChild(a),l.appendChild(n),t.continue()},i.appendChild(l),a.acceptButton_.onclick=function(){var e=new mdc.radio.MDCRadio(document.querySelector(".mdc-radio.radio-selected"));console.log(e);var t=JSON.parse(e.value);console.log(t),document.getElementById("app-current-panel").dataset.view="create",createTempRecord(t.office,t.template,n)}}function insertTemplateByOffice(){var e={admin:"",recipient:"",employee:"",subscription:""},t=indexedDB.open(firebase.auth().currentUser.uid),a=document.createDocumentFragment();t.onsuccess=function(){var a=t.result,n=a.transaction("subscriptions").objectStore("subscriptions").index("office");n.openCursor().onsuccess=function(t){var a=t.target.result;return a?"CANCELLED"===a.value.status?void a.continue():e.hasOwnProperty(a.value.template)?void a.continue():document.querySelector("[data-selection=\""+a.value.office+"\"] [data-template=\""+a.value.template+"\"]")?void a.continue():void(document.querySelector("[data-selection=\""+a.value.office+"\"]").appendChild(createGroupList(a.value.office,a.value.template)),console.log(a.value),a.continue()):void 0}}}function createTempRecord(e,t){var a=firebase.auth().currentUser.uid,n=indexedDB.open(a);n.onsuccess=function(){var a=n.result,i=a.transaction("subscriptions").objectStore("subscriptions"),l=i.index("officeTemplate"),r=IDBKeyRange.only([e,t]);l.get(r).onsuccess=function(e){var t=e.target.result,a=[],n=[];t.venue.forEach(function(e){var t={};t.venueDescriptor=e,t.location="",t.address="",t.geopoint={_latitude:"",_longitude:""},a.push(t)}),console.log(t),t.schedule.forEach(function(e){var t={};t.name=e,t.startTime="",t.endTime="",n.push(t)});var i={office:t.office,template:t.template,venue:a,schedule:n,attachment:t.attachment,timestamp:Date.now(),canEdit:!0,assignees:[],activityName:t.template.toUpperCase(),create:!0};updateCreateActivity(i,!0),removeDialog()}}}function hasAnyValueInChildren(e,t,a){var n=firebase.auth().currentUser.uid,i=indexedDB.open(n);return new Promise(function(n){i.onsuccess=function(){var l=i.result,r=l.transaction("children").objectStore("children"),c=0,d=!1;r.openCursor().onsuccess=function(i){var l=i.target.result;return l?void(l.value.template===t&&l.value.office===e&&"CANCELLED"!=a&&c++,l.continue()):void(0===c?(d=!1,n(d)):(d=!0,n(d)))}}})}function updateDomFromIDB(e,t,a){var n=firebase.auth().currentUser.uid,i=indexedDB.open(n);i.onsuccess=function(){var n=e,l=i.result,r=l.transaction("activity","readwrite").objectStore("activity");if("venue"===t.hash)return n=updateVenue(n,t,a),document.getElementById(convertKeyToId(t.key)).querySelector("[data-primary]").textContent=a.primary,document.getElementById(convertKeyToId(t.key)).querySelector("[data-secondary]").textContent=a.secondary.address,document.getElementById("send-activity").classList.remove("hidden"),void(e.hasOwnProperty("create")||r.put(n));if("addOnlyAssignees"===t.hash)return 0<a.primary.length&&a.primary.forEach(function(t){-1<e.assignees.indexOf(t)||e.assignees.push(t)}),console.log(e),void readNameAndImageFromNumber(a.primary,l);n.attachment[t.key].value=a.primary,e.hasOwnProperty("create")||r.put(n);"weekday"!==t.hash&&t.hasOwnProperty("key")&&(document.getElementById(convertKeyToId(t.key)).querySelector("[data-primary]").textContent=a.primary,a.hasOwnProperty("secondary")&&(document.getElementById(convertKeyToId(t.key)).querySelector("[data-secondary]").textContent=a.secondary.address),document.getElementById("send-activity").classList.remove("hidden"))}}function updateVenue(e,t,a){return e.venue.forEach(function(e){e.venueDescriptor===t.key&&(e.location=a.primary,e.address=a.secondary.address,e.geopoint._latitude=a.secondary.geopoint._latitude,e.geopoint._longitude=a.secondary.geopoint._longitude,console.log(e))}),e}function convertKeyToId(e){return e.replace(/\s/g,"-")}function convertIdToKey(e){return e.replace(/-/g," ")}function updateCreateContainer(e){document.body.style.backgroundColor="#eeeeee";var t=document.createElement("div");t.style.display="inline-flex";var a=document.createElement("span");a.className="material-icons",a.textContent="arrow_back",a.id="backToConv";var n=document.createElement("span");n.textContent=e.activityName,n.style.fontSize="19px",n.style.paddingLeft="10px",n.style.marginTop="2px",t.appendChild(a),t.appendChild(n),header(t.outerHTML,""),document.getElementById("backToConv").addEventListener("click",function(){backNav()});var l=document.createElement("div");l.className="mdc-top-app-bar--fixed-adjust update-create--activity";var r=["office","venue","schedule","attachment","assignees"],c=0;for(c;c<5;c++){var d=document.createElement("ul");d.className="mdc-list custom--list-margin";var s=document.createElement("div");switch(r[c]){case"office":d.classList.remove("custom--list-margin");break;case"schedule":s.className="mdc-list-group__subheader",s.id="schedule--group";break;case"venue":case"assignees":d.classList.add("mdc-list--two-line","mdc-list--avatar-list");}"schedule"===r[c]?l.appendChild(s):(d.id=r[c]+"--list",l.appendChild(d))}if(e.canEdit){var o=document.createElement("button");o.className="mdc-fab send--activity-fab",o.setAttribute("aria-label","Send"),o.id="send-activity",e.hasOwnProperty("create")||o.classList.add("hidden");var m=document.createElement("span");m.className="mdc-fab__icon material-icons",m.textContent="send",o.appendChild(m),l.appendChild(o)}return l}function updateCreateActivity(e,t){t&&history.pushState(["updateCreateActivity",e],null,null);var a=firebase.auth().currentUser.uid,n=indexedDB.open(a);n.onsuccess=function(){var t=n.result,a=document.getElementById("app-current-panel");a.innerHTML=updateCreateContainer(e).outerHTML;var l=document.getElementById("office--list");l.appendChild(createSimpleLi("Office",{office:e.office,showLabel:!0})),document.getElementById("send-activity")&&document.getElementById("send-activity").addEventListener("click",function(){sendActivity(e)}),createVenueSection(e),createScheduleTable(e),createAttachmentContainer(e);for(var r=document.querySelectorAll(".update-create--activity input"),c=0;c<r.length;c++)r[c].addEventListener("input",function(){document.getElementById("send-activity").classList.contains("hidden")&&document.getElementById("send-activity").classList.remove("hidden")});if(document.querySelector(".mdc-select")){var d=new mdc.select.MDCSelect(document.querySelector(".mdc-select"));d.listen("change",function(){console.log(d),updateDomFromIDB(e,{hash:"weekday",key:d.root_.dataset.value},{primary:d.value}),document.getElementById("send-activity").classList.contains("hidden")&&document.getElementById("send-activity").classList.remove("hidden")})}createAssigneeList(t,e,!0),createActivityCancellation(e)}}function createSimpleLi(e,t){var a=document.createElement("li");a.className="mdc-list-item mdc-ripple-upgraded";var n=document.createElement("span");n.className="detail--static-text";var i=document.createElement("span"),l=document.createElement("span");if("Office"===e&&(l.className="data--value-list",l.textContent=t.office,n.textContent=e,a.appendChild(n),a.appendChild(l)),"children"===e){var r=document.createElement("span");r.className="mdc-list-item__meta",r.appendChild(createRadioInput()),a.textContent=t,a.appendChild(r),a.onclick=function(){checkRadioInput(this,{name:t})}}if("delete"===e&&(l.className="mdc-list-item__graphic material-icons",l.textContent=e,n.classList.remove("detail--static-text"),n.classList.add("delete-activity"),n.textContent=t.text,a.appendChild(l),a.appendChild(n)),"empty"===e&&(a.dataset.prop="delete"),"undo-deleted"===e){l.className="mdc-list-item__graphic material-icons",l.textContent="delete",n.classList.remove("detail--static-text"),n.classList.add("delete-activity"),n.textContent=t.text,a.appendChild(l),a.appendChild(n),a.classList.add("undo-delete-activity");var c=document.createElement("button");c.className="mdc-button mdc-ripple-upgraded mdc-list-item__meta undo-deleted",c.textContent="Undo",c.onclick=function(){if("Android"===localStorage.getItem("deviceType"))try{IsGpsEnabled.gpsEnabled()?reqForUndoDeleted(t.id):enableGps()}catch(e){console.log(e)}else reqForUndoDeleted(t.id)},a.appendChild(c)}return a}function reqForUndoDeleted(e){document.querySelector(".undo-deleted").style.display="none",listItem.appendChild(loader("undo-delete-loader")),requestCreator("statusChange",{activityId:e,status:"PENDING"})}function createGroupList(e,t){var a=document.createElement("li");a.className="mdc-list-item transition-ease",a.dataset.template=t;var n=document.createElement("span");n.className="mdc-list-item__text",n.textContent=t.toUpperCase();var i=document.createElement("span");return i.className="mdc-list-item__meta",i.appendChild(createRadioInput()),a.onclick=function(){checkRadioInput(this,{office:e,template:t})},a.appendChild(n),a.appendChild(i),a}function createVenueSection(e){console.log(e);var t=document.getElementById("venue--list");e.venue.forEach(function(a){t.appendChild(createVenueLi(a,!0,e));var n=document.createElement("div");n.className="map-detail "+convertKeyToId(a.venueDescriptor),t.appendChild(n)}),0===e.venue.length&&(document.getElementById("venue--list").style.display="none")}function createVenueLi(e,t,a,n){var i=!1,l=document.createElement("li");l.className="mdc-list-item mdc-ripple-upgraded",l.id=convertKeyToId(e.venueDescriptor);var r=document.createElement("div");r.className="mdc-list-item__text link--span";var c=document.createElement("span");c.className="mdc-list-item__primary-text";var d=document.createElement("span");d.className="mdc-list-item__meta";var s=document.createElement("label");s.className="mdc-fab add--assignee-icon attachment-selector-label";var o=document.createElement("span");if(o.className="mdc-fab__icon material-icons",o.textContent="add_location",s.appendChild(o),t){var m=document.createElement("span");m.className="detail--static-text",m.textContent=e.venueDescriptor;var p=document.createElement("span");p.className="data--value-list",p.textContent=e.location,p.dataset.primary="",c.appendChild(m),c.appendChild(p),r.appendChild(c),r.onclick=function(){i=!i;var t={lat:e.geopoint._latitude,lng:e.geopoint._longitude};maps("",i,convertKeyToId(e.venueDescriptor),t)},a.canEdit&&(d.setAttribute("aria-hidden","true"),d.appendChild(s),s.onclick=function(t){selectorUI(t,{record:a,store:"map",attachment:{present:!1},key:e.venueDescriptor})})}else c.textContent=e.location,r.appendChild(c);var u=document.createElement("span");u.className="mdc-list-item__meta material-icons",n&&(u.appendChild(createRadioInput()),l.onclick=function(){console.log(e),checkRadioInput(this,{location:e.location,address:e.address,geopoint:{_latitude:e.latitude,_longitude:e.longitude},venueDesc:e.venueDescriptor})});var h=document.createElement("span");return h.className="mdc-list-item__secondary-text",h.textContent=e.address,h.dataset.secondary="",r.appendChild(h),l.appendChild(r),n?l.appendChild(u):l.appendChild(d),l}function createScheduleTable(e){e.schedule.length||(document.getElementById("schedule--group").style.display="none");var t=0;e.schedule.forEach(function(a){t++,console.log(a.startTime);var n=document.createElement("h5");n.className="mdc-list-group__subheader label--text",n.textContent=a.name;var i=document.createElement("ul");i.className="mdc-list mdc-list--dense";var l=document.createElement("li");l.className="mdc-list-divider",l.setAttribute("role","separator");var r=document.createElement("li");r.className="mdc-list-item schedule-start-li";var c=document.createElement("div");c.className="mdc-text-field start--date"+t;var d=document.createElement("input");d.value=moment(a.startTime||new Date).format("YYYY-MM-DD"),d.type="date",d.disabled=!e.canEdit,d.className="mdc-text-field__input",c.appendChild(d);var s=document.createElement("span");s.className="mdc-list-item__meta";var o=document.createElement("div");o.className="mdc-text-field start--time"+t;var m=document.createElement("input");m.value=moment(a.startTime||new Date).format("HH:mm"),m.type="time",m.className="time--input",m.disabled=!e.canEdit,m.className="mdc-text-field__input",o.appendChild(m),s.appendChild(o);var p=document.createElement("li");p.className="mdc-list-item schedule-end-li";var u=document.createElement("div");u.className="mdc-text-field end--date"+t;var h=document.createElement("input");h.value=moment(a.endTime||new Date).format("YYYY-MM-DD"),h.type="date",h.disabled=!e.canEdit,h.className="mdc-text-field__input",u.appendChild(h);var y=document.createElement("span");y.className="mdc-list-item__meta";var g=document.createElement("div");g.className="mdc-text-field end--time"+t;var v=document.createElement("input");v.value=moment(a.endTime||new Date).format("HH:mm"),v.type="time",v.disabled=!e.canEdit,v.className="mdc-text-field__input",g.appendChild(v),y.appendChild(g),r.appendChild(c),r.appendChild(s),p.appendChild(u),p.appendChild(y),i.appendChild(r),i.appendChild(l),i.appendChild(p),document.getElementById("schedule--group").appendChild(n),document.getElementById("schedule--group").appendChild(i)})}function createAttachmentContainer(e){["Name","Template","email","phoneNumber","HHMM","weekday","number","base64","string"].forEach(function(e){var t=document.createElement("div");t.className=e+"--group",document.getElementById("attachment--list").appendChild(t)});var t={phoneNumber:"",weekday:"","HH:MM":"",string:"",base64:"",number:"",email:""};Object.keys(e.attachment).forEach(function(a){var n=document.createElement("div");n.className="HH:MM"===e.attachment[a].type?"attachment-field HHMM":"attachment-field "+e.attachment[a].type,n.id=convertKeyToId(a),e.canEdit&&n.classList.add("editable--true");var i=document.createElement("span");if(i.className="label--text",i.textContent=a,"Name"===a){n.appendChild(i);n.appendChild(createSimpleInput(e.attachment[a].value,e.canEdit,"",a,!0))}if("string"===e.attachment[a].type&&"Name"!==a&&(n.appendChild(i),n.appendChild(createSimpleInput(e.attachment[a].value,e.canEdit,"",a))),"number"===e.attachment[a].type&&(n.appendChild(i),n.appendChild(createNumberInput(e.attachment[a].value,e.canEdit))),"email"===e.attachment[a].type&&(n.appendChild(i),n.appendChild(createEmailInput(e.attachment[a].value,e.canEdit))),"phoneNumber"===e.attachment[a].type){n.classList.add("selector--margin");var l=document.createElement("label");l.className="mdc-fab add--assignee-icon attachment-selector-label";var r=document.createElement("span");r.className="mdc-fab__icon material-icons",r.textContent="person_add",l.appendChild(r);var c=document.createElement("span");c.className="data--value-list",c.dataset.primary="",e.canEdit&&(n.appendChild(l),l.onclick=function(t){selectorUI(t,{record:e,store:"users",attachment:{present:!0,key:a}})}),n.appendChild(i),c.textContent=e.attachment[a].value,n.appendChild(c)}if("HH:MM"==e.attachment[a].type&&(n.appendChild(i),n.appendChild(createTimeInput(e.attachment[a].value,e.canEdit,{simple:!1,type:"time"}))),"weekday"===e.attachment[a].type&&(n.appendChild(i),n.appendChild(createSelectMenu(a,e.attachment[a].value,e.canEdit))),"base64"===e.attachment[a].type){var d=document.createElement("label");d.className="mdc-fab attachment-selector-label add--assignee-icon",d.id="start-camera";var s=document.createElement("span");s.className="mdc-fab__icon material-icons",s.textContent="add_a_photo",d.appendChild(s);var o=document.createElement("ul");o.className="image-preview--attachment mdc-image-list standard-image-list mdc-image-list--with-text-protection",o.appendChild(setFilePath(e.attachment[a].value,a,!0)),n.appendChild(o),e.canEdit&&(n.appendChild(d),n.appendChild(o),d.onclick=function(){readCameraFile()})}if(!t.hasOwnProperty(e.attachment[a].type)){var m=document.createElement("label");m.className="mdc-fab add--assignee-icon attachment-selector-label";var p=document.createElement("span");p.className="mdc-fab__icon material-icons",p.textContent="add",m.appendChild(p),n.appendChild(i);var u=document.createElement("span");u.textContent=e.attachment[a].value,u.className="data--value-list",n.appendChild(u),e.canEdit&&hasAnyValueInChildren(e.office,e.attachment[a].type,e.status).then(function(t){t&&(console.log(t),n.appendChild(m),n.classList.add("selector--margin"),m.onclick=function(t){u.dataset.primary="",selectorUI(t,{record:e,store:"children",attachment:{present:!0,key:a,office:e.office,template:e.attachment[a].type,status:e.status}})})})}var h=document.createElement("hr");h.className="attachment--divider","HH:MM"===e.attachment[a].type?(document.querySelector(".HHMM--group").appendChild(n),document.querySelector(".HHMM--group").appendChild(h)):"Name"===a?(document.querySelector(".Name--group").appendChild(n),document.querySelector(".Name--group").appendChild(h)):t.hasOwnProperty(e.attachment[a].type)?(document.querySelector("."+e.attachment[a].type+"--group").appendChild(n),document.querySelector("."+e.attachment[a].type+"--group").appendChild(h)):(document.querySelector(".Template--group").appendChild(n),document.querySelector(".Template--group").appendChild(h))})}function createAssigneeList(e,t,a){if(a){var n=document.createElement("li");n.className="mdc-list-item label--text add--assignee-loader",n.textContent="Assignees";var i=document.createElement("span");i.className="mdc-list-item__meta";var l=document.createElement("div");l.className="mdc-fab add--assignee-icon",l.onclick=function(e){selectorUI(e,{record:t,store:"users",attachment:{present:!1}})};var r=document.createElement("span");r.className="mdc-fab__icon material-icons",r.textContent="person_add",l.appendChild(r),i.appendChild(l),t.canEdit&&n.appendChild(i),document.getElementById("assignees--list").appendChild(n)}readNameAndImageFromNumber(t.assignees,e)}function readNameAndImageFromNumber(e,t){var a=t.transaction("users").objectStore("users");e.forEach(function(e){a.get(e).onsuccess=function(t){var a=t.target.result;a?document.getElementById("assignees--list").appendChild(createSimpleAssigneeLi(a)):(a={mobile:e,displayName:"",photoURL:""},document.getElementById("assignees--list").appendChild(createSimpleAssigneeLi(a)))}})}function createSimpleAssigneeLi(e,t,a){var n=document.createElement("li");if(n.classList.add("mdc-list-item","assignee-li"),!e)return n;n.dataset.value=e.mobile;var i=document.createElement("img");i.classList.add("mdc-list-item__graphic"),i.src=e.mobile===firebase.auth().currentUser.phoneNumber?firebase.auth().currentUser.photoURL||"./img/empty-user.jpg":e.photoURL||"./img/empty-user.jpg",i.setAttribute("onerror","handleImageError(this)");var l=document.createElement("span");l.classList.add("mdc-list-item__text");var r=document.createElement("span");r.className="mdc-list-item__primary-text";var c=document.createElement("span");c.classList.add("mdc-list-item__secondary-text"),e.displayName?(r.textContent=e.displayName,c.textContent=e.mobile):r.textContent=e.mobile,l.appendChild(r),l.appendChild(c);var d=document.createElement("span");return d.className="mdc-list-item__meta material-icons",t&&(a?d.appendChild(createCheckBox(e)):(d.appendChild(createRadioInput()),n.onclick=function(){checkRadioInput(this,n.dataset.value)})),n.appendChild(i),n.appendChild(l),n.appendChild(d),n}function createRadioInput(){var e=document.createElement("div");e.className="mdc-radio radio-control-selector";var t=document.createElement("input");t.className="mdc-radio__native-control",t.type="radio",t.name="radio";var a=document.createElement("div");a.className="mdc-radio__background";var n=document.createElement("div");n.className="mdc-radio__outer-circle";var i=document.createElement("div");return i.className="mdc-radio__inner-circle",a.appendChild(n),a.appendChild(i),e.appendChild(t),e.appendChild(a),e}function createCheckBox(e){var t=document.createElement("div");t.className="mdc-checkbox status-check",t.dataset.selected=e.isSelected;var a=document.createElement("input");a.className="mdc-checkbox__native-control",a.type="checkbox",a.onclick=function(t){checkCheckboxInput(t,e)};var n=document.createElement("div");n.className="mdc-checkbox__background";var i=document.createElement("div");return i.className="mdc-checkbox__mixedmark",n.innerHTML="<svg class=\"mdc-checkbox__checkmark\"\n    viewBox=\"0 0 24 24\">\n    <path class=\"mdc-checkbox__checkmark-path\"\n    fill=\"none\"\n    d=\"M1.73,12.91 8.1,19.28 22.79,4.59\"/>\n    </svg>\n    <div class=\"mdc-checkbox__mixedmark\"></div>",t.appendChild(a),t.appendChild(n),t}function checkCheckboxInput(e,t){var a=firebase.auth().currentUser.uid,n=indexedDB.open(a);n.onsuccess=function(){var a=n.result,i=a.transaction("users","readwrite").objectStore("users");t.hasOwnProperty("isSelected")&&t.isSelected?(e.target.parentNode.dataset.selected=!1,t.isSelected=!1):(e.target.parentNode.dataset.selected=!0,t.isSelected=!0,document.querySelector(".selector-send span").textContent="send"),i.put(t),0==document.querySelectorAll("[data-selected=\"true\"]").length?(document.querySelector(".selector-send span").textContent="add",document.querySelector(".selector-send").dataset.clicktype="numpad"):document.querySelector(".selector-send").dataset.clicktype=""}}function checkRadioInput(e,t){var a=new mdc.radio.MDCRadio(e.querySelector(".radio-control-selector"));a.root_.classList.add("radio-selected"),a.checked=!0,console.log(t),document.querySelector(".selector-send span").textContent="send",document.querySelector(".selector-send").dataset.clicktype="",a.value=JSON.stringify(t)}function setFilePath(e,t,a){if(document.querySelector(".image--list-li"))return document.getElementById("attachment-picture").src="data:image/jpeg;base64,"+e,void document.getElementById("send-activity").classList.remove("hidden");var n=document.createElement("li");n.className="mdc-image-list__item image--list-li";var i=document.createElement("div"),l=document.createElement("img");l.className="profile-container--main mdc-image-list__image ",l.id="attachment-picture",l.dataset.photoKey=t,l.setAttribute("onerror","handleImageErrorAttachment(this)"),l.src=e?e:"./img/placeholder.png",l.onclick=function(){openImage(this.src)},i.appendChild(l),n.appendChild(i);var r=document.createElement("div");r.className="mdc-image-list__supporting";var c=document.createElement("span");if(c.textContent=t,c.className="mdc-image-list__label",c.id="label--image",r.appendChild(c),n.appendChild(r),a)return n}function readCameraFile(){"Android"===localStorage.getItem("deviceType")?FetchCameraForAttachment.startCamera():webkit.messageHandlers.takeImageForAttachment.postMessage("convert image to base 64")}function openImage(e){if("data"===e.substring(0,4)){document.getElementById("viewImage--dialog-component").querySelector("img").src=e;var t=new mdc.dialog.MDCDialog.attachTo(document.querySelector("#viewImage--dialog-component"));t.show()}}function createActivityCancellation(e){var t=document.createElement("div");if((t.className="status--cancel-cont",!e.hasOwnProperty("create"))&&e.canEdit){if("CANCELLED"===e.status){t.appendChild(createSimpleLi("undo-deleted",{text:"Deleted",id:e.activityId})),document.querySelector(".update-create--activity").appendChild(t);new mdc.ripple.MDCRipple.attachTo(document.querySelector(".undo-deleted"));return}if("CANCELLED"!==e.status){t.appendChild(createSimpleLi("delete",{text:"Delete Activity"})),document.querySelector(".update-create--activity").appendChild(t),document.getElementById("cancel-alert")||cancelAlertDialog();var a=new mdc.dialog.MDCDialog(document.querySelector("#cancel-alert"));document.getElementById("delete-allow").onclick=function(){if("Android"===localStorage.getItem("deviceType"))try{IsGpsEnabled.gpsEnabled()?deleteActivityReq(e.activityId):enableGps()}catch(t){console.log(t)}else deleteActivityReq(e.activityId)},a.listen("MDCDialog:cancel",function(){console.log("canceled")}),document.querySelector(".delete-activity").addEventListener("click",function(e){a.lastFocusedTarget=e.target,a.show()})}}}function deleteActivityReq(e){document.querySelector(".delete-activity").style.display="none",document.querySelector(".status--cancel-cont li").appendChild(loader("cancel-loader")),requestCreator("statusChange",{activityId:e,status:"CANCELLED"})}function cancelAlertDialog(){var e=document.createElement("aside");e.className="mdc-dialog",e.id="cancel-alert";var t=document.createElement("div");t.className="mdc-dialog__surface";var a=document.createElement("section");a.className="mdc-dialog__body",a.textContent="Are you sure you want to delete this activity ? ";var n=document.createElement("footer");n.className="mdc-dialog__footer";var i=document.createElement("button");i.type="button",i.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--accept delete-btn",i.textContent="Delete",i.id="delete-allow";var l=document.createElement("button");l.type="button",l.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--cancel cancel-delete-btn",l.textContent="Cancel",n.appendChild(l),n.appendChild(i),t.appendChild(a),t.appendChild(n),e.appendChild(t);var r=document.createElement("div");r.className="mdc-dialog__backdrop",e.appendChild(r),document.body.appendChild(e)}function sendActivity(e){if(e.hasOwnProperty("create"))return void insertInputsIntoActivity(e);var t=firebase.auth().currentUser.uid,a=indexedDB.open(t);a.onsuccess=function(){var t=a.result,n=t.transaction("activity","readwrite").objectStore("activity");n.get(e.activityId).onsuccess=function(e){var t=e.target.result;insertInputsIntoActivity(t,n)}}}function concatDateWithTime(e,t){var a=moment(e+" "+t);return moment(a).valueOf()}function insertInputsIntoActivity(e){console.log(e);for(var t,a=document.querySelectorAll(".string"),n=0;n<a.length;n++){if(t=a[n].querySelector(".mdc-text-field__input").value,a[n].querySelector(".mdc-text-field__input").required&&checkSpacesInString(t))return void snacks("Please provide an input for the field \u201CName\u201D ");e.attachment[convertIdToKey(a[n].id)].value=t}for(var l,r=document.querySelectorAll(".number"),n=0;n<r.length;n++)l=r[n].querySelector(".mdc-text-field__input").value,e.attachment[convertIdToKey(r[n].id)].value=l;for(var c,d=document.querySelectorAll(".email"),n=0;n<d.length;n++)c=d[n].querySelector(".mdc-text-field__input").value,e.attachment[convertIdToKey(d[n].id)].value=c;for(var s,o=document.querySelectorAll(".HHMM"),n=0;n<o.length;n++)s=o[n].querySelector(".mdc-text-field__input").value,e.attachment[convertIdToKey(o[n].id)].value=s;for(var m=document.querySelectorAll(".image-preview--attachment  img"),p=0;p<m.length;p++)e.attachment[convertKeyToId(m[p].dataset.photoKey)].value=m[p].src;for(var u=void 0,h=void 0,y=void 0,g=void 0,n=1;n<e.schedule.length+1;n++){if(u=getInputText(".start--date"+n).value,h=getInputText(".start--time"+n).value,y=getInputText(".end--date"+n).value,g=getInputText(".end--time"+n).value,console.log(concatDateWithTime(u,h)),!concatDateWithTime(u,h)&&!concatDateWithTime(y,g))return void snacks("Please Select A Start Date and End Date");if(""===u)return void snacks("Please Select a Start Date");if(""===y)return void snacks("Please Select an End Date");if(concatDateWithTime(y,g)<concatDateWithTime(u,h))return void snacks("The End Date and Time should be greater or equal to the start time");e.schedule[n-1].startTime=concatDateWithTime(u,h)||"",e.schedule[n-1].endTime=concatDateWithTime(y,g)||""}for(var n=0;n<e.venue.length;n++)e.venue[n].geopoint={latitude:e.venue[n].geopoint._latitude,longitude:e.venue[n].geopoint._longitude};var v={venue:e.venue,schedule:e.schedule,attachment:e.attachment};if("Android"===localStorage.getItem("deviceType")){try{if(!IsGpsEnabled.gpsEnabled())return void enableGps();sendUpdateReq(v,e)}catch(t){console.log(t)}return}sendUpdateReq(v,e)}function sendUpdateReq(e,t){return t.hasOwnProperty("create")?void(e.office=t.office,e.template=t.template,e.share=t.assignees,document.querySelector("header").appendChild(progressBar()),document.querySelector("#send-activity").classList.add("hidden"),requestCreator("create",e)):(e.activityId=t.activityId,document.querySelector("header").appendChild(progressBar()),document.querySelector("#send-activity").classList.add("hidden"),void requestCreator("update",e))}function checkSpacesInString(e){return!e.replace(/\s/g,"").length}function initSearchForSelectors(e,t,a){if(searchBarUI(t),"map"===t){var n=document.getElementById("search--bar-selector");return autocomplete=new google.maps.places.Autocomplete(n,{componentRestrictions:{country:"in"}}),void initializeAutocompleteGoogle(autocomplete,a.record,a)}"users"===t&&initUserSelectorSearch(e,a)}function searchBarUI(e){var t=document.getElementById("dialog--component"),a=t.querySelector("#action-data");a.className="search--cont",t.querySelector(".mdc-top-app-bar__section--align-end").classList.add("search-field-transform"),t.querySelector(".mdc-top-app-bar__section--align-start").style.backgroundColor="white",document.getElementById("search--bar--field")?document.getElementById("search--bar--field").style.display="block":a.appendChild(createSimpleInput("",!0,!0)),document.getElementById("selector--search").style.display="none",document.querySelector(".selector-send").dataset.clicktype="",document.querySelector(".selector-send span").textContent="send",t.querySelector("#view-type span").dataset.type="back-list","users"===e&&(t.querySelector("#view-type span").dataset.state="user-list-back")}function resetSelectorUI(e){var t=document.getElementById("dialog--component"),a=t.querySelector("#action-data");t.querySelector("#view-type span").dataset.type="",t.querySelector(".mdc-top-app-bar__section--align-end").classList.remove("search-field-transform"),a.querySelector("#search--bar--field").classList.remove("field-input"),a.classList.remove("search--cont"),document.getElementById("selector--search").style.display="block",document.querySelector(".selector-send").style.display="block",document.querySelector("#search--bar--field").style.display="none",t.querySelector(".mdc-top-app-bar__section--align-start").style.backgroundColor="#eeeeee",document.getElementById("data-list--container").style.display="block";var n=new mdc.dialog.MDCDialog(t);"users"===e.store&&(document.getElementById("data-list--container").innerHTML="",fillUsersInSelector(e,n)),"subscriptions"===e.store&&document.getElementById("data-list--container").querySelectorAll("li").forEach(function(e){e.style.display="flex"})}function initializeAutocompleteGoogle(e,t,a){document.querySelector("#dialog--component .mdc-dialog__surface").style.width="100vw",document.querySelector("#dialog--component .mdc-dialog__surface").style.height="100vh",e.addListener("place_changed",function(){var n=e.getPlace();if(!n.geometry)return void snacks("Please select a valid location");var i="";n.address_components&&(i=[n.address_components[0]&&n.address_components[0].short_name||"",n.address_components[1]&&n.address_components[1].short_name||"",n.address_components[2]&&n.address_components[2].short_name||""].join(" ")),console.log(i);var l={primary:n.name,secondary:{address:i,geopoint:{_latitude:n.geometry.location.lat(),_longitude:n.geometry.location.lng()}}};updateDomFromIDB(t,{hash:"venue",key:a.key},l),removeDialog(),console.log(i),console.log(n)})}function createSimpleInput(e,t,a,n,i){if(!t){var l=document.createElement("span");return l.className="data--value-list",l.textContent=e,l}var r=document.createElement("div");r.className=n&&15>n.length?"mdc-text-field data--value-list":"mdc-text-field data--value-list-small";var c=document.createElement("input");c.className="mdc-text-field__input input--value--update",c.style.paddingTop="0px",c.value=e,c.required=i;var d=document.createElement("div");d.className="mdc-line-ripple",a&&(r.id="search--bar--field",c.id="search--bar-selector",r.classList.add("field-input")),r.appendChild(c),r.appendChild(d);new mdc.textField.MDCTextField.attachTo(r);return r}function createNumberInput(e,t){if(!t){var a=document.createElement("span");return a.className="data--value-list",a.textContent=e,a}var n=document.createElement("div");n.className="mdc-text-field data--value-list";var i=document.createElement("input");i.className="mdc-text-field__input input--type-number",i.type="number",i.style.paddingTop="0px",i.value=e,i.setAttribute("onkeypress","return event.charCode >= 48 && event.charCode <= 57");var l=document.createElement("div");return l.className="mdc-line-ripple",n.appendChild(i),n.appendChild(l),n}function createEmailInput(e,t){if(!t){var a=document.createElement("span");return a.className="data--value-list",a.textContent=e,a}var n=document.createElement("div");n.className="mdc-text-field data--value-list";var i=document.createElement("input");i.className="mdc-text-field__input input--type-email",i.type="email",i.placeholder="johndoe@example.com",i.style.paddingTop="0px",i.value=e;var l=document.createElement("div");return l.className="mdc-line-ripple",n.appendChild(i),n.appendChild(l),n}function createTimeInput(e,t,a){if(!t){var n=document.createElement("span");return n.className="data--value-list",n.textContent="date"===a.type?moment(e).calendar():e,n}console.log(t);var i=document.createElement("div");i.className="mdc-text-field";var l=document.createElement("input");l.className="mdc-text-field__input input--type-time",l.type=a.type,l.style.borderBottom="none",l.value="date"===a.type?moment(e).format("YYYY-MM-DD"):e,"time"===a.type&&(i.classList.add("data--value-list"),l.style.width="100%",l.value=e||moment(new Date).format("HH:mm"));var r=document.createElement("div");return r.className="mdc-line-ripple",i.appendChild(l),i.appendChild(r),a.simple?(l.classList.remove("mdc-text-field__input"),l):i}function createSelectMenu(e,t,a){if(!a){var n=document.createElement("span");return n.className="data--value-list",n.textContent=t,n}var l=document.createElement("div");l.className="mdc-select data--value-list",l.style.height="32%;",l.id=convertKeyToId(e),l.dataset.value=e,l.dataset.primary="";var r=document.createElement("select");r.className="mdc-select__native-control",r.style.paddingRight="0px";for(var c,d=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],s=0;s<d.length;s++)c=document.createElement("option"),c.value=d[s],c.textContent=d[s],t===d[s]&&c.setAttribute("selected","true"),r.appendChild(c);var o=document.createElement("label");o.className="mdc-floating-label",o.textContent="";var m=document.createElement("div");return m.className="mdc-line-ripple",l.appendChild(o),l.appendChild(r),l.appendChild(m),l}function showSendActivity(e){console.log(e);var t=document.getElementById("send-activity"),a=t.getBoundingClientRect(),n=document.querySelector(".status--cancel-cont").getBoundingClientRect(),i=!(a.right<n.left||a.left>n.right||a.bottom<n.top||a.top>n.bottom);return console.log(i),i?void t.classList.add("hidden"):void t.classList.remove("hidden")}function toggleActionables(e){if((console.log(e),!!e)&&"create"!==document.getElementById("app-current-panel").dataset.view){var t=indexedDB.open(firebase.auth().currentUser.uid);t.onsuccess=function(){var a=t.result,n=a.transaction("activity").objectStore("activity");n.get(e).onsuccess=function(e){var t=e.target.result,a=document.querySelectorAll(".mdc-fab");t.editable&&(document.querySelector(".loader")&&(document.querySelector(".loader").remove(),document.querySelector(".add--assignee-loader .add--assignee-icon").style.display="block"),document.querySelector(".progress--update")&&document.querySelector(".progress--update").remove())}}}}firebase.initializeApp({apiKey:"AIzaSyA4s7gp7SFid_by1vLVZDmcKbkEcsStBAo",authDomain:"growthfile-207204.firebaseapp.com",databaseURL:"https://growthfile-207204.firebaseio.com",projectId:"growthfile-207204",storageBucket:"growthfile-207204.appspot.com",messagingSenderId:"701025551237"}),window.addEventListener("load",function(){window.onerror=function(e,t,a,n,i){requestCreator("instant",{message:{msg:e,url:t,lineNo:a,columnNo:n,error:i}})},startApp()});function initSW(){navigator.serviceWorker.register("/syncWorker.js").then(function(e){e.addEventListener("updatefound",function(){var t=e.installing;console.log("A new service worker is being installed:",t)}),startApp(),console.log("ServiceWorker registration successful with scope: ",e.scope)},function(e){console.log("ServiceWorker registration failed: ",e)})}function firebaseUiConfig(e){return{callbacks:{signInSuccess:function(t){return!!e&&void updateEmail(t,e)},signInFailure:function(e){return handleUIError(e)}},signInFlow:"popup",signInOptions:[{provider:firebase.auth.PhoneAuthProvider.PROVIDER_ID,recaptchaParameters:{type:"image",size:"invisible",badge:"bottomleft"},defaultCountry:"IN"}]}}function userSignedOut(){var e=document.createElement("div");e.id="login-container",document.body.appendChild(e);var t=new firebaseui.auth.AuthUI(firebase.auth()||"");t.start("#login-container",firebaseUiConfig())}function layoutGrid(){var e=document.createElement("div");e.classList.add("mdc-layout-grid","mdc-typography","app"),e.id="main-layout-app";var t=document.createElement("div");t.className="mdc-layout-grid__inner cell-space";var a=document.createElement("div");a.id="header";var n=document.createElement("div");n.id="app-current-panel",n.className="mdc-layout-grid__cell--span-12";var i=document.createElement("div");i.id="snackbar-container";var l=document.createElement("div");l.className="drawer--cont",t.appendChild(a),t.appendChild(n),t.appendChild(i),e.appendChild(t),document.body.innerHTML=e.outerHTML,imageViewDialog()}function imageViewDialog(){var e=document.createElement("aside");e.id="viewImage--dialog-component",e.className="mdc-dialog",e.role="alertdialog";var t=document.createElement("div");t.className="mdc-dialog__surface";var a=document.createElement("section");a.className="mdc-dialog__content";var n=document.createElement("img");n.src="",n.style.width="100%",a.appendChild(n),t.appendChild(a),e.appendChild(t);var i=document.createElement("div");i.className="mdc-dialog__backdrop",e.appendChild(i),document.body.appendChild(e)}moment.locale("en",{calendar:{lastDay:"[yesterday]",sameDay:"LT",nextDay:"[Tomorrow at] LT",lastWeek:"dddd",nextWeek:"dddd [at] LT",sameElse:"L"},months:["January","February","March","April","May","June","July","August","September","October","November","December"]}),window.scrollBy({top:100,left:0,behavior:"smooth"});function startApp(){return layoutGrid(),window.Worker||window.indexedDB?void(console.log(firebase),firebase.auth().onAuthStateChanged(function(e){if(!e)return document.getElementById("main-layout-app").style.display="none",void userSignedOut();if(document.getElementById("main-layout-app").style.display="block",localStorage.getItem("dbexist"))return(listView(!0),"Android"===localStorage.getItem("deviceType"))?(requestCreator("now",AndroidId.getDeviceId()),void manageLocation()):(requestCreator("now","localStorage.getItem('iosUUID')"),void manageLocation());console.log(e),document.getElementById("app-current-panel").appendChild(loader("init-loader")),localStorage.setItem("dbexist",e.uid);var t="";try{t=AndroidId.getDeviceId(),requestCreator("now",t),localStorage.setItem("deviceType","Android")}catch(t){localStorage.setItem("deviceType","Ios"),requestCreator("now","localStorage.getItem('iosUUID')")}})):(snacks("Please upgrade your android version"),void firebase.auth().signOut().catch(signOutError))}window.onpopstate=function(e){if(e.state)if("listView"!==e.state[0]&&"conversation"!==e.state[0]&&"updateCreateActivity"!==e.state[0]){var t=indexedDB.open(localStorage.getItem("dbexist"));t.onsuccess=function(){var a=t.result;window[e.state[0]](e.state[1],a,!1)}}else"listView"===e.state[0]?window[e.state[0]](!0):window[e.state[0]](e.state[1],!1)};function backNav(){history.back()}function UserCanExitApp(){FetchHistory.stateView(!0)}function listView(e){document.querySelector(".init-loader")&&document.querySelector(".init-loader").remove(),e&&history.pushState(["listView"],null,null),listPanel();var t=localStorage.getItem("dbexist"),a=indexedDB.open(t);a.onsuccess=function(){var e=a.result,n=e.transaction(["root"],"readwrite"),i=n.objectStore("root");i.get(t).onsuccess=function(t){var a=t.target.result;document.querySelector(".mdc-drawer--temporary")||initMenu(e,a.offices),creatListHeader("Recent"),fetchDataForActivityList(e)}}}function fetchDataForActivityList(e){var t="",a=document.getElementById("activty--list"),n=e.transaction("activity"),i=n.objectStore("activity"),l=i.index("timestamp"),r=document.querySelector(".mdc-drawer--temporary").dataset.currentOffice;l.openCursor(null,"prev").onsuccess=function(a){var n=a.target.result;if(!n){var i=window.pageYOffset;return void setTimeout(function(){appendActivityListToDom(t,!0),createActivityIcon(e),scrollToActivity(i)},100)}"all"===r?"subscription"!==n.value.template&&0===n.value.hidden&&createActivityList(e,n.value).then(function(e){t+=e}):"subscription"!==n.value.template&&0===n.value.hidden&&n.value.office===r&&createActivityList(e,n.value).then(function(e){t+=e}),n.continue()}}function createActivityList(e,t,a){return new Promise(function(n){getCount(e,t.activityId).then(function(i){getCommentUndUser(e,t.activityId,t.creator).then(function(l){getCreatorDetails(e,l).then(function(e){e.count=i,n(activityListUI(t,e,a))})})})})}function getCount(e,t){return new Promise(function(a){var n=e.transaction("activityCount","readonly").objectStore("activityCount");n.get(t).onsuccess=function(e){var t=e.target.result;t?a(t.count):a(0)}})}function getCommentUndUser(e,t,a){var n={creator:a,comment:"",commentUser:""};return new Promise(function(a){var i=e.transaction("addendum").objectStore("addendum").index("activityId");i.openCursor(t,"prev").onsuccess=function(t){var i=t.target.result;i?i.value.isComment?(n.comment=i.value.comment,readNameFromNumber(e,i.value.user).then(function(e){n.commentUser=e,a(n)})):(n.comment=i.value.comment,a(n)):a(n)}})}function getCreatorDetails(e,t){return new Promise(function(a){if(t.creator===firebase.auth().currentUser.phoneNumber)t.creator={photo:firebase.auth().currentUser.photoURL||"./img/empty-user.jpg",number:t.creator},a(t);else{var n=e.transaction("users").objectStore("users");n.get(t.creator).onsuccess=function(e){var n=e.target.result;t.creator=n&&n.hasOwnProperty("photoURL")?{photo:e.target.result.photoURL||"./img/empty-user.jpg",number:t.creator}:{photo:"./img/empty-user.jpg",number:t.creator},a(t)}}})}function activityListUI(e,t,a){var n=document.createElement("li");n.dataset.id=e.activityId,n.setAttribute("onclick","localStorage.setItem('clickedActivity',this.dataset.id);conversation(this.dataset.id,true)");var i=document.createElement("img");i.dataset.number=t.creator.number,i.className="mdc-list-item__graphic material-icons",i.setAttribute("onerror","handleImageError(this)"),i.src=t.creator.photo;var l=document.createElement("span");l.classList.add("mdc-list-item__text");var r=document.createElement("span");r.className="mdc-list-item__primary-text bigBlackBold",r.textContent=e.activityName;var c=document.createElement("span");c.className="mdc-list-item__secondary-text",c.textContent=t.commentUser?t.commentUser+" : "+t.comment:""+t.comment,l.appendChild(r),l.appendChild(c);var d=document.createElement("span");if(d.classList.add("mdc-list-item__meta"),0!==t.count){var s=document.createElement("div"),o=document.createElement("span");o.textContent=t.count,o.className="count mdc-meta__custom-text",s.appendChild(o),n.classList.add("mdc-list-item","activity--list-item","count-active","mdc-elevation--z1"),d.appendChild(s)}else{var m=document.createElement("div");m.className="mdc-meta__custom-text",m.style.width="80px",m.style.fontSize="14px",m.textContent=moment(e.timestamp).calendar(),n.classList.add("mdc-list-item","activity--list-item","mdc-elevation--z1"),d.appendChild(m)}var p=document.createElement("span");p.classList.add("mdc-list-item__secondary-text","status-in-activity",""+e.status);var u=document.createElement("i");u.className="material-icons";var h=document.createElement("i");h.classList.add("status-cancel","material-icons"),h.appendChild(document.createTextNode("clear"));var y=document.createElement("i");return(y.classList.add("status-confirmed","material-icons"),y.appendChild(document.createTextNode("check")),"CONFIRMED"===e.status&&p.appendChild(y),"CANCELLED"===e.status&&p.appendChild(h),d.appendChild(p),a)?(n.appendChild(i),n.appendChild(l),n.appendChild(d),n):(n.innerHTML+=i.outerHTML+l.outerHTML+d.outerHTML,n.outerHTML)}function appendActivityListToDom(e,t,a){t||(listPanel(),creatListHeader(a,!t)),document.getElementById("activity--list").innerHTML=e}function createActivityIcon(e){var t=e.transaction(["subscriptions"]).objectStore("subscriptions"),a=t.count();a.onsuccess=function(){if(a.result){var e=document.createElement("button");e.className="mdc-fab create-activity",e.setAttribute("aria-label","Add");var t=document.createElement("span");t.className="mdc-fab_icon material-icons",t.textContent="add",e.appendChild(t),document.getElementById("activity--list").appendChild(e),document.querySelector(".create-activity").addEventListener("click",function(e){selectorUI(e,{record:"",store:"subscriptions"})})}}}function listPanel(){if(!document.getElementById("activity-list-main")){var e=document.createElement("div");e.className="mdc-card panel-card mdc-top-app-bar--fixed-adjust",e.id="activity-list-main";var t=document.createElement("ul");t.className="mdc-list mdc-list--two-line mdc-list--avatar-list",t.id="activity--list",e.appendChild(t),document.getElementById("app-current-panel").innerHTML=e.outerHTML}}function creatListHeader(e,t){var a=document.createElement("div");a.className="drawer--icons";var n=document.createElement("span");n.id="menu--panel";var i=document.createElement("i");i.className="material-icons",i.textContent=t?"keyboard_backspace":"menu";var l=document.createElement("span");l.className="current--selcted-filter",l.textContent="Cancelled"===e?"Trash":e,n.appendChild(i),n.appendChild(l),a.appendChild(n);var r=document.createElement("span");r.id="search--panel";var c=document.createElement("i");c.className="material-icons",c.textContent="search",r.appendChild(c),header(a.outerHTML,"","list");var d=new mdc.drawer.MDCTemporaryDrawer(document.querySelector(".mdc-drawer--temporary"));document.getElementById("menu--panel").addEventListener("click",function(){return t?void backNav():void(d.open=!0,sendCurrentViewNameToAndroid("drawer"))})}function scrollToActivity(e){return localStorage.getItem("clickedActivity")?(document.querySelector("[data-id=\""+localStorage.getItem("clickedActivity")+"\"]").scrollIntoView({behavior:"instant",block:"center",inline:"center"}),void localStorage.removeItem("clickedActivity")):0==e?(localStorage.removeItem("clickedActivity"),void window.scrollTo(0,0)):void(0<e&&window.scrollTo(0,e))}function initMenu(e,t){var a=document.createElement("aside");a.className="mdc-drawer mdc-drawer--temporary mdc-typography",a.dataset.currentOffice=t?t.allOffices[0]:"all";var n=document.createElement("nav");n.className="mdc-drawer__drawer";var l=document.createElement("header");l.className="mdc-drawer__header drawer--header";var r=document.createElement("div");r.className="mdc-drawer__header-content";var c=document.createElement("div");c.className="drawer--header-div",c.onclick=function(){profileView(!0)};var d=document.createElement("img");d.className="drawer-header-icon",d.src=firebase.auth().currentUser.photoURL||"./img/empty-user.jpg",d.setAttribute("onerror","handleImageError(this)");var s=document.createElement("div");s.className="header--details";var o=document.createElement("div");o.className="mdc-typography--subtitle",o.textContent=firebase.auth().currentUser.displayName||firebase.auth().currentUser.phoneNumber;var m=document.createElement("div");m.textContent=t?t.allOffices[0]:"",m.className="mdc-typography--caption current--office-name";var p=document.createElement("div");s.appendChild(p),s.appendChild(o),s.appendChild(m),t&&t.hasMultipleOffice&&(p.className="material-icons",p.style.float="right",p.textContent="arrow_drop_down",p.onclick=function(){document.querySelector(".office-selection-lists")||createOfficeSelectionUI(t.allOffices,e)}),c.appendChild(d),r.appendChild(c),r.appendChild(s),l.appendChild(r);var u=document.createElement("nav");if(u.className="mdc-drawer__content mdc-list filter-sort--list",t&&t.hasMultipleOffice){var h=document.createElement("div");h.className="mdc-list-item mdc-list-item--activated";var y=document.createElement("i");y.className="material-icons mdc-list-item__graphic drawer--icons",y.setAttribute("aria-hidden","true"),y.textContent="all_inbox";var i=document.createElement("span");i.textContent="All offices",h.onclick=function(){var t=new mdc.drawer.MDCTemporaryDrawer(document.querySelector(".mdc-drawer--temporary"));allOffices("All Offices",e,!0),t.open=!1},h.appendChild(y),h.appendChild(i),u.appendChild(h)}[{type:"Incoming",icon:"call_received"},{type:"Outgoing",icon:"call_made"},{type:"Urgent",icon:"star_rate"},{type:"Recent",icon:"watch_later"},{type:"Nearby",icon:"near_me"},{type:"Pending",icon:""},{type:"Cancelled",icon:"delete"}].forEach(function(t){var n=document.createElement("div");n.className="mdc-list-item mdc-list-item--activated";var a=document.createElement("i");a.className="material-icons mdc-list-item__graphic drawer--icons",a.setAttribute("aria-hidden","true"),a.textContent=t.icon;var i=document.createElement("span");i.textContent="Cancelled"===t.type?"Trash":t.type,n.appendChild(a),n.appendChild(i),n.onclick=function(){window.scrollTo(0,0),("Pending"===t.type||"Cancelled"===t.type)&&filterActivities(t.type,e,!0),("Incoming"===t.type||"Outgoing"===t.type)&&sortByCreator(t.type,e,!0),"Urgent"===t.type&&sortByDates(t.type,e,!0),"Nearby"===t.type&&sortByLocation(t.type,e,!0),"Recent"===t.type&&listView();var a=new mdc.drawer.MDCTemporaryDrawer(document.querySelector(".mdc-drawer--temporary"));a.open=!1,sendCurrentViewNameToAndroid("listView"),document.querySelector(".current--selcted-filter").textContent=t.type},u.appendChild(n)}),n.appendChild(l),n.appendChild(u),a.appendChild(n),document.body.appendChild(a)}function createOfficeSelectionUI(e){document.querySelector(".filter-sort--list").classList.add("hidden");var t=document.createElement("nav");t.className="mdc-drawer__content mdc-list office-selection-lists",document.querySelector(".mdc-drawer__drawer").appendChild(t),e.forEach(function(e){if(e!==document.querySelector(".mdc-drawer--temporary").dataset.currentOffice&&!document.querySelector(".different-office-link")){var n=document.createElement("div");n.className="mdc-list-item mdc-list-item--activated different-office-link";var a=document.createElement("span");a.textContent=e,n.appendChild(a),n.onclick=function(){document.querySelector(".filter-sort--list").classList.remove("hidden"),t.remove();var a=new mdc.drawer.MDCTemporaryDrawer.attachTo(document.querySelector(".mdc-drawer--temporary"));a.root_.dataset.currentOffice=e,document.querySelector(".current--office-name").textContent=e,listView(),a.open=!1},t.appendChild(n)}})}function allOffices(e,t,a){a&&history.pushState(["allOffices",e],null,null);var n=t.transaction("activity").objectStore("activity").index("timestamp"),i="";n.openCursor(null,"prev").onsuccess=function(a){var n=a.target.result;return n?void("subscription"!==n.value.template&&0===n.value.hidden&&createActivityList(t,n.value).then(function(e){i+=e}),n.continue()):(appendActivityListToDom(i,!1,e),void createActivityIcon(t))}}function filterActivities(e,t,a){a?history.pushState(["filterActivities",e],null,null):history.replaceState(["filterActivities",e],null,null);var n=t.transaction("activity").objectStore("activity").index("timestamp"),i=document.querySelector(".mdc-drawer--temporary").dataset.currentOffice,l="";n.openCursor(null,"prev").onsuccess=function(a){var n=a.target.result;if(!n){var r=window.pageYOffset;return void setTimeout(function(){appendActivityListToDom(l,!1,e),createActivityIcon(t),scrollToActivity(r)},300)}n.value.status===e.toUpperCase()&&n.value.office===i&&"subscription"!==n.value.template&&0===n.value.hidden&&createActivityList(t,n.value).then(function(e){l+=e}),n.continue()}}function sortByCreator(e,t,a){a?history.pushState(["sortByCreator",e],null,null):history.replaceState(["sortByCreator",e],null,null);var n=t.transaction("activity").objectStore("activity").index("timestamp"),i=document.querySelector(".mdc-drawer--temporary").dataset.currentOffice,l="",r=firebase.auth().currentUser.phoneNumber;n.openCursor(null,"prev").onsuccess=function(a){var n=a.target.result;if(!n){var c=window.pageYOffset;return void setTimeout(function(){appendActivityListToDom(l,!1,e),createActivityIcon(t),scrollToActivity(c)},200)}"Incoming"===e&&n.value.creator!==r&&n.value.office===i&&"subscription"!==n.value.template&&0===n.value.hidden&&createActivityList(t,n.value).then(function(e){l+=e}),"Outgoing"===e&&n.value.creator===r&&n.value.office===i&&"subscription"!==n.value.template&&0===n.value.hidden&&createActivityList(t,n.value).then(function(e){l+=e}),n.continue()}}function sortByDates(e,t,a){a?history.pushState(["sortByDates",e],null,null):history.replaceState(["sortByDates",e],null,null);var n=document.querySelector(".mdc-drawer--temporary").dataset.currentOffice,i=moment().format("YYYY-MM-DD"),l={HIGH:[],LOW:[]},r=t.transaction("calendar").objectStore("calendar").index("range");r.openCursor().onsuccess=function(e){var t=e.target.result;return t?void(i>=t.value.start&&i<=t.value.end&&t.value.office===n?l.HIGH.push(t.value):l.LOW.push(t.value),t.continue()):(l.HIGH.sort(function(e,t){return moment(t.start).valueOf()-moment(e.start).valueOf()}),l.LOW.sort(function(e,t){return moment(t.end).valueOf()-moment(e.end).valueOf()}),void generateActivitiesByDate(sortBykeys(l)))}}function generateActivitiesByDate(e){var t=firebase.auth().currentUser.uid,a=indexedDB.open(t),n="";a.onsuccess=function(){var t=a.result,i=t.transaction("activity").objectStore("activity");Object.keys(e.HIGH).forEach(function(e){i.get(e).onsuccess=function(e){var a=e.target.result;createActivityList(t,a).then(function(e){n+=e})}}),Object.keys(e.LOW).forEach(function(e){i.get(e).onsuccess=function(e){var a=e.target.result;createActivityList(t,a).then(function(e){n+=e})}}),setTimeout(function(){var e=window.pageYOffset;appendActivityListToDom(n,!1,"Urgent"),createActivityIcon(t),scrollToActivity(e)},600)}}function sortBykeys(e){console.log(e);for(var t=e.LOW,a=e.HIGH,n={LOW:{},HIGH:{}},i=t.length,l=0;l<i;l++)key=t[l],n.LOW.hasOwnProperty(key.activityId)||(n.LOW[key.activityId]=key);for(var r=a.length,c=0;c<r;c++)key=a[c],n.HIGH.hasOwnProperty(key.activityId)||(n.HIGH[key.activityId]=key);return n}function sortByLocation(e,t,a){a?history.pushState(["sortByLocation",e],null,null):history.replaceState(["sortByLocation",e],null,null);var n=firebase.auth().currentUser.uid,i=new Worker("js/nearestLocationHandler.js");i.postMessage({dbName:n}),i.onmessage=function(e){sortActivitiesByLocation(t,e.data)},i.onerror=locationSortError}function sortActivitiesByLocation(e,t){for(var a="",n=document.querySelector(".mdc-drawer--temporary").dataset.currentOffice,l=e.transaction("activity").objectStore("activity"),r=0;r<t.length;r++)l.get(t[r].activityId).onsuccess=function(t){t.target.result.office===n&&"CANCELLED"!==t.target.result&&createActivityList(e,t.target.result).then(function(e){a+=e})};setTimeout(function(){var t=window.pageYOffset;appendActivityListToDom(a,!1,"Nearby"),createActivityIcon(e),scrollToActivity(t)},500)}function locationSortError(e){console.log(e)}function header(e,t,a){var n=document.createElement("header");n.className="mdc-top-app-bar mdc-top-app-bar--fixed mdc-elevation--z1","list"===a&&n.classList.add("header-list--gray");var i=document.createElement("div");i.className="mdc-top-app-bar__row";var l=document.createElement("section");l.className="mdc-top-app-bar__section mdc-top-app-bar__section--align-start";var r=document.createElement("div");r.id="view-type",r.innerHTML=e,l.appendChild(r);var c=document.createElement("div");c.className="mdc-top-app-bar__section mdc-top-app-bar__section--align-end";var d=document.createElement("div");return d.id="action-data",t&&(d.innerHTML=t),c.appendChild(d),i.appendChild(l),i.appendChild(c),n.innerHTML=i.outerHTML,"selector"===a?n:void(document.getElementById("header").innerHTML=n.outerHTML)}function backIconHeader(e){var t=document.createElement("span");t.id=e;var a=document.createElement("i");a.className="material-icons",a.textContent="arrow_back",t.appendChild(a),header(t.outerHTML)}function createInputForProfile(e,t,a){var n=document.createElement("div");n.className="mdc-text-field mdc-text-field--dense "+a+" attachment--text-field",n.dataset.key=e,n.dataset.type=t,n.id=e.replace(/\s/g,"");var i=document.createElement("input");i.className="mdc-text-field__input",t&&"displayName"===e&&(i.placeholder="Your Name"),t&&"email"===e&&(i.placeholder="Your Email");var l=document.createElement("div");return l.className="mdc-line-ripple",n.appendChild(i),n.appendChild(l),n}var _typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(e){return"undefined"==typeof e?"undefined":_typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":"undefined"==typeof e?"undefined":_typeof2(e)};function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function profileView(e){e&&history.pushState(["profileView"],null,null);var t=new mdc.drawer.MDCTemporaryDrawer(document.querySelector(".mdc-drawer--temporary"));t.open=!1,document.body.style.backgroundColor="#eeeeee";var a=firebase.auth().currentUser,n=a.uid,i=indexedDB.open(n);i.onsuccess=function(){var e=i.result,t=e.transaction(["root"],"readwrite"),l=t.objectStore("root");l.get(n).onsuccess=function(e){var n=e.target.result;n.view="profile",l.put(n),t.oncomplete=function(){createProfileHeader(),createProfilePanel(),disableInputs(),document.getElementById("close-profile--panel").addEventListener("click",function(){backNav()}),showProfilePicture(firebase.auth().currentUser.photoURL),inputFile("uploadProfileImage").addEventListener("change",readUploadedFile),changeDisplayName(a),changeEmailAddress(a)}}},sendCurrentViewNameToAndroid("profile")}function createProfileHeader(){var e=document.createElement("span");e.id="close-profile--panel";var t=document.createElement("i");t.className="material-icons",t.textContent="arrow_back",e.appendChild(t),header(e.outerHTML)}function createProfilePanel(){var e=document.createElement("div");e.id="profile-view--container",e.className="mdc-top-app-bar--fixed-adjust mdc-theme--background";var t=document.createElement("button");t.className="mdc-fab";var a=document.createElement("label");a.setAttribute("for","uploadProfileImage");var n=document.createElement("span");n.className="mdc-fab__icon material-icons",n.textContent="add_a_photo",a.appendChild(n),t.appendChild(a);var i=document.createElement("input");i.type="file",i.style.display="none",i.id="uploadProfileImage",i.accept="accept=\"image/png,image/jpeg;capture=camera";var l=document.createElement("div");l.id="profile--image-container",l.className="profile-container--main";var r=document.createElement("img");r.src=firebase.auth().currentUser.photoURL,r.id="user-profile--image",r.setAttribute("onerror","handleImageError(this)");var c=document.createElement("div");c.className="insert-overlay",l.appendChild(r),l.appendChild(c),l.appendChild(t),l.appendChild(i);var d=document.createElement("div");d.id="name--change-container",d.className="profile-psuedo-card";var s=document.createElement("button");s.className="mdc-icon-button material-icons",s.id="edit--name",s.setAttribute("aria-hidden","true"),s.setAttribute("aria-pressed","false"),s.setAttribute("data-toggle-on-content","check"),s.setAttribute("data-toggle-on-label","check"),s.setAttribute("data-toggle-off-content","edit"),s.setAttribute("data-toggle-off-label","displayName"),s.textContent="edit",d.appendChild(createInputForProfile("displayName","Name")),d.appendChild(s);var o=document.createElement("div");o.id="email--change-container",o.className="profile-psuedo-card";var m=document.createElement("button");m.className="mdc-icon-button material-icons",m.id="edit--email",m.setAttribute("aria-hidden","true"),m.setAttribute("aria-pressed","false"),m.setAttribute("data-toggle-on-content","check"),m.setAttribute("data-toggle-on-label","check"),m.setAttribute("data-toggle-off-content","edit"),m.setAttribute("data-toggle-off-label","updateEmail"),m.textContent="email",o.appendChild(createInputForProfile("email","Email")),o.appendChild(m);var p=document.createElement("div");p.id="ui-auth",p.className="";var u=document.createElement("div");u.id="change--number-container";var h=document.createElement("div");h.id="phone-number--change-container",h.className="mdc-layout-grid__inner",u.appendChild(h),e.appendChild(l),e.appendChild(d),e.appendChild(o),e.appendChild(p),e.appendChild(u),document.getElementById("app-current-panel").innerHTML=e.outerHTML}function toggleIconData(e,t){var a=document.getElementById(e),n=new mdc.iconButton.MDCIconButtonToggle(a);n.root_.addEventListener("MDCIconButtonToggle:change",function(e){var a=e.detail;if(!a.isOn){t.input_.disabled=!0,t.input_.style.borderBottom="none";var n=this.dataset.toggleOffLabel,i=t.value;handleFieldInput(n,i),t.lineRipple_.deactivate()}else console.log(t),t.input_.style.borderBottom="1px solid rgba(0,0,0,.42)",t.input_.disabled=!1,t.lineRipple_.activate(),"Android"===localStorage.getItem("deviceType")?openAndroidKeyboard.startKeyboard():"",t.input_.focus()})}function handleFieldInput(e,t){var a=firebase.auth().currentUser;if(console.log("undefined"==typeof t?"undefined":_typeof(t)),"displayName"===e&&a.updateProfile(_defineProperty({},e,t)).then(function(){successDialog()}).catch(authUpdatedError),"updateEmail"===e){if(t===firebase.auth().currentUser.email)return void snacks("This email address already exists");5>=timeDiff(firebase.auth().currentUser.metadata.lastSignInTime)?(console.log("less than 5"),updateEmail(firebase.auth().currentUser,t)):newSignIn(t)}}function timeDiff(e){var t=moment().format("YYY-MM-DD HH:mm"),a=moment(e).format("YYY-MM-DD HH:mm");return moment(t).diff(moment(a),"minutes")}function newSignIn(e){var t=document.createElement("div");t.id="refresh-login",t.className="mdc-elevation--z3",document.getElementById("ui-auth").innerHTML=t.outerHTML;var a=new firebaseui.auth.AuthUI(firebase.auth());a.start("#refresh-login",firebaseUiConfig(e)),setTimeout(function(){document.querySelector(".firebaseui-id-phone-number").value=firebase.auth().currentUser.phoneNumber,document.querySelector(".firebaseui-id-phone-number").disabled=!0,document.querySelector(".firebaseui-label").remove()},300)}function readUploadedFile(e){console.log(e);var t=e.target.files[0],a=new FileReader;t&&(a.readAsDataURL(t),processImage(t))}function processImage(e){var t=firebase.auth().currentUser.uid,a=firebase.storage().ref("ProfileImage/"+t),n=a.put(e,{cacheControl:"public,max-age=31536000",contentType:"image/jpeg"});n.on(firebase.storage.TaskEvent.STATE_CHANGED,function(){if(firebase.storage.TaskState.RUNNING){if(document.querySelector("#profile--image-container .loader"))return;document.querySelector(".insert-overlay").classList.add("middle"),document.getElementById("profile--image-container").appendChild(loader()),document.querySelector("#profile--image-container .loader").classList.add("profile--loader")}},function(e){console.log(e);requestCreator("instant",{message:e})},function(){n.snapshot.ref.getDownloadURL().then(updateAuth)})}function updateAuth(e){console.log(e);var t=firebase.auth().currentUser;t.updateProfile({photoURL:e}).then(function(){removeLoader(e)}).catch(authUpdatedError)}function removeLoader(e){document.querySelector(".insert-overlay").classList.remove("middle");var t=document.getElementById("profile--image-container");t.children[0].classList.add("reset-opacity"),t.removeChild(t.lastChild),showProfilePicture(e)}function showProfilePicture(e){firebase.auth().currentUser;document.getElementById("user-profile--image").src=e||"../img/empty-user.jpg",document.querySelector(".drawer-header-icon").src=e||"../img/empty-user.jpg"}function authUpdatedError(e){snacks(e.message)}function changeDisplayName(e){var t=getInputText("#displayName");e.displayName&&(t.value=e.displayName),toggleIconData("edit--name",t)}function changeEmailAddress(e){var t=getInputText("#email");e.email&&(t.value=e.email),toggleIconData("edit--email",t)}function updateEmail(e,t){console.log(t),e.updateEmail(t).then(emailUpdateSuccess).catch(authUpdatedError)}function emailUpdateSuccess(){var e=firebase.auth().currentUser;console.log(e),e.sendEmailVerification().then(emailVerificationSuccess).catch(emailVerificationError)}function emailVerificationSuccess(){successDialog(),snacks("Verification link has been send to your email address")}function emailVerificationError(e){snacks(e.message)}function handleReauthError(e){console.log(e)}function disableInputs(){getInputText("#displayName").input_.disabled=!0,getInputText("#email").input_.disabled=!0}function initUserSelectorSearch(t,a){var n=document.getElementById("search--bar-selector");n.value="";var i="",l=document.createDocumentFragment(),r={},c=a.record.assignees;c.forEach(function(e){r[e]=""}),n.addEventListener("input",function(n){var e=n.target.value;return isNumber(e)?(i=t.transaction("users").objectStore("users"),void searchUsersDB(formatNumber(e),i,l,r,a)):void(l=document.createDocumentFragment(),i=t.transaction("users").objectStore("users").index("displayName"),searchUsersDB(formatName(e),i,l,r,a))})}function isNumber(e){return!isNaN(e)}function formatNumber(e){var t=e;return"91"===t.substring(0,2)?t="+"+t:"+91"!==t.substring(0,3)&&(t="+91"+t),t}function formatName(e){var t=e.split(" "),a=t.length,n=[],i=0;for(i=0;i<a;i++){var l=t[i];if(l.charAt(0).toUpperCase()===e.charAt(0).toUpperCase)return e;n.push(l.charAt(0).toUpperCase()+l.slice(1))}return n.join(" ")}function checkNumber(e){var t=/^\+[1-9]\d{11,14}$/;return t.test(e)}function searchUsersDB(e,t,a,n,i){console.log(e);var l=IDBKeyRange.bound(e,e+"\uFFFF"),r=document.getElementById("data-list--container");t.openCursor(l).onsuccess=function(e){var t=e.target.result;if(!t){if(r.innerHTML="",0==a.children.length){var l=document.createElement("div");l.className="data-not-found";var c=document.createElement("p");return c.textContent="No Contact Found",c.className="mdc-typography--headline5",l.appendChild(c),void(document.querySelector(".data-not-found")||r.appendChild(l))}r.appendChild(a);var d=document.querySelectorAll("[data-selected=\"true\"]");return void d.forEach(function(e){var t=new mdc.checkbox.MDCCheckbox.attachTo(e);t.checked=!0,e.children[1].style.animation="none",e.children[1].children[0].children[0].style.animation="none"})}i.attachment.present?a.appendChild(createSimpleAssigneeLi(t.value,!0,!1)):!n.hasOwnProperty(t.value.mobile)&&a.appendChild(createSimpleAssigneeLi(t.value,!0,!0)),t.continue()}}var offset="";function handleImageError(e){e.onerror=null,e.src="./img/empty-user.jpg";var t=window.indexedDB.open(firebase.auth().currentUser.uid);return t.onsuccess=function(){var a=t.result,n=a.transaction("users","readwrite"),i=n.objectStore("users");i.get(e.dataset.number).onsuccess=function(e){var t=e.target.result;0==t.isUpdated||(t.isUpdated=0,i.put(t))}},!0}function handleImageErrorAttachment(e){return e.onerror=null,e.src="./img/placeholder.png",!0}function loader(e){var t=document.createElement("div");return t.className="loader "+e,t}function successDialog(){var e=document.createElement("aside");e.className="mdc-dialog mdc-dialog--open success--dialog",e.id="success--dialog";var t=document.createElement("div");t.className="mdc-dialog__surface round--surface";var a=document.createElement("section");a.className="mdc-dialog__body";var n=document.createElement("div");n.className="success--container";var i=document.createElement("div");i.className="success--check",n.appendChild(i),a.appendChild(n),t.appendChild(a),e.appendChild(t),document.body.appendChild(e);var l=new mdc.dialog.MDCDialog(document.querySelector("#success--dialog"));l.show(),setTimeout(function(){document.getElementById("success--dialog").remove(),document.body.classList.remove("mdc-dialog-scroll-lock")},1200)}function enableGps(e){if(!document.getElementById("enable-gps")){var t=document.createElement("aside");t.className="mdc-dialog mdc-dialog--open",t.id="enable-gps";var a=document.createElement("div");a.className="mdc-dialog__surface",a.style.width="90%",a.style.height="auto";var n=document.createElement("section");n.className="mdc-dialog__body mock-main-body",n.textContent=e;var i=document.createElement("footer");i.className="mdc-dialog__footer mock-footer";var l=document.createElement("button");l.type="button",l.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--cancel",l.textContent="Ok",l.id="",l.style.backgroundColor="#3498db",i.appendChild(l),a.appendChild(n),a.appendChild(i),t.appendChild(a),document.body.appendChild(t)}var r=new mdc.dialog.MDCDialog(document.querySelector("#enable-gps"));r.show()}function progressBar(){var e=document.createElement("div");e.className="mdc-linear-progress mdc-linear-progress--indeterminate progress--update",e.role="progressbar";var t=document.createElement("div");t.className="mdc-linear-progress__buffering-dots";var a=document.createElement("div");a.className="mdc-linear-progress__buffer";var n=document.createElement("div");n.className="mdc-linear-progress__bar mdc-linear-progress__primary-bar";var i=document.createElement("span");i.className="mdc-linear-progress__bar-inner",n.appendChild(i);var l=document.createElement("div");l.className="mdc-linear-progress__bar mdc-linear-progress__secondary-bar";var r=document.createElement("span");return r.className="mdc-linear-progress__bar-inner",l.appendChild(r),e.appendChild(t),e.appendChild(a),e.appendChild(n),e.appendChild(l),e}function snacks(e,t){var a=document.createElement("div");a.className="mdc-snackbar",a.setAttribute("aria-live","assertive"),a.setAttribute("aria-atomic","true"),a.setAttribute("aria-hidden","true");var n=document.createElement("div");n.className="mdc-snackbar__text mdc-typography--subtitle2";var i=document.createElement("div");i.className="mdc-snackbar__action-wrapper";var l=document.createElement("button");l.className="mdc-snackbar__action-button",i.appendChild(l),a.appendChild(n),a.appendChild(i),document.getElementById("snackbar-container").innerHTML=a.outerHTML;var r={message:e,actionText:t?t.btn:"OK",timeout:1e4,actionHandler:function(){t&&requestCreator("statusChange",{activityId:t.id,status:"PENDING"})}},c=mdc.snackbar.MDCSnackbar.attachTo(document.querySelector(".mdc-snackbar"));c.show(r)}function fetchCurrentTime(e){return Date.now()+e}function geolocationApi(e,t,a){return new Promise(function(n,i){var l=new XMLHttpRequest;l.open(e,t,!0),l.setRequestHeader("Content-Type","application/json"),l.onreadystatechange=function(){if(4===l.readyState)if(200===l.status){var e=JSON.parse(l.responseText);n({latitude:e.location.lat,longitude:e.location.lng,accuracy:e.accuracy,provider:"Cellular",lastLocationTime:Date.now()})}else i(l.statusText)},a?(console.log(a),l.send(a)):n(void 0)}).catch(function(e){return e})}function manageLocation(){var e=void 0;if("Android"===localStorage.getItem("deviceType"))try{e=Towers.getCellularData(),console.log(e)}catch(t){requestCreator("instant",{message:t.message})}else e=!1;var t=indexedDB.open(firebase.auth().currentUser.uid);t.onsuccess=function(){var a=t.result,n=a.transaction("root","readwrite").objectStore("root");n.get(firebase.auth().currentUser.uid).onsuccess=function(t){return new Promise(function(){var a=t.target.result;geoFetchPromise=e?geolocationApi("POST","https://www.googleapis.com/geolocation/v1/geolocate?key=AIzaSyCtyIm3PBorFtIfRSjl1JtE4RlYXVx6U6c",e):{latitude:"",longitude:"",accuracy:999999},navigatorFetchPromise=locationInterval(a.provider),Promise.all([geoFetchPromise,navigatorFetchPromise]).then(function(e){var t=e.filter(function(e){return e!==void 0}),a=sortedByAccuracy(t);updateLocationInRoot(a)}).catch(function(e){requestCreator("instant",{message:e})})})}}}function locationInterval(e){var t=[],a=0,n={latitude:"",longitude:"",accuracy:"",lastLocationTime:""},i=void 0,l=void 0;return new Promise(function(r,c){if("Mock"===e)return void r(void 0);l||"Android"!==localStorage.getItem("deviceType")||(l=setTimeout(function(){if(""===n.latitude&&""===n.longitude)return clearInterval(d),clearTimeout(l),void r({latitude:"",longitude:"",accuracy:-1,provider:"Mock",lastLocationTime:0})},1e4));var d=setInterval(function(){navigator.geolocation.getCurrentPosition(function(e){if(e){if(0==t.length)return void t.push({latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy,lastLocationTime:Date.now()});if(t[0].latitude.toFixed(3)===e.coords.latitude.toFixed(3)&&t[0].longitude.toFixed(3)===e.coords.longitude.toFixed(3)){if(++a,3>a&&t.push({latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy,lastLocationTime:Date.now()}),3==a&&350>t[2].accuracy)return clearInterval(d),n.latitude=t[2].latitude,n.longitude=t[2].longitude,n.accuracy=t[2].accuracy,n.provider="HTML5",n.lastLocationTime=t[2].lastLocationTime,void r(n);i||(console.log("time out for low accurate location"),i=setTimeout(function(){var e=sortedByAccuracy(t);return n.latitude=e.latitude,n.longitude=e.longitude,n.accuracy=e.accuracy,n.provider="HTML5",n.lastLocationTime=e.lastLocationTime,clearInterval(d),void r(n)},2500))}}},function(e){c(e)})},500)}).catch(function(e){return e})}function sortedByAccuracy(e){var t=e.sort(function(e,t){return e.accuracy-t.accuracy});return t[0]}function updateLocationInRoot(e){if(e){var t=firebase.auth().currentUser.uid,a=indexedDB.open(t);a.onsuccess=function(){var n=a.result,i=n.transaction("root","readwrite").objectStore("root");i.get(t).onsuccess=function(t){var a=t.target.result;a.latitude=e.latitude,a.longitude=e.longitude,a.accuracy=e.accuracy,a.provider=e.provider,a.lastLocationTime=e.timestamp,i.put(a)}}}}function sendCurrentViewNameToAndroid(e){"Android"===localStorage.getItem("deviceType")&&Fetchview.startConversation(e)}function inputFile(e){return document.getElementById(e)}function requestCreator(e,t){var a=new Worker("js/apiHandler.js"),n={type:e,body:""};if(!t)a.postMessage(n);else if("instant"===e||"now"===e||"Null"===e)t&&(n.body=JSON.stringify(t)),a.postMessage(n);else{offset&&(clearTimeout(offset),offset=null);var i=firebase.auth().currentUser.uid,l=indexedDB.open(i);l.onsuccess=function(){var e=l.result,r=e.transaction("root","readwrite"),c=r.objectStore("root");c.get(i).onsuccess=function(e){var i=e.target.result;if(!(i.hasOwnProperty("latitude")&&i.hasOwnProperty("longitude")&&i.hasOwnProperty("accuracy")))enableGps("Fetching Location Please wait");else if(i.latitude&&i.longitude&&i.accuracy){var l={latitude:i.latitude,longitude:i.longitude,accuracy:i.accuracy};t.timestamp=fetchCurrentTime(i.serverTime),t.geopoint=l,n.body=t,a.postMessage(n)}else enableGps("Fetching Location Please wait")}}}a.onmessage=loadViewFromRoot,a.onerror=onErrorMessage}function loadViewFromRoot(e){if("notification"===e.data.type)return void successDialog();if("removeLocalStorage"===e.data.type)return void localStorage.removeItem("dbexist");if("manageLocation"===e.data.type)return void manageLocation();if("error"===e.data.type)return document.querySelector("header .mdc-linear-progress")&&document.querySelector("header .mdc-linear-progress").remove(),document.querySelector(".loader")&&document.querySelector(".loader").remove(),document.querySelector(".delete-activity")&&(document.querySelector(".delete-activity").style.display="block"),document.querySelector(".undo-delete-loader")&&(document.querySelector(".undo-delete-loader").style.display="block"),void snacks(e.data.msg);if("create-success"===e.data.type)return void listView();if("reset-offset"===e.data.type)return void(offset&&(console.log("removing offset"),clearTimeout(offset),offset=null));var t=window.indexedDB.open(firebase.auth().currentUser.uid);t.onsuccess=function(){var a=t.result;if("updateAssigneesList"===e.data.type){console.log("only update assingee list");var n=a.transaction("activity").objectStore("activity");return n.get(e.data.params.id).onsuccess=function(t){t.target.result;readNameAndImageFromNumber([e.data.params.number],a)},void history.pushState(["listView"],null,null)}return"redirect-to-list"===e.data.type?void history.pushState(["listView"],null,null):history.state?"updateCreateActivity"===history.state[0]?(toggleActionables(history.state[1].activityId),void handleTimeout()):void("profileView"===history.state[0]||(console.log("running view in state"),window[history.state[0]](history.state[1],!1),handleTimeout())):void window.listView(!0)}}function onErrorMessage(e){var t={message:e.message,body:{"line-number":e.lineno,file:e.filename}};requestCreator("instant",t),console.table({"line-number":e.lineno,error:e.message,file:e.filename})}function handleTimeout(){offset=setTimeout(function(){requestCreator("Null"),manageLocation()},3e4)}function getInputText(e){return mdc.textField.MDCTextField.attachTo(document.querySelector(e))}