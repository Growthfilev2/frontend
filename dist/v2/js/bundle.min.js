function addView(t){setHeader("<a class='mdc-top-app-bar__navigation-icon material-icons'>arrow_back</a>\n    <span class=\"mdc-top-app-bar__title\">"+("subscription"===t.template?"Add other contacts":"users"===t.template?"Add people":t.template)+"</span>\n    ",""),document.getElementById("app-current-panel").classList.remove("mdc-layout-grid","pl-0","pr-0"),document.getElementById("app-current-panel").innerHTML="\n        <iframe class='' id='form-iframe' src='"+window.location.origin+"/v2/forms/"+t.template+"/edit.html'></iframe>",document.getElementById("form-iframe").addEventListener("load",function(e){document.getElementById("form-iframe").contentWindow.init(t)})}function sendOfficeData(t){appLocation(3).then(function(e){requestCreator("createOffice",t,e).then(function(){successDialog("Office created successfully"),giveSubscriptionInit(t.name)}).catch(console.error)}).catch(handleLocationError)}function sendUsersData(t){appLocation(3).then(function(e){requestCreator("checkIns",t,e).then(function(e){history.back(),successDialog("")}).catch(console.error)}).catch(handleLocationError)}function sendSubscriptionData(t){appLocation(3).then(function(e){requestCreator("subscription",t,e).then(function(e){ApplicationState.createdSubscription=!0,localStorage.setItem("ApplicationState",JSON.stringify(ApplicationState)),document.getElementById("app-header").classList.add("hidden"),loadingScreen();var t=db.transaction(["root"],"readwrite"),n=t.objectStore("root"),a=firebase.auth().currentUser.uid;n.get(a).onsuccess=function(e){var t=e.target.result;t.fromTime=0,n.put(t)},t.oncomplete=function(){reloadPage()}})}).catch(handleLocationError)}function sendFormToParent(i){progressBar.open();var o=i.customerAuths;delete i.customerAuths,appLocation(3).then(function(t){if(Array.isArray(i)){var n=[],a=i[0].template;return i.forEach(function(e){n.push(requestCreator("create",e,t))}),void Promise.all(n).then(function(e){successDialog("You Created a "+a),reportView()}).catch(console.error)}requestCreator("create",i,t).then(function(){if("attendance regularization"===i.template){successDialog("You Applied for an AR");var e=db.transaction("attendance","readwrite"),n=e.objectStore("attendance");return n.get(i.id).onsuccess=function(e){var t=e.target.result;t&&(t.editable=0,n.put(t))},void(e.oncomplete=function(){reportView()})}successDialog("You Created a "+i.template),"customer"===i.template&&(ApplicationState.knownLocation=!0,ApplicationState.venue={office:i.office,template:i.template,status:i.status,location:i.venue[0].location,address:i.venue[0].address,latitude:i.venue[0].geopoint.latitude,longitude:i.venue[0].geopoint.longitude},localStorage.setItem("ApplicationState",JSON.stringify(ApplicationState)),Object.keys(o).forEach(function(e){requestCreator("updateAuth",o[e],t).then(function(e){console.log(e)}).catch(console.error)})),reportView()}).catch(console.error)}).catch(handleLocationError)}function parseContact(e){var t=e.split("&")[0].split("=")[1],n=e.split("&")[1].split("=")[1],a=e.split("&")[2].split("=")[1];return{displayName:t||"",phoneNumber:n?formatNumber(n):"",email:a||""}}function setContactForCustomer(e){var t=parseContact(e);document.getElementById("form-iframe").contentWindow.setContact(t,"First Contact")}function setContactForCustomerFailed(e){handleError({message:e,body:""})}function getContactManager(e){var t=parseContact(e);document.getElementById("form-iframe").contentWindow.setContactForManager(t)}function getContactSupervisors(e){var t=parseContact(e);document.getElementById("form-iframe").contentWindow.setContactForSupervisors(t)}function setContactForSecondCustomer(e){var t=parseContact(e);document.getElementById("form-iframe").contentWindow.setContact(t,"Second Contact")}function setContactForSecondCustomerFailed(e){handleError({message:e,body:""})}function expenseClaimImage(e){document.getElementById("form-iframe").contentWindow.setExpenseImage(e)}function attendanceView(n){var e=document.querySelector(".tabs-section .data-container");if(e){e.innerHTML=attendanceDom();var t=document.getElementById("attendance-view");getSubscription("","leave").then(function(e){e.length&&t&&t.appendChild(createTemplateButton(e))}).catch(function(e){handleError({message:e.message,body:{stack:e.stack||""}})}),getEmployeeDetails(IDBKeyRange.only(firebase.auth().currentUser.phoneNumber),"employees").then(function(e){var t={};e.forEach(function(e){t[e.office]=e}),createAttendanceCard(t,n)}).catch(function(e){createAttendanceCard()})}}function createAttendanceCard(i,o){getMonthlyData().then(function(e){var t=document.getElementById("attendance-cards");if(e.length){var n="",a=void 0;e.forEach(function(e){a!==e.month&&(n+='<div class="hr-sect hr-sect mdc-theme--primary mdc-typography--headline5 mdc-layout-grid__cell--span-12-desktop mdc-layout-grid__cell--span-4-phone mdc-layout-grid__cell--span-8-tablet">'+moment(e.month+1+"-"+e.year,"MM-YYYY").format("MMMM YYYY")+"</div>"),a=e.month,n+=attendaceCard(e,i)}),t&&(t.innerHTML=n,toggleReportCard(".attendance-card"),o&&document.querySelector('[data-id="'+o.id+'"]').scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),[].map.call(document.querySelectorAll(".status-button"),function(e){e.addEventListener("click",checkStatusSubscription)}))}else t&&(t.innerHTML="<h5 class='mdc-typography--headline5 mdc-layout-grid__cell--span-12 text-center'>No Attendance Found</h5>")}).catch(function(e){console.log(e),handleError({message:e.message,body:{stack:e.stack||""}})})}function attendaceCard(e,t){return'<div data-id="'+e.id+'" class=\'mdc-card report-card mdc-card--outlined attendance-card mdc-layout-grid__cell mdc-layout-grid__cell--span-6-desktop mdc-layout-grid__cell--span-8-tablet \'>\n      <div class=\'mdc-card__primary-action\'>\n        <div class="demo-card__primary">\n        <div class=\'left\'>\n            <div class="month-date-cont">\n              <div class="day">'+cardDate(e)+'</div>\n              <div class="date">'+e.date+'</div>\n            </div>\n            <div class="heading-container">\n              <span class="demo-card__title mdc-typography '+(e.attendance<1?"mdc-theme--error":"mdc-theme--success")+'">Attendance : '+e.attendance+'</span>\n              <h3 class="demo-card__subtitle mdc-typography mdc-typography--subtitle2 mb-0 card-office-title">'+e.office+"</h3>\n            </div>\n        </div>\n        <div class='right'>\n          <div class=\"dropdown-container dropdown\">\n            <i class=\"material-icons\">keyboard_arrow_down</i>\n            <div class='mdc-typography--subtitle2 mdc-theme--primary'>"+attendanceStatusType(e)+"</div>\n          </div>\n        </div>\n        </div>\n        <div class='detail-container hidden'>\n        <div class='text-container pt-10 pb-10 mdc-typography--body1'>\n          "+(e.addendum.length?"\n            <div class='detail count'>\n              "+getMinimumDalyCount(e,t)+"\n            </div>\n            <div class='detail working-hour'>\n              "+getWorkingHoursText(e,t)+"\n            </div>\n          ":"No Activities Found")+"\n        </div>\n      <div class='time-container'>\n          "+e.addendum.map(function(e){return" <a class='time addendum-value mdc-typography--headline6 "+(e.latitude&&e.longitude?"mdc-theme--primary":"")+"' "+(e.latitude&&e.longitude?"href='geo:"+e.latitude+","+e.longitude+"?q="+e.latitude+","+e.longitude+"'":"")+">\n                  "+getAttendanceTime(e)+"\n                  <div class='mdc-typography--caption'>Check-in</div>\n              </a>"}).join("")+"\n         </div>         \n        </div>\n      </div>\n        "+(1==e.attendance?"":'<div class="mdc-card__actions '+(0<e.attendance&&e.attendance<1?"mdc-card__actions--full-bleed":"")+'">\n        '+attendaceButtons(e)+"\n      </div>")+"\n  </div>"}function getMinimumDalyCount(e,t){return Object.keys(t).length?t[e.office]?t[e.office].attachment.hasOwnProperty("Minimum Daily Activity Count")?t[e.office].attachment["Minimum Daily Activity Count"].value?"  Count :  "+e.addendum.length+" / "+t[e.office].attachment["Minimum Daily Activity Count"].value:" Count : "+e.addendum.length:void 0:" Count : "+e.addendum.length:" Count :  "+e.addendum.length}function getWorkingHoursText(e,t){var n=calculateWorkedHours(e.addendum);return n?Object.keys(t).length&&t[e.office]&&t[e.office].attachment["Minimum Working Hours"].value?" Working hours :  "+n+" / "+t[e.office].attachment["Minimum Working Hours"].value+" ":" Working hours :  "+n:""}function getAttendanceTime(e){return moment(e.timestamp).format("hh:mm A")}function calculateWorkedHours(e){var t=e.length;if(!t||1==t)return"";var n=Math.abs(e[t-1].timestamp-e[0].timestamp)/36e5;return n?Number(n.toFixed(2)):""}function attendanceStatusType(e){return e.onLeave?"On leave":e.onAr?"On AR":e.holiday?"Holiday":e.weeklyOff?"Weekly off":e.isLate?"Late":""}function attendanceDom(){return"<div class='attendance-section report-view' id='attendance-view'>\n    <div class='monthly-stat  mdc-layout-grid__inner' id='attendance-cards'></div>\n  </div>"}function isAttendaceCardToday(e){var t=new Date;return e.date==t.getDate()&&e.month==t.getMonth()&&e.year==t.getFullYear()}function attendaceButtons(e){return 1==e.attendance?"":0==e.attendance?'\n    <button class=\'mdc-button mdc-card__action mdc-card__action--button status-button\' data-template="leave" data-id="'+e.id+'" data-office="'+e.office+'"  data-date="'+e.year+"/"+(e.month+1)+"/"+e.date+'" '+(e.editable?"":"disabled")+">\n      Apply Leave\n    </button>\n    <button class='mdc-button mdc-card__action mdc-card__action--button status-button mdc-button--raised' data-id=\""+e.id+'" data-template="attendance regularization" data-office="'+e.office+'"  data-date="'+e.year+"/"+(e.month+1)+"/"+e.date+'" '+(e.editable&&!isAttendaceCardToday(e)?"":"disabled")+">\n    Apply AR\n  </button>\n    ":0<e.attendance&&e.attendance<1?'<button class="mdc-button mdc-card__action mdc-card__action--button full-bleed--action status-button" data-id="'+e.id+'" data-id="'+e.id+'" '+(e.editable&&!isAttendaceCardToday(e)?"":"disabled")+' data-template="attendance regularization" data-office="'+e.office+'"  data-date="'+e.year+"/"+(e.month+1)+"/"+e.date+'">\n    <span class="mdc-button__label">Apply AR</span>\n    <i class="material-icons" aria-hidden="true">arrow_forward</i>\n  </button>':void 0}function cardDate(e){return moment(e.date+"-"+(e.month+1)+"-"+e.year,"DD-MM-YYYY").format("ddd")}function getMonthlyData(){return new Promise(function(e,t){var n=db.transaction("attendance"),i=[];n.objectStore("attendance").index("key").openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;if(t)if(t.value.date&&t.value.month&&t.value.year){var n=t.value.year+"-"+(t.value.month+1)+"-"+t.value.date,a=moment().format("YYYY-MM-DD");moment(a,"YYYY-MM-DD").isBefore(moment(n,"YYYY-MM-DD"))||t.value.hasOwnProperty("attendance")&&(t.value.addendum||(t.value.addendum=[]),t.value.hasOwnProperty("addendum")?t.value.addendum.sort(function(e,t){return e.timestamp-t.timestamp}):t.value.addendum=[],i.push(t.value)),t.continue()}else t.continue()},n.oncomplete=function(){return e(i)},n.onerror=function(){return t({message:n.error})}})}function checkStatusSubscription(e){var t=e.target.closest("button").dataset,n=db.transaction("subscriptions","readwrite"),a=n.objectStore("subscriptions").index("officeTemplate").openCursor(IDBKeyRange.only([t.office,t.template])),i=void 0;a.onsuccess=function(e){var t=e.target.result;if(t){if("CANCELLED"===t.value.status)return t.delete(),void t.continue();i=t.value,t.continue()}},a.onerror=function(){return reject({message:a.error})},n.oncomplete=function(){i?(history.pushState(["addView"],null,null),i.date=t.date,i.id=t.id,addView(i)):snacks("You don't have "+t.template+" subscription")},n.onerror=function(){return reject({message:n.error})}}var contactsUl,chatsUl,currentChatsArray=[],currentContactsArray=[],menu=void 0,timer=null,duration=800;function chatView(){var e=document.querySelector(".tabs-section .data-container");if(e){if(!document.getElementById("search-btn")){var t=createElement("button",{className:"material-icons mdc-top-app-bar__action-item mdc-icon-button",id:"search-btn",textContent:"search"});document.getElementById("section-end").appendChild(t),t.addEventListener("click",function(){history.pushState(["searchChats"],null,null),search()})}e.innerHTML=chatDom(),firebase.auth().currentUser.getIdTokenResult().then(function(n){if(isAdmin(n)){var e=createFab("person_add");document.querySelector(".user-chats").appendChild(e),e.addEventListener("click",function(){if(1==n.claims.admin.length)return history.pushState(["addView"],null,null),void addView({template:"users",phoneNumbers:[],office:n.claims.admin[0]});var t=new Dialog("Choose Office",officeSelectionList(n.claims.admin),"choose-office-subscription").create("simple"),e=new mdc.list.MDCList(document.getElementById("dialog-office"));bottomDialog(t,e),e.listen("MDCList:action",function(e){t.close(),history.pushState(["addView"],null,null),addView({template:"users",phoneNumbers:[],office:n.claims.admin[e.detail.index]})})})}}),readLatestChats(!0)}}function chooseContact(e){var t=parseContact(e);t.mobile=t.phoneNumber,delete t.phoneNumber,history.pushState(["enterChat",t],null,null),enterChat(t)}function chatDom(){return"<div class='user-chats'>\n    \n<div id='search-users-container'>\n    <div class='search-field'></div>\n    <div class='search-result-container'></div>\n</div>\n<div class=\"mdc-list-group\">\n <h3 id='no-result-found' style='text-align:center'></h3>   \n<div class='chats-container'>\n<h3 class=\"mdc-list-group__subheader mdc-list-group__subheader mdc-typography--headline6\"></h3>\n<ul class=\"mdc-list mdc-list--two-line mdc-list--avatar-list\" id='chats'>\n\n</ul>\n</div>\n<div class='contacts-container'>\n  <h3 class=\"mdc-list-group__subheader mdc-list-group__subheader mdc-typography--headline6\"></h3>\n  <ul class=\"mdc-list mdc-list--two-line mdc-list--avatar-list\" id='all-contacts'>\n  </ul>\n</div>\n  </div>\n</div>"}function searchBar(){return'<div id=\'search-users\' class="mdc-text-field mdc-text-field--with-leading-icon mdc-text-field--with-trailing-icon mdc-text-field--no-label">\n    <i class="material-icons mdc-text-field__icon" tabindex="0" role="button" id=\'search-back\'>arrow_back</i>\n    <i class="material-icons mdc-text-field__icon hidden"  tabindex="0" role="button" id=\'clear-search\'>clear</i>\n    <input type="text" id="my-input" class="mdc-text-field__input" placeholder=\'Search...\' style=\'padding-left:48px;padding-right: 48px;\'>\n    <div class="mdc-line-ripple"></div>\n</div>'}function search(){document.getElementById("app-header").classList.add("hidden"),document.querySelector("#search-users-container .search-field").innerHTML=searchBar();var o=new mdc.textField.MDCTextField(document.getElementById("search-users"));o.focus(),o.input_.addEventListener("input",function(e){o.trailingIcon_.root_.classList.remove("hidden"),e.target.value?o.trailingIcon_.root_.classList.remove("hidden"):o.trailingIcon_.root_.classList.add("hidden");var n=firebase.auth().currentUser.phoneNumber,t=getSearchBound(e),a="",i="";currentChatsArray=[],currentContactsArray=[],t.bound.onsuccess=function(e){var t=e.target.result;t&&(t.value.mobile!==n&&(t.value.timestamp?(a+=userLi(t.value),currentChatsArray.push(t.value)):(i+=userLi(t.value),currentContactsArray.push(t.value))),t.continue())},t.tx.oncomplete=function(){var e=document.getElementById("chats"),t=document.getElementById("all-contacts"),n=document.getElementById("no-result-found");n&&(currentChatsArray.length||currentContactsArray.length?n.innerHTML="":n.innerHTML="No Results Found"),e&&(currentChatsArray.length?(document.querySelector(".chats-container h3").textContent="Chats",document.querySelector(".chats-container").classList.remove("hidden")):(document.querySelector(".chats-container h3").textContent="",document.querySelector(".chats-container").classList.add("hidden")),e.innerHTML=a),t&&(i?(document.querySelector(".contacts-container h3").textContent="Other Contacts",document.querySelector(".contacts-container").classList.remove("hidden")):(document.querySelector(".contacts-container h3").textContent="",document.querySelector(".contacts-container").classList.add("hidden")),t.innerHTML=i)}}),o.leadingIcon_.root_.onclick=function(){history.back()},o.trailingIcon_.root_.onclick=function(){searchInitCancel(o)}}function getSearchBound(e){var t=e.target.value,n=db.transaction(["users","addendum"]),a=n.objectStore("users"),i=null,o="next";return e.target.value?(t=isNumber(t)?(indexName="mobile",formatNumber(t)):(indexName="NAME_SEARCH",t.toLowerCase()),i=IDBKeyRange.bound(t,t+"￿"),a=a.index(indexName)):"searchChats"===history.state[0]&&(indexName="timestamp",o="prev"),{tx:n,bound:a=a.openCursor(i,o)}}function isNumber(e){return!isNaN(e)}function formatNumber(e){var t=e;return"91"===t.substring(0,2)?t="+"+t:"+91"!==t.substring(0,3)&&(t="+91"+t),t.replace(/ +/g,"")}function getOtherContacts(){currentContactsArray=[];var e=db.transaction("users","readwrite"),t=e.objectStore("users").index("timestamp"),n=firebase.auth().currentUser.phoneNumber,a="";t.openCursor("").onsuccess=function(e){var t=e.target.result;t&&(t.value.mobile!==n&&(a+=userLi(t.value),currentContactsArray.push(t.value)),t.continue())},e.oncomplete=function(){var e=document.getElementById("all-contacts");document.querySelector(".contacts-container").classList.remove("hidden"),e&&(a?(e.innerHTML=a,initializeContactList(contactsUl=new mdc.list.MDCList(e))):e.innerHTML="No Contacts Found")}}function readLatestChats(t){currentChatsArray=[];var e=db.transaction(["users"],"readwrite"),n=e.objectStore("users").index("timestamp"),a=firebase.auth().currentUser.phoneNumber,i="",o=IDBKeyRange.bound(1,27138906e5);n.openCursor(o,"prev").onsuccess=function(e){var t=e.target.result;t&&(console.log(t.value),t.value.mobile!==a&&(i+=userLi(t.value),currentChatsArray.push(t.value)),t.continue())},e.oncomplete=function(){var e=document.getElementById("chats");document.querySelector(".chats-container").classList.remove("hidden"),e&&(currentChatsArray.length?(e.innerHTML=i,t&&initializeChatList(chatsUl=new mdc.list.MDCList(e))):e.innerHTML="<h3 class=\"mb-0 mdc-typography--headline5 mdc-theme--primary mb-0 text-center\">No Chats found</h3>\n                <p class='text-center'>Choose From Below or Search</p>\n                ")}}function initializeChatList(e){e.listen("MDCList:action",function(e){var t=currentChatsArray[e.detail.index];"searchChats"===history.state[0]?history.replaceState(["enterChat",t],null,null):history.pushState(["enterChat",t],null,null),enterChat(t)})}function initializeContactList(e){e.listen("MDCList:action",function(e){var t=currentContactsArray[e.detail.index];"searchChats"===history.state[0]?history.replaceState(["enterChat",t],null,null):history.pushState(["enterChat",t],null,null),enterChat(t)})}function userLi(e){return'<li class="mdc-list-item">\n   <div style="position:relative">\n   <img class="mdc-list-item__graphic"  aria-hidden="true" src='+(e.photoURL||"./img/empty-user.jpg")+'  onerror="imgErr(this)" data-number='+e.mobile+'>\n   <i class="material-icons user-selection-icon">check_circle</i>\n   </div>\n    \n    <span class="mdc-list-item__text">\n    <span class="mdc-list-item__primary-text">\n        '+(e.displayName||e.mobile)+'\n    </span>\n    <span class="mdc-list-item__secondary-text">\n    '+(e.comment||"")+'\n    </span>\n    </span>\n    <span class="mdc-list-item__meta" aria-hidden="true">\n    <span class=\'chat-time mdc-typography--subtitle2\'>\n        '+(e.timestamp?formatCreatedTime(e.timestamp):"")+"</span>\n    </span>\n    </li>"}function loadUsers(r,s){return new Promise(function(e,t){var n=db.transaction(["users"]),a=n.objectStore("users"),i=firebase.auth().currentUser.phoneNumber,o="",c=[];a.openCursor().onsuccess=function(e){var t=e.target.result;t&&(t.value.mobile!==i&&(s&&s[t.value.mobile]||(c.push(t.value),r&&(t.value.comment="",t.value.count="",t.value.timestamp=""),o+=userLi(t.value))),t.continue())},n.oncomplete=function(){return e({domString:o,data:c})}})}function selectNew(){return"<div class='new-message-container'>\n        <h2 class='mdc-typography--headline5 mt-0 mb-0'>Message Team With Direct</h2>\n    <p>Send private message.... </p>\n    <button class='mdc-button' onclick=newMessage()>\n    <span class=\"mdc-button__label\">Send Message</span>\n    </button>\n    </div>"}function formatCreatedTime(e){return e?isToday(e)?moment(e).format("hh:mm"):moment(e).format("D, MMM").replace(",",""):""}function isToday(e){return(new Date).setHours(0,0,0,0)==new Date(e).setHours(0,0,0,0)}function enterChat(e){var t=document.querySelector(".tabs-section .data-container");if(t){var n=setHeader("<a class='mdc-top-app-bar__navigation-icon material-icons'>arrow_back</a>\n        <img src="+(e.photoURL||"./img/empty-user.jpg")+' class=\'header-image\' onerror="imgErr(this)">\n        <span class="mdc-top-app-bar__title">'+(e.displayName||e.mobile)+"</span>\n        ","");n.root_.classList.remove("hidden"),console.log(n),t.innerHTML='\n    <div class="page">\n    <div class="marvel-device nexus5">\n  \n      <div class="screen">\n        <div class="screen-container">\n          \n          <div class="chat">\n            <div class="chat-container">\n              \n              <div class="conversation">\n                <div class="conversation-container">\n                <div id=\'content\'>\n                </div>\n            \n                <form class="conversation-compose">\n                  <div class="input-space-left"></div>\n                                    \n                  <input class="input-msg" data-name="dm" data-param="assignee" data-param-value="'+e.mobile+'" name="input" placeholder="Type a message" autocomplete="off"  id=\'comment-input\'>\n                  <div class="input-space-right"></div>\n                  <button class="send" id=\'comment-send\'>\n                      <div class="circle">\n                        <i class="material-icons">send</i>\n                      </div>\n                    </button>\n                </form>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n        ',getUserChats(e)}}function actionBoxDom(t,e){var n=createElement("div",{className:"message "+e+" menu-action"});return n.addEventListener("touchstart",function(e){touchStart(e,t.addendumId,t.activityId,t.location._latitude,t.location._longitude)}),n.addEventListener("touchend",touchEnd),n.addEventListener("touchcancel",touchCancel),n.addEventListener("touchmove",touchMove),n.innerHTML=actionBoxContent(t),n}function actionBoxContent(e){return"\n    <div class='menu-container mdc-menu-surface--anchor' id=\""+e.addendumId+'"> </div>\n    '+e.comment+'\n<span class="metadata">\n    <span class="time">\n    '+moment(e.timestamp).format("hh:mm")+"\n    </span>\n    <span class='tick'>\n        <i class='material-icons'>info</i>\n    </span>\n</span>"}function actionBox(e,t){return'\n    <div class="message '+t+' menu-action" ontouchstart="touchStart(event,\''+e.addendumId+"','"+e.activityId+"','"+e.location._latitude+"','"+e.location._longitude+'\')" ontouchEnd="touchEnd(event)" ontouchmove="touchMove(event)" ontouchcancel="touchCancel(event)">  \n    '+actionBoxContent(e)+"\n    </div>\n  "}function handleLongPress(e,t,n,a){clearTimeout(timer);var i={_latitude:n,_longitude:a};menu&&(menu.open=!1,menu=null),createActivityActionMenu(e,t,i)}function touchStart(e,t,n,a,i){timer=setTimeout(function(){handleLongPress(t,n,a,i)},duration)}function touchEnd(e){clearTimeout(timer)}function touchMove(e){clearTimeout(timer)}function touchCancel(e){clearTimeout(timer)}function messageBoxContent(e,t){return" "+e+'\n    <span class="metadata">\n        <span class="time">'+moment(t).format("hh:mm")+"</span\n    </span>\n  </div>"}function messageBox(e,t,n){return' <div class="message '+t+'">\n    '+messageBoxContent(e,n)+"\n    "}function messageBoxDom(e,t,n){var a=createElement("div",{className:"message "+t});return a.innerHTML=messageBoxContent(e,n),a}function createActivityHeading(e){return e.activityName+"\n    <p class='card-time mdc-typography--subtitle1 mb-0 mt-0'>Created On "+formatCreatedTime(e.timestamp)+'</p>\n    <span class="demo-card__subtitle mdc-typography mdc-typography--subtitle2 mt-0">by '+(e.creator.displayName||e.creator.phoneNumber)+"</span>"}function getStatusArray(e){console.log(e);var t=[],n={name:"Confirm",icon:"check",status:"CONFIRMED",color:"green"},a={name:"Undo",icon:"undo",status:"PENDING",color:"black"},i={name:"Delete",icon:"delete",status:"CANCELLED",color:"red"};return"CANCELLED"===e.status&&t.push(n,a),"PENDING"===e.status&&t.push(n,i),"CONFIRMED"===e.status&&t.push(a,i),t}function createActivityActionMenu(o,c,r){db.transaction("activity").objectStore("activity").get(c).onsuccess=function(e){var t=e.target.result;if(t){var n=createActivityHeading(t),a=[{name:"View",icon:"info"},{name:"Reply",icon:"reply"}];t.canEdit&&(a.push({name:"Share",icon:"share"}),a=a.concat(getStatusArray(t)),console.log(a));var i=o+c;document.getElementById(o).innerHTML=createSimpleMenu(a,i),document.getElementById(i).appendChild(menuItemMap({name:"Map",icon:"map"},r)),(menu=new mdc.menu.MDCMenu(document.getElementById(i))).open=!0,menu.root_.classList.add("align-right-menu"),menu.listen("MDCMenu:selected",function(e){switch(a[e.detail.index].name){case"View":showViewDialog(n,t,"view-form");break;case"Reply":reply(t);break;case"Share":share(t);break;case"Undo":setActivityStatus(t,"PENDING");break;case"Confirm":setActivityStatus(t,"CONFIRMED");break;case"Delete":setActivityStatus(t,"CANCELLED")}})}}}function reply(e){var t=document.querySelector(".conversation-compose input");t.dispatchEvent(new Event("focus")),t.focus(),t.placeholder="Type your reply",t&&(t.dataset.name="comment",t.dataset.param="activityId",t.dataset.paramValue=e.activityId)}function showViewDialog(e,t,n){var a=new Dialog(e,activityDomCustomer(t),n).create();return a.open(),a.autoStackButtons=!1,a.buttons_[1].classList.add("hidden"),new mdc.ripple.MDCRipple(a.buttons_[0]),a.listen("MDCDialog:opened",function(e){var t=document.getElementById("schedule-container");t&&new mdc.list.MDCList(t).layout()}),a}function createDynamicChips(e,t,n){var a=createElement("button",{className:"mdc-chip mdc-chip--selected",id:t}),i=createElement("div",{className:"mdc-chip__text",textContent:e}),o=createElement("i",{className:"material-icons mdc-chip__icon mdc-chip__icon--trailing",textContent:"cancel"});return o.setAttribute("tabindex","0"),o.setAttribute("role","button"),n&&a.appendChild(n),a.appendChild(i),a.appendChild(o),a}function share(t){var e=document.querySelector(".tabs-section .data-container");if(e){var a={},r={};t.assignees.forEach(function(e){a[e.phoneNumber]=!0}),e.innerHTML="\n    <div id='search-users-container'>\n    </div>\n    <div class='share-user-container'>\n    <div class=\"mdc-chip-set hidden\" id='share'>\n    </div>\n    </div>\n    <ul class=\"mdc-list mdc-list--two-line mdc-list--avatar-list\" id='users-list'>\n    </ul>\n    <button class=\"mdc-fab mdc-theme--primary-bg app-fab--absolute\" aria-label=\"Favorite\" id='send-assignee'>\n        <span class=\"mdc-fab__icon material-icons mdc-theme--on-primary\">arrow_forward</span>\n    </button>\n    ",setHeader("<a class='mdc-top-app-bar__navigation-icon material-icons'>arrow_back</a>\n    <span class=\"mdc-top-app-bar__title\">Add People</span>\n    ","<a class='mdc-top-app-bar__action-item material-icons' id='search-btn'>\n        search\n    </a>");var s=document.getElementById("share"),l=new mdc.chips.MDCChipSet(s),n=document.getElementById("users-list"),d=new mdc.list.MDCList(n),i=new mdc.ripple.MDCRipple(document.getElementById("send-assignee"));history.pushState(["share",t],null,null),console.log(l),loadUsers(!0,a).then(function(c){c.data.length&&(i.root_.addEventListener("click",function(){var e=Object.keys(r);e.length?(console.log(r),addAssignee(t,e)):snacks("At least 1 contact must be selected")}),document.getElementById("users-list").innerHTML=c.domString,l.listen("MDCChip:removal",function(e){console.log(l.chips);var t=d.listElements[Number(e.detail.chipId)];delete r[c.data[Number(e.detail.chipId)].mobile],s.removeChild(e.detail.root),t.classList.remove("selected"),t.querySelector(".user-selection-icon").classList.add("hidden"),t.querySelector(".user-selection-icon").classList.remove("user-selection-show"),l.chips.length?s.classList.remove("hidden"):s.classList.add("hidden")}),d.listen("MDCList:action",function(e){var t=e.detail.index,n=d.listElements[t],a=c.data[t];if(n.classList.contains("selected")){new mdc.chips.MDCChip(document.getElementById(""+t)).beginExit()}else{r[a.mobile]=!0,n.classList.add("selected"),n.querySelector(".user-selection-icon").classList.remove("hidden"),n.querySelector(".user-selection-icon").classList.add("user-selection-show");var i=createElement("img",{className:"mdc-chip__icon mdc-chip__icon--leading",src:a.photoURL||"./img/empty-user.jpg"}),o=createDynamicChips(a.displayName||a.mobile,t,i);s.appendChild(o),l.addChip(o),o.scrollIntoView({behavior:"smooth",block:"center",inline:"end"}),s.classList.remove("hidden")}}),document.getElementById("search-btn").addEventListener("click",function(e){document.getElementById("app-header").classList.add("hidden"),document.getElementById("search-users-container").innerHTML="<div class='search-field'>\n            "+searchBar()+"\n        </div>";var n=new mdc.textField.MDCTextField(document.getElementById("search-users"));n.focus(),n.input_.addEventListener("input",function(e){e.target.value?n.trailingIcon_.root_.classList.remove("hidden"):n.trailingIcon_.root_.classList.add("hidden"),d.listElements.forEach(function(e){e.classList.remove("found")});var t=getSearchBound(e);t.bound.onsuccess=function(e){var t=e.target.result;if(t)if(a[t.value.mobile])t.continue();else{var n=document.querySelector('[data-number="'+t.value.mobile+'"]');n&&n.parentNode.parentNode.classList.add("found"),t.continue()}},t.tx.oncomplete=function(){d.listElements.forEach(function(e){e.classList.contains("found")?e.classList.remove("hidden"):e.classList.add("hidden")})}}),n.leadingIcon_.root_.onclick=function(){searchInitBack(n)},n.trailingIcon_.root_.onclick=function(){searchInitCancel(n)}}))})}}function closeSearchBar(){document.getElementById("search-users")&&document.getElementById("search-users").classList.add("hidden"),document.getElementById("app-header").classList.remove("hidden")}function searchInitBack(e){closeSearchBar(),e.value="",e.input_.dispatchEvent(new Event("input"))}function searchInitCancel(e){e.value="",e.input_.dispatchEvent(new Event("input"))}function activityDomCustomer(e){return" <div class='mdc-card'>\n    <div id='status-change-container'></div>\n    <div class='view-card'>\n    <div id='schedule-container'>\n        <ul class='mdc-list mdc-list--two-line'>\n            "+viewSchedule(e)+"\n        </ul>\n    </div>\n    <div id='schedule-container'>\n        <ul class='mdc-list mdc-list--two-line'>\n            "+viewVenue(e)+"\n        </ul>\n    </div>\n    <div id='attachment-container'>\n        "+viewAttachment(e)+"\n    </div>  \n     \n        <div id='assignee-container'>\n            "+(e.assignees.length?'<div class="assignees tasks-heading center">\n            <i class="material-icons">share</i>\n            '+viewAssignee(e)+"\n        </div>":"")+"\n          \n    </div>\n\n</div>"}function addAssignee(t,n){closeSearchBar(),appLocation(3).then(function(e){requestCreator("share",{activityId:t.activityId,share:n},e).then(function(){snacks("You added "+n.length+" people"),history.back()}).catch(console.error)}).catch(handleLocationError)}function setActivityStatus(t,n){appLocation(3).then(function(e){requestCreator("statusChange",{activityId:t.activityId,status:n},e).then(function(){snacks(t.activityName+" is "+n)}).catch(console.error)}).catch(handleLocationError)}function iconByType(e,t){if("string"===e)return"Name"===t?"account_circle":"info";return{phoneNumber:"phone","HH:MM":"access_time",weekday:"today"}[e]}function viewFormAttachmentEl(e,t){return"base64"===t.attachment[e].type?'<ul class="mdc-image-list my-image-list mdc-image-list--masonry">\n        <li class="mdc-image-list__item">\n        <img class="mdc-image-list__image" src="'+t.attachment[e].value+'" onerror="imgErr(this)">\n          <div class="mdc-image-list__supporting">\n            <span class="mdc-image-list__label">'+e+"</span>\n          </div>\n        </li>\n      </ul>":"Include"===e?"":'<h1 class="mdc-typography--subtitle1 mt-0">\n        '+e+" : "+t.attachment[e].value+"\n    </h1>"}function viewAttachment(t){return""+Object.keys(t.attachment).map(function(e){return""+(t.attachment[e].value?viewFormAttachmentEl(e,t):"")}).join("")}function viewVenue(e,n){return""+e.venue.map(function(e,t){return"\n            "+(e.location&&e.address?'\n            <li class="mdc-list-item">\n                 '+(0==t?'<span class="mdc-list-item__graphic material-icons"\n                 aria-hidden="true">location_on</span>':'<span class="mdc-list-item__graphic" aria-hidden="true"\n                    style=\'background-color:white\'></span>')+"\n                    <span class='mdc-list-item__text'>\n                    <span class='mdc-list-item__primary-text'>"+e.location+"</span>\n                    <span class='mdc-list-item__secondary-text'>"+e.address+"</span>\n                    </span>\n                     "+(n?'<a class="mdc-list-item__meta material-icons venue-map-intent mdc-theme--primary" aria-hidden="true" href=\'geo:'+e.geopoint._latitude+","+e.geopoint._longitude+"?q="+e.geopoint._latitude+","+e.geopoint._longitude+"'>map</a>":"")+"\n              </li>":"")}).join("")}function viewSchedule(e){return"\n    \n    "+e.schedule.map(function(e,t){return'\n            <li class="mdc-list-item">\n            '+(0==t?'<span class="mdc-list-item__graphic material-icons"\n            aria-hidden="true">today</span>':'<span class="mdc-list-item__graphic" aria-hidden="true"\n            style=\'background-color:white\'></span>')+'\n            <span class="mdc-list-item__text">\n              <span class="mdc-list-item__primary-text">'+e.name+'</span>\n              <span class="mdc-list-item__secondary-text">'+moment(e.startTime).format("D MMM h[:]mm A")+" - "+moment(e.endTime).format("D MMM h[:]mm A")+"</span>\n            </span>\n          </li>"}).join("")}function viewAssignee(e){return"\n    <div class=\"mdc-chip-set\" id='share'>\n     "+e.assignees.map(function(e,t){return'<div class="mdc-chip" id=\''+t+"-preselected'>\n                    <img class='mdc-chip__icon mdc-chip__icon--leading' src="+(e.photoURL||"../img/empty-user.jpg")+" onerror=\"imgErr(this)\">\n                    <div class='mdc-chip__text'>"+(e.displayName||e.phoneNumber)+"</div>\n                </div>"}).join("")+"\n    </div>"}function createStatusChange(e){var t="";return"CANCELLED"===e&&(t='<li class="mdc-list-item" data-value="PENDING">\n       PENDING\n      </li>\n      <li class="mdc-list-item" data-value="CONFIRMED">\n        CONFIRMED\n    </li>\n      '),"PENDING"===e&&(t='<li class="mdc-list-item mdc-list-item--selected" data-value="PENDING" aria-selected="true">\n        PENDING\n       </li>\n       <li class="mdc-list-item" data-value="CONFIRMED">\n         CONFIRMED\n     </li>\n       '),"CONFIRMED"===e&&(t='<li class="mdc-list-item mdc-list-item--selected" data-value="CONFIRMED" aria-selected="true">\n        CONFIRMED\n       </li>\n       <li class="mdc-list-item" data-value="PENDING">\n         PENDING\n     </li>\n       '),'<div class="mdc-select status-select" id=\'status-enhanced-select\'>\n    <input type="hidden" name="enhanced-select">\n    <i class="mdc-select__dropdown-icon"></i>\n    <div class="mdc-select__selected-text"></div>\n    <div class="mdc-select__menu mdc-menu mdc-menu-surface status-select">\n      <ul class="mdc-list">\n        '+t+'\n      </ul>\n    </div>\n    <span class="mdc-floating-label">Change Status</span>\n    <div class="mdc-line-ripple"></div>\n  </div>'}function dynamicAppendChats(e){var n=document.getElementById("content"),a=firebase.auth().currentUser.phoneNumber;e.forEach(function(e){if(n){var t="them";if(e.user===a&&(t="me"),e.user===history.state[1].mobile||e.user===a){if(e.isComment){if(e.user===a)return;return void n.appendChild(messageBoxDom(e.comment,t,e.timestamp))}n.appendChild(actionBoxDom(e,t))}}}),setBottomScroll()}function getHumanDateString(e){var t=moment(),n=moment().subtract(1,"day");return e.isSame(t,"day")?"Today":e.isSame(n,"day")?"Yesterday":e.format("DD MMMM YYYY")}function dateBox(e){return"<div class='date-box'>\n<div class=\"date\" data-chat-date='"+e+"'>"+e+"</div>\n</div>"}function getUserChats(c){var e=db.transaction("addendum"),t=e.objectStore("addendum").index("key"),a=firebase.auth().currentUser.phoneNumber,n=IDBKeyRange.only(a+c.mobile),i=firebase.auth().currentUser.photoURL||"./img/empty-user.jpg",r=document.getElementById("content"),o="",s="",l="";t.openCursor(n).onsuccess=function(e){var t=e.target.result;if(t){t.value.user===a?(s="me",image=i):(s="them",image=c.photoURL||"./img/empty-user.jpg");var n=getHumanDateString(moment(t.value.timestamp));n!==l&&(o+=dateBox(n)),l=n,t.value.isComment?o+=messageBox(t.value.comment,s,t.value.timestamp):t.value.user!==a&&t.value.user!==c.mobile||(o+=actionBox(t.value,s)),t.continue()}},e.oncomplete=function(){r.innerHTML=o,setBottomScroll();var e=document.querySelector(".conversation-compose");e&&(e.querySelector("input").addEventListener("focus",function(e){setTimeout(function(){setBottomScroll()},500)}),e.addEventListener("submit",function(e){e.preventDefault();var t=e.target.input,n=t.value;if(n){var a=t.dataset.param,i=t.dataset.paramValue,o={comment:n};o[a]=i,appLocation(3).then(function(e){requestCreator(t.dataset.name,o,e).then(function(){r.appendChild(messageBoxDom(n,"me",Date.now())),setBottomScroll(),t.value="",t.dataset.name="dm",t.dataset.param="assignee",t.dataset.paramValue=c.mobile,t.placeholder="Type a message"}).catch(function(e){t.value="",snacks(e.message)})}).catch(handleLocationError)}}))}}function resetCommentField(e,t,n){e.style.height="72px",t.style.height="56px",n.style.height="auto"}function setBottomScroll(){var e=document.querySelector(".conversation-container");e&&(e.scrollTop=e.scrollHeight)}function expenseView(){var e=document.querySelector(".tabs-section .data-container");if(e){e.innerHTML=reimDom();var t=document.getElementById("reim-view");getSubscription("","claim").then(function(e){e.length&&t&&t.appendChild(createTemplateButton(e))}).catch(function(e){console.log(e),handleError({message:e.message,body:{stack:e.stack||"",error:e}})}),getReimMonthlyData().then(function(n){console.log(n);var e=document.getElementById("reimbursement-cards"),t=Object.keys(n);if(t.length){var a=monthlyString="";t.forEach(function(e){var t=Number(e);a!==new Date(t).getMonth()&&(monthlyString+='<div class="hr-sect hr-sect mdc-theme--primary mdc-typography--headline5 mdc-layout-grid__cell--span-12-desktop mdc-layout-grid__cell--span-4-phone mdc-layout-grid__cell--span-8-tablet">'+moment(new Date(t).getMonth()+1+"-"+new Date(t).getFullYear(),"MM-YYYY").format("MMMM YYYY")+"</div>"),a=new Date(t).getMonth(),Object.keys(n[e]).forEach(function(e){monthlyString+=reimbursementCard(t,e,n)})}),e&&(e.innerHTML=monthlyString,toggleReportCard(".reim-card"),[].map.call(document.querySelectorAll("[data-claim-id]"),function(t){t.addEventListener("click",function(){var e=t.dataset.claimId;db.transaction("activity").objectStore("activity").get(e).onsuccess=function(e){var t=e.target.result;t&&showViewDialog(createActivityHeading(t),t,"view-form")}})}))}else e&&(e.innerHTML="<h5 class='mdc-typography--headline5 mdc-layout-grid__cell--span-12 text-center'>No Reimbursement Found</h5>")}).catch(function(e){handleError({message:e.message,body:{stack:e.stack||""}})})}}function reimbursementCard(e,t,n){return"<div class='mdc-card report-card mdc-card--outlined reim-card mdc-layout-grid__cell--span-6-desktop mdc-layout-grid__cell--span-4-phone mdc-layout-grid__cell--span-8-tablet'>\n    <div class='mdc-card__primary-action'>\n      <div class=\"demo-card__primary\">\n      <div class='left'>\n          <div class=\"month-date-cont\">\n            <div class=\"day\">"+cardDate({date:new Date(e).getDate(),month:new Date(e).getMonth(),year:new Date(e).getFullYear()})+'</div>\n            <div class="date">'+new Date(e).getDate()+'</div>\n          </div>\n          <div class="heading-container">\n            <span class="demo-card__title mdc-typography">'+calculateTotalReim(n[e][t])+'</span>\n            <h3 class="demo-card__subtitle mdc-typography mdc-typography--subtitle2 mb-0 card-office-title">'+t+"</h3>\n          </div>\n      </div>\n      <div class='right'>\n        <div class=\"dropdown-container dropdown\">\n          <i class=\"material-icons\">keyboard_arrow_down</i>\n        </div>\n      </div>\n      </div>\n      <div class='detail-container hidden'>\n      <div class='text-container'></div>\n      <div class='amount-container'>\n        "+n[e][t].map(function(e){return"\n                <div class='amount mdc-typography--headline6 "+("CANCELLED"===e.details.status?"mdc-theme--error":"CONFIRMED"===e.details.status?"mdc-theme--success":"")+"' "+(e.details.claimId?'data-claim-id="'+e.details.claimId+'"':"")+">\n                    "+("km allowance"===e.reimbursementType?kmAllowanceDetail(e):claimDetail(e))+"\n                </div>\n                "}).join("")+"\n        </div>\n      </div>\n      </div>\n    </div>\n</div>"}function claimDetail(e){return"<div class='mdc-typography--caption'>"+(e.reimbursementType||"")+"</div>\n    "+("CANCELLED"===e.details.status?0:convertAmountToCurrency(e.amount,e.currency)||"")+"\n    <div class='mdc-typography--caption'>"+(e.details.status||"")+"</div>\n    <div class='mdc-typography--subtitle2'>"+(e.reimbursementName||"")+"</div>"}function kmAllowanceDetail(e){return"\n    <a style='text-decoration: none;' href='https://www.google.com/maps/dir/?api=1&origin="+e.details.startLocation.latitude+"%2C"+e.details.startLocation.longitude+"&destination="+e.details.endLocation.latitude+"%2C"+e.details.endLocation.longitude+"'>\n        <div class='mdc-typography--caption'>"+(e.reimbursementType||"")+"</div>\n        "+("CANCELLED"===e.details.status?0:convertAmountToCurrency(e.amount,e.currency)||"")+"\n        <div class='mdc-typography--caption'>"+(e.details.rate?convertAmountToCurrency(Number(e.details.rate),e.currency):"")+"</div>\n        <div class='mdc-typography--subtitle2'>"+(e.details.distanceTravelled+" KM"||"")+"</div>\n    </a>\n    "}function calculateTotalReim(e){var t=0,n="";return e.forEach(function(e){"CANCELLED"!==e.details.status&&(t+=Number(e.amount),n=e.currency)}),convertAmountToCurrency(t,n)}function convertAmountToCurrency(e,t){return new Intl.NumberFormat("en-IN",{style:"currency",currency:t||"INR"}).format(e)}function reimDom(){return"<div class='reim-section report-view' id='reim-view'>\n        <div id='reimbursement-cards' class='mdc-layout-grid__inner'></div>\n    "}function getReimMonthlyData(){return new Promise(function(e,t){var n=db.transaction("reimbursement"),a=n.objectStore("reimbursement").index("key"),i={};a.openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;if(t){var n={};if(!i[t.value.key])return n[t.value.office]=[t.value],i[t.value.key]=n,void t.continue();i[t.value.key][t.value.office]?i[t.value.key][t.value.office].push(t.value):i[t.value.key][t.value.office]=[t.value],t.continue()}},n.oncomplete=function(){try{Object.keys(i).forEach(function(t){Object.keys(i[t]).forEach(function(e){i[t][e].sort(function(e,t){return t.timestamp-e.timestamp})})})}catch(e){console.log(e)}return console.log(i),e(i)},n.onerror=function(){return t(n.error)}})}function createElement(e,t){var n=document.createElement(e);return t&&Object.keys(t).forEach(function(e){n[e]=t[e]}),n}function createFab(e){var t=createElement("button",{className:"mdc-fab mdc-fab--without-icon app-fab--absolute mdc-button--raised mdc-fab--exited"}),n=createElement("span",{className:"mdc-fab__icon material-icons",textContent:e});return t.appendChild(n),new mdc.ripple.MDCRipple(t),setTimeout(function(){t.classList.remove("mdc-fab--exited")},200),t}function actionButton(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=createElement("div",{className:"action-button-container"}),a=createElement("div",{className:"submit-button-cont"}),i=createButton(e,t);return i.classList.add("mdc-button--raised","submit-btn"),new mdc.ripple.MDCRipple(i),a.appendChild(i),n.appendChild(a),n}function createExtendedFab(e,t,n,a){var i=createElement("button",{className:"mdc-fab mdc-fab--extended mdc-theme--primary-bg mdc-theme--on-primary",id:n});return a&&i.classList.add("app-fab--absolute"),i.innerHTML='<div class="mdc-fab__ripple"></div>\n                   <span class="material-icons mdc-fab__icon">'+e+'</span>\n                   <span class="mdc-fab__label">'+t+"</span>",new mdc.ripple.MDCRipple(i),i}function createButton(e,t,n){var a=createElement("button",{className:"mdc-button",id:t||""}),i=createElement("span",{className:"mdc-button__label",textContent:e});if(n){var o=createElement("i",{className:"material-icons mdc-button__icon",textContent:n});a.appendChild(o)}return a.appendChild(i),a}function createLi(e){return createElement("li",{className:"mdc-list-item",textContent:e})}function Dialog(e,t,n){this.title=e,this.content=t,this.id=n}function setHeader(e,t){var n=document.getElementById("app-header");return n.querySelector("#section-start").innerHTML=e,n.querySelector("#section-end").innerHTML=t,new mdc.topAppBar.MDCTopAppBar(n)}function createSimpleMenu(e,t){return'\n    <div class="mdc-menu mdc-menu-surface" id="'+t+'">\n    <ul class="mdc-list" role="menu" aria-hidden="true" aria-orientation="vertical" tabindex="-1">\n    '+e.map(function(e){return' <li class="mdc-list-item" role="menuitem">\n        <span class="mdc-list-item__graphic mdc-menu__selection-group-icon">\n        <i class=\'material-icons\'>'+e.icon+'</i>\n        </span>\n        <span class="mdc-list-item__text">'+e.name+"</span>\n        </li>"}).join("")+"\n    </ul>\n    </div>\n  "}function menuItemMap(e,t){var n=createElement("li",{className:"mdc-list-item map-menu-item"});n.setAttribute("role","menuitem");var a='<a target="_blank") href=\'comgooglemaps://?center='+t._latitude+","+t._longitude+'\' class="mdc-list-item__text" on>'+e.name+"</span>";return"Android"===native.getName()&&(a="<a href='geo:"+t._latitude+","+t._longitude+"?q="+t._latitude+","+t._longitude+'\' class="mdc-list-item__text">'+e.name+"</a>"),n.innerHTML="<span class=\"mdc-list-item__graphic mdc-menu__selection-group-icon\">\n    <i class='material-icons'>"+e.icon+"</i>\n    </span>\n    "+a,n}function textFieldTelephone(e){return'\n    <div class="'+(e.customClass?e.customClass:"")+" mdc-text-field mdc-text-field--outlined  mt-10 "+(e.disabled?"mdc-text-field--disabled":"")+" "+(e.label?"":"mdc-text-field--no-label")+"\" id='"+e.id+"'>\n    <input class=\"mdc-text-field__input\" value='"+e.value+"' type='tel' "+(e.disabled?"disabled":"")+'>\n    <div class="mdc-notched-outline">\n    <div class="mdc-notched-outline__leading"></div>\n    '+(e.label?'<div class="mdc-notched-outline__notch">\n    <label for=\'email\' class="mdc-floating-label mdc-floating-label--float-above ">'+e.label+"</label>\n    </div>":"")+'\n    <div class="mdc-notched-outline__trailing"></div>\n    </div>\n    </div>\n    '}function textField(e){return'<div class="mdc-text-field mdc-text-field--outlined full-width '+(e.leadingIcon?"mdc-text-field--with-leading-icon":"")+" "+(e.trailingIcon?"mdc-text-field--with-trailing-icon":"")+" "+(e.disabled?"mdc-text-field--disabled":"")+"\" id='"+e.id+"'>\n    "+(e.leadingIcon?'<i class="material-icons mdc-text-field__icon" tabindex="0" role="button">'+e.leadingIcon+"</i>":"")+"\n    <input autocomplete="+(e.autocomplete?e.autocomplete:"off")+' type="'+(e.type||"text")+'" class="mdc-text-field__input" value="'+(e.value||"")+'"  required="'+(e.required||"false")+'" '+(e.disabled?"disabled":"")+" >\n    "+(e.trailingIcon?'<i class="material-icons mdc-text-field__icon" tabindex="0" role="button">'+e.trailingIcon+"</i>":"")+'\n    \n    <div class="mdc-notched-outline">\n      <div class="mdc-notched-outline__leading"></div>\n      <div class="mdc-notched-outline__notch">\n        <label  class="mdc-floating-label">'+e.label+'</label>\n      </div>\n      <div class="mdc-notched-outline__trailing"></div>\n    </div>\n  </div>'}function textArea(e){return'<div class="mdc-text-field mdc-text-field--textarea" id="'+e.id+'">\n    <textarea  class="mdc-text-field__input" rows="4" cols="40" required="'+e.required+'"></textarea>\n    <div class="mdc-notched-outline">\n      <div class="mdc-notched-outline__leading"></div>\n      <div class="mdc-notched-outline__notch">\n        <label for="textarea" class="mdc-floating-label">'+e.label+'</label>\n      </div>\n      <div class="mdc-notched-outline__trailing"></div>\n    </div>\n  </div>'}function createRadio(e,t){var n=createElement("div",{className:"mdc-radio",id:e});return n.innerHTML='<input class="mdc-radio__native-control" type="radio" id="'+t+'" name="radios">\n    <div class="mdc-radio__background">\n        <div class="mdc-radio__outer-circle"></div>\n        <div class="mdc-radio__inner-circle"></div>\n    </div>\n    <div class="mdc-radio__ripple"></div>\n    ',new mdc.radio.MDCRadio(n),n}Dialog.prototype.create=function(e){var t=createElement("div",{className:"mdc-dialog",role:"alertDialog",id:this.id});t.setAttribute("aria-modal","true"),t.setAttribute("aria-labelledby","Title"),t.setAttribute("aria-describedby","content");var n=createElement("div",{className:"mdc-dialog__container"}),a=createElement("div",{className:"mdc-dialog__surface"}),i=createElement("h2",{className:"mdc-dialog__title"});i.innerHTML=this.title,this.footer=createElement("footer",{className:"mdc-dialog__actions"});var o=createElement("div",{className:"mdc-dialog__content"});this.content instanceof HTMLElement?o.appendChild(this.content):o.innerHTML=this.content,a.appendChild(i),a.appendChild(o),"simple"!==e&&(this.cancelButton=createElement("button",{className:"mdc-button mdc-dialog__button",type:"button",textContent:"Close"}),this.cancelButton.setAttribute("data-mdc-dialog-action","close"),this.okButton=createElement("button",{className:"mdc-button mdc-dialog__button",type:"button",textContent:"Okay"}),this.okButton.setAttribute("data-mdc-dialog-action","accept"),this.footer.appendChild(this.cancelButton),this.footer.appendChild(this.okButton),a.appendChild(this.footer)),n.appendChild(a),t.appendChild(n),t.appendChild(createElement("div",{className:"mdc-dialog__scrim"}));var c=document.getElementById("dialog-container");return c.innerHTML="",c.appendChild(t),new mdc.dialog.MDCDialog(t)};var sliderElement,xStart=null,yStart=null,sliderCallback=null;function swipe(e,t){e&&(sliderCallback=t,(sliderElement=e).addEventListener("touchstart",handleTouchStart,!1),e.addEventListener("touchmove",handleTouchMove,!1))}function removeSwipe(){sliderElement&&(sliderElement.removeEventListener("touchstart",handleTouchStart,!1),sliderElement.removeEventListener("touchmove",handleTouchMove,!1),sliderCallback=sliderElement=null)}function handleTouchStart(e){var t=e.touches[0];xStart=t.clientX,yStart=t.clientY}function handleTouchMove(e){if(xStart){var t=e.touches[0].clientX,n=e.touches[0].clientY,a=t-xStart,i=n-yStart,o={direction:"",element:sliderElement};Math.abs(a)>Math.abs(i)?o.direction=0<a?"left":"right":o.direction=0<i?"down":"up",yStart=xStart=null,sliderCallback(o)}}function AppKeys(){this.mode="production"}function getSuggestions(){if(!ApplicationState.knownLocation)return getSubsWithVenue().then(homeView).catch(function(e){handleError({message:e.message,body:{stack:e.stack||""}})});getKnownLocationSubs().then(homeView).catch(function(e){handleError({message:e.message,body:{stack:e.stack||""}})})}function getKnownLocationSubs(){return new Promise(function(e,t){var n=db.transaction("subscriptions","readwrite"),a=n.objectStore("subscriptions"),i=[],o=ApplicationState.venue;a.openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;if(t)return"CANCELLED"===t.value.status?t.delete():t.value.attachment&&Object.keys(t.value.attachment).forEach(function(e){t.value.attachment[e].type===o.template&&i.push(t.value)}),void t.continue()},n.oncomplete=function(){e(i)}})}function getPendingLocationActivities(){return new Promise(function(e,t){var n=db.transaction("activity"),i=[];n.objectStore("activity").index("status").openCursor("PENDING").onsuccess=function(e){var t=e.target.result;if(t)if(t.value.office===ApplicationState.office)if(t.value.hidden)t.continue();else{var n=void 0;if(n){var a=!1;n.schedule.forEach(function(e){(e.startTime||e.endTime)&&moment(moment().format("DD-MM-YY")).isBetween(moment(e.startTime).format("DD-MM-YY"),moment(e.endTime).format("DD-MM-YY"),null,"[]")&&(e.isValid=!0,a=!0)}),a&&i.push(n),t.continue()}else t.continue()}else t.continue()},n.oncomplete=function(){return e(i)}})}function getSubsWithVenue(){return new Promise(function(e,t){var n=db.transaction("subscriptions","readwrite"),a=n.objectStore("subscriptions"),i=[];a.openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;if(t){if("check-in"!==t.value.template)return"CANCELLED"===t.value.status?t.delete():t.value.venue&&Array.isArray(t.value.venue)&&t.value.venue.length&&(console.log(t.value),i.push(t.value)),void t.continue();t.continue()}},n.oncomplete=function(){e(i)}})}function handleNav(e){return console.log(e),"homeView"===history.state[0]?(history.pushState(["profileView"],null,null),void profileView()):history.back()}function homePanel(e){return" <div class=\"container home-container\">\n  <div class='meta-work'>\n    <ul class='mdc-list subscription-list' id='common-task-list'>\n      "+e.map(function(e){return"<li class='mdc-list-item' id=\""+e.id+'">'+e.name+"\n          <span class='mdc-list-item__meta material-icons'>keyboard_arrow_right</span>\n        </li>"}).join("")+"\n\n      <li class='mdc-list-divider'></li>\n    </ul>\n  </div>\n  <div class='work-tasks'>\n      <div id='text'>\n     \n      </div>\n      <div id ='ar-container'></div>\n      <div id='duty-container'></div>\n      <div id='suggestions-container'></div>\n      <div id='action-button' class='attendence-claims-btn-container mdc-layout-grid__inner'>\n      </div>\n\n  </div>\n  <button class=\"mdc-fab mdc-fab--extended  mdc-theme--primary-bg app-fab--absolute\" id='reports'>\n    <span class=\"material-icons mdc-fab__icon\">description</span>\n    <span class=\"mdc-fab__label\">My Reports</span>\n </button>\n</div>"}function homeHeaderStartContent(e){return'\n  <img class="mdc-top-app-bar__navigation-icon mdc-icon-button image" id=\'profile-header-icon\' onerror="imgErr(this)" src='+(firebase.auth().currentUser.photoURL||"./img/src/empty-user.jpg")+'>\n  <span class="mdc-top-app-bar__title">'+e+"</span>\n"}function homeView(a){document.getElementById("start-load").classList.add("hidden");try{var o=getCommonTasks();progressBar.close(),history.pushState(["homeView"],null,null);var e="";1<ApplicationState.nearByLocations.length&&(e='<button class="material-icons mdc-top-app-bar__action-item mdc-icon-button" aria-label="remove" id=\'change-location\'>clear</button>');var t=getHeader("app-header",homeHeaderStartContent(ApplicationState.venue.location||""),e);ApplicationState.venue||generateCheckInVenueName(t),document.getElementById("change-location")&&document.getElementById("change-location").addEventListener("click",function(){progressBar.open(),manageLocation(3).then(mapView).catch(handleLocationError)}),t.listen("MDCTopAppBar:nav",handleNav),t.root_.classList.remove("hidden");var n=document.getElementById("app-current-panel");n.classList.add("mdc-top-app-bar--fixed-adjust","mdc-layout-grid","pl-0","pr-0");var i=a.length;n.innerHTML=homePanel(o);var c=document.getElementById("common-task-list");if(c){var r=new mdc.list.MDCList(c);r.singleSelection=!0,r.listen("MDCList:action",function(e){var t=o[e.detail.index];if("Change Location"===t.name)return progressBar.open(),void manageLocation(3).then(mapView).catch(handleLocationError);if("Chat"===t.name)return history.pushState(["chatView"],null,null),void chatView();var n=Object.keys(ApplicationState.officeWithCheckInSubs);if(1==n.length)return photoOffice=n[0],history.pushState(["snapView"],null,null),void snapView();var a=new Dialog("Choose Office","<ul class='mdc-list subscription-list' id='dialog-office'>\n         "+n.map(function(e){return"<li class='mdc-list-item'>\n           "+e+"\n           <span class='mdc-list-item__meta material-icons mdc-theme--primary'>\n             keyboard_arrow_right\n           </span>\n           </li>"}).join("")+"\n         </ul>","choose-office-subscription").create("simple"),i=new mdc.list.MDCList(document.getElementById("dialog-office"));bottomDialog(a,i),i.listen("MDCList:action",function(e){photoOffice=n[e.detail.index],history.pushState(["snapView"],null,null),snapView(),a.close()})})}var s=document.querySelector(".work-tasks #text");Promise.all([checkForUpdates(),getYesterdayAtt()]).then(function(e){var t=e[0],n=e[1];t.length||n.length||a.length?(s&&(s.innerHTML='<h3 class="mdc-list-group__subheader mt-0 mb-0">Suggestions</h3>'),createArSuggestion(n),createUpdatesuggestion(t)):s&&(document.querySelector(".work-tasks #text").innerHTML='<h3 class="mdc-list-group__subheader mdc-typography--headline5  mdc-theme--primary">All Tasks Completed</h3>')}).catch(handleError);var l=firebase.auth().currentUser;if(document.getElementById("reports").addEventListener("click",function(){if(l.email&&l.emailVerified)return history.pushState(["reportView"],null,null),void reportView();history.pushState(["emailUpdation"],null,null),emailUpdation(reportView)}),!i)return;if(console.log(a),document.querySelector(".work-tasks #text")&&document.getElementById("suggestions-container")){document.querySelector(".work-tasks #text").innerHTML='<h3 class="mdc-list-group__subheader mt-0 mb-0">Suggestions</h3>',document.getElementById("suggestions-container").innerHTML=templateList(a);var d=new mdc.list.MDCList(document.getElementById("suggested-list"));handleTemplateListClick(d)}}catch(e){console.log(e),handleError({message:e.message,body:JSON.stringify(e.stack)})}}function generateCheckInVenueName(c){var n=ApplicationState.lastCheckInCreated;if(n&&c){var e=firebase.auth().currentUser.phoneNumber,t=db.transaction("addendum"),a=t.objectStore("addendum"),i=[];if(a.indexNames.contains("KeyTimestamp")){var o=e+e,r=IDBKeyRange.only([n,o]);a.index("KeyTimestamp").getAll(r).onsuccess=function(e){e.target.result.length&&(i=e.target.result)}}else a.index("user").openCursor(e).onsuccess=function(e){var t=e.target.result;t&&(t.value.timestamp===n&&i.push(t.value),t.continue())};t.oncomplete=function(){console.log(i),i.length&&i.forEach(function(o){db.transaction("activity").objectStore("activity").get(o.activityId).onsuccess=function(e){var t=e.target.result;if(t&&"check-in"===t.template){var n=o.comment.split(" "),a=n.indexOf("from"),i=n.slice(a+1,n.length).join(" ");console.log(c),console.log(i),c.root_.querySelector(".mdc-top-app-bar__title")&&(c.root_.querySelector(".mdc-top-app-bar__title").textContent=i)}}})}}}function getCommonTasks(){var e=[{name:"Chat",id:"open-chat-list"}];return ApplicationState.officeWithCheckInSubs&&Object.keys(ApplicationState.officeWithCheckInSubs).length&&e.push({name:"Photo Check-In",id:"photo-check-in"}),e}function createUpdatesuggestion(n){var e=document.getElementById("duty-container");if(n.length&&e){e.innerHTML="<ul class='mdc-list subscription-list'>\n    "+n.map(function(e){return"<li class='mdc-list-item'>\n        <span class='mdc-list-item__text'>"+e.activityName+'</span>\n      \n        <span class="mdc-list-item__meta material-icons mdc-theme--primary">\n          keyboard_arrow_right\n      </span>\n        </li>'}).join("")+"\n    <li class='mdc-list-divider'></li>\n  </ul>";var t=new mdc.list.MDCList(e.querySelector("ul"));t.singleSelection=!0,t.selectedIndex=0,t.listen("MDCList:action",function(e){var i=n[e.detail.index],t=createActivityHeading(i),o=createElement("div");o.style.float="right";var c=new Dialog(t,activityDomCustomer(i),"view-form").create();c.open(),c.autoStackButtons=!1,c.buttons_[1].classList.add("hidden"),i.canEdit&&(getStatusArray(i).forEach(function(e){var t=createElement("button",{className:"mdc-button material-icons"});t.style.color=e.color;var n=createElement("span",{className:"mdc-button__label",textContent:e.name}),a=createElement("i",{className:"material-icons mdc-button__icon",textContent:e.icon});t.appendChild(a),t.appendChild(n),t.addEventListener("click",function(){setActivityStatus(i,e.status),c.close()}),o.appendChild(t)}),c.listen("MDCDialog:opened",function(){c.root_.querySelector("#status-change-container").appendChild(o)}))})}}function getYesterdayArDate(){var e=new Date;return console.log(e.setDate(e.getDate()-1)),e.setDate(e.getDate()-1)}function createArSuggestion(e){var t=document.getElementById("ar-container"),c=createElement("ul",{className:"mdc-list subscription-list mdc-list--two-line"});if(e.forEach(function(e){var t=createElement("li",{className:"mdc-list-item"}),n=createElement("span",{className:"mdc-list-item__meta material-icons mdc-theme--primary",textContent:"keyboard_arrow_right"}),a=createElement("span",{className:"mdc-list-item__text"}),i=createElement("span",{className:"mdc-list-item__primary-text"}),o=createElement("span",{className:"mdc-list-item__secondary-text mdc-theme--error",textContent:"Attendance Yesterday : "+e.attendance});o.style.marginTop="5px",o.style.fontSize="1rem",0==e.attendance&&(i.textContent="Apply AR/Leave : "+e.office),0<e.attendance&&e.attendance<1&&(i.textContent="Apply AR : "+e.office),a.appendChild(i),a.appendChild(o),t.appendChild(a),t.addEventListener("click",function(){history.pushState(["reportView"],null,null),reportView(e)}),t.appendChild(n),c.appendChild(t)}),t){t.appendChild(c);var n=new mdc.list.MDCList(c);n.selectedIndex=0,n.singleSelection=!0}}function getYesterdayAtt(){return new Promise(function(e,t){var n=new Date,a=db.transaction("attendance"),i=a.objectStore("attendance").index("key"),o=[];i.openCursor(IDBKeyRange.lowerBound(getYesterdayArDate())).onsuccess=function(e){var t=e.target.result;t&&(t.value.hasOwnProperty("attendance")&&1!=t.value.attendance&&t.value.date===n.getDate()-1&&t.value.month==n.getMonth()&&t.value.year==n.getFullYear()&&o.push(t.value),t.continue())},a.oncomplete=function(){return e(o)},a.onerror=function(){return t(a.error)}})}function checkForUpdates(){return new Promise(function(i,e){var t=moment().valueOf(),n=moment().add(24,"h").valueOf();console.log(n);var a=db.transaction("calendar"),o=[],c=IDBKeyRange.lowerBound(t);a.objectStore("calendar").index("end").openCursor(c).onsuccess=function(e){var t=e.target.result;t&&("CANCELLED"!==t.value.status&&1!=t.value.hidden&&t.value.start&&t.value.end&&t.value.start<=n&&o.push(t.value),t.continue())},a.oncomplete=function(){console.log(o);var t=db.transaction("activity"),n=[];o.forEach(function(e){t.objectStore("activity").get(e.activityId).onsuccess=function(e){var t=e.target.result;t.attachment.Location&&t.attachment.Location.value&&(console.log(t),n.push(t))}}),t.oncomplete=function(){console.log(n);var e=db.transaction("map"),a=[];n.forEach(function(n){e.objectStore("map").index("location").get(n.attachment.Location.value).onsuccess=function(e){var t=e.target.result;t&&t.latitude&&t.longitude&&(1<calculateDistanceBetweenTwoPoints({latitude:t.latitude,longitude:t.longitude},ApplicationState.location)||a.push(n))}}),e.oncomplete=function(){return i(a)}}},a.onerror=function(){return e({message:tx.error,body:""})}})}function handleTemplateListClick(c){c.singleSelection=!0,c.selectedIndex=0,c.listen("MDCList:action",function(e){var t=c.listElements[e.detail.index],n=JSON.parse(t.dataset.office),a=JSON.parse(t.dataset.value);if(1==n.length)return history.pushState(["addView"],null,null),void addView(a[0]);var i=new Dialog("Choose Office",officeSelectionList(a),"choose-office-subscription").create("simple"),o=new mdc.list.MDCList(document.getElementById("dialog-office"));bottomDialog(i,o),o.listen("MDCList:action",function(e){history.pushState(["addView"],null,null),addView(a[e.detail.index]),i.close()})})}function officeSelectionList(e){return"<ul class='mdc-list subscription-list' id='dialog-office'>\n    "+e.map(function(e){return"<li class='mdc-list-item'>\n      "+e.office+"\n      <span class='mdc-list-item__meta material-icons mdc-theme--primary'>\n        keyboard_arrow_right\n      </span>\n      </li>"}).join("")+"\n    </ul>"}function bottomDialog(e,t){t.singleSelection=!0,t.selectedIndex=0,setTimeout(function(){e.root_.querySelector(".mdc-dialog__surface").classList.add("open"),t.foundation_.adapter_.focusItemAtIndex(0)},50),e.listen("MDCDialog:opened",function(){t.layout()}),e.listen("MDCDialog:closing",function(){e.root_.querySelector(".mdc-dialog__surface").classList.remove("open")}),e.open()}function pendinglist(e){return'\n  <ul class="mdc-list subscription-list" role="group" aria-label="List with checkbox items" id=\'confirm-tasks\'>\n    '+e.map(function(e,t){return'\n      <li class="mdc-list-item" role="checkbox" aria-checked="false">\n      Confirm '+e.activityName+' ?    \n      <div class=\'mdc-checkbox mdc-list-item__meta\'>\n        <input type="checkbox"\n                class="mdc-checkbox__native-control"\n                id="demo-list-checkbox-item-'+t+'" />\n        <div class="mdc-checkbox__background">\n          <svg class="mdc-checkbox__checkmark"\n                viewBox="0 0 24 24">\n            <path class="mdc-checkbox__checkmark-path"\n                  fill="none"\n                  d="M1.73,12.91 8.1,19.28 22.79,4.59"/>\n          </svg>\n          <div class="mdc-checkbox__mixedmark"></div>\n        </div>\n      </div>   \n    </li>'}).join()+"\n  </ul>\n  "}function templateList(e){var o=createElement("ul",{className:"mdc-list subscription-list",id:"suggested-list"});return e.forEach(function(e){var t=o.querySelector('[data-template="'+e.template+'"]');if(t){var n=JSON.parse(t.dataset.office);n.push(e.office);var a=JSON.parse(t.dataset.value);a.push(e),t.dataset.office=JSON.stringify(n),t.dataset.value=JSON.stringify(a)}else{var i=createElement("li",{className:"mdc-list-item"});i.dataset.template=e.template,i.dataset.office=JSON.stringify([e.office]),i.dataset.value=JSON.stringify([e]),i.innerHTML=formatTextToTitleCase("Create New "+e.template)+"\n      <span class='mdc-list-item__meta material-icons mdc-theme--primary'>\n        keyboard_arrow_right\n      </span>",o.appendChild(i)}}),o.outerHTML}function updateName(){var e=firebase.auth().currentUser;getHeader("app-header","<a class='mdc-top-app-bar__navigation-icon material-icons'>arrow_back</a>\n  <span class=\"mdc-top-app-bar__title\">Update Name</span>\n  ","");document.getElementById("app-current-panel").innerHTML="<div class='mdc-layout-grid change-name'>\n\n<div class=\"mdc-text-field mdc-text-field--outlined mt-10\" id='name'>\n  <input class=\"mdc-text-field__input\" required value='"+firebase.auth().currentUser.displayName+'\' type=\'text\' >\n <div class="mdc-notched-outline">\n     <div class="mdc-notched-outline__leading"></div>\n     <div class="mdc-notched-outline__notch">\n           <label for=\'email\' class="mdc-floating-label mdc-floating-label--float-above ">Name</label>\n     </div>\n     <div class="mdc-notched-outline__trailing"></div>\n </div>\n</div>\n<div class="mdc-text-field-helper-line">\n  <div class="mdc-text-field-helper-text mdc-text-field-helper-text--validation-msg\t">\n  </div>\n</div>\n\n<div  class=\'mb-10 mt-10\'>\n  <button class=\'mdc-button mdc-theme--primary-bg\' id=\'name-btn\'>\n  <span class=\'mdc-button__label mdc-theme--on-primary\'>Update<span>\n</button>\n</div>\n  </div>';var t=new mdc.textField.MDCTextField(document.getElementById("name"));t.focus(),document.getElementById("name-btn").addEventListener("click",function(){if(!t.value)return t.focus(),t.foundation_.setValid(!1),t.foundation_.adapter_.shakeLabel(!0),void(t.helperTextContent="Name Cannot Be Left Blank");progressBar.open(),e.updateProfile({displayName:t.value.trim()}).then(function(){progressBar.close(),history.back(),snacks("Name Updated Successfully")})})}function getEmailViewHeading(e){var t={topBarText:"",heading:"",btnText:"Update"};return e.email?e.emailVerified?(t.topBarText="Update Email",t.btnText="Update"):(t.topBarText="Verify Email",t.heading="Please Verify Your Email Address To Continue",t.btnText="Verify"):(t.topBarText="Add Email",t.heading="Please Add You Email Address To Continue"),t}function emailUpdation(a,i){var o=firebase.auth().currentUser,c=getEmailViewHeading(o),e="<a class='mdc-top-app-bar__navigation-icon material-icons'>arrow_back</a>\n  <span class=\"mdc-top-app-bar__title\">"+c.topBarText+"</span>\n  ";getHeader("app-header",e,"").root_.classList.remove("hidden"),getEmployeeDetails(IDBKeyRange.bound(["recipient","CONFIRMED"],["recipient","PENDING"]),"templateStatus").then(function(e){document.getElementById("app-current-panel").innerHTML="<div class='mdc-layout-grid update-email'>\n        \n    "+updateEmailDom(o.email,getReportOffices(e),c)+"\n    </div>";var t=new mdc.textField.MDCTextField(document.getElementById("email"));if(t.focus(),document.getElementById("email-btn").addEventListener("click",function(){return console.log(t),emailReg(t.value)?(progressBar.open(),o.email?t.value!==o.email?void emailUpdate(t.value,a):o.emailVerified?(progressBar.close(),setHelperInvalid(t),void(t.helperTextContent="New Email Cannot Be Same As Previous Email")):void emailVerification(a):void emailUpdate(t.value,a)):(setHelperInvalid(t),void(t.helperTextContent="Enter A Valid Email Id"))}),!e.length&&!i){var n=new mdc.ripple.MDCRipple(document.getElementById("skip-btn"));n.root_.classList.remove("hidden"),n.root_.addEventListener("click",function(){history.pushState([""+a],null,null),a()})}})}function emailUpdate(e,t){firebase.auth().currentUser.updateEmail(e).then(function(){emailVerification(t)}).catch(handleEmailError)}function emailVerification(e){firebase.auth().currentUser.sendEmailVerification().then(function(){snacks("Email Verification Has Been Sent."),progressBar.close(),history.pushState(["emailVerificationWait"],null,null),emailVerificationWait(e)}).catch(handleEmailError)}function emailVerificationWait(t){var n=firebase.auth().currentUser;document.getElementById("app-current-panel").innerHTML="<div class='mdc-layout-grid'>\n  <h3 class='mdc-typography--headline6'>Verification Link Has Been Sent To "+firebase.auth().currentUser.email+"</h3>\n  <p class='mdc-typography--body1'>Click Continue To Proceed Further</p>\n  <button class='mdc-button mdc-theme--primary-bg mt-10' id='continue'>\n  <span class='mdc-button__label mdc-theme--on-primary'>CONTINUE</span>\n  </button>\n</div>",document.getElementById("continue").addEventListener("click",function(e){progressBar.open(),firebase.auth().currentUser.reload(),setTimeout(function(){if(firebase.auth().currentUser.reload(),!n.emailVerified)return snacks("Email Not Verified. Try Again"),void progressBar.close();progressBar.close(),history.pushState([""+t],null,null),t()},2e3)})}function handleEmailError(e){(progressBar.close(),"auth/requires-recent-login"!==e.code)?snacks(e.message):showReLoginDialog("Email Authentication","Please Login Again To Complete The Operation").listen("MDCDialog:closed",function(e){"accept"===e.detail.action&&revokeSession()})}function getReportOffices(e){var n=[];return e.forEach(function(e,t){-1<n.indexOf(e.office)||n.push(e.office)}),n.length?"You Are A Recipient In Reports for "+n.join(", ").replace(/,(?!.*,)/gim," &"):""}function updateEmailDom(e,t,n){return"\n\n<h3 class='mdc-typography--headline6'>"+n.heading+"</h3>\n<p class='report-rec mt-10 mdc-typography--body1'>\n"+t+'\n</p>\n\n<div class="mdc-text-field mdc-text-field--outlined mt-10" id=\'email\'>\n  <input class="mdc-text-field__input" required value=\''+(e||"")+'\' type=\'email\'>\n <div class="mdc-notched-outline">\n     <div class="mdc-notched-outline__leading"></div>\n     <div class="mdc-notched-outline__notch">\n           <label for=\'email\' class="mdc-floating-label '+(e?"mdc-floating-label--float-above":"")+"\">Email</label>\n     </div>\n     <div class=\"mdc-notched-outline__trailing\"></div>\n </div>\n</div>\n<div class=\"mdc-text-field-helper-line\">\n  <div class=\"mdc-text-field-helper-text mdc-text-field-helper-text--validation-msg\t\">\n  </div>\n</div>\n\n<div  class='mb-10 mt-10'>\n<button class='mdc-button mdc-theme--primary-bg' id='email-btn'>\n<span class='mdc-button__label mdc-theme--on-primary'>"+n.btnText+"<span>\n</button>\n\n<button class='mdc-button mt-10 hidden' id='skip-btn'>\n<span class='mdc-button__label'>SKIP<span>\n</button>\n\n</div>\n"}function incentiveView(){var e=document.querySelector(".tabs-section .data-container");if(e){e.innerHTML=incentiveDom();var t=document.getElementById("incentive-view");getSubscription("","customer").then(function(e){e.length&&t&&t.appendChild(createTemplateButton(e))}).catch(function(e){handleError({message:e.message,body:{stack:e.stack||""}})})}}function incentiveDom(){return"<div class='incentive-section report-view' id='incentive-view'>\n  </div>"}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}AppKeys.prototype.getMode=function(){return this.mode},AppKeys.prototype.getMapKey=function(){return"production"===this.mode?"AIzaSyA4s7gp7SFid_by1vLVZDmcKbkEcsStBAo":"AIzaSyCadBqkHUJwdcgKT11rp_XWkbQLFAy80JQ"},AppKeys.prototype.getKeys=function(){return"production"===this.mode?{apiKey:this.getMapKey(),authDomain:"growthfile-207204.firebaseapp.com",databaseURL:"https://growthfile-207204.firebaseio.com",projectId:"growthfile-207204",storageBucket:"growthfile-207204.appspot.com",messagingSenderId:"701025551237"}:{apiKey:this.getMapKey(),authDomain:"growthfilev2-0.firebaseapp.com",projectId:"growthfilev2-0",messagingSenderId:"1011478688238"}},AppKeys.prototype.getBaseUrl=function(){return"production"===this.mode?"https://api2.growthfile.com/api/":"https://us-central1-growthfilev2-0.cloudfunctions.net/api/"};var db,EMAIL_REAUTH,firebaseUI,appKey=new AppKeys,progressBar=void 0,snackBar=void 0,DB_VERSION=30,sliderIndex=1,sliderTimeout=1e4;function imgErr(e){return e.onerror="",e.src="./img/empty-user.jpg",!0}window.addEventListener("error",function(e){-1<e.message.toLowerCase().indexOf("script error")?this.console.log(e):handleError({message:"global error :"+e.message,body:{lineno:e.lineno,filename:e.filename,colno:e.colno,error:JSON.stringify({stack:e.error.stack,message:e.error.message})}})});var globMark,native={setFCMToken:function(e){localStorage.setItem("token",e)},getFCMToken:function(){return localStorage.getItem("token")},setName:function(e){localStorage.setItem("deviceType",e)},getName:function(){return localStorage.getItem("deviceType")},setIosInfo:function(e){var t=new URLSearchParams(e),n={};t.forEach(function(e,t){n[t]="appVersion"===t?Number(e):e}),localStorage.setItem("deviceInfo",JSON.stringify(n))},getIosInfo:function(){return localStorage.getItem("deviceInfo")},getInfo:function(){return!!this.getName()&&("Android"===this.getName()?(localStorage.getItem("deviceInfo")||localStorage.setItem("deviceInfo",getAndroidDeviceInformation()),localStorage.getItem("deviceInfo")):this.getIosInfo())}};function getAndroidDeviceInformation(){return JSON.stringify({id:AndroidInterface.getId(),deviceBrand:AndroidInterface.getDeviceBrand(),deviceModel:AndroidInterface.getDeviceModel(),osVersion:AndroidInterface.getOsVersion(),baseOs:AndroidInterface.getBaseOs(),radioVersion:AndroidInterface.getRadioVersion(),appVersion:Number(AndroidInterface.getAppVersion())})}function initializeApp(){window.addEventListener("load",function(){firebase.initializeApp(appKey.getKeys()),progressBar=new mdc.linearProgress.MDCLinearProgress(document.querySelector("#app-header .mdc-linear-progress")),snackBar=new mdc.snackbar.MDCSnackbar(document.querySelector(".mdc-snackbar")),topBar=new mdc.topAppBar.MDCTopAppBar(document.querySelector(".mdc-top-app-bar"));var n=this.document.getElementById("app-current-panel");window.Worker||window.indexedDB?firebase.auth().onAuthStateChanged(function(e){if(!e)return history.pushState(["userSignedOut"],null,null),void userSignedOut();var t=new mdc.topAppBar.MDCTopAppBar(document.getElementById("app-header"));return t.listen("MDCTopAppBar:nav",handleNav),t.root_.classList.add("hidden"),"production"!==appKey.getMode()||native.getInfo()?(n.classList.remove("hidden"),EMAIL_REAUTH?(history.pushState(["reportView"],null,null),history.pushState(["profileView"],null,null),history.pushState(["emailUpdation"],null,null),void emailUpdation(!1,function(){EMAIL_REAUTH=!1,history.back()})):(localStorage.setItem("error",JSON.stringify({})),void checkNetworkValidation())):redirect()}):new Dialog("App Incompatiblity","Growthfile is incompatible with this device").create().open()}),window.addEventListener("orientationchange",function(){var e=this.document.querySelector(".action-button-container .submit-button-cont");e&&(90==this.screen.orientation.angle&&(e.style.position="relative"),0==this.screen.orientation.angle&&(e.style.position="fixed"))})}function checkNetworkValidation(){navigator.onLine?startApp():failureScreen({message:"You Are Currently Offline. Please Check Your Internet Connection",icon:"wifi_off",title:"BROKEN INTERNET CONNECTION"},checkNetworkValidation)}function firebaseUiConfig(){return{callbacks:{signInSuccessWithAuthResult:function(e){return console.log(e),!1},signInFailure:function(e){return handleUIError(e)},uiShown:function(){}},signInFlow:"popup",signInOptions:[{provider:firebase.auth.PhoneAuthProvider.PROVIDER_ID,recaptchaParameters:{type:"image",size:"invisible",badge:"bottomleft"},defaultCountry:"IN"}]}}function initializeFirebaseUI(){document.getElementById("app-header").classList.remove("hidden");header=setHeader("<a class='mdc-top-app-bar__navigation-icon material-icons'>arrow_back</a>\n  <span class=\"mdc-top-app-bar__title\">Login</span>\n  ",""),header.listen("MDCTopAppBar:nav",handleNav),(firebaseUI=firebaseui.auth.AuthUI.getInstance()||new firebaseui.auth.AuthUI(firebase.auth())).start(document.getElementById("login-container"),firebaseUiConfig())}function userSignedOut(){progressBar.close(),document.getElementById("dialog-container").innerHTML="",document.getElementById("step-ui").innerHTML="",document.getElementById("app-header").classList.add("hidden"),firebaseUI&&firebaseUI.delete();var e=document.getElementById("app-current-panel");e.innerHTML="\n    <div class='slider' id='app-slider'>\n      <div class='slider-container'>\n        <div class='slider-content'>\n          <div class='graphic-container'>\n            <img src='./img/ic_launcher.png'>\n          </div>\n\n          <div class='text'>\n              <p class='mdc-typography--headline6 text-center mb-0'>\n                Welcome to Growthfile\n              </p>\n              <p class='mdc-typography--body1 text-center p-10'>\n                Mark attendance on Growthfile to avoid deductions in salary and expenses\n              </p>\n          </div>\n        </div>\n        \n\n      </div>\n    </div>\n    <div class=\"action-button-container\">\n          <div class=\"submit-button-cont\">\n              <div class='dot-container'>\n                <span class='dot active'></span>\n                <span class='dot'></span>\n                <span class='dot'></span>\n              </div>\n              <div class='mdc-typography--body1 mb-10'>\n                <div class='text-center'>\n                  <a href='https://www.growthfile.com/legal.html#privacy-policy'>Privacy Policy</a> &\n                  <a href='https://www.growthfile.com/legal.html#terms-of-use-user'>Terms of use</a>\n                </div>\n              </div>\n              <button class=\"mdc-button mdc-button--raised submit-btn\" data-mdc-auto-init=\"MDCRipple\"\n                  id='login-btn'>\n                  <div class=\"mdc-button__ripple\"></div>\n                  \n                  <span class=\"mdc-button__label\">Agree & Continue</span>\n              </button>\n          </div>\n        </div>\n  ";var t=document.getElementById("app-slider");new mdc.ripple.MDCRipple(document.getElementById("login-btn")).root_.addEventListener("click",function(){removeSwipe(),e.innerHTML="",history.pushState(["login"],null,null),initializeFirebaseUI()});setInterval(function(){sliderSwipe({element:t,direction:"right"})},sliderTimeout);swipe(t,sliderSwipe)}function sliderSwipe(e){var t=e.element;"left"===e.direction&&(sliderIndex<=1?sliderIndex=3:sliderIndex--),"right"===e.direction&&(3<=sliderIndex?sliderIndex=1:sliderIndex++),loadSlider(t),[].concat(_toConsumableArray(document.querySelectorAll(".dot"))).forEach(function(e,t){e.classList.remove("active"),t==sliderIndex-1&&e.classList.add("active")})}function loadSlider(e){var t="";switch(sliderIndex){case 1:t="<div class='graphic-container'>\n      <img src='./img/ic_launcher.png'>\n    </div>\n\n    <div class='text'>\n        <p class='mdc-typography--headline6 text-center mb-0'>\n          Welcome to Growthfile\n        </p>\n        <p class='mdc-typography--body1 text-center p-10'>\n          Mark attendance on Growthfile to avoid deductions in salary and expenses\n        </p>\n    </div>";break;case 2:t="\n        <div class='icon-container'>\n          <i class='material-icons mdc-theme--primary'>room</i>\n\n        </div>\n        <div class='text-container'>\n          <ul class='slider-list'>\n            <li>Mark attendance on your phone</li>\n            <li>Branch, customer or unknown location</li>\n            <li>Calculate kilometres traveled</li>\n          </ul>\n        </div>\n        ";break;case 3:t="\n        <div class='image-container'>\n            <img src='./img/currency_large.png' class='currency-primary'>\n        </div>\n        <div class='text-container'>\n        <ul class='slider-list'>\n            <li>Daily payment calculation</li>\n            <li>Online bank transfer</li>\n            <li>Offer letter, payslip & form 16</li>\n            \n        </ul>\n        </div>\n        "}e.querySelector(".slider-content").innerHTML=t}function loadingScreen(){var e=document.getElementById("app-current-panel"),t=["Loading Growthfile","Getting Your Data","Creating Profile","Please Wait"];e.innerHTML="\n  <div class='splash-content' id='loading-screen'>\n\n      <div class='graphic-container'>\n        <img src='./img/ic_launcher.png'>\n      </div>\n  \n      <div class='text'>\n\n        <p class='mdc-typography--headline6 text-center mb-0'>\n            Growthfile is free to use for any employee of any company\n        </p>\n        <p class='mdc-typography--subtitle2 text-center'>\n          No more queries, disputes, delays or deductions from your monthly salary & other payments\n        </p>\n    </div>\n\n    <div class=\"showbox\" id='start-load'>\n    <div class=\"loader\">\n      <svg class=\"circular\" viewBox=\"25 25 50 50\">\n        <circle class=\"path\" cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-width=\"4\" stroke-miterlimit=\"10\"/>\n      </svg>\n    </div>\n    <p class=\"mdc-typography--subtitle2 mdc-theme--primary\"></p>\n  </div>\n    <div class='icon-cont mdc-layout-grid__inner mt-20'>\n        <div class='mdc-layout-grid__cell--span-2-phone mdc-layout-grid__cell--span-4-tablet mdc-layout-grid__cell--span-6-desktop'>\n          <div class='icon text-center'>\n            <i class='material-icons mdc-theme--primary'>room</i>\n            <p class='mt-10 mdc-typography--subtitle1 mdc-theme--primary'>Check-in</p>\n          </div>\n        </div>\n       \n        <div class='mdc-layout-grid__cell--span-2-phone mdc-layout-grid__cell--span-4-tablet mdc-layout-grid__cell--span-6-desktop'>\n          <div class='icon text-center'>\n            <img src='./img/currency.png' class='currency-primary'>\n            <p class='mt-10 mdc-typography--subtitle1 mdc-theme--primary'>Incentives</p>\n          </div>\n        </div>\n\n      </div>\n  </div>\n  ";var n=document.getElementById("start-load"),a=0,i=setInterval(function(){a==t.length-1&&clearInterval(i),n.querySelector("p").textContent=t[a],a++},a+1e3)}function startApp(){var i=firebase.auth().currentUser.uid,t=window.indexedDB.open(i,DB_VERSION);t.onupgradeneeded=function(e){if((db=t.result).onerror=function(){handleError({message:""+db.error.message})},e.oldVersion){createReportObjectStores(db),db.objectStoreNames.contains("list")&&db.deleteObjectStore("list"),db.objectStoreNames.contains("reports")&&db.deleteObjectStore("reports");var n=t.transaction.objectStore("root");n.get(i).onsuccess=function(e){var t=e.target.result;t.fromTime=0,n.put(t)},console.log("version upgrade")}else createObjectStores(db,i)},t.onsuccess=function(){console.log("request success"),db=t.result,console.log("run app"),loadingScreen(),requestCreator("now",{device:native.getInfo(),from:"",registerToken:native.getFCMToken()}).then(function(t){if(t.updateClient)updateApp();else if(t.revokeSession)revokeSession(!0);else{var n=void 0,e=db.transaction("root","readwrite"),a=e.objectStore("root");a.get(i).onsuccess=function(e){(n=e.target.result).linkedAccounts=t.linkedAccounts||[],t.idProofs&&(n.idProofs=t.idProofs),a.put(n)},e.oncomplete=function(){if(!n.fromTime)return requestCreator("Null").then(initProfileView).catch(console.error);initProfileView(),runRead({read:"1"})}}}).catch(console.error)},t.onerror=function(){handleError({message:""+t.error.name,body:JSON.stringify(t.error.message)})}}function initProfileView(){document.getElementById("app-header").classList.remove("hidden"),history.pushState(["profileCheck"],null,null),profileCheck()}function miniProfileCard(e,t,n){return"<div class='mdc-card profile-update-init'>\n  \n  <div class='content-area'>\n  <div id='primary-content'>\n  \n  "+e+"\n  </div>\n  </div>\n  "+n+"\n</div>"}function increaseStep(e){var t=e-1;0!=t&&(document.getElementById("step"+t).classList.remove("is-active"),document.getElementById("step"+t).classList.add("is-complete")),document.getElementById("step"+e).classList.add("is-active")}function checkForPhoto(){if(firebase.auth().currentUser.photoURL)return increaseStep(3),void checkForEmail();increaseStep(2);document.getElementById("app-current-panel").innerHTML=miniProfileCard('\n\n      <div class=\'photo-container\'>\n      <img src="./img/empty-user.jpg" id="image-update">\n      <button class="mdc-fab mdc-theme--primary-bg" aria-label="Favorite">\n        <span class="mdc-fab__icon material-icons mdc-theme--on-primary">camera</span>\n        <input type=\'file\' accept=\'image/jpeg;capture=camera\' id=\'choose\'>\n      </button>\n      </div>\n  \n      ',' <span class="mdc-top-app-bar__title">Add Your Profile Picture</span>',""),document.getElementById("choose").addEventListener("change",function(e){getImageBase64(e).then(function(e){return requestCreator("backblaze",{imageBase64:document.getElementById("image-update").src=e})}).then(checkForEmail).catch(function(e){snacks(e.message)})})}function checkForEmail(){var e=firebase.auth().currentUser;if(e.email&&e.emailVerified)return increaseStep(4),void checkForId();getRootRecord().then(function(e){if(e.skipEmail)return increaseStep(4),void checkForId();increaseStep(3),emailUpdation(!0,function(){checkForId()})})}function checkForId(){getRootRecord().then(function(e){if(e.skipIdproof||e.idProofs)return increaseStep(5),void checkForBankAccount();increaseStep(4),idProofView(checkForBankAccount)})}function checkForBankAccount(){getRootRecord().then(function(e){e.skipBankAccountAdd||e.linkedAccounts.length?openMap():(increaseStep(5),addNewBankAccount(openMap))})}function resizeAndCompressImage(e){var t=document.createElement("canvas"),n=new CanvasDimension(e.width,e.height);n.setMaxHeight(screen.height),n.setMaxWidth(screen.width);var a=n.getNewDimension();return t.width=a.width,t.height=a.height,t.getContext("2d").drawImage(e,0,0,a.width,a.height),t.toDataURL("image/jpeg",.5)}function CanvasDimension(e,t){this.MAX_HEIGHT="",this.MAX_WIDTH="",this.width=e,this.height=t}function showReLoginDialog(e,t){var n=new Dialog(e,'<h3 class="mdc-typography--headline6 mdc-theme--primary">'+t+"</h3>").create();return n.open(),n.buttons_[1].textContent="RE-LOGIN",n}function getProfileCompletionTabs(){firebase.auth().currentUser;return'<div class="step-container mdc-top-app-bar--fixed-adjust">\n  <div class="progress">\n    <div class="progress-track"></div>\n    <div id="step1" class="progress-step">\n      <i class=\'material-icons\'>person</i>\n    </div>\n    <div id="step2" class="progress-step">\n      <i class=\'material-icons\'>camera</i>\n    </div>\n    <div id="step3" class="progress-step">\n      <i class=\'material-icons\'>email</i>\n    </div>\n    <div id="step4" class="progress-step">\n      <i class=\'material-icons\'>verified_user</i>\n     </div>\n    <div id="step5" class="progress-step">\n      <i class=\'material-icons\'>payment</i>\n    </div>\n  </div>\n\n</div>'}function profileCheck(){var e=firebase.auth().currentUser;if(document.getElementById("step-ui").innerHTML=getProfileCompletionTabs(),!e.displayName)return document.getElementById("app-header").classList.remove("hidden"),increaseStep(1),void updateName(function(){checkForPhoto()});increaseStep(2),checkForPhoto()}function areObjectStoreValid(e){for(var t=["map","children","calendar","root","subscriptions","list","users","activity","addendum"],n=0;n<t.length;n++){var a=t[n];if(!e.contains(a))return{"not-present":a,isValid:!1}}return{"not-present":"",isValid:!0}}function getEmployeeDetails(a,i){return new Promise(function(n,e){var t=db.transaction(["children"]).objectStore("children").index(i).getAll(a);t.onsuccess=function(e){var t=e.target.result;return console.log(t),n(t)},t.onerror=function(){return e({message:t.error,body:""})}})}function createReportObjectStores(e){if(!e.objectStoreNames.contains("attendance")){var t=e.createObjectStore("attendance",{keyPath:"id"});t.createIndex("key","key"),t.createIndex("date","date"),t.createIndex("month","month"),t.createIndex("office","office"),t.createIndex("attendance","attendance")}if(!e.objectStoreNames.contains("payment")){var n=e.createObjectStore("payment",{keyPath:"id"});n.createIndex("key","key"),n.createIndex("date","date"),n.createIndex("month","month"),n.createIndex("year","year"),n.createIndex("status","status"),n.createIndex("office","office")}if(!e.objectStoreNames.contains("reimbursement")){var a=e.createObjectStore("reimbursement",{keyPath:"id"});a.createIndex("key","key"),a.createIndex("date","date"),a.createIndex("month","month"),a.createIndex("year","year"),a.createIndex("office","office")}}function createObjectStores(e,t){var n=e.createObjectStore("activity",{keyPath:"activityId"});n.createIndex("timestamp","timestamp"),n.createIndex("office","office"),n.createIndex("hidden","hidden"),n.createIndex("template","template"),n.createIndex("status","status");var a=e.createObjectStore("users",{keyPath:"mobile"});a.createIndex("displayName","displayName"),a.createIndex("isUpdated","isUpdated"),a.createIndex("count","count"),a.createIndex("mobile","mobile"),a.createIndex("timestamp","timestamp"),a.createIndex("NAME_SEARCH","NAME_SEARCH");var i=e.createObjectStore("addendum",{autoIncrement:!0});i.createIndex("activityId","activityId"),i.createIndex("user","user"),i.createIndex("key","key"),i.createIndex("KeyTimestamp",["timestamp","key"]);var o=e.createObjectStore("subscriptions",{autoIncrement:!0});o.createIndex("office","office"),o.createIndex("template","template"),o.createIndex("officeTemplate",["office","template"]),o.createIndex("validSubscription",["office","template","status"]),o.createIndex("templateStatus",["template","status"]),o.createIndex("status","status"),o.createIndex("count","count"),o.createIndex("report","report");var c=e.createObjectStore("calendar",{autoIncrement:!0});c.createIndex("activityId","activityId"),c.createIndex("timestamp","timestamp"),c.createIndex("start","start"),c.createIndex("end","end"),c.createIndex("office","office"),c.createIndex("urgent",["status","hidden"]),c.createIndex("onLeave",["template","status","office"]);var r=e.createObjectStore("map",{autoIncrement:!0});r.createIndex("activityId","activityId"),r.createIndex("location","location"),r.createIndex("latitude","latitude"),r.createIndex("longitude","longitude"),r.createIndex("nearby",["status","hidden"]),r.createIndex("byOffice",["office","location"]),r.createIndex("bounds",["latitude","longitude"]),r.createIndex("office","office"),r.createIndex("status","status"),r.createIndex("selection",["office","status","location"]);var s=e.createObjectStore("children",{keyPath:"activityId"});s.createIndex("template","template"),s.createIndex("office","office"),s.createIndex("templateStatus",["template","status"]),s.createIndex("officeTemplate",["office","template"]),s.createIndex("employees","employee"),s.createIndex("employeeOffice",["employee","office"]),s.createIndex("team","team"),s.createIndex("teamOffice",["team","office"]),createReportObjectStores(e),e.createObjectStore("root",{keyPath:"uid"}).put({uid:t,fromTime:0,location:""})}function redirect(){firebase.auth().signOut().then(function(){window.location="https://www.growthfile.com"}).catch(function(e){console.log(e),window.location="https://www.growthfile.com",handleError({message:e+" from redirect"})})}function getUniqueOfficeCount(){return new Promise(function(e,t){var n=[],a=db.transaction("children");a.objectStore("children").index("employees").openCursor(firebase.auth().currentUser.phoneNumber).onsuccess=function(e){var t=e.target.result;t&&("CANCELLED"!==t.value.status&&n.push(t.value.office),t.continue())},a.oncomplete=function(){return e(n)},a.onerror=function(){return t({message:a.error.message,body:JSON.stringify(a.error)})}})}function hasDataInDB(){return new Promise(function(e){var t=db.transaction(["activity","subscriptions"]),n=t.objectStore("activity").count(),a=t.objectStore("subscriptions").count(),i=void 0,o=void 0;n.onsuccess=function(){i=n.result},a.onsuccess=function(){o=a.result},t.oncomplete=function(){return e(!(!i&&!o))}})}function getCheckInSubs(){return new Promise(function(e){var n={},t=db.transaction("subscriptions");t.objectStore("subscriptions").index("templateStatus").openCursor(IDBKeyRange.bound(["check-in","CONFIRMED"],["check-in","PENDING"])).onsuccess=function(e){var t=e.target.result;t&&(n[t.value.office]?n[t.value.office].timestamp<=t.value.timestamp&&(n[t.value.office]=t.value):n[t.value.office]=t.value,t.continue())},t.oncomplete=function(){return e(n)}})}function openMap(){document.getElementById("step-ui").innerHTML="",progressBar.open(),appLocation(3).then(function(o){progressBar.close(),getCheckInSubs().then(function(e){if(!Object.keys(e).length)return ApplicationState.location=o,localStorage.setItem("ApplicationState",JSON.stringify(ApplicationState)),history.pushState(["searchOffice",o],null,null),void searchOffice(o);ApplicationState.officeWithCheckInSubs=e;var t=localStorage.getItem("ApplicationState");if(!t)return mapView(o);var n=JSON.parse(t);if(!n.lastCheckInCreated)return mapView(o);var a=isLastLocationOlderThanThreshold(n.lastCheckInCreated,300),i=isLocationMoreThanThreshold(calculateDistanceBetweenTwoPoints(n.location,o));return a||i?mapView(o):(ApplicationState=n,history.pushState(["reportView"],null,null),reportView())})}).catch(function(e){progressBar.close(),handleLocationError(e,!0)})}function fillVenueInCheckInSub(e,t){var n=e.venue[0];return e.venue=[{geopoint:{latitude:t.latitude||"",longitude:t.longitude||""},location:t.location||"",address:t.address||"",venueDescriptor:n}],e}function reloadPage(){window.location.reload(!0)}function calculateSpeed(e,t){return e/t}function distanceDelta(e,t){return calculateDistanceBetweenTwoPoints(e,t)}function timeDelta(t,n){try{return moment.duration(moment(n).diff(t)).asHours()}catch(e){return console.log(e),(n-t)/36e6}}function getStoredLocation(){var e=localStorage.getItem("ApplicationState");if(e)return JSON.parse(e).location}function isLocationOld(e,t){return!!t&&(t.latitude===e.latitude&&t.longitude===e.longitude)}function isLocationMoreThanThreshold(e){return 1<=e}function isLastLocationOlderThanThreshold(t,e){try{var n=moment();return e<moment.duration(n.diff(t)).asSeconds()}catch(e){return Math.abs((Date.now()-t)/1e3)}}function toRad(e){return e*Math.PI/180}function calculateDistanceBetweenTwoPoints(e,t){var n=toRad(t.latitude-e.latitude),a=toRad(t.longitude-e.longitude),i=toRad(t.latitude),o=toRad(e.latitude),c=Math.sin(n/2)*Math.sin(n/2)+Math.sin(a/2)*Math.sin(a/2)*Math.cos(i)*Math.cos(o);return 6371*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)))}function GetOffsetBounds(e,t){var n=180/Math.PI;this.latLng=e,this.ratio=t/6378*n,this.radioLon=this.ratio/Math.cos(this.latLng.latitude*Math.PI/180)}function getCellularInformation(){var e=void 0,t=AndroidInterface.getMobileCountryCode(),n=AndroidInterface.getMobileNetworkCode(),a=AndroidInterface.getRadioType(),i=AndroidInterface.getCarrier(),o=AndroidInterface.getWifiAccessPoints();try{e=AndroidInterface.getCellTowerInformation()}catch(e){handleError({message:e.message,body:{mcc:t,mnc:n,radioType:a,carrier:i}})}var c=[],r=[];o&&(c=parseWifiQuery(o)),e&&(r=removeFalseCellIds(parseQuery(e,t,n)));var s={};return t&&(s.homeMobileCountryCode=Number(t)),n&&(s.homeMobileNetworkCode=Number(n)),i&&(s.carrier=i),a&&(s.radioType=a),c.length&&(s.wifiAccessPoints=c),r.length&&(s.cellTowers=r),c.length&&r.length?s.considerIp=!1:s.considerIp=!0,s}function removeFalseCellIds(e){var t=2147483647;return e.filter(function(e){return 0<e.cellId&&e.cellId<t&&0<e.locationAreaCode&&e.locationAreaCode<t})}function parseWifiQuery(e){var a=[];return e.split(",").forEach(function(e){var t=new URLSearchParams(e);if(t.has("ssid")&&t.delete("ssid"),t.has("macAddress")){var n={};t.forEach(function(e,t){n[t]="macAddress"===t?e:Number(e)}),a.push(n)}}),a}function parseQuery(e,n,a){var i=[];return e.split(",").forEach(function(e){var t=new URLSearchParams(e);i.push(queryPatramsToObject(t,n,a))}),i}function queryPatramsToObject(e,n,a){var i={};return e.forEach(function(e,t){"mobileCountryCode"!==t||0!=Number(e)?"mobileNetworkCode"!==t||0!=Number(e)?i[t]=Number(e):i[t]=Number(a):i[t]=Number(n)}),i}window.onpopstate=function(e){this.console.log(e),e.state&&"mapView"!==e.state[0]&&("reportView"!==e.state[0]?"emailUpdation"!==e.state[0]&&"emailVerificationWait"!==e.state[0]?window[e.state[0]](e.state[1]):history.go(-1):this.reportView(e.state[1]))},CanvasDimension.prototype.setMaxWidth=function(e){this.MAX_WIDTH=e},CanvasDimension.prototype.setMaxHeight=function(e){this.MAX_HEIGHT=e},CanvasDimension.prototype.getNewDimension=function(){return this.width>this.height?this.width>this.MAX_WIDTH&&(this.height*=this.MAX_WIDTH/this.width,this.width=this.MAX_WIDTH):this.height>this.MAX_HEIGHT&&(this.width*=this.MAX_HEIGHT/this.height,this.height=this.MAX_HEIGHT),{width:this.width,height:this.height}},GetOffsetBounds.prototype.north=function(){return this.latLng.latitude+this.ratio},GetOffsetBounds.prototype.south=function(){return this.latLng.latitude-this.ratio},GetOffsetBounds.prototype.east=function(){return this.latLng.longitude+this.radioLon},GetOffsetBounds.prototype.west=function(){return this.latLng.longitude-this.radioLon};var o=void 0,selectedSubs=void 0;ApplicationState=JSON.parse(localStorage.getItem("ApplicationState"))||{location:"",knownLocation:!1,venue:"",iframeVersion:13,nearByLocations:[]};var markersObject={markers:[],infowindow:[]};function failureScreen(e,t){document.getElementById("app-header").classList.add("hidden"),document.getElementById("app-current-panel").innerHTML="\n    <div class=\"center-abs location-not-found\">\n    <i class='material-icons mdc-theme--secondary'>"+(e.icon||"location_off")+"</i>\n    <p class='mdc-typography--headline5'>\n    "+e.title+"\n    </p>\n    <p class='mdc-typography--body1'>\n    "+e.message+'\n    </p>\n    <button class="mdc-button mdc-theme--primary-bg" id=\'try-again\'>\n    <span class="mdc-button__label mdc-theme--on-primary">RETRY</span>\n    </button>\n    </div>',document.getElementById("try-again").addEventListener("click",function(e){document.querySelector(".center-abs.location-not-found").classList.add("hidden"),t()})}function handleLocationError(e,t){switch(progressBar&&progressBar.close(),document.getElementById("selection-box-prog")&&document.getElementById("selection-box-prog").classList.add("mdc-linear-progress--closed"),e.message){case"THRESHOLD EXCEED":history.state&&mapView(e.body.geopoint);break;case"BROKEN INTERNET CONNECTION":if(t)return void failureScreen({message:"You Are Currently Offline. Please Check Your Internet Connection",icon:"wifi_off",title:"BROKEN INTERNET CONNECTION"},function(){loadingScreen(),openMap()});new Dialog(e.message,"Please Check Your Internet Connection").create().open();break;case"TURN ON YOUR WIFI":if(t)return void failureScreen({message:"Enabling Wifi Will Help Growthfile Accurately Detect Your Location",icon:"wifi_off",title:"TURN ON YOUR WIFI"},function(){loadingScreen(),openMap()});new Dialog(e.message,"Enabling Wifi Will Help Growthfile Accurately Detect Your Location").create().open();break;default:if(handleError({message:e.message,body:{reason:e.body||e,stack:e.stack||""}}),t)return void failureScreen({message:"There was a problem in detecting your location. Please try again later",icon:"location_off",title:"Failed To Detect Location"},function(){loadingScreen(),openMap()});new Dialog("Location Error","There was a problem in detecting your location. Please try again later").create().open()}}function mapView(t){document.getElementById("app-header").classList.add("hidden"),ApplicationState.location=t,history.pushState(["mapView"],null,null);var e=document.getElementById("app-current-panel");e.classList.remove("mdc-top-app-bar--fixed-adjust","mdc-layout-grid","pl-0","pr-0"),e.innerHTML=mapDom(),document.getElementById("map-view").style.height="100%";var n={lat:t.latitude,lng:t.longitude};console.log(n);var a=new GetOffsetBounds(t,1),i={north:a.north(),south:a.south(),east:a.east(),west:a.west()};if(document.getElementById("map")){console.log(google);var o=new google.maps.Map(document.getElementById("map"),{center:n,zoom:15,disableDefaultUI:!0,restriction:{latLngBounds:i,strictBounds:!0}});new google.maps.Marker({position:n,icon:"./img/bluecircle.png",map:o}),new google.maps.Circle({strokeColor:"#89273E",strokeOpacity:.8,strokeWeight:2,fillColor:"#89273E",fillOpacity:.35,map:o,center:n,radius:t.accuracy<100?2*t.accuracy:t.accuracy});google.maps.event.addListenerOnce(o,"idle",function(){console.log("idle_once"),loadNearByLocations(i,o,t).then(function(e){return(ApplicationState.nearByLocations=e).length?1==e.length?createKnownCheckIn(e[0],"",t):(document.getElementById("map").style.display="block",void loadCardData(e,o,t)):createUnkownCheckIn("",t)})})}}function createUnkownCheckIn(t,n,a){var e=Object.keys(ApplicationState.officeWithCheckInSubs);ApplicationState.knownLocation=!1;var i=[];e.forEach(function(e){var t=JSON.parse(JSON.stringify(ApplicationState.officeWithCheckInSubs[e]));t.share=[],i.push(requestCreator("create",fillVenueInCheckInSub(t,""),n))}),t&&t.open(),Promise.all(i).then(function(){t&&t.close(),successDialog("Check-In Created"),ApplicationState.venue="",localStorage.setItem("ApplicationState",JSON.stringify(ApplicationState)),history.pushState(["reportView"],null,null),reportView()}).catch(function(e){"Invalid check-in"!==e.message?t&&t.close():handleInvalidCheckinLocation(a,function(e){ApplicationState.location=e,createUnkownCheckIn(t,e,!0)})})}function handleInvalidCheckinLocation(e,n){if(e)return reloadPage();if("Android"!==native.getName())try{webkit.messageHandlers.locationService.postMessage("start"),window.addEventListener("iosLocation",function e(t){n(t.detail),window.removeEventListener("iosLocation",e,!0)},!0)}catch(e){failureScreen({message:"There was a problem in detecting your location.",icon:"location_off",title:"Failed To Detect Location"},reloadPage)}else handleGeoLocationApi().then(n).catch(function(e){handleError({message:"Geolocation failed to get data for retry attempt at invalid checkin",body:e}),failureScreen({message:"There was a problem in detecting your location.",icon:"location_off",title:"Failed To Detect Location"},reloadPage)})}function loadCardData(t,n,a){ApplicationState.knownLocation=!0;var e="<ul class='mdc-list mdc-list pt-0 mdc-list--two-line mdc-list--avatar-list' id='selected-venue'>\n  "+t.map(function(e){return""+venueList(e)}).join("")+"\n  <li class='mdc-list-divider'></li>\n  "+loadUnkwown()+"\n</ul>";document.querySelector("#selection-box").classList.remove("hidden"),document.querySelector("#selection-box #card-primary").textContent="Choose location",document.querySelector("#selection-box .content-body").innerHTML=e,document.getElementById("map").style.height="calc(100vh - "+(document.querySelector("#selection-box").offsetHeight-52)+"px)";var i=new mdc.linearProgress.MDCLinearProgress(document.getElementById("selection-box-prog")),o=new mdc.list.MDCList(document.getElementById("selected-venue"));o.singleSelection=!0,o.selectedIndex=0,o.listen("MDCList:action",function(e){if(console.log(e.detail.index),e.detail.index==t.length)return createUnkownCheckIn(i,a);focusMarker(n,markersObject,e.detail.index),i.open(),createKnownCheckIn(t[e.detail.index],"",a)})}function createKnownCheckIn(t,n,e,a){var i=JSON.parse(JSON.stringify(ApplicationState.officeWithCheckInSubs[t.office]));i.share=[],n&&n.open(),requestCreator("create",fillVenueInCheckInSub(i,t),e).then(function(){successDialog("Check-In Created"),ApplicationState.venue=t,localStorage.setItem("ApplicationState",JSON.stringify(ApplicationState)),history.pushState(["reportView"],null,null),reportView()}).catch(function(e){"Invalid check-in"!==e.message?n&&n.close():handleInvalidCheckinLocation(a,function(e){ApplicationState.location=e,createKnownCheckIn(t,n,e,!0)})})}function loadUnkwown(){return' <li class=\'mdc-list-item venue-list-item  pl-0 pr-0\'>\n  <span class="mdc-list-item__graphic material-icons" aria-hidden="true">location_on</span>\n    Unknown location\n    <span class="mdc-list-item__meta material-icons" aria-hidden="true">keyboard_arrow_right</span>\n  </li>'}function venueList(e){return'<li class=\'mdc-list-item venue-list-item  pl-0 pr-0\'>\n    <span class="mdc-list-item__graphic material-icons" aria-hidden="true">location_on</span>\n    <span class="mdc-list-item__text">\n      <span class="mdc-list-item__primary-text">'+e.location+'</span>\n      <span class="mdc-list-item__secondary-text">'+e.office+'</span>\n    </span>\n    <span class="mdc-list-item__meta material-icons" aria-hidden="true">keyboard_arrow_right</span>\n    </li>\n  \n    '}function newOfficeView(){}function selectionBox(){return'<div class="selection-box-auto hidden" id=\'selection-box\'>\n\n  <div class="card__primary">\n    <h2 class="demo-card__title mdc-typography mdc-typography--headline6 margin-auto" id=\'card-primary\'>\n    </h2>\n  </div>\n  <div role="progressbar"\n    class="mdc-linear-progress mdc-linear-progress--indeterminate mdc-linear-progress--closed"\n    id=\'selection-box-prog\'>\n    <div class="mdc-linear-progress__buffering-dots"></div>\n    <div class="mdc-linear-progress__buffer"></div>\n    <div class="mdc-linear-progress__bar mdc-linear-progress__primary-bar">\n      <span class="mdc-linear-progress__bar-inner"></span>\n    </div>\n    <div class="mdc-linear-progress__bar mdc-linear-progress__secondary-bar">\n      <span class="mdc-linear-progress__bar-inner"></span>\n    </div>\n  </div>\n\n  <div class="content-body">\n  </div>\n  </div>\n'}function toggleCardHeight(e,t){var n=document.getElementById("map-view"),a=document.getElementById(t);e?(n.classList.add("hidden"),a.classList.remove("hidden"),a.style.height="100%",document.getElementById("app-header").classList.add("hidden")):(n.classList.remove("hidden"),document.getElementById("selection-box").classList.remove("hidden"),a.classList.add("hidden"),document.getElementById("app-header").classList.remove("hidden"))}function mapDom(){return"\n  <div id='map-view' class=''>\n    <div id='map'></div>\n      "+selectionBox()+"\n    </div>\n  "}function snapView(e){document.querySelector(e).innerHTML='\n  <div class=\'snap-container\'>\n  <h6 class=\'mdc-typography--headline5 text-center\'>\n    Create a photo check-in\n  </h6>\n  <div class=\'landing-page-container text-center\'>\n    <button class="mdc-fab mdc-fab--extended mdc-theme--primary-bg mdc-theme--on-primary">\n      <div class="mdc-fab__ripple"></div>\n      <span class="material-icons mdc-fab__icon">camera</span>\n      <span class="mdc-fab__label">Take photo</span>\n    </button>\n  </div>\n  </div>\n  ',document.querySelector(".snap-container .mdc-fab").addEventListener("click",openCamera),openCamera()}function openCamera(){"Android"!==native.getName()?webkit.messageHandlers.startCamera.postMessage("setFilePath"):AndroidInterface.startCamera("setFilePath")}function setFilePathFailed(e){snacks(e)}function setFilePath(e){var n="data:image/jpg;base64,"+e;document.querySelector(".tabs-section .data-container").innerHTML='\n\n  <div class=\'image-container\'>\n  <div id=\'snap\' class="snap-bckg">\n  <div class="form-meta snap-form">\n    <div class="mdc-text-field mdc-text-field--no-label mdc-text-field--textarea" id=\'snap-textarea\'>\n        <textarea\n        class="mdc-text-field__input  snap-text mdc-theme--on-primary" rows="1" cols="100"></textarea></div>\n        <button id=\'snap-submit\' class="mdc-fab app-fab--absolute  snap-fab mdc-theme--primary-bg  mdc-ripple-upgraded"\n      style="z-index: 9;">\n      <svg class="mdc-button__icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/><path d="M0 0h24v24H0z" fill="none"/></svg>\n      </button>\n  </div>\n  </div>\n\n  </div>\n  ';var t=document.getElementById("snap"),a=new mdc.textField.MDCTextField(document.getElementById("snap-textarea")),i=new mdc.ripple.MDCRipple(document.getElementById("snap-submit"));a.focus(),a.input_.addEventListener("keyup",function(){this.style.paddingTop="25px",this.style.height="5px",this.style.height=this.scrollHeight+"px",this.scrollHeight<=300&&(i.root_.style.bottom=this.scrollHeight-20+"px")});var o=new Image;o.onload=function(){var e=getOrientation(o);t.style.backgroundImage="url("+n+")","landscape"!=e&&"sqaure"!=e||(t.style.backgroundSize="contain")},o.src=n,i.root_.addEventListener("click",function(){var e=a.value,t=JSON.parse(JSON.stringify(ApplicationState.officeWithCheckInSubs[photoOffice]));t.attachment.Photo.value=n,t.attachment.Comment.value=e,t.share=[],requestCreator("create",fillVenueInCheckInSub(t,ApplicationState.venue),ApplicationState.location).then(function(){history.pushState(["reportView"],null,null),reportView(),successDialog("Check-In Created")}).catch(console.error)})}function mdcDefaultSelect(e,t,n,a){return'<div class="mdc-select" id='+n+'>\n  <i class="mdc-select__dropdown-icon"></i>\n  <select class="mdc-select__native-control">\n  <option disabled selected></option>\n  '+e.map(function(e){return" <option value='"+e+"'>\n    "+e+"\n    </option>"}).join("")+"\n"+a+"\n\n  </select>\n  <label class='mdc-floating-label'>"+t+'</label>\n  <div class="mdc-line-ripple"></div>\n</div>'}function mdcSelectVenue(e,t,n){return'<div class="mdc-select" id='+n+'>\n  <i class="mdc-select__dropdown-icon"></i>\n  <select class="mdc-select__native-control">\n  <option disabled selected value='+JSON.stringify("0")+"></option>\n  <option value="+JSON.stringify("1")+">UNKNOWN LOCATION</option>\n\n  "+e.map(function(e){return" <option value='"+JSON.stringify(e)+"'>\n    "+e.location+"\n    </option>"}).join("")+"\n  \n</select>\n  <label class='mdc-floating-label'>"+t+'</label>\n  <div class="mdc-line-ripple"></div>\n</div>'}function getOrientation(e){return e.width>e.height?"landscape":e.height>e.width?"potrait":e.width==e.height?"square":void 0}function focusMarker(e,t,n){var a=t.markers[n],i=t.infowindow[n];i.setContent("<span>"+a.title+"</span>"),i.open(e,a),e.panTo(a.position),e.setZoom(18)}function loadNearByLocations(o,u,m){return new Promise(function(e,t){markersObject.markers=[],markersObject.infowindow=[];var r=new google.maps.InfoWindow,s=[],l=void 0,n=db.transaction(["map"]),a=n.objectStore("map").index("bounds"),i=IDBKeyRange.bound([o.south,o.west],[o.north,o.east]),d=u.getBounds();a.openCursor(i).onsuccess=function(e){var t=e.target.result;if(t)if(ApplicationState.officeWithCheckInSubs[t.value.office])if(1<calculateDistanceBetweenTwoPoints(m,t.value))t.continue();else{s.push(t.value);var n=new google.maps.Marker({position:{lat:t.value.latitude,lng:t.value.longitude},title:t.value.location,icon:{url:"./img/m.png",size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)},id:t.value.activityId,value:JSON.stringify(t.value)});n.setMap(u);var a,i,o,c="<span>"+t.value.location+"</span>";google.maps.event.addListener(n,"click",(a=n,i=c,o=r,function(){l&&l.close(),o.setContent(i),o.open(u,a),l=o})),markersObject.markers.push(n),markersObject.infowindow.push(r),d.extend(n.getPosition()),t.continue()}else t.continue()},n.oncomplete=function(){return u.fitBounds(d),e(s)}})}function paymentView(){var e=document.querySelector(".tabs-section .data-container");if(e){e.innerHTML=paymentDom(),document.getElementById("start-load").classList.add("hidden");var t=document.getElementById("payments"),a="",i="";getPaymentData().then(function(n){var e=Object.keys(n);e.length?(e.forEach(function(e){var t=Number(e);a!==new Date(t).getMonth()&&(i+='<div class="hr-sect hr-sect mdc-theme--primary mdc-typography--headline5 mdc-layout-grid__cell--span-12-desktop mdc-layout-grid__cell--span-4-phone mdc-layout-grid__cell--span-8-tablet">'+moment(new Date(t).getMonth()+1+"-"+new Date(t).getFullYear(),"MM-YYYY").format("MMMM YYYY")+"</div>"),a=new Date(t).getMonth(),Object.keys(n[e]).forEach(function(e){i+=paymentCard(t,e,n)})}),t&&(t.innerHTML=i,toggleReportCard(".payment-card"),[].map.call(document.querySelectorAll("[data-paymentdata]"),function(t){console.log(t),t.addEventListener("click",function(){var e=JSON.parse(t.dataset.paymentdata);new Dialog(paymentViewHeading(e),paymentViewContent(e),"payment-dialog").create("simple").open()})}))):t&&(t.innerHTML="<h5 class='mdc-typography--headline5 text-center'>No Payment Found</h5>")}).catch(function(e){console.log(e),handleError({message:e.message,body:{stack:e.stack||""}})})}}function getPaymentData(){return new Promise(function(e,t){var n=db.transaction("payment"),a=n.objectStore("payment").index("key"),i={};a.openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;if(t){var n={};if(!i[t.value.key])return n[t.value.office]=[t.value],i[t.value.key]=n,void t.continue();i[t.value.key][t.value.office]?i[t.value.key][t.value.office].push(t.value):i[t.value.key][t.value.office]=[t.value],t.continue()}},n.oncomplete=function(){return e(i)}})}function paymentCard(e,t,n){return"<div class='mdc-card  report-card mdc-card--outlined payment-card mdc-layout-grid__cell--span-6-desktop mdc-layout-grid__cell--span-4-phone mdc-layout-grid__cell--span-8-tablet'>\n        <div class='mdc-card__primary-action'>\n          <div class=\"demo-card__primary\">\n          <div class='left'>\n              <div class=\"month-date-cont\">\n                <div class=\"day\">"+cardDate({date:new Date(e).getDate(),month:new Date(e).getMonth(),year:new Date(e).getFullYear()})+'</div>\n                <div class="date">'+new Date(e).getDate()+'</div>\n              </div>\n              <div class="heading-container">\n                <span class="demo-card__title mdc-typography">'+calculateTotalPayment(n[e][t])+'</span>\n                <h3 class="demo-card__subtitle mdc-typography mdc-typography--subtitle2 mb-0 card-office-title">'+t+"</h3>\n              </div>\n          </div>\n          <div class='right'>\n            <div class=\"dropdown-container dropdown\">\n              <i class=\"material-icons\">keyboard_arrow_down</i>\n            </div>\n          </div>\n          </div>\n          <div class='detail-container hidden'>\n          <div class='text-container'></div>\n          <div class='amount-container'>\n           "+n[e][t].map(function(e){return"\n                <div  data-paymentData='"+JSON.stringify(e)+"' class='amount  mdc-typography--headline6 "+("CANCELLED"===e.status?"mdc-theme--error":"CONFIRMED"===e.status?"mdc-theme--success":"")+"'>\n                    <div class='mdc-typography--caption'>"+e.type+"</div>\n                    "+("CANCELLED"===e.status?0:convertAmountToCurrency(e.amount,e.currency))+"\n                    <div class='mdc-typography--caption'>"+e.status+"</div>\n                </div>\n                "}).join("")+"\n         </div>\n          </div>\n        </div>\n    </div>"}function paymentViewHeading(e){return"<span class='capitalize'>"+e.type+"</span>\n    <div class='card-time mdc-typography--subtitle1 capitalize'>Created On "+formatCreatedTime(e.createdAt)+"</p>\n    "}function paymentViewContent(e){return"<div class=claim-view'> \n        "+(e.amount?"\n        <h3 class='mdc-typography--body1 info-heading mt-0'>\n            Amount : "+convertAmountToCurrency(Number(e.amount),e.currency):"")+"\n        </h3>\n      \n        "+(e.status?"<h3 class='mdc-typography--body1 info-heading mt-0'>\n           Status : "+e.status+" \n        </h3>":"")+"\n        "+(e.cycleStartTime&&e.cycleEndTime?"<h3 class='mdc-typography--body1 info-heading'>\n            Cycle : "+moment(e.cycleStartTime).format("DD/MM/YYYY")+" - "+moment(e.cycleEndTime).format("DD/MM/YYYY")+"\n        </h3>":"")+"\n        \n    </div>"}function calculateTotalPayment(e){var n=0,a="";return e.forEach(function(e){var t=Number(e.amount);n+=t,a=e.currency}),convertAmountToCurrency(n,a)}function paymentDom(){return"<div class='payment-section report-view' id='payments'>   \n</div>"}function profileView(){moment(firebase.auth().currentUser.metadata.lastSignInTime).format("dddd, MMMM Do YYYY, h:mm:ss a"),firebase.auth().currentUser;setHeader("<a class='mdc-top-app-bar__navigation-icon mdc-top-app-bar__navigation-icon material-icons'>arrow_back</a>\n  <span class=\"mdc-top-app-bar__title\">Profile</span>","");var e='<div class="mdc-card demo-card" id=\'profile-card\'>\n  <div class="mdc-card__primary-action demo-card__primary-action" tabindex="0">\n  \n  <div class="mdc-card__media mdc-card__media--16-9 demo-card__media"\n  style="background-image: url('+(firebase.auth().currentUser.photoURL||"./img/empty-user-big.jpg")+");\" onerror=\"imgErr(this)\">\n  <button class=\"mdc-fab mdc-fab--mini mdc-theme--primary-bg\" aria-label=\"Favorite\" style=\"\n    position: fixed;\n    top: 1rem;\n    right: 1rem;\n\">\n  <span class=\"mdc-fab__icon material-icons\">edit</span>\n  <input id='choose-profile-image' type='file' accept='image/jpeg;capture=camera'  class='overlay-text'>\n\n</button>\n</div>\n\n<div id='base-details'></div>\n<div id='user-details'></div>  \n\n";document.getElementById("app-current-panel").innerHTML=e,setDetails()}function setDetails(){progressBar.close(),document.getElementById("base-details").innerHTML=createBaseDetails(),document.getElementById("user-details").innerHTML=createUserDetails(),new mdc.list.MDCList(document.getElementById("basic-info-edit")),document.getElementById("choose-profile-image").addEventListener("change",function(e){getImageBase64(e).then(function(e){return document.querySelector(".mdc-card__media.mdc-card__media--16-9").style.backgroundImage="url("+e+")",requestCreator("backblaze",{imageBase64:e})}).then(function(){snacks("Profile picture updated"),firebase.auth().currentUser.reload()}).catch(console.error)}),createViewProfile()}function createBaseDetails(){var e=firebase.auth().currentUser;return"<div class=\"basic-info seperator\">\n  <ul class='mdc-list' id='basic-info-edit'>\n  <li class='mdc-list-item'>\n  <span class=\"mdc-list-item__graphic material-icons\" aria-hidden=\"true\">account_box</span>\n  "+e.displayName+'\n  <span class="mdc-list-item__meta material-icons mdc-theme--primary" aria-hidden="true" onclick="history.pushState([\'updateName\'],null,null);updateName(function(){history.back()})">edit</span>\n  </li>\n  <li class=\'mdc-list-item\'>\n  <span class="mdc-list-item__graphic material-icons" aria-hidden="true">email</span>\n  '+(e.email||"-")+'\n  <span class="mdc-list-item__meta material-icons mdc-theme--primary" aria-hidden="true" onclick="history.pushState([\'emailUpdation\'],null,null);emailUpdation(false,function(){history.back()})">edit</span>\n  </li>\n  <li class=\'mdc-list-item\'>\n    <span class="mdc-list-item__graphic material-icons" aria-hidden="true">phone</span>\n    '+e.phoneNumber+'\n    <span class="mdc-list-item__meta material-icons mdc-theme--primary" aria-hidden="true" onclick="history.pushState([\'changePhoneNumber\'],null,null);changePhoneNumber()">edit</span>\n  </li>\n  <li class=\'mdc-list-item\'>\n    <span class="mdc-list-item__graphic material-icons" aria-hidden="true">account_balance</span>\n    Bank accounts\n    <span class="mdc-list-item__meta material-icons mdc-theme--primary" aria-hidden="true" onclick="history.pushState([\'bankAccount\'], null, null);bankAccount()">edit</span>\n  </li>\n  <li class=\'mdc-list-item\'>\n    <span class="mdc-list-item__graphic material-icons" aria-hidden="true">verified_user</span>\n    Id proofs\n    <span class="mdc-list-item__meta material-icons mdc-theme--primary" aria-hidden="true" onclick="history.pushState([\'idProofView\'],null,null);idProofView(function(){history.back()})">edit</span>\n  </li>\n  </ul>\n</div>'}function bankAccount(){getRootRecord().then(function(e){var t=e.linkedAccounts;console.log(t);var n=firebase.auth().currentUser;setHeader("<a class='mdc-top-app-bar__navigation-icon material-icons'>arrow_back</a>\n      <span class=\"mdc-top-app-bar__title\">Bank accounts</span>\n      ",""),document.getElementById("app-current-panel").innerHTML="\n      <ul class='mdc-list mdc-list--two-line' id='bank-list'>\n      "+t.map(function(e,t){return"<li class='mdc-list-item' data-index=\""+t+'">\n            <span class="mdc-list-item__text">\n              <span class="mdc-list-item__primary-text">'+e.bankAccount+'</span>\n              <span class="mdc-list-item__secondary-text">'+e.ifsc+"</span>\n          </span>\n          <span class='mdc-list-item__meta material-icons bank-account-remove mdc-theme--error'  data-account=\""+getLast4digitsOfAccount(e.bankAccount)+'">delete</span>\n          </li>'}).join("")+"\n      </ul>\n      ",new mdc.list.MDCList(document.getElementById("bank-list")).selectedIndex=0,[].map.call(document.querySelectorAll(".bank-account-remove"),function(i){i&&i.addEventListener("click",function(){requestCreator("removeBankAccount",{bankAccount:i.dataset.account}).then(function(){var e=firebase.auth().currentUser.uid,t=db.transaction("root","readwrite"),n=t.objectStore("root"),a=void 0;n.get(e).onsuccess=function(e){a=e.target.result;var t=Number(i.parentNode.dataset.index);a.linkedAccounts.splice(t,1),n.put(a)},t.oncomplete=function(){i.parentNode.remove(),snacks("Account removed")}}).catch(console.error)})});var a=actionButton("Add BANK ACCOUNT");a.querySelector(".mdc-button").addEventListener("click",function(){if(!n.email||!n.emailVerified)return history.pushState(["emailUpdation"],null,null),void emailUpdation(!0,profileView);history.pushState(["addNewBankAccount"],null,null),addNewBankAccount(function(){reloadPage()})}),document.getElementById("app-current-panel").appendChild(a)})}function getLast4digitsOfAccount(e){return e.substr(e.length-4)}function addNewBankAccount(i){var t=firebase.auth().currentUser;setHeader("profileCheck"===history.state[0]?'<span class="mdc-top-app-bar__title">Add New Bank Account</span>':"<a class='mdc-top-app-bar__navigation-icon material-icons'>arrow_back</a>\n    <span class=\"mdc-top-app-bar__title\">Add New Bank Account</span>\n    ",""),document.getElementById("app-current-panel").innerHTML="\n  <div class='mdc-layout-grid'>\n  "+("profileCheck"===history.state[0]?"<button class='mdc-button mdc-button--raised' id='skip-btn'>SKIP</button>":"")+"\n  <div class='add-bank-container mt-20'>\n\n    <div class='text-field-container'>\n      "+textField({id:"account-number",label:"Bank Account Number",disabled:!1,value:"",type:"number",required:!0})+'\n      <div class="mdc-text-field-helper-line">\n        <div class="mdc-text-field-helper-text mdc-text-field-helper-text--validation-msg"></div>\n      </div>\n    </div>\n\n    <div class=\'text-field-container mt-10\'>\n      '+textField({id:"account-number-re",label:"Re-enter Bank Account Number",disabled:!1,value:"",type:"number",required:!0})+'\n      <div class="mdc-text-field-helper-line">\n        <div class="mdc-text-field-helper-text mdc-text-field-helper-text--validation-msg"></div>\n      </div>\n    </div>\n\n    <div class=\'text-field-container mt-10 mb-10\'>\n      '+textField({id:"ifsc",label:"IFSC",disabled:!1,value:"",type:"text",required:!0})+'\n      <div class="mdc-text-field-helper-line">\n        <div class="mdc-text-field-helper-text mdc-text-field-helper-text--validation-msg"></div>\n      </div>\n    </div>\n\n    <div class=\'text-field-container mb-10\'>\n      '+textArea({id:"address",label:"Address",required:!0})+'\n      <div class="mdc-text-field-helper-line">\n        <div class="mdc-text-field-helper-text mdc-text-field-helper-text--validation-msg\t"></div>\n      </div>\n    </div>\n \n  </div>\n  </div>\n  '+actionButton("SUBMIT","submit-btn").outerHTML+"\n  ";var e=new mdc.ripple.MDCRipple(document.getElementById("submit-btn"));e.root_.setAttribute("disabled","true");var o={};[].map.call(document.querySelectorAll(".mdc-text-field"),function(e){var t=new mdc.textField.MDCTextField(e);t.input_.addEventListener("paste",function(e){e.preventDefault()}),t.root_.classList.add("full-width"),o[t.label_.root_.textContent]=t}),o["Re-enter Bank Account Number"].input_.addEventListener("input",function(){o["Re-enter Bank Account Number"].value!==o["Bank Account Number"].value?(setHelperInvalid(o["Re-enter Bank Account Number"],!1),e.root_.setAttribute("disabled","true")):(setHelperValid(o["Re-enter Bank Account Number"]),e.root_.removeAttribute("disabled"))}),e.root_.addEventListener("click",function(){console.log(o);for(var e=Object.keys(o),t=0;t<e.length;t++){var n=e[t],a=o[n];if(!a.value)return setHelperInvalid(a),void(a.helperTextContent=n+" Cannot Be Empty");a.helperTextContent=""}if(o["Re-enter Bank Account Number"].value!==o["Bank Account Number"].value)return setHelperInvalid(o["Re-enter Bank Account Number"]),void(field.helperTextContent="Bank Account number do not match");requestCreator("newBankAccount",{bankAccount:o["Bank Account Number"].value,ifsc:o.IFSC.value,address1:o.Address.value}).then(function(){snacks("New bank account added"),i?i():history.back()}).catch(console.error)});var n=document.getElementById("skip-btn");n&&(new mdc.ripple.MDCRipple(n),n.addEventListener("click",function(){if(i){var e=db.transaction("root","readwrite"),n=e.objectStore("root");return n.get(t.uid).onsuccess=function(e){var t=e.target.result;t.skipBankAccountAdd=!0,n.put(t)},void(e.oncomplete=function(){i()})}history.back()}))}function changePhoneNumber(){var e=firebase.auth().currentUser;setHeader("<a class='mdc-top-app-bar__navigation-icon material-icons'>arrow_back</a>\n  <span class=\"mdc-top-app-bar__title\">Phone number</span>\n  ",""),document.getElementById("app-current-panel").innerHTML="<div class='mdc-layout-grid change-phone-number'>\n  \n  <div class='change-number-form full-width'>\n    <div class='old-phone-number-container'>\n      "+textFieldTelephone({disabled:!0,value:e.phoneNumber,label:"Current phone number",id:"old-phone-number",customClass:"full-width"})+"\n    </div>\n    <h3 class='mdc-typography--body1'>Enter your new phone number with country code</h3>\n    <div class='new-phone-number-container full-width'>\n      <span class=\"mdc-typography--headline5 plus-synbol\">+</span>\n      "+textFieldTelephone({disable:!1,value:"91",id:"new-phone-number-country-code",customClass:"country-code"})+"\n     \n      "+textFieldTelephone({disable:!1,value:"",label:"New phone number",id:"new-phone-number",customClass:"new-number-field full-width"})+"\n     \n    </div>\n  \n    <div class=\"mdc-theme--error mt-10\"\tid='change-number-helper'></div>\n    </div>\n  </div>\n  "+actionButton("Update","change-number-btn").outerHTML+"\n  ";var t=new mdc.textField.MDCTextField(document.getElementById("old-phone-number")),a=new mdc.textField.MDCTextField(document.getElementById("new-phone-number")),i=new mdc.textField.MDCTextField(document.getElementById("new-phone-number-country-code"));a.focus(),document.getElementById("change-number-btn").addEventListener("click",function(){if(document.getElementById("change-number-helper").textContent="",!i.value)return setHelperInvalid(i),void(document.getElementById("change-number-helper").textContent="Please Enter a country code");if(!a.value)return setHelperInvalid(a),void(document.getElementById("change-number-helper").textContent="Please Enter your new mobile number");var n="+"+i.value+a.value;if(t.value===n)return setHelperInvalid(a),void(document.getElementById("change-number-helper").textContent="Current phone number cannot be same as new phone number");console.log(n),showReLoginDialog("Change Phone Number","On clicking RE-LOGIN you will be logged out of the app. Login in again with "+a.value+" to change your phone number").listen("MDCDialog:closed",function(e){if("accept"===e.detail.action){var t=new Dialog("Please Wait","<h3 class='mdc-typography--body1 mdc-theme--primary'>Do not close the app while transition is taking place.</h3>").create("simple");t.open(),console.log(t),t.scrimClickAction="",appLocation(3).then(function(e){requestCreator("changePhoneNumber",{newPhoneNumber:n},e).then(function(e){setTimeout(function(){window.location.reload()},5e3),console.log(e)}).catch(function(e){t.close(),document.getElementById("app-current-panel").classList.remove("freeze")})}).catch(handleLocationError)}})})}function setHelperInvalid(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];e.focus(),e.foundation_.setValid(!1),e.foundation_.adapter_.shakeLabel(t)}function setHelperValid(e){e.focus(),e.foundation_.setValid(!0)}function createUserDetails(){return'\n  <div class="mdc-tab-bar" role="tablist">\n  <div class="mdc-tab-scroller">\n      <div class="mdc-tab-scroller__scroll-area">\n          <div class="mdc-tab-scroller__scroll-content" id=\'tab-scroller\'>\n          </div>\n      </div>\n  </div>\n</div>\n<div id=\'my-details\' class=\'pt-10\'></div>\n\n'}function createViewProfile(){getEmployeeDetails(IDBKeyRange.only(firebase.auth().currentUser.phoneNumber),"employees").then(function(a){var t="";a.forEach(function(e){t+=addTabs(e.office)}),document.getElementById("tab-scroller").innerHTML=t;var e=new mdc.tabBar.MDCTabBar(document.querySelector(".mdc-tab-bar"));e.listen("MDCTabBar:activated",function(e){var t=a[e.detail.index],n=t.office,s=[t.attachment["First Supervisor"].value,t.attachment["Second Supervisor"].value];document.getElementById("my-details").innerHTML=fillUserDetails(t),Promise.all([getEmployeeDetails([n,"recipient"],"officeTemplate"),getEmployeeDetails([n,"leave-type"],"officeTemplate"),getEmployeeDetails([1,n],"teamOffice")]).then(function(e){var t=e[0],n=e[1],a=e[2];console.log(e),t.length&&(document.getElementById("reports").innerHTML=' <h1 class="mdc-typography--subtitle1 mt-0">\n                          Reports :\n                          '+t.map(function(e){return"<span>"+e.attachment.Name.value+'</span>  <span class="dots"></span>'}).join("")+"\n                          </h1>"),n.length&&(document.getElementById("leaves").innerHTML='<h1 class="mdc-typography--headline6 mb-0">\n                          Annual  Leave Limit\n                          '+n.map(function(e,t){return'<h1 class="mdc-typography--headline6 mt-0 '+(n.length-t==1?"":"mb-0")+'">'+(e.attachment["Annual Limit"].value?e.attachment.Name.value+" : "+e.attachment["Annual Limit"].value:"")+" </h1>"}).join("")+"\n                      </h1>");var i=db.transaction(["users"]),o=i.objectStore("users"),c="",r="";s.forEach(function(e){o.get(e).onsuccess=function(e){var t=e.target.result;t&&(r+=addUserChips(t))}}),a.length&&a.forEach(function(e){o.get(e.attachment["Phone Number"].value).onsuccess=function(e){var t=e.target.result;t&&(c+=addUserChips(t))}}),i.oncomplete=function(){r&&(document.getElementById("supervisors").innerHTML='<h1 class="mdc-typography--headline6 mt-0 mb-0">Supervisors</h1>\n                  <div class="mdc-chip-set supervisor">\n                  '+r+"\n                  </div>\n                  "),c&&(document.getElementById("my-team").innerHTML='<h1 class="mdc-typography--headline6 mt-0 mb-0">Team</h1>\n                  <div class="mdc-chip-set">\n                  '+c+"\n                  </div>")}})}),e.activateTab(0)})}function createEditProfile(e,t){return" "+nameField(e)+"\n\n  "+emailField(t,"This Will Be Used For Sending Reports")+"\n    "}function nameField(e){return'<div class="mdc-typography mdc-typography--body2 p-10" id=\'card-body-edit\'>\n  <div class="mdc-text-field mdc-text-field--with-leading-icon full-width" id=\'name\'>\n\n  <svg class=\'mdc-text-field__icon\' xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/><path d="M0 0h24v24H0z" fill="none"/></svg>\n      <input class="mdc-text-field__input" value="'+e+'">\n      <div class="mdc-line-ripple"></div>\n      <label class="mdc-floating-label '+(e?"mdc-floating-label--float-above":"")+'">Name</label>\n  </div>\n  <div class="mdc-text-field-helper-line">\n      <div id="username-helper-text" class="mdc-text-field-helper-text" aria-hidden="true">\n       This will be displayed on your public profile\n\n      </div>\n  </div>'}function emailField(e,t,n){return'<div class="mdc-text-field mdc-text-field--with-leading-icon full-width" id=\'email\'>\n  <svg class=\'mdc-text-field__icon\' xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/><path d="M0 0h24v24H0z" fill="none"/></svg>\n  <input class="mdc-text-field__input" type=\'email\' value="'+e+'" autofocus='+(n?"true":"false")+'>\n  <div class="mdc-line-ripple"></div>\n  <label class="mdc-floating-label '+(e?"mdc-floating-label--float-above":"")+' ">Email</label>\n</div>\n<div class="mdc-text-field-helper-line">\n  <div id="username-helper-text" class="mdc-text-field-helper-text" aria-hidden="true">\n      '+t+"\n  </div>\n</div>"}function addTabs(e){return' <button class="mdc-tab" role="tab">\n        <span class="mdc-tab__content">\n            <span class="mdc-tab__text-label">'+e+'</span>\n        </span>\n        <span class="mdc-tab-indicator">\n            <span\n                class="mdc-tab-indicator__content mdc-tab-indicator__content--underline"></span>\n        </span>\n        <span class="mdc-tab__ripple"></span>\n    </button>'}function addUserChips(e){return'\n  <div class="mdc-chip">\n    '+(e.photoURL?'<img class="mdc-chip__icon mdc-chip__icon--leading" src='+e.photoURL+' onerror="imgErr(this)">':'\n    \n    <svg class="mdc-chip__icon mdc-chip__icon--leading" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M16.5 12c1.38 0 2.49-1.12 2.49-2.5S17.88 7 16.5 7C15.12 7 14 8.12 14 9.5s1.12 2.5 2.5 2.5zM9 11c1.66 0 2.99-1.34 2.99-3S10.66 5 9 5C7.34 5 6 6.34 6 8s1.34 3 3 3zm7.5 3c-1.83 0-5.5.92-5.5 2.75V19h11v-2.25c0-1.83-3.67-2.75-5.5-2.75zM9 13c-2.33 0-7 1.17-7 3.5V19h7v-2.25c0-.85.33-2.34 2.37-3.47C10.5 13.1 9.66 13 9 13z"/></svg>')+'\n    <div class="mdc-chip__text">'+(e.displayName||e.mobile)+"</div>\n</div>"}function fillUserDetails(t){var n={"First Supervisor":!0,"Second Supervisor":!0,"Phone Number":!0,Name:!0};return'<div class="office-info">\n'+Object.keys(t.attachment).map(function(e){return n[e]?"":t.attachment[e].value?'<h1 class="mdc-typography--subtitle1 mt-0">\n    '+e+" : "+t.attachment[e].value+"\n</h1>":""}).join("")+"\n\n\n\n<div id='reports'>\n\n</div>\n</div>\n<div class=\"hierchy pt-10 seperator\">\n<div id='supervisors'>\n</div>\n\n<div id='my-team' style='padding-bottom:10px'>\n</div>\n</div>\n\n<div class=\"meta-hidden-details\">\n<div id='leaves'>\n\n</div>\n\n</div>\n\n</div>\n\n</div>\n"}function timeDiff(e){var t=moment().format("YYY-MM-DD HH:mm"),n=moment(e).format("YYY-MM-DD HH:mm");return moment(t).diff(moment(n),"minutes")}function isEmailValid(e,t){return!!e&&!(e===t)}function reportView(t,e){var n=document.getElementById("app-current-panel");n.classList.remove("mdc-theme--primary-bg"),getReportTabData().then(function(o){console.log(o),reportViewHeader(),n.classList.add("mdc-top-app-bar--fixed-adjust","mdc-layout-grid","pl-0","pr-0"),n.innerHTML="\n    "+showTabs(o)+"\n    <div class='tabs-section'>\n    <div class='content'>\n    <div class='data-container mdc-layout-grid'>\n    </div>\n    </div>\n    </div>";var e=new mdc.tabBar.MDCTabBar(document.querySelector(".mdc-tab-bar"));if(e.listen("MDCTabBar:activated",function(e){if(history.replaceState(["reportView",e.detail.index],null,null),e.detail.index){if(document.getElementById("search-btn")&&document.getElementById("search-btn").remove(),1==e.detail.index){var t=Object.keys(ApplicationState.officeWithCheckInSubs);if(1==t.length)return photoOffice=t[0],void snapView(".tabs-section .data-container");var n=new Dialog("Choose Office","<ul class='mdc-list subscription-list' id='dialog-office'>\n         "+t.map(function(e){return"<li class='mdc-list-item'>\n           "+e+"\n           <span class='mdc-list-item__meta material-icons mdc-theme--primary'>\n             keyboard_arrow_right\n           </span>\n           </li>"}).join("")+"\n         </ul>","choose-office-subscription").create("simple"),a=new mdc.list.MDCList(document.getElementById("dialog-office"));return bottomDialog(n,a),void a.listen("MDCList:action",function(e){photoOffice=t[e.detail.index],snapView(".tabs-section .data-container"),n.close()})}var i=o[e.detail.index];window[i.view]()}else chatView()}),null==t)return 2<o.length?e.activateTab(2):e.activateTab(0);e.activateTab(t)})}function reportViewHeader(){var e="";1<ApplicationState.nearByLocations.length&&(e='<button class="material-icons mdc-top-app-bar__action-item mdc-icon-button" aria-label="remove" id=\'change-location\'>clear</button>');var t=setHeader(homeHeaderStartContent(ApplicationState.venue.location||""),e);t.root_.classList.remove("hidden"),ApplicationState.venue||generateCheckInVenueName(t),document.getElementById("change-location")&&document.getElementById("change-location").addEventListener("click",function(){progressBar.open(),appLocation(3).then(mapView).catch(handleLocationError)})}function homeHeaderStartContent(e){return'<img class="mdc-top-app-bar__navigation-icon mdc-icon-button image" id=\'profile-header-icon\' onerror="imgErr(this)" src='+(firebase.auth().currentUser.photoURL||"./img/src/empty-user.jpg")+'>\n  <span class="mdc-top-app-bar__title">'+e+"</span>"}function generateCheckInVenueName(c){var n=ApplicationState.lastCheckInCreated;if(n&&c){var e=firebase.auth().currentUser.phoneNumber,t=db.transaction("addendum"),a=t.objectStore("addendum"),i=[];if(a.indexNames.contains("KeyTimestamp")){var o=e+e,r=IDBKeyRange.only([n,o]);a.index("KeyTimestamp").getAll(r).onsuccess=function(e){e.target.result.length&&(i=e.target.result)}}else a.index("user").openCursor(e).onsuccess=function(e){var t=e.target.result;t&&(t.value.timestamp===n&&i.push(t.value),t.continue())};t.oncomplete=function(){console.log(i),i.length&&i.forEach(function(o){db.transaction("activity").objectStore("activity").get(o.activityId).onsuccess=function(e){var t=e.target.result;if(t&&"check-in"===t.template){var n=o.comment.split(" "),a=n.indexOf("from"),i=n.slice(a+1,n.length).join(" ");console.log(c),console.log(i),c.root_.querySelector(".mdc-top-app-bar__title")&&(c.root_.querySelector(".mdc-top-app-bar__title").textContent=i)}}})}}}function getReportTabData(){return new Promise(function(t,e){var a=[{name:"Contacts",id:"open-chat-list",icon:"person_add",view:"chatView",index:0},{name:"Photo Check-In",id:"photo-check-in",icon:"add_a_photo",view:"snapView",index:1}],n=["attendance","reimbursement","payment"],i=db.transaction(n);n.forEach(function(e,t){if(db.objectStoreNames.contains(e)){var n=i.objectStore(e).count();n.onsuccess=function(){n.result&&("attendance"===e&&a.push({icon:"room",name:"Attendances",store:"attendance",view:"attendanceView",index:t}),"reimbursement"===e&&a.push({icon:"motorcycle",name:"Reimbursements",store:"reimbursement",view:"expenseView",index:t}),"payment"===e&&a.push({icon:"payment",name:"Payments",store:"payment",view:"paymentView",index:t}))}}}),i.oncomplete=function(){getSubscription("","customer").then(function(e){return e.length&&a.push({name:"Incentives",icon:"./img/currency.png",view:"incentiveView",index:a.length+1}),t(a)})},i.onerror=function(){return e(tx.error)}})}function showTabs(e){return'<div class="mdc-tab-bar" role="tablist" style=\'margin-top:5px;\'>\n    <div class="mdc-tab-scroller">\n      <div class="mdc-tab-scroller__scroll-area">\n        <div class="mdc-tab-scroller__scroll-content">\n      \n          '+e.map(function(e){return'\n              <button class="mdc-tab" role="tab" aria-selected="false" tabindex="-1" id='+(e.id||"")+'>\n              <span class="mdc-tab__content">\n                '+("Incentives"===e.name?"<img class='mdc-tab__icon currency-primary' src="+e.icon+">":'<span class="mdc-tab__icon material-icons" aria-hidden="true">'+e.icon+"</span>")+'\n                \n                <span class="mdc-tab__text-label">'+e.name+'</span>\n              </span>\n              <span class="mdc-tab-indicator">\n                <span class="mdc-tab-indicator__content mdc-tab-indicator__content--underline"></span>\n              </span>\n              <span class="mdc-tab__ripple"></span>\n            </button>'}).join("")+"\n        </div>\n      </div>\n    </div>\n  </div>"}function getReportSubs(o){return new Promise(function(e,t){var n=[],a=db.transaction("subscriptions","readwrite"),i=a.objectStore("subscriptions");(i.indexNames.contains("report")?i.index("report").openCursor(IDBKeyRange.only(o)):i.openCursor()).onsuccess=function(e){var t=e.target.result;if(t)return"CANCELLED"===t.value.status?t.delete():t.value.report===o&&"attendance regularization"!==t.value.template&&n.push(t.value),void t.continue()},a.oncomplete=function(){return e(n)},a.onerror=function(){return t(a.error)}})}function toggleReportCard(e){[].map.call(document.querySelectorAll(e),function(t){if(t){var n=t.querySelector(".dropdown i");if(!n)return;n.addEventListener("click",function(){var e=t.querySelector(".detail-container");e.classList.contains("hidden")?(n.textContent="keyboard_arrow_up",e.classList.remove("hidden")):(n.textContent="keyboard_arrow_down",e.classList.add("hidden"))})}})}function createTemplateButton(n){var e=createFab("add");return e.addEventListener("click",function(){if(1==n.length)return history.pushState(["addView"],null,null),void addView(n[0]);var t=new Dialog("Choose Office",officeSelectionList(n),"choose-office-subscription").create("simple"),e=new mdc.list.MDCList(document.getElementById("dialog-office"));bottomDialog(t,e),e.listen("MDCList:action",function(e){history.pushState(["addView"],null,null),addView(n[e.detail.index]),t.close()})}),e}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var workerResolves={},workerRejects={},workerMessageIds=0;function isWifiRequired(){if("Android"!==native.getName())return!1;if(AndroidInterface.isWifiOn())return!1;return!!{samsung:!0,OnePlus:!0}[JSON.parse(native.getInfo()).deviceBrand]}var readDebounce=debounce(function(){requestCreator("Null").then(handleComponentUpdation).catch(console.error)},1e3,!1);function handleError(e){console.log(e);var t=JSON.parse(localStorage.getItem("error"));return t.hasOwnProperty(e.message)&&(e.device=localStorage.getItem("deviceInfo")),t[e.message]=e,localStorage.setItem("error",JSON.stringify(t)),requestCreator("instant",JSON.stringify(e))}function successDialog(e){var t=document.getElementById("success-animation"),n=document.getElementById("app-current-panel");t.classList.remove("hidden"),document.getElementById("app-header").style.opacity="0.1",n.style.opacity="0.1",t.querySelector(".success-text").textContent=e,setTimeout(function(){t.classList.add("hidden"),n.style.opacity="1",document.getElementById("app-header").style.opacity="1"},2e3)}function snacks(e,t,n){snackBar.labelText=e,snackBar.open(),snackBar.timeoutMs=4e3,snackBar.actionButtonText=t||"Okay",snackBar.listen("MDCSnackbar:closed",function(e){"action"===e.detail.reason&&n&&"function"==typeof n&&n()})}function fetchCurrentTime(e){return Date.now()+e}function appLocation(e){return new Promise(function(t,n){manageLocation(e).then(function(e){return ApplicationState.location&&"profileCheck"!==history.state[0]&&isLocationMoreThanThreshold(calculateDistanceBetweenTwoPoints(ApplicationState.location,e))?n({message:"THRESHOLD EXCEED",body:{geopoint:e}}):(ApplicationState.location=e,localStorage.setItem("ApplicationState",JSON.stringify(ApplicationState)),t(e))}).catch(n)})}function manageLocation(a){return new Promise(function(t,n){getLocation().then(function(e){return 35e3<=e.accuracy?0<a?void setTimeout(function(){console.log("retry because of high accuracy"),manageLocation(a-1).then(t).catch(n)},1e3):(console.log("retry end of high accuracy"),handleLocationOld(3,e).then(t).catch(n)):(console.log("accuracy is less than 35000"),handleLocationOld(3,e).then(t).catch(n))}).catch(n)})}function handleLocationOld(a,i){return new Promise(function(t,n){var e=getStoredLocation();return e&&isLocationOld(e,i)&&0<a?void setTimeout(function(){getLocation().then(function(e){console.log("retry because new location is same to old location"),handleLocationOld(a-1,e).then(t).catch(n)}).catch(n)},1e3):t(i)})}function getLocation(){return new Promise(function(n,a){if(!navigator.onLine)return a({message:"BROKEN INTERNET CONNECTION"});if("Android"===native.getName())html5Geolocation().then(function(t){if(!(t.isLocationOld||350<=t.accuracy))return n(t);handleGeoLocationApi().then(n).catch(function(e){return n(t)})}).catch(function(t){handleGeoLocationApi().then(n).catch(function(e){return a({message:"Both HTML and Geolocation failed to fetch location",body:{html5:t,geolocation:e},locationError:!0})})});else try{webkit.messageHandlers.locationService.postMessage("start"),window.addEventListener("iosLocation",function e(t){n(t.detail),window.removeEventListener("iosLocation",e,!0)},!0)}catch(e){html5Geolocation().then(function(e){return n(e)}).catch(function(e){a(e)})}})}function handleGeoLocationApi(){return new Promise(function(e,t){var n=void 0;try{n=getCellularInformation()}catch(e){t(e.message)}Object.keys(n).length||t("empty object from getCellularInformation"),requestCreator("geolocationApi",n).then(e).catch(t)})}function iosLocationError(e){html5Geolocation().then(function(e){var t=new CustomEvent("iosLocation",{detail:e});window.dispatchEvent(t)}).catch(console.error),handleError(e)}function html5Geolocation(){return new Promise(function(t,n){navigator.geolocation.getCurrentPosition(function(e){return t({latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy,provider:"HTML5",isLocationOld:isLocationOld(e.coords,getStoredLocation()),lastLocationTime:Date.now()})},function(e){n({message:e.message})},{maximumAge:0,timeout:8e3,enableHighAccuracy:!1})})}window.addEventListener("callRead",readDebounce);var placeService,placeResult,apiHandler=new Worker("js/apiHandler.js?version=70");function requestCreator(e,n,a){var t=firebase.auth().currentUser,i={type:e,body:n,meta:{user:{token:"",uid:t.uid,displayName:t.displayName,photoURL:t.photoURL,phoneNumber:t.phoneNumber},key:appKey.getMapKey(),apiUrl:appKey.getBaseUrl()}};return a?getRootRecord().then(function(e){var t=fetchCurrentTime(e.serverTime);return i.body.timestamp=t,i.body.geopoint=a,"check-in"===n.template&&(ApplicationState.lastCheckInCreated=t),localStorage.setItem("ApplicationState",JSON.stringify(ApplicationState)),console.log("sending",i),executeRequest(i)}):executeRequest(i)}function executeRequest(a){var e=firebase.auth().currentUser;return"instant"!==a.type&&progressBar.open(),e.getIdToken().then(function(e){return a.meta.user.token=e,apiHandler.onmessage=function(e){if(progressBar.close(),console.log(e),e.data.success){var t=workerResolves[e.data.id];t&&t(e.data.response)}else{var n=workerRejects[e.data.id];n&&(n(e.data),e.data.apiRejection?"Null"!==e.data.requestType&&snacks(e.data.message):handleError({message:e.data.message,body:JSON.stringify(e.data.body)}))}delete workerResolves[e.data.id],delete workerRejects[e.data.id]},apiHandler.onerror=function(e){progressBar.open(),handleError({message:e.message,body:JSON.stringify({filename:e.filename,lineno:e.lineno,colno:e.colno})})},new Promise(function(e,t){var n=workerMessageIds++;a.id=n,workerResolves[n]=e,workerRejects[n]=t,apiHandler.postMessage(a)})})}function updateApp(){if("Android"!==native.getName())return webkit.messageHandlers.updateApp.postMessage("Update App");var e=new Dialog("New Update Avaialble","Please Install the Latest version from google play store , to Use Growthfile. Click Okay to Install Lastest Version from Google Play Store.").create();e.open(),e.scrimClickAction="",e.listen("MDCDialog:opened",function(){e.buttons_[0].setAttribute("disabled","true")}),e.listen("MDCDialog:closed",function(e){"accept"===e.detail.action&&AndroidInterface.openGooglePlayStore("com.growthfile.growthfileNew")})}function revokeSession(){firebase.auth().signOut().then(function(){document.getElementById("app-header").classList.add("hidden")}).catch(function(e){handleError({message:"Sign out error",body:e})})}function officeRemovalSuccess(e){var t=new Dialog("Reminder","You have been removed from "+e.msg.join(" & ")).create();t.open(),t.listen("MDCDialog:closed",function(){})}function updateIosLocation(e){e.lastLocationTime=Date.now();var t=new CustomEvent("iosLocation",{detail:e});window.dispatchEvent(t)}function handleComponentUpdation(e){if(console.log(e),e.reloadApp)reloadPage();else if(e.templates.length&&getCheckInSubs().then(function(e){ApplicationState.officeWithCheckInSubs=e,localStorage.setItem("ApplicationState",JSON.stringify(ApplicationState))}),history.state)switch(history.state[0]){case"enterChat":if(!e.addendum.length)return;dynamicAppendChats(e.addendum);break;case"chatView":if(!e.addendum.length)return;readLatestChats(!1);break;case"reportView":reportView(history.state[1]);break;default:console.log("no refresh")}}function backgroundTransition(){}function runRead(e){if(firebase.auth().currentUser&&e.read){var t=new CustomEvent("callRead",{detail:e.read});window.dispatchEvent(t)}}function debounce(a,i,o){var c;return function(){var e=this,t=arguments,n=o&&!c;clearTimeout(c),c=setTimeout(function(){c=null,o||a.apply(e,t)},i),n&&a.apply(e,t)}}function removeChildNodes(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function getRootRecord(){return new Promise(function(e,t){var n=void 0,a=db.transaction(["root"],"readwrite");a.objectStore("root").get(firebase.auth().currentUser.uid).onsuccess=function(e){var t=e.target.result;n=t},a.oncomplete=function(){e(n)},a.onerror=function(){t({message:a.error.message+" from getRootRecord"})}})}function getSubscription(i,o){return new Promise(function(t){var e=db.transaction(["subscriptions"]).objectStore("subscriptions"),n=void 0,a=void 0;n=i?(a=e.index("validSubscription"),IDBKeyRange.bound([i,o,"CONFIRMED"],[i,o,"PENDING"])):(a=e.index("templateStatus"),IDBKeyRange.bound([o,"CONFIRMED"],[o,"PENDING"])),a.getAll(n).onsuccess=function(e){return t(e.target.result)}})}function emailReg(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())}function getSuggestions(){if(!ApplicationState.knownLocation)return getSubsWithVenue().then(homeView);getKnownLocationSubs().then(homeView)}function getKnownLocationSubs(){return new Promise(function(e,t){var n=db.transaction("subscriptions","readwrite"),a=n.objectStore("subscriptions"),i=[],o=ApplicationState.venue;a.openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;if(t){if("CANCELLED"===t.value.status)return t.delete(),void t.continue();Object.keys(t.value.attachment).forEach(function(e){t.value.attachment[e].type===o.template&&i.push(t.value)}),t.continue()}},n.oncomplete=function(){e(i)}})}function getPendingLocationActivities(){return new Promise(function(e,t){var n=db.transaction("activity"),a=[];n.objectStore("activity").index("status").openCursor("PENDING").onsuccess=function(e){var t=e.target.result;if(t)if(t.value.office===ApplicationState.office)if(t.value.hidden)t.continue();else{t.continue()}else t.continue()},n.oncomplete=function(){return e(a)}})}function getSubsWithVenue(){return new Promise(function(e,t){var n=db.transaction("subscriptions","readwrite"),a=n.objectStore("subscriptions"),i=[];a.openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;if(t){if("check-in"!==t.value.template)return"CANCELLED"===t.value.status?t.delete():t.value.venue.length&&(console.log(t.value),i.push(t.value)),void t.continue();t.continue()}},n.oncomplete=function(){e(i)}})}function handleNav(e){return console.log(e),"reportView"===history.state[0]?(history.pushState(["profileView"],null,null),void profileView()):history.back()}function createUpdatesuggestion(n){var e=document.getElementById("duty-container");if(n.length&&e){e.innerHTML="<ul class='mdc-list subscription-list'>\n    "+n.map(function(e){return"<li class='mdc-list-item'>\n        <span class='mdc-list-item__text'>"+e.activityName+'</span>\n      \n        <span class="mdc-list-item__meta material-icons mdc-theme--primary">\n          keyboard_arrow_right\n      </span>\n        </li>'}).join("")+"\n    <li class='mdc-list-divider'></li>\n  </ul>";var t=new mdc.list.MDCList(e.querySelector("ul"));t.singleSelection=!0,t.selectedIndex=0,t.listen("MDCList:action",function(e){var i=n[e.detail.index],t=createActivityHeading(i),o=createElement("div");o.style.float="right";var c=new Dialog(t,activityDomCustomer(i),"view-form").create();c.open(),c.autoStackButtons=!1,c.buttons_[1].classList.add("hidden"),i.canEdit&&(getStatusArray(i).forEach(function(e){var t=createElement("button",{className:"mdc-button material-icons"});t.style.color=e.color;var n=createElement("span",{className:"mdc-button__label",textContent:e.name}),a=createElement("i",{className:"material-icons mdc-button__icon",textContent:e.icon});t.appendChild(a),t.appendChild(n),t.addEventListener("click",function(){setActivityStatus(i,e.status),c.close()}),o.appendChild(t)}),c.listen("MDCDialog:opened",function(){c.root_.querySelector("#status-change-container").appendChild(o)}))})}}function getYesterdayArDate(){var e=new Date;return console.log(e.setDate(e.getDate()-1)),e.setDate(e.getDate()-1)}function createArSuggestion(e){var t=document.getElementById("ar-container"),c=createElement("ul",{className:"mdc-list subscription-list mdc-list--two-line"});if(e.forEach(function(e){var t=createElement("li",{className:"mdc-list-item"}),n=createElement("span",{className:"mdc-list-item__meta material-icons mdc-theme--primary",textContent:"keyboard_arrow_right"}),a=createElement("span",{className:"mdc-list-item__text"}),i=createElement("span",{className:"mdc-list-item__primary-text"}),o=createElement("span",{className:"mdc-list-item__secondary-text mdc-theme--error",textContent:"Attendance Yesterday : "+e.attendance});o.style.marginTop="5px",o.style.fontSize="1rem",0==e.attendance&&(i.textContent="Apply AR/Leave : "+e.office),0<e.attendance&&e.attendance<1&&(i.textContent="Apply AR : "+e.office),a.appendChild(i),a.appendChild(o),t.appendChild(a),t.addEventListener("click",function(){history.pushState(["reportView"],null,null),reportView(e)}),t.appendChild(n),c.appendChild(t)}),t){t.appendChild(c);var n=new mdc.list.MDCList(c);n.selectedIndex=0,n.singleSelection=!0}}function getYesterdayAtt(){return new Promise(function(e,t){var n=new Date,a=db.transaction("attendance"),i=a.objectStore("attendance").index("key"),o=[];i.openCursor(IDBKeyRange.lowerBound(getYesterdayArDate())).onsuccess=function(e){var t=e.target.result;t&&(t.value.hasOwnProperty("attendance")&&1!=t.value.attendance&&t.value.date===n.getDate()-1&&t.value.month==n.getMonth()&&t.value.year==n.getFullYear()&&o.push(t.value),t.continue())},a.oncomplete=function(){return e(o)},a.onerror=function(){return t(a.error)}})}function checkForUpdates(){return new Promise(function(i,e){var t=moment().valueOf(),n=moment().add(24,"h").valueOf();console.log(n);var a=db.transaction("calendar"),o=[],c=IDBKeyRange.lowerBound(t);a.objectStore("calendar").index("end").openCursor(c).onsuccess=function(e){var t=e.target.result;t&&("CANCELLED"!==t.value.status&&1!=t.value.hidden&&t.value.start&&t.value.end&&t.value.start<=n&&o.push(t.value),t.continue())},a.oncomplete=function(){console.log(o);var t=db.transaction("activity"),n=[];o.forEach(function(e){t.objectStore("activity").get(e.activityId).onsuccess=function(e){var t=e.target.result;t.attachment.Location&&t.attachment.Location.value&&(console.log(t),n.push(t))}}),t.oncomplete=function(){console.log(n);var e=db.transaction("map"),a=[];n.forEach(function(n){e.objectStore("map").index("location").get(n.attachment.Location.value).onsuccess=function(e){var t=e.target.result;t&&t.latitude&&t.longitude&&(1<calculateDistanceBetweenTwoPoints({latitude:t.latitude,longitude:t.longitude},ApplicationState.location)||a.push(n))}}),e.oncomplete=function(){return i(a)}}},a.onerror=function(){return e({message:tx.error,body:""})}})}function handleTemplateListClick(c){c.singleSelection=!0,c.selectedIndex=0,c.listen("MDCList:action",function(e){var t=c.listElements[e.detail.index],n=JSON.parse(t.dataset.office),a=JSON.parse(t.dataset.value);if(1==n.length)return history.pushState(["addView"],null,null),void addView(a[0]);var i=new Dialog("Choose Office",officeSelectionList(a),"choose-office-subscription").create("simple"),o=new mdc.list.MDCList(document.getElementById("dialog-office"));bottomDialog(i,o),o.listen("MDCList:action",function(e){history.pushState(["addView"],null,null),addView(a[e.detail.index]),i.close()})})}function officeSelectionList(e){return"<ul class='mdc-list subscription-list' id='dialog-office'>\n    "+e.map(function(e){return"<li class='mdc-list-item'>\n      "+("object"===(void 0===e?"undefined":_typeof(e))?e.office:e)+"\n      <span class='mdc-list-item__meta material-icons mdc-theme--primary'>\n        keyboard_arrow_right\n      </span>\n      </li>"}).join("")+"\n    </ul>"}function bottomDialog(e,t){t.singleSelection=!0,t.selectedIndex=0,setTimeout(function(){e.root_.querySelector(".mdc-dialog__surface").classList.add("open"),t.foundation_.adapter_.focusItemAtIndex(0)},50),e.listen("MDCDialog:opened",function(){t.layout()}),e.listen("MDCDialog:closing",function(){e.root_.querySelector(".mdc-dialog__surface").classList.remove("open")}),e.open()}function pendinglist(e){return'\n  <ul class="mdc-list subscription-list" role="group" aria-label="List with checkbox items" id=\'confirm-tasks\'>\n    '+e.map(function(e,t){return'\n      <li class="mdc-list-item" role="checkbox" aria-checked="false">\n      Confirm '+e.activityName+' ?    \n      <div class=\'mdc-checkbox mdc-list-item__meta\'>\n        <input type="checkbox"\n                class="mdc-checkbox__native-control"\n                id="demo-list-checkbox-item-'+t+'" />\n        <div class="mdc-checkbox__background">\n          <svg class="mdc-checkbox__checkmark"\n                viewBox="0 0 24 24">\n            <path class="mdc-checkbox__checkmark-path"\n                  fill="none"\n                  d="M1.73,12.91 8.1,19.28 22.79,4.59"/>\n          </svg>\n          <div class="mdc-checkbox__mixedmark"></div>\n        </div>\n      </div>   \n    </li>'}).join()+"\n  </ul>\n  "}function templateList(e){var o=createElement("ul",{className:"mdc-list subscription-list",id:"suggested-list"});return e.forEach(function(e){var t=o.querySelector('[data-template="'+e.template+'"]');if(t){var n=JSON.parse(t.dataset.office);n.push(e.office);var a=JSON.parse(t.dataset.value);a.push(e),t.dataset.office=JSON.stringify(n),t.dataset.value=JSON.stringify(a)}else{var i=createElement("li",{className:"mdc-list-item"});i.dataset.template=e.template,i.dataset.office=JSON.stringify([e.office]),i.dataset.value=JSON.stringify([e]),i.innerHTML="Create New "+e.template+"\n      <span class='mdc-list-item__meta material-icons mdc-theme--primary'>\n        keyboard_arrow_right\n      </span>",o.appendChild(i)}}),o.outerHTML}function getImageBase64(o,e){return new Promise(function(a,e){var t=o.target.files;if(t.length){var n=t[0],i=new FileReader;i.onload=function(e){var t=e.target.result,n=new Image;n.src=t,n.onload=function(){var e=resizeAndCompressImage(n);return a(e)}},i.readAsDataURL(n)}})}function updateName(e){var t=firebase.auth().currentUser;setHeader("profileCheck"===history.state[0]?'<span class="mdc-top-app-bar__title">Name</span>':"<a class='mdc-top-app-bar__navigation-icon material-icons'>arrow_back</a>\n    <span class=\"mdc-top-app-bar__title\">Name</span>\n    ",""),document.getElementById("app-current-panel").innerHTML="\n  \n  <div class='mdc-layout-grid change-name'>\n  <p class='mdc-typography--body1'>\n  Please provide your name\n  \n  </p>\n<div class=\"mdc-text-field mdc-text-field--outlined mt-10\" id='name'>\n  <input class=\"mdc-text-field__input\" required value='"+(firebase.auth().currentUser.displayName||"")+'\' type=\'text\'  placeholder=\'Type your name here\'>\n <div class="mdc-notched-outline">\n     <div class="mdc-notched-outline__leading"></div>\n     <div class="mdc-notched-outline__notch">\n           <label for=\'email\' class="mdc-floating-label mdc-floating-label--float-above ">Name</label>\n     </div>\n     <div class="mdc-notched-outline__trailing"></div>\n </div>\n</div>\n<div class="mdc-text-field-helper-line">\n  <div class="mdc-text-field-helper-text mdc-text-field-helper-text--validation-msg\t">\n  </div>\n</div>\n  </div>\n  <div  class=\'mb-10 mt-10\'>\n    '+actionButton("Update","name-btn").outerHTML+"\n  </div>";var n=new mdc.textField.MDCTextField(document.getElementById("name"));n.focus(),document.getElementById("name-btn").addEventListener("click",function(){if(!n.value)return setHelperInvalid(n),void(n.helperTextContent="Name Cannot Be Left Blank");progressBar.open(),t.updateProfile({displayName:n.value.trim()}).then(function(){progressBar.close(),snacks("Name updated"),e()})})}function getEmailViewHeading(e){var t={topBarText:"",heading:"",btnText:"Update"};return e.email?e.emailVerified?(t.topBarText="Email",t.btnText="Update"):(t.topBarText="Email",t.btnText="Verify"):t.topBarText="Email",t}function emailUpdation(e,t){var a=firebase.auth().currentUser,n=getEmailViewHeading(a);setHeader("profileCheck"===history.state[0]?'\n    <span class="mdc-top-app-bar__title">'+n.topBarText+"</span>\n    ":"<a class='mdc-top-app-bar__navigation-icon material-icons'>arrow_back</a>\n    <span class=\"mdc-top-app-bar__title\">"+n.topBarText+"</span>\n    ","").root_.classList.remove("hidden"),document.getElementById("app-current-panel").innerHTML=updateEmailDom(e,n);var i=new mdc.textField.MDCTextField(document.getElementById("email"));i.focus(),document.getElementById("email-btn").addEventListener("click",function(){return emailReg(i.value)?(progressBar.open(),a.email?i.value!==a.email?void emailUpdate(i.value,t):a.emailVerified?(progressBar.close(),setHelperInvalid(i),void(i.helperTextContent="New Email Cannot Be Same As Previous Email")):void emailVerification(t):void emailUpdate(i.value,t)):(setHelperInvalid(i),void(i.helperTextContent="Enter A Valid Email Id"))});var o=document.getElementById("skip-btn");o&&(new mdc.ripple.MDCRipple(o),o.classList.remove("hidden"),o.addEventListener("click",function(){var e=db.transaction("root","readwrite"),n=e.objectStore("root");n.get(a.uid).onsuccess=function(e){var t=e.target.result;t.skipEmail=!0,n.put(t)},e.oncomplete=function(){t()}}))}function emailUpdate(e,t){firebase.auth().currentUser.updateEmail(e).then(function(){emailVerification(t)}).catch(handleEmailError)}function emailVerification(e){firebase.auth().currentUser.sendEmailVerification().then(function(){snacks("Email verification has been sent."),progressBar.close(),emailVerificationWait(e)}).catch(handleEmailError)}function emailVerificationWait(t){var n=firebase.auth().currentUser;document.getElementById("app-current-panel").innerHTML="<div class='mdc-layout-grid'>\n  <h3 class='mdc-typography--headline6'>Verification Link Has Been Sent To "+firebase.auth().currentUser.email+"</h3>\n  <p class='mdc-typography--body1'>Click Continue To Proceed Further</p>\n</div>\n"+actionButton("CONTINUE","continue").outerHTML+"\n",document.getElementById("continue").addEventListener("click",function(e){firebase.auth().currentUser.reload(),setTimeout(function(){firebase.auth().currentUser.reload(),n.emailVerified?t():snacks("Email not verified. Try again")},2e3)})}function handleEmailError(e){(progressBar.close(),"auth/requires-recent-login"!==e.code)?snacks(e.message):showReLoginDialog("Email Authentication","Please Login Again To Complete The Operation").listen("MDCDialog:closed",function(e){"accept"===e.detail.action&&("profileCheck"!==history.state[0]&&(EMAIL_REAUTH=!0),revokeSession())})}function updateEmailDom(e,t){var n=firebase.auth().currentUser.email;return"\n  <div class='mdc-layout-grid update-email'>\n  "+(e?"<button class='mdc-button mt-10 mdc-button--raised' id='skip-btn'>\n  <span class='mdc-button__label mdc-theme--secondary'>SKIP<span>\n  </button>":"")+"\n\n<h3 class='mdc-typography--headline6'>"+t.heading+"</h3>\n<p class='report-rec mt-10 mdc-typography--body1'>\nVerify your email to receive  offer letter, salary slip, tax forms & other documents\n</p>\n\n<div class=\"mdc-text-field mdc-text-field--outlined mt-10\" id='email'>\n  <input class=\"mdc-text-field__input\" required value='"+(n||"")+'\' type=\'email\'>\n <div class="mdc-notched-outline">\n     <div class="mdc-notched-outline__leading"></div>\n     <div class="mdc-notched-outline__notch">\n           <label for=\'email\' class="mdc-floating-label '+(n?"mdc-floating-label--float-above":"")+'">Email</label>\n     </div>\n     <div class="mdc-notched-outline__trailing"></div>\n </div>\n</div>\n<div class="mdc-text-field-helper-line">\n  <div class="mdc-text-field-helper-text mdc-text-field-helper-text--validation-msg\t">\n  </div>\n</div>\n\n</div>\n<div  class=\'mb-10 mt-10\'>\n  '+actionButton(t.btnText,"email-btn").outerHTML+"\n</div>\n"}function idProofView(t){setHeader("profileCheck"===history.state[0]?' <span class="mdc-top-app-bar__title">Add ID Proof</span>':"<a class='mdc-top-app-bar__navigation-icon material-icons'>arrow_back</a>\n    <span class=\"mdc-top-app-bar__title\">Add ID Proof</span>\n    ",""),document.getElementById("app-current-panel").innerHTML="\n  <div class='id-container app-padding'>\n  "+("profileCheck"===history.state[0]?" <button class='mdc-button mdc-button--raised' id='skip-btn'>SKIP</button>":"")+"\n \n    <div class='pan-container pb-10'>\n    <h3 class='mdc-typography--headline6 mdc-theme--primary'> Enter PAN card details</h3>\n      <div class='text-field-container mt-10 mb-10'>\n        "+textField({id:"pan-number",label:"Enter PAN Number",value:"",type:"text",required:!0})+'\n        <div class="mdc-text-field-helper-line">\n          <div class="mdc-text-field-helper-text mdc-text-field-helper-text--validation-msg"></div>\n        </div>\n    </div>\n    <div class=\'pan-images mdc-layout-grid__inner\'>\n        <div class=\'mdc-layout-grid__cell\'>\n          <div class=\'image-container\'>\n            <img src=\'./img/placeholder.png\' class=\'width-100\' data-name="panFront">\n           \n            <div class=\'add-icon-cont\'>\n            <button class="mdc-fab mdc-button--raised" aria-label="Favorite" id=\'pan-front-btn\' data-name="panFront">\n              <div class="mdc-fab__ripple"></div>\n              <span class="mdc-fab__icon material-icons">add_a_photo</span>\n            </button>\n            </div>\n          </div>\n          <div class="mdc-image-list__supporting">\n          <span class="mdc-image-list__label">PAN FRONT</span>\n        </div>\n        </div>\n        <div class=\'mdc-layout-grid__cell\'>\n        <div class=\'image-container\'>\n            <img src=\'./img/placeholder.png\' class=\'width-100\' data-name="panBack">\n            \n            <div class=\'add-icon-cont\'>\n            <button class="mdc-fab mdc-button--raised" aria-label="Favorite" id=\'pan-back-btn\' data-name="panBack">\n              <div class="mdc-fab__ripple"></div>\n              <span class="mdc-fab__icon material-icons">add_a_photo</span>\n            </button>\n          </div>\n            \n        </div>\n        <div class="mdc-image-list__supporting">\n              <span class="mdc-image-list__label">PAN BACK</span>\n            </div> \n        </div>\n    </div>\n    </div>\n    <div class=\'aadhar-container\'>\n        <h3 class=\'mdc-typography--headline6 mdc-theme--primary\'>Enter AADHAR card details</h3>\n      <div class=\'text-field-container mt-10 mb-10\'>\n        '+textField({id:"aadhar-number",label:"Enter AADHAR card Number",value:"",type:"text",required:!0})+'\n        <div class="mdc-text-field-helper-line">\n          <div class="mdc-text-field-helper-text mdc-text-field-helper-text--validation-msg"></div>\n        </div>\n      </div>\n      <div class=\'aadhar-images mdc-layout-grid__inner\'>\n      <div class=\'mdc-layout-grid__cell\'>\n      <div class=\'image-container\'>\n        <img src=\'./img/placeholder.png\' class=\'width-100\' data-name="aadharFront">\n       \n        <div class=\'add-icon-cont\'>\n        <button class="mdc-fab mdc-button--raised" aria-label="Favorite" id=\'aadhar-front-btn\' data-name="aadharFront">\n          <div class="mdc-fab__ripple"></div>\n          <span class="mdc-fab__icon material-icons">add_a_photo</span>\n        </button>\n        </div>\n      </div>\n      <div class="mdc-image-list__supporting">\n      <span class="mdc-image-list__label">AADHAR FRONT</span>\n    </div>\n    </div>\n    <div class=\'mdc-layout-grid__cell\'>\n    <div class=\'image-container\'>\n        <img src=\'./img/placeholder.png\' class=\'width-100\' data-name="aadharBack">\n        \n        <div class=\'add-icon-cont\'>\n        <button class="mdc-fab mdc-button--raised" aria-label="Favorite" id=\'aadhar-back-btn\' data-name="aadharBack">\n          <div class="mdc-fab__ripple"></div>\n          <span class="mdc-fab__icon material-icons">add_a_photo</span>\n        </button>\n      </div>\n        \n    </div>\n    <div class="mdc-image-list__supporting">\n          <span class="mdc-image-list__label">AADHAR BACK</span>\n        </div> \n    </div>\n</div>\n      </div>\n    </div>\n   \n       \n    </div>\n    '+actionButton("UPDATE","submit-btn").outerHTML+"\n  \n  ";new mdc.textField.MDCTextField(document.getElementById("pan-number")),new mdc.textField.MDCTextField(document.getElementById("aadhar-number"));var e=document.getElementById("skip-btn");[].concat(_toConsumableArray(document.querySelectorAll(".id-container .mdc-fab"))).forEach(function(e){e.addEventListener("click",function(){"Android"!==parent.native.getName()?webkit.messageHandlers.startCamera.postMessage(e.dataset.name):AndroidInterface.startCamera(e.dataset.name)})});var n=document.getElementById("submit-btn");new mdc.ripple.MDCRipple(n),n.addEventListener("click",function(){snacks("Service unavailable right now. please try again later"),window.scrollTo(0,0)}),e&&(new mdc.ripple.MDCRipple(e),e.addEventListener("click",function(){var e=db.transaction("root","readwrite"),n=e.objectStore("root");n.get(firebase.auth().currentUser.uid).onsuccess=function(e){var t=e.target.result;t.skipIdproof=!0,n.put(t)},e.oncomplete=function(){t&&t()}}))}function aadharFront(e){var t=document.querySelector('[data-name="aadharFront"]');t&&(t.src="data:image/jpg;base64,"+e)}function aadharBack(e){var t=document.querySelector('[data-name="aadharBack"]');t&&(t.src="data:image/jpg;base64,"+e)}function panFront(e){var t=document.querySelector('[data-name="panFront"]');t&&(t.src="data:image/jpg;base64,"+e)}function panBack(e){var t=document.querySelector('[data-name="panBack"]');t&&(t.src="data:image/jpg;base64,"+e)}var placeSearchField,map,searchPlaceMarkers=[];function searchOffice(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:history.state[1];document.getElementById("app-current-panel").innerHTML="<div class='search-map-cont mdc-top-app-bar--fixed-adjust'>\n\n     <div class='search-container'>\n        "+textField({id:"search-address",label:"Search for your office location",leadingIcon:"search",trailingIcon:"clear",autocomplete:"organization"})+"\n      <div class='search-result-container'>\n        \n        \n         <ul class='mdc-list mdc-list--two-line mdc-list--avatar-list' id='place-query-ul'>\n         </ul>\n      </div>\n     </div>\n    <div id='map-search'></div>\n     \n    </div>",setHeader('<span class="mdc-top-app-bar__title">Search Office</span>',"").root_.classList.remove("hidden");var e={lat:n.latitude,lng:n.longitude};map=new google.maps.Map(document.getElementById("map-search"),{zoom:15,center:e,disableDefaultUI:!0});new google.maps.Marker({position:e,icon:"./img/bluecircle.png",map:map}),new google.maps.Circle({strokeColor:"#89273E",strokeOpacity:.8,strokeWeight:2,fillColor:"#89273E",fillOpacity:.35,map:map,center:e,radius:n.accuracy<100?2*n.accuracy:n.accuracy});(placeSearchField=new mdc.textField.MDCTextField(document.querySelector(".mdc-text-field"))).focus(),placeSearchField.trailingIcon_.root_.addEventListener("click",function(){placeSearchField.value="",placeSearchField.trailingIcon_.root_.classList.add("hidden"),document.getElementById("place-query-ul").innerHTML="",placeSearchField.focus(),map.setCenter(e),clearPlaceMarkers(),clearPlaceCustomControl()}),placeSearchField.trailingIcon_.root_.classList.add("hidden");var a={query:"",fields:["name","geometry","place_id","formatted_address","types"]};placeSearchField.input_.addEventListener("input",function(e){if(e.target.value.trim()){placeSearchField.trailingIcon_.root_.classList.remove("hidden");var t=new CustomEvent("searchPlaces",{detail:{value:e.target.value,placeRequesParam:a,geopoint:n}});window.dispatchEvent(t)}})}var searchDebounde=debounce(function(e){var t=e.detail.placeRequesParam,n=e.detail.value,a=e.detail.geopoint;t.query=n;var i=new mdc.list.MDCList(document.getElementById("place-query-ul")),o=new google.maps.InfoWindow;progressBar.open(),(placeService=new google.maps.places.PlacesService(map)).findPlaceFromQuery(t,function(e,t){if(i.root_.innerHTML="",progressBar.close(),t===google.maps.places.PlacesServiceStatus.OK)return 1==e.length?(placeResult=e[0],createPlaceMarker(o),void showPlaceBox(map)):void e.forEach(function(e){var t=searchPlaceResultList(e.name,e.formatted_address);t.addEventListener("click",function(){placeResult=e,i.root_.innerHTML="",placeSearchField.value=placeResult.name,showPlaceBox(map),createPlaceMarker(o)}),i.root_.appendChild(t)});clearPlaceCustomControl(),clearPlaceMarkers(),map.setCenter({lat:a.latitude,lng:a.longitude}),i.root_.appendChild(createLi('No result found for "'+n+'"'))})},1e3,!1);function CenterControl(e){var t=createElement("div",{className:"mdc-card place-box mdc-elevation--z24"});t.innerHTML="\n    <div class='mdc-card__primary-action'>\n      <div class='demo-card__primary'>\n      <ul class='mdc-list'>\n        <li class='mdc-list-item pl-0 pr-0'>\n          <h2 class='demo-card__title mdc-typography mdc-typography--headline6'>"+placeResult.name+"</h2>\n          <span class='mdc-list-item__meta material-icons'>keyboard_arrow_up</span\n        </li>\n      </ul>  \n        <div class='mdc-typography mdc-typography--body2 pt-0 pb-20 mb-10'>\n            "+placeResult.formatted_address+"\n        </div>\n      </div>\n    </div>",e.appendChild(t)}function expandPlaceBox(){placeService.getDetails({placeId:placeResult.place_id,fields:["international_phone_number","photos"]},function(e,t){t==google.maps.places.PlacesServiceStatus.OK&&(placeResult.international_phone_number=e.international_phone_number||"",placeResult.photos=e.photos||[]),console.log(e);var n=document.getElementById("app-current-panel");n.classList.add("mdc-top-app-bar--fixed-adjust");setHeader("<a class='mdc-top-app-bar__navigation-icon material-icons'>arrow_back</a>\n        <span class=\"mdc-top-app-bar__title\">"+placeResult.name+"</span>\n        ",'<button class="material-icons mdc-top-app-bar__action-item mdc-icon-button" aria-label="remove" id=\'close-placebox\'>clear</button>').root_.classList.remove("hidden"),n.innerHTML="<div class='expand-box up'>\n        <div class='mdc-card'>\n            <div class='mdc-card__primary-action'>\n               <div class='mdc-card__media mdc-card__media--16-9' style='background-image:url(\""+(placeResult.photos.length?placeResult.photos[0].getUrl():"./img/business.svg")+"\")'>\n                "+(1<placeResult.photos.length?" <span class=\"prev material-icons\" id='prev-image'>navigate_before</span>\n                <span class=\"next material-icons\" id='next-image'>navigate_next</span>":"")+"\n            </div>\n                \n                <div class='demo-card__primary'>\n                  <h2 class='demo-card__title mdc-typography mdc-typography--headline6'>"+placeResult.name+'</h2>\n                </div>\n                <div class="mdc-chip-set" role="grid"> \n                  '+placeResult.types.map(function(e){return'<div class="mdc-chip" role="row">\n                    <div class="mdc-chip__ripple"></div>\n                    <span role="gridcell">\n                      <span role="button" tabindex="0" class="mdc-chip__text">'+e+"</span>\n                    </span>\n                  </div>"}).join("")+' \n                </div>\n                <li class=\'mdc-list-item address-list\'>\n                  <span class="mdc-list-item__graphic material-icons" aria-hidden="true">room</span>\n                  '+placeResult.formatted_address+"\n                </li>\n                \n                <ul class='mdc-list'>\n                  "+(placeResult.international_phone_number?' <li class=\'mdc-list-item\'>\n                    <span class="mdc-list-item__graphic material-icons" aria-hidden="true">phone</span>\n                      '+placeResult.international_phone_number+"\n                    </li>":"")+"\n                </ul>\n                 \n                  </div>\n                  </div>\n                  "+createExtendedFab("check","CONFIRM","confirm-btn",!0).outerHTML+"\n      </div>",document.getElementById("close-placebox").addEventListener("click",function(){document.querySelector(".expand-box").classList.add("down"),document.querySelector(".expand-box").classList.remove("up"),setTimeout(function(){history.back()},500)});var i=document.getElementById("confirm-btn");i.addEventListener("click",function(){i.classList.add("mdc-fab--exited"),requestCreator("searchOffice",{query:placeResult.place_id}).then(function(e){if(!e.length)return(t=new Dialog(placeResult.name+" not found","Do you want to create a new office ? ").create()).buttons_[0].textContent="cancel",t.buttons_[1].textContent="create new office",t.open(),void t.listen("MDCDialog:closed",function(e){"accept"===e.detail.action?createOfficeInit():i.classList.remove("mdc-fab--exited")});var t,n="<ul class='mdc-list  mdc-list--two-line'  id='office-selection-list'>\n                    "+e.map(function(e,t){return"<li class='mdc-list-item pl-0 pr-0' tabindex=\"-1\">\n                            <span class='mdc-list-item__text'>\n                                <span class='mdc-list-item__primary-text'>"+e.name+"</span>\n                                <span class='mdc-list-item__secondary-text'>"+e.registeredOfficeAddress+'</span>\n                            </span>\n                            <span class="mdc-list-item__graphic mdc-list-item__meta">\n                            <div class="mdc-checkbox">\n                                <input type="checkbox"\n                                        class="mdc-checkbox__native-control"\n                                        id="demo-list-checkbox-item-'+t+'" />\n                                <div class="mdc-checkbox__background">\n                                  <svg class="mdc-checkbox__checkmark"\n                                        viewBox="0 0 24 24">\n                                    <path class="mdc-checkbox__checkmark-path"\n                                          fill="none"\n                                          d="M1.73,12.91 8.1,19.28 22.79,4.59"/>\n                                  </svg>\n                                  <div class="mdc-checkbox__mixedmark"></div>\n                                </div>\n                              </div>\n                        </span>\n                        </li>'}).join("")+"\n                </ul> \n                ";(t=new Dialog("Choose office",n).create()).buttons_[0].textContent="cancel",t.buttons_[1].textContent="create new office",t.open();var a=new mdc.list.MDCList(document.getElementById("office-selection-list"));a.singleSelection=!0;t.listen("MDCDialog:opened",function(e){a.layout(),a.listen("MDCList:action",function(e){console.log(e),console.log(a),a.selectedIndex.length?(e.detail.index,a.selectedIndex=[e.detail.index],t.buttons_[1].textContent="JOIN"):(null,t.buttons_[1].textContent="create new office")})}),t.listen("MDCDialog:closed",function(e){"accept"===e.detail.action?a.selectedIndex.length?giveSubscriptionInit():createOfficeInit():i.classList.remove("mdc-fab--exited")})}).catch(function(e){console.log(e),i.classList.remove("mdc-fab--exited")})});var a=document.getElementById("next-image"),o=document.getElementById("prev-image");if(a&&o){var c=0;a.addEventListener("click",function(){++c>=placeResult.photos.length&&(c=0),loadImageInPlaceBox(placeResult.photos[c].getUrl())}),o.addEventListener("click",function(){--c<0&&(c=placeResult.photos.length-1),loadImageInPlaceBox(placeResult.photos[c].getUrl())})}})}function isAdmin(e){if(e.claims.hasOwnProperty("admin")&&Array.isArray(e.claims.admin)&&e.claims.admin.length)return!0}function createOfficeInit(){var e={template:"office",firstContact:"",secondContact:"",name:placeResult.name,placeId:placeResult.place_id,registeredOfficeAddress:placeResult.formatted_address};history.pushState(["addView"],null,null),addView(e)}function giveSubscriptionInit(){var e={assignees:[],template:"subscription",office:0<arguments.length&&void 0!==arguments[0]?arguments[0]:placeResult.name};history.pushState(["addView"],null,null),addView(e)}function loadImageInPlaceBox(e){var t=document.querySelector(".expand-box .mdc-card__media");t&&(t.style.backgroundImage='url("'+e+'")')}function clearPlaceCustomControl(){map.controls[google.maps.ControlPosition.BOTTOM_CENTER].length&&map.controls[google.maps.ControlPosition.BOTTOM_CENTER].clear()}function showPlaceBox(){console.log(placeResult),clearPlaceCustomControl();var e=document.createElement("div");new CenterControl(e,placeResult);e.index=1,map.controls[google.maps.ControlPosition.BOTTOM_CENTER].push(e),placeSearchField.input_.blur(),e.addEventListener("click",function(){history.pushState(["expandPlaceBox"],null,null),expandPlaceBox()}),swipe(e,function(e){console.log(e),"up"===e.direction&&(history.pushState(["expandPlaceBox"],null,null),expandPlaceBox(),removeSwipe())})}function searchPlaceResultList(e,t,n){var a=createElement("li",{className:"mdc-list-item"});return a.innerHTML="<span class='mdc-list-item__graphic material-icons'>"+(n||"location_on")+"</span>\n      <span class='mdc-list-item__text'>\n          <span class='mdc-list-item__primary-text'>"+e+"</span>\n          <span class='mdc-list-item__secondary-text'>"+t+"</span>\n      </span>",a}function clearPlaceMarkers(){searchPlaceMarkers.forEach(function(e){e.setMap(null)}),searchPlaceMarkers=[]}function createPlaceMarker(e){clearPlaceMarkers();var t=new google.maps.Marker({map:map,position:placeResult.geometry.location});map.setCenter(new google.maps.LatLng(placeResult.geometry.location.lat(),placeResult.geometry.location.lng())),google.maps.event.addListener(t,"click",function(){e.setContent(placeResult.name),e.open(map,this)}),searchPlaceMarkers.push(t)}window.addEventListener("searchPlaces",searchDebounde);