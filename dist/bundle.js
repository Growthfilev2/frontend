function initSW(){navigator.serviceWorker.register("/syncWorker.js").then(function(t){t.addEventListener("updatefound",function(){var e=t.installing;console.log("A new service worker is being installed:",e)}),startApp(),console.log("ServiceWorker registration successful with scope: ",t.scope)},function(e){console.log("ServiceWorker registration failed: ",e)})}function firebaseUiConfig(n){return{callbacks:{signInSuccess:function(e,t,a){if(!n)return!1;updateEmail(e,n)},signInFailure:function(e){return handleUIError(e)}},signInFlow:"popup",signInOptions:[{provider:firebase.auth.PhoneAuthProvider.PROVIDER_ID,recaptchaParameters:{type:"image",size:"invisible",badge:"bottomleft"},defaultCountry:"IN"}]}}function userSignedOut(){var e=document.createElement("div");e.id="login-container",document.body.appendChild(e),new firebaseui.auth.AuthUI(firebase.auth()||"").start("#login-container",firebaseUiConfig())}function layoutGrid(){var e=document.createElement("div");e.classList.add("mdc-layout-grid","mdc-typography","app"),e.id="main-layout-app";var t=document.createElement("div");t.className="mdc-layout-grid__inner cell-space";var a=document.createElement("div");a.id="header";var n=document.createElement("div");n.id="app-current-panel",n.className="mdc-layout-grid__cell--span-12";var c=document.createElement("div");c.id="snackbar-container",document.createElement("div").className="drawer--cont",t.appendChild(a),t.appendChild(n),t.appendChild(c),e.appendChild(t),document.body.innerHTML=e.outerHTML,imageViewDialog()}function imageViewDialog(){var e=document.createElement("aside");e.id="viewImage--dialog-component",e.className="mdc-dialog",e.role="alertdialog";var t=document.createElement("div");t.className="mdc-dialog__surface";var a=document.createElement("section");a.className="mdc-dialog__content";var n=document.createElement("img");n.src="",n.style.width="100%",a.appendChild(n),t.appendChild(a),e.appendChild(t);var c=document.createElement("div");c.className="mdc-dialog__backdrop",e.appendChild(c),document.body.appendChild(e)}function startApp(){if(layoutGrid(),!window.Worker&&!window.indexedDB)return snacks("Please upgrade your android version"),void firebase.auth().signOut().catch(signOutError);firebase.auth().onAuthStateChanged(function(e){if(!e)return document.getElementById("main-layout-app").style.display="none",void userSignedOut();if(document.getElementById("main-layout-app").style.display="block",localStorage.getItem("dbexist"))return listView(!0),"Android"===localStorage.getItem("deviceType")?requestCreator("now",AndroidId.getDeviceId()):requestCreator("now","localStorage.getItem('iosUUID')"),void manageLocation();document.getElementById("app-current-panel").appendChild(loader("init-loader")),localStorage.setItem("dbexist",e.uid);try{requestCreator("now",AndroidId.getDeviceId()),localStorage.setItem("deviceType","Android")}catch(e){localStorage.setItem("deviceType","Ios"),requestCreator("now","localStorage.getItem('iosUUID')")}})}function backNav(){history.back()}function UserCanExitApp(){FetchHistory.stateView(!0)}function conversation(e,t){t&&history.pushState(["conversation",e],null,null),fetchAddendumForComment(e)}function fetchAddendumForComment(t){var n=firebase.auth().currentUser,c=window.indexedDB.open(n.uid);c.onsuccess=function(){var a=c.result,e=a.transaction("addendum","readonly").objectStore("addendum").index("activityId");createHeaderContent(a,t),commentPanel(a,t),statusChange(a,t),sendCurrentViewNameToAndroid("conversation"),reinitCount(a,t);e.openCursor(t).onsuccess=function(e){var t=e.target.result;t?(document.getElementById(t.value.addendumId)||createComment(a,t.value,n).then(function(e){document.getElementById("chat-container").appendChild(e)}),t.continue()):document.querySelector(".activity--chat-card-container").scrollTop=document.querySelector(".activity--chat-card-container").scrollHeight}}}function commentPanel(e,t){if(!document.querySelector(".activity--chat-card-container")){var a=document.createElement("div");a.className="activity--chat-card-container  mdc-top-app-bar--fixed-adjust panel-card";var n=document.createElement("div");n.id="chat-container",n.className="mdc-card reverser-parent";var c=document.createElement("div");c.className="user-comment--container";var r=document.createElement("div");r.className="status--change-cont";var o=document.createElement("div");o.className="comment--container";var i=document.createElement("div");i.className="input--text-padding mdc-text-field mdc-text-field--dense",i.id="write--comment",i.style.width="100%";var d=document.createElement("input");d.className="mdc-text-field__input comment-field mdc-elevation--z4",d.type="text",i.appendChild(d),o.appendChild(i);var l=document.createElement("button");l.classList.add("mdc-fab","mdc-fab--mini","hidden"),l.id="send-chat--input";var s=document.createElement("span");s.classList.add("mdc-fac__icon","material-icons"),s.textContent="send",l.appendChild(s),o.appendChild(l),a.appendChild(n),c.appendChild(o),document.getElementById("app-current-panel").innerHTML=a.outerHTML+r.outerHTML+c.outerHTML,document.querySelector(".comment-field").oninput=function(e){e.target.value&&" "!==e.target.value?(document.getElementById("send-chat--input").classList.remove("hidden"),document.getElementById("write--comment").style.width="80%",document.querySelector(".status--change-cont").style.opacity="0"):(document.getElementById("send-chat--input").classList.add("hidden"),document.getElementById("write--comment").style.width="100%",document.getElementById("write--comment").style.transition="0.3s ease",document.querySelector(".status--change-cont").style.transition="0.3s ease",document.querySelector(".status--change-cont").style.opacity="1")},document.getElementById("send-chat--input").onclick=function(){if("Android"!==localStorage.getItem("deviceType"))sendComment(t);else try{if(!IsGpsEnabled.gpsEnabled())return void enableGps("Please turn on GPS to use this application");sendComment(t)}catch(e){console.log(e)}}}}function sendComment(e){requestCreator("comment",{activityId:e,comment:document.querySelector(".comment-field").value}),document.querySelector(".comment-field").value="",document.querySelector(".status--change-cont").style.opacity="1"}function statusChange(e,t){var l=document.createElement("label");l.setAttribute("for","toggle-status"),l.textContent="Confirm Completion",e.transaction("activity").objectStore("activity").get(t).onsuccess=function(e){var t=e.target.result;if(!t.canEdit||"CANCELLED"===t.status){var a=document.createElement("span"),n=e.target.result;return a.textContent="Activity "+n.status.toLowerCase(),document.querySelector(".status--change-cont").innerHTML=a.outerHTML,void(document.querySelector(".status--change-cont").style.textAlign="center")}if(0!=t.editable){if(!document.querySelector(".status-check")){var c=document.createElement("div");c.className="mdc-form-field form-field-status";var r=document.createElement("div");r.className="mdc-checkbox status-check";var o=document.createElement("input");o.className="mdc-checkbox__native-control",o.id="toggle-status",o.type="checkbox";var i=document.createElement("div");i.className="mdc-checkbox__background";document.createElement("div").className="mdc-checkbox__mixedmark",i.innerHTML='<svg class="mdc-checkbox__checkmark"\n      viewBox="0 0 24 24">\n      <path class="mdc-checkbox__checkmark-path"\n      fill="none"\n      d="M1.73,12.91 8.1,19.28 22.79,4.59"/>\n      </svg>\n      <div class="mdc-checkbox__mixedmark"></div>',r.appendChild(o),r.appendChild(i),c.appendChild(r),document.querySelector(".status--change-cont").innerHTML=c.outerHTML+l.outerHTML}var d=new mdc.checkbox.MDCCheckbox.attachTo(document.querySelector(".mdc-checkbox"));"CONFIRMED"===t.status&&(d.checked=!0),document.querySelector(".mdc-checkbox").onclick=function(){if(document.querySelector(".form-field-status").classList.add("hidden"),document.querySelector(".status--change-cont").appendChild(loader("status-loader")),"Android"!==localStorage.getItem("deviceType"))changeStatusRequest(d,t);else try{IsGpsEnabled.gpsEnabled()||(enableGps(),resetStatusConfirmation(d,t)),changeStatusRequest(d,t)}catch(e){console.log(e)}}}else document.querySelector(".status--change-cont").innerHTML=l.outerHTML+loader("status-loader").outerHTML}}function resetStatusConfirmation(e,t){document.querySelector(".form-field-status").classList.remove("hidden"),document.querySelector(".status--change-cont .status-loader").remove(),"CONFIRMED"===t.status?e.checked=!0:e.checked=!1}function changeStatusRequest(e,t){e.checked?requestCreator("statusChange",{activityId:t.activityId,status:"CONFIRMED"}):requestCreator("statusChange",{activityId:t.activityId,status:"PENDING"})}function createComment(e,u,t){var m=!1;return new Promise(function(i){document.getElementById(u.addendumId)&&i(document.getElementById(u.addendumId).outerHTML);var d=document.createElement("div");d.classList.add("comment-box","talk-bubble","tri-right","round","btm-left"),t.phoneNumber===u.user?d.classList.add("current-user--comment","secondary-color-light"):d.classList.add("other-user--comment","mdc-theme--primary-bg"),d.id=u.addendumId;var l=document.createElement("div");l.classList.add("talktext");var s=document.createElement("p");s.classList.add("user-name--comment","mdc-typography--subtitle2"),readNameFromNumber(e,u.user).then(function(e){s.textContent=e;var t=document.createElement("p");t.classList.add("comment","mdc-typography--subtitle2"),t.textContent=u.comment;var a=document.createElement("span");a.className="comment--info";var n=document.createElement("span");n.textContent=moment(u.timestamp).format("DD-MM-YY H:mm"),n.classList.add("comment-date","mdc-typography--caption");var c=document.createElement("div"),r=document.createElement("i");r.classList.add("user-map--span","material-icons"),r.appendChild(document.createTextNode("location_on")),c.onclick=function(e){m=!m;var t={lat:u.location._latitude,lng:u.location._longitude};maps(e,m,u.addendumId,t)},r.dataset.latitude=u.location._latitude,r.dataset.longitude=u.location._longitude,c.appendChild(r);var o=document.createElement("div");o.className="map-convo",a.appendChild(n),a.appendChild(c),l.appendChild(s),l.appendChild(t),l.appendChild(a),d.appendChild(l),d.appendChild(o),i(d)}).catch(console.log)})}function readNameFromNumber(n,c){return new Promise(function(a,t){var e=n.transaction("users").objectStore("users");e.get(c).onsuccess=function(e){var t=e.target.result;return t?t.displayName?a(t.displayName):void a(c):a(c)},e.get(c).onerror=function(e){t(e)}})}function maps(e,t,a,n){var c="";if(c=e?document.getElementById(a).querySelector(".map-convo"):document.querySelector(".map-detail."+a),console.log(t),!t)return c.style.height="0px",void(e&&(e.target.textContent="location_on"));if(0!==c.children.length)return c.style.height="200px",void(e&&(e.target.textContent="arrow_drop_down"));e&&(e.target.textContent="arrow_drop_down"),c.style.height="200px";var r=new google.maps.Map(c,{zoom:16,center:n,disableDefaultUI:!0});if(!e){var o=document.createElement("div");new MapsCustomControl(o,r,n.lat,n.lng);o.index=1,r.controls[google.maps.ControlPosition.TOP_LEFT].push(o)}new google.maps.Marker({position:n,map:r})}function MapsCustomControl(e,t,a,n){var c=document.createElement("div");c.style.backgroundColor="#fff",c.style.border="2px solid #fff",c.style.borderRadius="3px",c.style.boxShadow="0 2px 6px rgba(0,0,0,.3)",c.style.cursor="pointer",c.style.marginBottom="22px",c.style.textAlign="center",c.style.padding="0px 5px 0px 5px",e.appendChild(c);var r=document.createElement("a");r.href="https://www.google.com/maps?q="+a+","+n,r.className="material-icons",r.style.color="rgb(25,25,25)",r.style.fontSize="16px",r.style.lineHeight="38px",r.style.paddingLeft="5px",r.style.paddingRight="5px",r.style.textDecoration="none",r.innerHTML="open_in_new",c.appendChild(r)}function createHeaderContent(t,e){var a=t.transaction("activity").objectStore("activity"),r=document.createElement("div"),o=document.createElement("div");o.className="back-icon",o.id="back-conv",o.style.float="left";var n=document.createElement("i");n.style.marginRight="5px",n.className="material-icons back-icon--large",n.textContent="arrow_back",o.appendChild(n),a.get(e).onsuccess=function(e){var c=e.target.result;getImageFromNumber(t,c.creator).then(function(e){console.log(e);var t=document.createElement("img");t.className="header--icon-creator",t.dataset.number=c.creator,t.src=e,t.setAttribute("onerror","handleImageError(this)"),o.appendChild(t);var a=document.createElement("div");a.className="mdc-list-item__text comment-header-primary mdc-typography--subtitle2",a.textContent=c.activityName;var n=document.createElement("span");n.className="mdc-list-item__secondary-text",n.textContent="Click here to see details",a.appendChild(n),r.appendChild(o),r.appendChild(a),header(r.outerHTML,""),document.getElementById("back-conv").addEventListener("click",function(){backNav()}),document.querySelector(".comment-header-primary").addEventListener("click",function(){updateCreateActivity(c,!0)})})}}function reinitCount(e,t){var a=e.transaction("activityCount","readwrite").objectStore("activityCount");a.get(t).onsuccess=function(e){var t=e.target.result;t&&(t.count=0,a.put(t))}}function getImageFromNumber(e,n){return new Promise(function(a){e.transaction("users").objectStore("users").get(n).onsuccess=function(e){var t=e.target.result;n===firebase.auth().currentUser.phoneNumber?a(firebase.auth().currentUser.photoURL||"./img/empty-user.jpg"):a(t?t.photoURL:"./img/empty-user.jpg")}})}function selectorUI(e,a){sendCurrentViewNameToAndroid("selector");var t=document.createElement("aside");t.id="dialog--component",t.className="mdc-dialog",t.role="alertdialog";var n=document.createElement("div");n.className="mdc-dialog__surface";var c=document.createElement("span");c.className="material-icons",c.textContent="search",c.id="selector--search";var r=document.createElement("span");r.className="material-icons dialog--header-back selector--type-"+a.store,r.textContent="arrow_back";var o=document.createElement("section");o.className="mdc-dialog__body--scrollable mdc-top-app-bar--fixed-adjust";var i=document.createElement("ul");i.id="data-list--container",i.className="mdc-list ",o.appendChild(i);var d=document.createElement("footer");d.className="mdc-dialog__footer";var l=document.createElement("button");l.className="mdc-fab mdc-dialog__footer__button mdc-dialog__footer__button--accept selector-send",l.type="button";var s=document.createElement("span");s.className="mdc-fab__icon material-icons","users"===a.store?(s.textContent="add",l.dataset.clicktype="numpad"):s.textContent="send",l.appendChild(s),d.appendChild(l),"subscriptions"===a.store||"children"===a.store?n.appendChild(header(r.outerHTML,"","selector")):n.appendChild(header(r.outerHTML,c.outerHTML,"selector")),n.appendChild(o),n.appendChild(d),t.appendChild(n);var u=document.createElement("div");u.className="mdc-dialog__backdrop",t.appendChild(u),document.body.appendChild(t),document.querySelector(".dialog--header-back").addEventListener("click",function(t){t.target.classList.contains("selector--type-users")&&"users-list-back"===t.target.dataset.state?resetSelectedContacts().then(function(e){removeDialog(t,a)}):removeDialog(t,a)}),initializeSelectorWithData(e,a)}function removeDialog(e,t){document.getElementById("dialog--component")&&(e&&"back-list"===e.target.dataset.type?resetSelectorUI(t):(document.getElementById("dialog--component").remove(),document.getElementById("growthfile").classList.remove("mdc-dialog-scroll-lock")))}function initializeSelectorWithData(e,a){console.log(a);var n=new mdc.dialog.MDCDialog(document.querySelector("#dialog--component")),c=a.record,t=firebase.auth().currentUser.uid,r=indexedDB.open(t);r.onsuccess=function(){var e=r.result;if("map"===a.store){var t=e.transaction(a.store).objectStore(a.store);fillMapInSelector(e,t.index("location"),n,a)}"subscriptions"===a.store&&fillSubscriptionInSelector(e,e.transaction(a.store).objectStore(a.store),n,a);"users"===a.store&&(e.transaction(a.store).objectStore(a.store),resetSelectedContacts().then(function(){fillUsersInSelector(a,n)})),"children"===a.store&&fillChildrenInSelector(e.transaction(a.store).objectStore(a.store),c,n,a)},n.lastFocusedTarget=e.target,n.show()}function fillUsersInSelector(n,t){var c=document.getElementById("data-list--container"),r={};n.record.assignees.forEach(function(e){r[e]=""});var a=indexedDB.open(firebase.auth().currentUser.uid);a.onsuccess=function(){var e=a.result;e.transaction("users").objectStore("users").openCursor().onsuccess=function(e){var t=e.target.result;if(t){var a=t.value;n.attachment.present?c.appendChild(createSimpleAssigneeLi(a,!0,!1)):r.hasOwnProperty(t.value.mobile)||c.appendChild(createSimpleAssigneeLi(a,!0,!0)),t.continue()}else{document.querySelectorAll('[data-selected="true"]').forEach(function(e){new mdc.checkbox.MDCCheckbox.attachTo(e).checked=!0,e.children[1].style.animation="none",e.children[1].children[0].children[0].style.animation="none"})}},document.getElementById("selector--search").addEventListener("click",function(){initSearchForSelectors(e,"users",n)}),t.acceptButton_.onclick=function(){if("numpad"===t.acceptButton_.dataset.clicktype)return document.getElementById("selector--search").style.display="none",document.getElementById("data-list--container").innerHTML="",document.querySelector(".mdc-dialog__footer").style.display="none",void addNewNumber(n,t);if(n.attachment.present){var e=new mdc.radio.MDCRadio(document.querySelector(".mdc-radio.radio-selected"));return console.log(e),console.log("run"),updateDomFromIDB(n.record,{hash:"",key:n.attachment.key},{primary:JSON.parse(e.value)}),void removeDialog()}if(n.record.hasOwnProperty("create"))resetSelectedContacts().then(function(e){updateDomFromIDB(n.record,{hash:"addOnlyAssignees"},{primary:e}),removeDialog()});else if("Android"!==localStorage.getItem("deviceType"))shareReq(n);else try{if(!IsGpsEnabled.gpsEnabled())return void enableGps();shareReq(n)}catch(e){console.log(e)}}}}function shareReq(t){document.querySelector(".add--assignee-loader").appendChild(loader("user-loader")),document.querySelector(".add--assignee-loader .add--assignee-icon").style.display="none",resetSelectedContacts().then(function(e){console.log(e),requestCreator("share",{activityId:t.record.activityId,share:e}),removeDialog()})}function addNewNumber(a){var e=document.createElement("div");e.className="custom-number--container";var t=document.createElement("input");t.className="mdc-text-field__input",t.id="number-field",t.type="number",t.setAttribute("maxlength","10"),t.setAttribute("size","10"),t.required=!0,t.onkeypress=function(e){return 48<=e.charCode&&e.charCode<=57},t.oninput=function(){this.value.length>this.maxLength?(console.log(this),this.value=this.value.slice(0,this.maxLength)):this.value.length===this.maxLength?(document.querySelector(".message-field").classList.remove("error-message"),this.classList.add("valid-input"),document.querySelector(".message-field").textContent="",document.getElementById("new-contact").disabled=!1):(document.querySelector(".message-field").classList.add("error-message"),document.querySelector(".message-field").textContent="* Please Enter a valid Number",document.getElementById("new-contact").disabled=!0)};var n=document.createElement("button");n.className="mdc-button",n.textContent="Add Contact",n.id="new-contact",n.onclick=function(){var t=formatNumber(document.getElementById("number-field").value);checkNumber(t)?numberNotExist(t).then(function(e){if(e)return document.getElementById("new-contact").disabled=!0,document.querySelector(".message-field").classList.add("error-message"),void(document.querySelector(".message-field").textContent="* Contact already exist");if(a.attachment.present)return updateDomFromIDB(a.record,{hash:"",key:a.attachment.key},{primary:[t]}),void removeDialog();if(a.record.hasOwnProperty("create"))return updateDomFromIDB(a.record,{hash:"addOnlyAssignees"},{primary:[t]}),void removeDialog();if("Android"!==localStorage.getItem("deviceType"))newNumberReq(a,t);else try{if(!IsGpsEnabled.gpsEnabled())return void enableGps();newNumberReq(a,t)}catch(e){console.log(e)}}):(document.querySelector(".message-field").classList.add("error-message"),document.querySelector(".message-field").textContent="* Please Enter a valid Number",document.getElementById("new-contact").disabled=!0)};var c=document.createElement("p");c.className="mdc-typography--subtitle2 message-field",c.textContent="Enter new phone contact without country code",c.id="helper-message",e.appendChild(t),e.appendChild(c),e.appendChild(n),document.querySelector("#dialog--component section.mdc-dialog__body--scrollable").appendChild(e);new mdc.ripple.MDCRipple.attachTo(document.getElementById("new-contact"))}function newNumberReq(e,t){requestCreator("share",{activityId:e.record.activityId,share:[t]}),removeDialog()}function numberNotExist(n){return new Promise(function(a){var e=firebase.auth().currentUser.uid,t=indexedDB.open(e);t.onsuccess=function(){t.result.transaction("users").objectStore("users").get(n).onsuccess=function(e){var t=e.target.result;a(!!t)}}})}function resetSelectedContacts(){return new Promise(function(n){var c=[],e=firebase.auth().currentUser.uid,t=indexedDB.open(e);t.onsuccess=function(){var a=t.result.transaction(["users"],"readwrite").objectStore("users");a.openCursor().onsuccess=function(e){var t=e.target.result;t?(t.value.isSelected&&(c.push(t.value.mobile),t.value.isSelected=!1,a.put(t.value)),t.continue()):n(c)}}})}function fillMapInSelector(e,t,a,n){var c=document.getElementById("data-list--container");t.openCursor(null,"nextunique").onsuccess=function(e){var t=e.target.result;t&&(t.value.location&&c.appendChild(createVenueLi(t.value,!1,n.record,!0)),t.continue())},document.getElementById("selector--search").addEventListener("click",function(){initSearchForSelectors(e,"map",n)}),a.acceptButton_.onclick=function(){var e=new mdc.radio.MDCRadio(document.querySelector(".mdc-radio.radio-selected")),t=JSON.parse(e.value);updateDomFromIDB(n.record,{hash:"venue",key:n.key},{primary:t.location,secondary:{address:t.address,geopoint:t.geopoint}}),removeDialog()}}function fillChildrenInSelector(e,a,t,n){var c=document.getElementById("data-list--container");console.log(n),e.openCursor().onsuccess=function(e){var t=e.target.result;t&&(t.value.template===n.attachment.template&&t.value.office===n.attachment.office&&"CANCELLED"!=n.attachment.status&&c.appendChild(createSimpleLi("children",t.value.attachment.Name.value)),t.continue())},t.acceptButton_.onclick=function(){var e=new mdc.radio.MDCRadio(document.querySelector(".mdc-radio.radio-selected")),t=JSON.parse(e.value);updateDomFromIDB(a,{hash:"children",key:n.attachment.key},{primary:t.name}),removeDialog()}}function fillSubscriptionInSelector(e,t,a,n){var c=document.getElementById("data-list--container"),r=document.createElement("div");r.className="mdc-list-group";var o=[];t.index("office").openCursor(null,"nextunique").onsuccess=function(e){var t=e.target.result;if(t){var a=document.createElement("h3");a.className="mdc-list-group__subheader subheader--group-small",a.textContent=t.value.office,a.dataset.groupOffice=t.value.office;var n=document.createElement("ul");n.className="mdc-list",n.dataset.selection=t.value.office,n.setAttribute("aria-orientation","vertical"),o.push(t.value.office),r.appendChild(a),r.appendChild(n),t.continue()}else insertTemplateByOffice(o)},c.appendChild(r),a.acceptButton_.onclick=function(){var e=new mdc.radio.MDCRadio(document.querySelector(".mdc-radio.radio-selected"));console.log(e);var t=JSON.parse(e.value);console.log(t),document.getElementById("app-current-panel").dataset.view="create",createTempRecord(t.office,t.template,n)}}function insertTemplateByOffice(e){var a={admin:"",recipient:"",employee:"",subscription:""},t=indexedDB.open(firebase.auth().currentUser.uid);document.createDocumentFragment();t.onsuccess=function(){t.result.transaction("subscriptions").objectStore("subscriptions").index("office").openCursor().onsuccess=function(e){var t=e.target.result;t&&("CANCELLED"!==t.value.status&&(a.hasOwnProperty(t.value.template)||document.querySelector('[data-selection="'+t.value.office+'"] [data-template="'+t.value.template+'"]')||(document.querySelector('[data-selection="'+t.value.office+'"]').appendChild(createGroupList(t.value.office,t.value.template)),console.log(t.value))),t.continue())}}}function createTempRecord(a,n,e){var t=firebase.auth().currentUser.uid,c=indexedDB.open(t);c.onsuccess=function(){var e=c.result.transaction("subscriptions").objectStore("subscriptions").index("officeTemplate"),t=IDBKeyRange.only([a,n]);e.get(t).onsuccess=function(e){var t=e.target.result,a=[],n=[];t.venue.forEach(function(e){var t={};t.venueDescriptor=e,t.location="",t.address="",t.geopoint={_latitude:"",_longitude:""},a.push(t)}),console.log(t),t.schedule.forEach(function(e){var t={};t.name=e,t.startTime="",t.endTime="",n.push(t)}),updateCreateActivity({office:t.office,template:t.template,venue:a,schedule:n,attachment:t.attachment,timestamp:Date.now(),canEdit:!0,assignees:[],activityName:t.template.toUpperCase(),create:!0},!0),removeDialog()}}}function hasAnyValueInChildren(c,r,o){var e=firebase.auth().currentUser.uid,t=indexedDB.open(e);return new Promise(function(n){t.onsuccess=function(){var e=t.result.transaction("children").objectStore("children"),a=0;e.openCursor().onsuccess=function(e){var t=e.target.result;t?(t.value.template===r&&t.value.office===c&&"CANCELLED"!=o&&a++,t.continue()):n(0!==a)}}})}function updateDomFromIDB(c,r,o){var e=firebase.auth().currentUser.uid,i=indexedDB.open(e);i.onsuccess=function(e){var t=c,a=i.result,n=a.transaction("activity","readwrite").objectStore("activity");return"venue"===r.hash?(t=updateVenue(t,r,o),document.getElementById(convertKeyToId(r.key)).querySelector("[data-primary]").textContent=o.primary,document.getElementById(convertKeyToId(r.key)).querySelector("[data-secondary]").textContent=o.secondary.address,document.getElementById("send-activity").classList.remove("hidden"),void(c.hasOwnProperty("create")||n.put(t))):"addOnlyAssignees"===r.hash?(0<o.primary.length&&o.primary.forEach(function(e){-1<c.assignees.indexOf(e)||c.assignees.push(e)}),console.log(c),void readNameAndImageFromNumber(o.primary,a)):(t.attachment[r.key].value=o.primary,c.hasOwnProperty("create")||n.put(t),void("weekday"!==r.hash&&r.hasOwnProperty("key")&&(document.getElementById(convertKeyToId(r.key)).querySelector("[data-primary]").textContent=o.primary,o.hasOwnProperty("secondary")&&(document.getElementById(convertKeyToId(r.key)).querySelector("[data-secondary]").textContent=o.secondary.address),document.getElementById("send-activity").classList.remove("hidden"))))}}function updateVenue(e,t,a){return e.venue.forEach(function(e){e.venueDescriptor===t.key&&(e.location=a.primary,e.address=a.secondary.address,e.geopoint._latitude=a.secondary.geopoint._latitude,e.geopoint._longitude=a.secondary.geopoint._longitude,console.log(e))}),e}function convertKeyToId(e){return e.replace(/\s/g,"-")}function convertIdToKey(e){return e.replace(/-/g," ")}function updateCreateContainer(e){document.body.style.backgroundColor="#eeeeee";var t=document.createElement("div");t.style.display="inline-flex";var a=document.createElement("span");a.className="material-icons",a.textContent="arrow_back",a.id="backToConv";var n=document.createElement("span");n.textContent=e.activityName,n.style.fontSize="19px",n.style.paddingLeft="10px",n.style.marginTop="2px",t.appendChild(a),t.appendChild(n),header(t.outerHTML,""),document.getElementById("backToConv").addEventListener("click",function(){backNav()});var c=document.createElement("div");c.className="mdc-top-app-bar--fixed-adjust update-create--activity";for(var r=["office","venue","schedule","attachment","assignees"],o=0;o<5;o++){var i=document.createElement("ul");i.className="mdc-list custom--list-margin";var d=document.createElement("div");switch(r[o]){case"office":i.classList.remove("custom--list-margin");break;case"schedule":d.className="mdc-list-group__subheader",d.id="schedule--group";break;case"venue":case"assignees":i.classList.add("mdc-list--two-line","mdc-list--avatar-list")}"schedule"===r[o]?c.appendChild(d):(i.id=r[o]+"--list",c.appendChild(i))}if(e.canEdit){var l=document.createElement("button");l.className="mdc-fab send--activity-fab",l.setAttribute("aria-label","Send"),l.id="send-activity",e.hasOwnProperty("create")||l.classList.add("hidden");var s=document.createElement("span");s.className="mdc-fab__icon material-icons",s.textContent="send",l.appendChild(s),c.appendChild(l)}return c}function updateCreateActivity(c,e){e&&history.pushState(["updateCreateActivity",c],null,null);var t=firebase.auth().currentUser.uid,r=indexedDB.open(t);r.onsuccess=function(){var e=r.result;document.getElementById("app-current-panel").innerHTML=updateCreateContainer(c).outerHTML,document.getElementById("office--list").appendChild(createSimpleLi("Office",{office:c.office,showLabel:!0})),document.getElementById("send-activity")&&document.getElementById("send-activity").addEventListener("click",function(){sendActivity(c)}),createVenueSection(c),createScheduleTable(c),createAttachmentContainer(c);for(var t=document.querySelectorAll(".update-create--activity input"),a=0;a<t.length;a++)t[a].addEventListener("input",function(e){document.getElementById("send-activity").classList.contains("hidden")&&document.getElementById("send-activity").classList.remove("hidden")});if(document.querySelector(".mdc-select")){var n=new mdc.select.MDCSelect(document.querySelector(".mdc-select"));n.listen("change",function(){console.log(n),updateDomFromIDB(c,{hash:"weekday",key:n.root_.dataset.value},{primary:n.value}),document.getElementById("send-activity").classList.contains("hidden")&&document.getElementById("send-activity").classList.remove("hidden")})}createAssigneeList(e,c,!0),createActivityCancellation(c)}}function createSimpleLi(e,t){var a=document.createElement("li");a.className="mdc-list-item mdc-ripple-upgraded";var n=document.createElement("span");n.className="detail--static-text";document.createElement("span");var c=document.createElement("span");if("Office"===e&&(c.className="data--value-list",c.textContent=t.office,n.textContent=e,a.appendChild(n),a.appendChild(c)),"children"===e){var r=document.createElement("span");r.className="mdc-list-item__meta",r.appendChild(createRadioInput()),a.textContent=t,a.appendChild(r),a.onclick=function(){checkRadioInput(this,{name:t})}}if("delete"===e&&(c.className="mdc-list-item__graphic material-icons",c.textContent=e,n.classList.remove("detail--static-text"),n.classList.add("delete-activity"),n.textContent=t.text,a.appendChild(c),a.appendChild(n)),"empty"===e&&(a.dataset.prop="delete"),"undo-deleted"===e){c.className="mdc-list-item__graphic material-icons",c.textContent="delete",n.classList.remove("detail--static-text"),n.classList.add("delete-activity"),n.textContent=t.text,a.appendChild(c),a.appendChild(n),a.classList.add("undo-delete-activity");var o=document.createElement("button");o.className="mdc-button mdc-ripple-upgraded mdc-list-item__meta undo-deleted",o.textContent="Undo",o.onclick=function(){if("Android"===localStorage.getItem("deviceType"))try{IsGpsEnabled.gpsEnabled()?reqForUndoDeleted(t.id):enableGps()}catch(e){console.log(e)}else reqForUndoDeleted(t.id)},a.appendChild(o)}return a}function reqForUndoDeleted(e){document.querySelector(".undo-deleted").style.display="none",listItem.appendChild(loader("undo-delete-loader")),requestCreator("statusChange",{activityId:e,status:"PENDING"})}function createGroupList(e,t){var a=document.createElement("li");a.className="mdc-list-item transition-ease",a.dataset.template=t;var n=document.createElement("span");n.className="mdc-list-item__text",n.textContent=t.toUpperCase();var c=document.createElement("span");return c.className="mdc-list-item__meta",c.appendChild(createRadioInput()),a.onclick=function(){checkRadioInput(this,{office:e,template:t})},a.appendChild(n),a.appendChild(c),a}function createVenueSection(a){console.log(a);var n=document.getElementById("venue--list");a.venue.forEach(function(e){n.appendChild(createVenueLi(e,!0,a));var t=document.createElement("div");t.className="map-detail "+convertKeyToId(e.venueDescriptor),n.appendChild(t)}),0===a.venue.length&&(document.getElementById("venue--list").style.display="none")}function createVenueLi(a,e,t,n){var c=!1,r=document.createElement("li");r.className="mdc-list-item mdc-ripple-upgraded",r.id=convertKeyToId(a.venueDescriptor);var o=document.createElement("div");o.className="mdc-list-item__text link--span";var i=document.createElement("span");i.className="mdc-list-item__primary-text";var d=document.createElement("span");d.className="mdc-list-item__meta";var l=document.createElement("label");l.className="mdc-fab add--assignee-icon attachment-selector-label";var s=document.createElement("span");if(s.className="mdc-fab__icon material-icons",s.textContent="add_location",l.appendChild(s),e){var u=document.createElement("span");u.className="detail--static-text",u.textContent=a.venueDescriptor;var m=document.createElement("span");m.className="data--value-list",m.textContent=a.location,m.dataset.primary="",i.appendChild(u),i.appendChild(m),o.appendChild(i),o.onclick=function(e){c=!c;var t={lat:a.geopoint._latitude,lng:a.geopoint._longitude};maps("",c,convertKeyToId(a.venueDescriptor),t)},t.canEdit&&(d.setAttribute("aria-hidden","true"),d.appendChild(l),l.onclick=function(e){selectorUI(e,{record:t,store:"map",attachment:{present:!1},key:a.venueDescriptor})})}else i.textContent=a.location,o.appendChild(i);var p=document.createElement("span");p.className="mdc-list-item__meta material-icons",n&&(p.appendChild(createRadioInput()),r.onclick=function(){console.log(a),checkRadioInput(this,{location:a.location,address:a.address,geopoint:{_latitude:a.latitude,_longitude:a.longitude},venueDesc:a.venueDescriptor})});var v=document.createElement("span");return v.className="mdc-list-item__secondary-text",v.textContent=a.address,v.dataset.secondary="",o.appendChild(v),r.appendChild(o),n?r.appendChild(p):r.appendChild(d),r}function createScheduleTable(f){f.schedule.length||(document.getElementById("schedule--group").style.display="none");var y=0;f.schedule.forEach(function(e){y++,console.log(e.startTime);var t=document.createElement("h5");t.className="mdc-list-group__subheader label--text",t.textContent=e.name;var a=document.createElement("ul");a.className="mdc-list mdc-list--dense";var n=document.createElement("li");n.className="mdc-list-divider",n.setAttribute("role","separator");var c=document.createElement("li");c.className="mdc-list-item schedule-start-li";var r=document.createElement("div");r.className="mdc-text-field start--date"+y;var o=document.createElement("input");o.value=moment(e.startTime||new Date).format("YYYY-MM-DD"),o.type="date",o.disabled=!f.canEdit,o.className="mdc-text-field__input",r.appendChild(o);var i=document.createElement("span");i.className="mdc-list-item__meta";var d=document.createElement("div");d.className="mdc-text-field start--time"+y;var l=document.createElement("input");l.value=moment(e.startTime||new Date).format("HH:mm"),l.type="time",l.className="time--input",l.disabled=!f.canEdit,l.className="mdc-text-field__input",d.appendChild(l),i.appendChild(d);var s=document.createElement("li");s.className="mdc-list-item schedule-end-li";var u=document.createElement("div");u.className="mdc-text-field end--date"+y;var m=document.createElement("input");m.value=moment(e.endTime||new Date).format("YYYY-MM-DD"),m.type="date",m.disabled=!f.canEdit,m.className="mdc-text-field__input",u.appendChild(m);var p=document.createElement("span");p.className="mdc-list-item__meta";var v=document.createElement("div");v.className="mdc-text-field end--time"+y;var h=document.createElement("input");h.value=moment(e.endTime||new Date).format("HH:mm"),h.type="time",h.disabled=!f.canEdit,h.className="mdc-text-field__input",v.appendChild(h),p.appendChild(v),c.appendChild(r),c.appendChild(i),s.appendChild(u),s.appendChild(p),a.appendChild(c),a.appendChild(n),a.appendChild(s),document.getElementById("schedule--group").appendChild(t),document.getElementById("schedule--group").appendChild(a)})}function createAttachmentContainer(p){["Name","Template","email","phoneNumber","HHMM","weekday","number","base64","string"].forEach(function(e){var t=document.createElement("div");t.className=e+"--group",document.getElementById("attachment--list").appendChild(t)});var v={phoneNumber:"",weekday:"","HH:MM":"",string:"",base64:"",number:"",email:""};Object.keys(p.attachment).forEach(function(t){var a=document.createElement("div");"HH:MM"===p.attachment[t].type?a.className="attachment-field HHMM":a.className="attachment-field "+p.attachment[t].type,a.id=convertKeyToId(t),p.canEdit&&a.classList.add("editable--true");var e=document.createElement("span");if(e.className="label--text","Name"===(e.textContent=t)){a.appendChild(e);a.appendChild(createSimpleInput(p.attachment[t].value,p.canEdit,"",t,!0))}if("string"===p.attachment[t].type&&"Name"!==t&&(a.appendChild(e),a.appendChild(createSimpleInput(p.attachment[t].value,p.canEdit,"",t))),"number"===p.attachment[t].type&&(a.appendChild(e),a.appendChild(createNumberInput(p.attachment[t].value,p.canEdit))),"email"===p.attachment[t].type&&(a.appendChild(e),a.appendChild(createEmailInput(p.attachment[t].value,p.canEdit))),"phoneNumber"===p.attachment[t].type){a.classList.add("selector--margin");var n=document.createElement("label");n.className="mdc-fab add--assignee-icon attachment-selector-label";var c=document.createElement("span");c.className="mdc-fab__icon material-icons",c.textContent="person_add",n.appendChild(c);var r=document.createElement("span");r.className="data--value-list",r.dataset.primary="",p.canEdit&&(a.appendChild(n),n.onclick=function(e){selectorUI(e,{record:p,store:"users",attachment:{present:!0,key:t}})}),a.appendChild(e),r.textContent=p.attachment[t].value,a.appendChild(r)}if("HH:MM"==p.attachment[t].type&&(a.appendChild(e),a.appendChild(createTimeInput(p.attachment[t].value,p.canEdit,{simple:!1,type:"time"}))),"weekday"===p.attachment[t].type&&(a.appendChild(e),a.appendChild(createSelectMenu(t,p.attachment[t].value,p.canEdit))),"base64"===p.attachment[t].type){var o=document.createElement("label");o.className="mdc-fab attachment-selector-label add--assignee-icon",o.id="start-camera";var i=document.createElement("span");i.className="mdc-fab__icon material-icons",i.textContent="add_a_photo",o.appendChild(i);var d=document.createElement("ul");d.className="image-preview--attachment mdc-image-list standard-image-list mdc-image-list--with-text-protection",d.appendChild(setFilePath(p.attachment[t].value,t,!0)),a.appendChild(d),p.canEdit&&(a.appendChild(o),a.appendChild(d),o.onclick=function(){readCameraFile()})}if(!v.hasOwnProperty(p.attachment[t].type)){var l=document.createElement("label");l.className="mdc-fab add--assignee-icon attachment-selector-label";var s=document.createElement("span");s.className="mdc-fab__icon material-icons",s.textContent="add",l.appendChild(s),a.appendChild(e);var u=document.createElement("span");u.textContent=p.attachment[t].value,u.className="data--value-list",a.appendChild(u),p.canEdit&&hasAnyValueInChildren(p.office,p.attachment[t].type,p.status).then(function(e){e&&(console.log(e),a.appendChild(l),a.classList.add("selector--margin"),l.onclick=function(e){u.dataset.primary="",selectorUI(e,{record:p,store:"children",attachment:{present:!0,key:t,office:p.office,template:p.attachment[t].type,status:p.status}})})})}var m=document.createElement("hr");m.className="attachment--divider","HH:MM"===p.attachment[t].type?(document.querySelector(".HHMM--group").appendChild(a),document.querySelector(".HHMM--group").appendChild(m)):"Name"===t?(document.querySelector(".Name--group").appendChild(a),document.querySelector(".Name--group").appendChild(m)):v.hasOwnProperty(p.attachment[t].type)?(document.querySelector("."+p.attachment[t].type+"--group").appendChild(a),document.querySelector("."+p.attachment[t].type+"--group").appendChild(m)):(document.querySelector(".Template--group").appendChild(a),document.querySelector(".Template--group").appendChild(m))})}function createAssigneeList(e,t,a){if(a){var n=document.createElement("li");n.className="mdc-list-item label--text add--assignee-loader",n.textContent="Assignees";var c=document.createElement("span");c.className="mdc-list-item__meta";var r=document.createElement("div");r.className="mdc-fab add--assignee-icon",r.onclick=function(e){selectorUI(e,{record:t,store:"users",attachment:{present:!1}})};var o=document.createElement("span");o.className="mdc-fab__icon material-icons",o.textContent="person_add",r.appendChild(o),c.appendChild(r),t.canEdit&&n.appendChild(c),document.getElementById("assignees--list").appendChild(n)}readNameAndImageFromNumber(t.assignees,e)}function readNameAndImageFromNumber(e,t){var n=t.transaction("users").objectStore("users");e.forEach(function(a){n.get(a).onsuccess=function(e){var t=e.target.result;t||(t={mobile:a,displayName:"",photoURL:""}),document.getElementById("assignees--list").appendChild(createSimpleAssigneeLi(t))}})}function createSimpleAssigneeLi(e,t,a){var n=document.createElement("li");if(n.classList.add("mdc-list-item","assignee-li"),!e)return n;n.dataset.value=e.mobile;var c=document.createElement("img");c.classList.add("mdc-list-item__graphic"),e.mobile===firebase.auth().currentUser.phoneNumber?c.src=firebase.auth().currentUser.photoURL||"./img/empty-user.jpg":c.src=e.photoURL||"./img/empty-user.jpg",c.setAttribute("onerror","handleImageError(this)");var r=document.createElement("span");r.classList.add("mdc-list-item__text");var o=document.createElement("span");o.className="mdc-list-item__primary-text";var i=document.createElement("span");i.classList.add("mdc-list-item__secondary-text"),e.displayName?(o.textContent=e.displayName,i.textContent=e.mobile):o.textContent=e.mobile,r.appendChild(o),r.appendChild(i);var d=document.createElement("span");return d.className="mdc-list-item__meta material-icons",t&&(a?d.appendChild(createCheckBox(e)):(d.appendChild(createRadioInput()),n.onclick=function(){checkRadioInput(this,n.dataset.value)})),n.appendChild(c),n.appendChild(r),n.appendChild(d),n}function createRadioInput(){var e=document.createElement("div");e.className="mdc-radio radio-control-selector";var t=document.createElement("input");t.className="mdc-radio__native-control",t.type="radio",t.name="radio";var a=document.createElement("div");a.className="mdc-radio__background";var n=document.createElement("div");n.className="mdc-radio__outer-circle";var c=document.createElement("div");return c.className="mdc-radio__inner-circle",a.appendChild(n),a.appendChild(c),e.appendChild(t),e.appendChild(a),e}function createCheckBox(t){var e=document.createElement("div");e.className="mdc-checkbox status-check",e.dataset.selected=t.isSelected;var a=document.createElement("input");a.className="mdc-checkbox__native-control",a.type="checkbox",a.onclick=function(e){checkCheckboxInput(e,t)};var n=document.createElement("div");n.className="mdc-checkbox__background";return document.createElement("div").className="mdc-checkbox__mixedmark",n.innerHTML='<svg class="mdc-checkbox__checkmark"\n    viewBox="0 0 24 24">\n    <path class="mdc-checkbox__checkmark-path"\n    fill="none"\n    d="M1.73,12.91 8.1,19.28 22.79,4.59"/>\n    </svg>\n    <div class="mdc-checkbox__mixedmark"></div>',e.appendChild(a),e.appendChild(n),e}function checkCheckboxInput(t,a){var e=firebase.auth().currentUser.uid,n=indexedDB.open(e);n.onsuccess=function(){var e=n.result.transaction("users","readwrite").objectStore("users");a.hasOwnProperty("isSelected")&&a.isSelected?(t.target.parentNode.dataset.selected=!1,a.isSelected=!1):(t.target.parentNode.dataset.selected=!0,a.isSelected=!0,document.querySelector(".selector-send span").textContent="send"),e.put(a),0==document.querySelectorAll('[data-selected="true"]').length?(document.querySelector(".selector-send span").textContent="add",document.querySelector(".selector-send").dataset.clicktype="numpad"):document.querySelector(".selector-send").dataset.clicktype=""}}function checkRadioInput(e,t){var a=e,n=new mdc.radio.MDCRadio(a.querySelector(".radio-control-selector"));n.root_.classList.add("radio-selected"),n.checked=!0,console.log(t),document.querySelector(".selector-send span").textContent="send",document.querySelector(".selector-send").dataset.clicktype="",n.value=JSON.stringify(t)}function setFilePath(e,t,a){if(document.querySelector(".image--list-li"))return document.getElementById("attachment-picture").src="data:image/jpeg;base64,"+e,void document.getElementById("send-activity").classList.remove("hidden");var n=document.createElement("li");n.className="mdc-image-list__item image--list-li";var c=document.createElement("div"),r=document.createElement("img");r.className="profile-container--main mdc-image-list__image ",r.id="attachment-picture",r.dataset.photoKey=t,r.setAttribute("onerror","handleImageErrorAttachment(this)"),r.src=e||"./img/placeholder.png",r.onclick=function(){openImage(this.src)},c.appendChild(r),n.appendChild(c);var o=document.createElement("div");o.className="mdc-image-list__supporting";var i=document.createElement("span");return i.textContent=t,i.className="mdc-image-list__label",i.id="label--image",o.appendChild(i),n.appendChild(o),a?n:void 0}function readCameraFile(){"Android"===localStorage.getItem("deviceType")?FetchCameraForAttachment.startCamera():webkit.messageHandlers.takeImageForAttachment.postMessage("convert image to base 64")}function openImage(e){"data"===e.substring(0,4)&&(document.getElementById("viewImage--dialog-component").querySelector("img").src=e,new mdc.dialog.MDCDialog.attachTo(document.querySelector("#viewImage--dialog-component")).show())}function createActivityCancellation(e){var t=document.createElement("div");if(t.className="status--cancel-cont",!e.hasOwnProperty("create")&&e.canEdit)if("CANCELLED"!==e.status){if("CANCELLED"!==e.status){t.appendChild(createSimpleLi("delete",{text:"Delete Activity"})),document.querySelector(".update-create--activity").appendChild(t),document.getElementById("cancel-alert")||cancelAlertDialog();var a=new mdc.dialog.MDCDialog(document.querySelector("#cancel-alert"));document.getElementById("delete-allow").onclick=function(){if("Android"===localStorage.getItem("deviceType"))try{IsGpsEnabled.gpsEnabled()?deleteActivityReq(e.activityId):enableGps()}catch(e){console.log(e)}else deleteActivityReq(e.activityId)},a.listen("MDCDialog:cancel",function(){console.log("canceled")}),document.querySelector(".delete-activity").addEventListener("click",function(e){a.lastFocusedTarget=e.target,a.show()})}}else{t.appendChild(createSimpleLi("undo-deleted",{text:"Deleted",id:e.activityId})),document.querySelector(".update-create--activity").appendChild(t);new mdc.ripple.MDCRipple.attachTo(document.querySelector(".undo-deleted"))}}function deleteActivityReq(e){document.querySelector(".delete-activity").style.display="none",document.querySelector(".status--cancel-cont li").appendChild(loader("cancel-loader")),requestCreator("statusChange",{activityId:e,status:"CANCELLED"})}function cancelAlertDialog(){var e=document.createElement("aside");e.className="mdc-dialog",e.id="cancel-alert";var t=document.createElement("div");t.className="mdc-dialog__surface";var a=document.createElement("section");a.className="mdc-dialog__body",a.textContent="Are you sure you want to delete this activity ? ";var n=document.createElement("footer");n.className="mdc-dialog__footer";var c=document.createElement("button");c.type="button",c.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--accept delete-btn",c.textContent="Delete",c.id="delete-allow";var r=document.createElement("button");r.type="button",r.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--cancel cancel-delete-btn",r.textContent="Cancel",n.appendChild(r),n.appendChild(c),t.appendChild(a),t.appendChild(n),e.appendChild(t);var o=document.createElement("div");o.className="mdc-dialog__backdrop",e.appendChild(o),document.body.appendChild(e)}function sendActivity(a){if(a.hasOwnProperty("create"))insertInputsIntoActivity(a);else{var e=firebase.auth().currentUser.uid,n=indexedDB.open(e);n.onsuccess=function(e){var t=n.result.transaction("activity","readwrite").objectStore("activity");t.get(a.activityId).onsuccess=function(e){insertInputsIntoActivity(e.target.result,t)}}}}function concatDateWithTime(e,t){var a=moment(e+" "+t);return moment(a).valueOf()}function insertInputsIntoActivity(e,t){console.log(e);for(var a=document.querySelectorAll(".string"),n=0;n<a.length;n++){var c=a[n].querySelector(".mdc-text-field__input").value;if(a[n].querySelector(".mdc-text-field__input").required&&checkSpacesInString(c))return void snacks("Please provide an input for the field “Name” ");e.attachment[convertIdToKey(a[n].id)].value=c}var r=document.querySelectorAll(".number");for(n=0;n<r.length;n++){var o=r[n].querySelector(".mdc-text-field__input").value;e.attachment[convertIdToKey(r[n].id)].value=o}var i=document.querySelectorAll(".email");for(n=0;n<i.length;n++){var d=i[n].querySelector(".mdc-text-field__input").value;e.attachment[convertIdToKey(i[n].id)].value=d}var l=document.querySelectorAll(".HHMM");for(n=0;n<l.length;n++){var s=l[n].querySelector(".mdc-text-field__input").value;e.attachment[convertIdToKey(l[n].id)].value=s}for(var u=document.querySelectorAll(".image-preview--attachment  img"),m=0;m<u.length;m++)e.attachment[convertKeyToId(u[m].dataset.photoKey)].value=u[m].src;var p=void 0,v=void 0,h=void 0,f=void 0;for(n=1;n<e.schedule.length+1;n++){if(p=getInputText(".start--date"+n).value,v=getInputText(".start--time"+n).value,h=getInputText(".end--date"+n).value,f=getInputText(".end--time"+n).value,console.log(concatDateWithTime(p,v)),!concatDateWithTime(p,v)&&!concatDateWithTime(h,f))return void snacks("Please Select A Start Date and End Date");if(""===p)return void snacks("Please Select a Start Date");if(""===h)return void snacks("Please Select an End Date");if(concatDateWithTime(h,f)<concatDateWithTime(p,v))return void snacks("The End Date and Time should be greater or equal to the start time");e.schedule[n-1].startTime=concatDateWithTime(p,v)||"",e.schedule[n-1].endTime=concatDateWithTime(h,f)||""}for(n=0;n<e.venue.length;n++)e.venue[n].geopoint={latitude:e.venue[n].geopoint._latitude,longitude:e.venue[n].geopoint._longitude};var y={venue:e.venue,schedule:e.schedule,attachment:e.attachment};if("Android"!==localStorage.getItem("deviceType"))sendUpdateReq(y,e);else try{if(!IsGpsEnabled.gpsEnabled())return void enableGps();sendUpdateReq(y,e)}catch(e){console.log(e)}}function sendUpdateReq(e,t){if(!t.hasOwnProperty("create"))return e.activityId=t.activityId,document.querySelector("header").appendChild(progressBar()),document.querySelector("#send-activity").classList.add("hidden"),void requestCreator("update",e);e.office=t.office,e.template=t.template,e.share=t.assignees,document.querySelector("header").appendChild(progressBar()),document.querySelector("#send-activity").classList.add("hidden"),requestCreator("create",e)}function checkSpacesInString(e){return!e.replace(/\s/g,"").length}function initSearchForSelectors(e,t,a){if(searchBarUI(t),"map"===t){var n=document.getElementById("search--bar-selector");return autocomplete=new google.maps.places.Autocomplete(n,{componentRestrictions:{country:"in"}}),void initializeAutocompleteGoogle(autocomplete,a.record,a)}"users"===t&&initUserSelectorSearch(e,a)}function searchBarUI(e){var t=document.getElementById("dialog--component"),a=t.querySelector("#action-data");a.className="search--cont",t.querySelector(".mdc-top-app-bar__section--align-end").classList.add("search-field-transform"),t.querySelector(".mdc-top-app-bar__section--align-start").style.backgroundColor="white",document.getElementById("search--bar--field")?document.getElementById("search--bar--field").style.display="block":a.appendChild(createSimpleInput("",!0,!0)),document.getElementById("selector--search").style.display="none",document.querySelector(".selector-send").dataset.clicktype="",document.querySelector(".selector-send span").textContent="send",t.querySelector("#view-type span").dataset.type="back-list","users"===e&&(t.querySelector("#view-type span").dataset.state="user-list-back")}function resetSelectorUI(e){var t=document.getElementById("dialog--component"),a=t.querySelector("#action-data");t.querySelector("#view-type span").dataset.type="",t.querySelector(".mdc-top-app-bar__section--align-end").classList.remove("search-field-transform"),a.querySelector("#search--bar--field").classList.remove("field-input"),a.classList.remove("search--cont"),document.getElementById("selector--search").style.display="block",document.querySelector(".selector-send").style.display="block",document.querySelector("#search--bar--field").style.display="none",t.querySelector(".mdc-top-app-bar__section--align-start").style.backgroundColor="#eeeeee",document.getElementById("data-list--container").style.display="block";var n=new mdc.dialog.MDCDialog(t);"users"===e.store&&(document.getElementById("data-list--container").innerHTML="",fillUsersInSelector(e,n)),"subscriptions"===e.store&&document.getElementById("data-list--container").querySelectorAll("li").forEach(function(e){e.style.display="flex"})}function initializeAutocompleteGoogle(n,c,r){document.querySelector("#dialog--component .mdc-dialog__surface").style.width="100vw",document.querySelector("#dialog--component .mdc-dialog__surface").style.height="100vh",n.addListener("place_changed",function(){var e=n.getPlace();if(e.geometry){var t="";e.address_components&&(t=[e.address_components[0]&&e.address_components[0].short_name||"",e.address_components[1]&&e.address_components[1].short_name||"",e.address_components[2]&&e.address_components[2].short_name||""].join(" ")),console.log(t);var a={primary:e.name,secondary:{address:t,geopoint:{_latitude:e.geometry.location.lat(),_longitude:e.geometry.location.lng()}}};updateDomFromIDB(c,{hash:"venue",key:r.key},a),removeDialog(),console.log(t),console.log(e)}else snacks("Please select a valid location")})}function createSimpleInput(e,t,a,n,c){if(!t){var r=document.createElement("span");return r.className="data--value-list",r.textContent=e,r}var o=document.createElement("div");n&&n.length<15?o.className="mdc-text-field data--value-list":o.className="mdc-text-field data--value-list-small";var i=document.createElement("input");i.className="mdc-text-field__input input--value--update",i.style.paddingTop="0px",i.value=e,i.required=c;var d=document.createElement("div");d.className="mdc-line-ripple",a&&(o.id="search--bar--field",i.id="search--bar-selector",o.classList.add("field-input")),o.appendChild(i),o.appendChild(d);new mdc.textField.MDCTextField.attachTo(o);return o}function createNumberInput(e,t){if(!t){var a=document.createElement("span");return a.className="data--value-list",a.textContent=e,a}var n=document.createElement("div");n.className="mdc-text-field data--value-list";var c=document.createElement("input");c.className="mdc-text-field__input input--type-number",c.type="number",c.style.paddingTop="0px",c.value=e,c.setAttribute("onkeypress","return event.charCode >= 48 && event.charCode <= 57");var r=document.createElement("div");return r.className="mdc-line-ripple",n.appendChild(c),n.appendChild(r),n}function createEmailInput(e,t){if(!t){var a=document.createElement("span");return a.className="data--value-list",a.textContent=e,a}var n=document.createElement("div");n.className="mdc-text-field data--value-list";var c=document.createElement("input");c.className="mdc-text-field__input input--type-email",c.type="email",c.placeholder="johndoe@example.com",c.style.paddingTop="0px",c.value=e;var r=document.createElement("div");return r.className="mdc-line-ripple",n.appendChild(c),n.appendChild(r),n}function createTimeInput(e,t,a){if(!t){var n=document.createElement("span");return n.className="data--value-list","date"===a.type?n.textContent=moment(e).calendar():n.textContent=e,n}console.log(t);var c=document.createElement("div");c.className="mdc-text-field";var r=document.createElement("input");r.className="mdc-text-field__input input--type-time",r.type=a.type,r.style.borderBottom="none","date"===a.type?r.value=moment(e).format("YYYY-MM-DD"):r.value=e,"time"===a.type&&(c.classList.add("data--value-list"),r.style.width="100%",r.value=e||moment(new Date).format("HH:mm"));var o=document.createElement("div");return o.className="mdc-line-ripple",c.appendChild(r),c.appendChild(o),a.simple?(r.classList.remove("mdc-text-field__input"),r):c}function createSelectMenu(e,t,a){if(!a){var n=document.createElement("span");return n.className="data--value-list",n.textContent=t,n}var c=document.createElement("div");c.className="mdc-select data--value-list",c.style.height="32%;",c.id=convertKeyToId(e),c.dataset.value=e,c.dataset.primary="";var r=document.createElement("select");r.className="mdc-select__native-control",r.style.paddingRight="0px";for(var o=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],i=0;i<o.length;i++){var d=document.createElement("option");d.value=o[i],d.textContent=o[i],t===o[i]&&d.setAttribute("selected","true"),r.appendChild(d)}var l=document.createElement("label");l.className="mdc-floating-label",l.textContent="";var s=document.createElement("div");return s.className="mdc-line-ripple",c.appendChild(l),c.appendChild(r),c.appendChild(s),c}function showSendActivity(e){console.log(e);var t=document.getElementById("send-activity"),a=t.getBoundingClientRect(),n=document.querySelector(".status--cancel-cont").getBoundingClientRect(),c=!(a.right<n.left||a.left>n.right||a.bottom<n.top||a.top>n.bottom);console.log(c),c?t.classList.add("hidden"):t.classList.remove("hidden")}function toggleActionables(e){if(console.log(e),e&&"create"!==document.getElementById("app-current-panel").dataset.view){var t=indexedDB.open(firebase.auth().currentUser.uid);t.onsuccess=function(){t.result.transaction("activity").objectStore("activity").get(e).onsuccess=function(e){var t=e.target.result;document.querySelectorAll(".mdc-fab");t.editable&&(document.querySelector(".loader")&&(document.querySelector(".loader").remove(),document.querySelector(".add--assignee-loader .add--assignee-icon").style.display="block"),document.querySelector(".progress--update")&&document.querySelector(".progress--update").remove())}}}}function listView(e){document.querySelector(".init-loader")&&document.querySelector(".init-loader").remove(),e&&history.pushState(["listView"],null,null),listPanel();var t=localStorage.getItem("dbexist"),n=indexedDB.open(t);n.onsuccess=function(){var a=n.result;a.transaction(["root"],"readwrite").objectStore("root").get(t).onsuccess=function(e){var t=e.target.result;document.querySelector(".mdc-drawer--temporary")||initMenu(a,t.offices),creatListHeader("Recent"),fetchDataForActivityList(a)}}}function fetchDataForActivityList(n){var c="",e=(document.getElementById("activty--list"),n.transaction("activity").objectStore("activity").index("timestamp")),r=document.querySelector(".mdc-drawer--temporary").dataset.currentOffice;e.openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;if(t)"all"===r?"subscription"!==t.value.template&&0===t.value.hidden&&createActivityList(n,t.value).then(function(e){c+=e}):"subscription"!==t.value.template&&0===t.value.hidden&&t.value.office===r&&createActivityList(n,t.value).then(function(e){c+=e}),t.continue();else{var a=window.pageYOffset;setTimeout(function(){appendActivityListToDom(c,!0),createActivityIcon(n),scrollToActivity(a)},100)}}}function createActivityList(n,c,r){return new Promise(function(a){getCount(n,c.activityId).then(function(t){getCommentUndUser(n,c.activityId,c.creator).then(function(e){getCreatorDetails(n,e).then(function(e){e.count=t,a(activityListUI(c,e,r))})})})})}function getCount(e,t){return new Promise(function(a){e.transaction("activityCount","readonly").objectStore("activityCount").get(t).onsuccess=function(e){var t=e.target.result;a(t?t.count:0)}})}function getCommentUndUser(n,e,t){var c={creator:t,comment:"",commentUser:""};return new Promise(function(a){n.transaction("addendum").objectStore("addendum").index("activityId").openCursor(e,"prev").onsuccess=function(e){var t=e.target.result;t?t.value.isComment?(c.comment=t.value.comment,readNameFromNumber(n,t.value.user).then(function(e){c.commentUser=e,a(c)})):(c.comment=t.value.comment,a(c)):a(c)}})}function getCreatorDetails(e,n){return new Promise(function(a){n.creator===firebase.auth().currentUser.phoneNumber?(n.creator={photo:firebase.auth().currentUser.photoURL||"./img/empty-user.jpg",number:n.creator},a(n)):e.transaction("users").objectStore("users").get(n.creator).onsuccess=function(e){var t=e.target.result;t&&t.hasOwnProperty("photoURL")?n.creator={photo:e.target.result.photoURL||"./img/empty-user.jpg",number:n.creator}:n.creator={photo:"./img/empty-user.jpg",number:n.creator},a(n)}})}function activityListUI(e,t,a){var n=document.createElement("li");n.dataset.id=e.activityId,n.setAttribute("onclick","localStorage.setItem('clickedActivity',this.dataset.id);conversation(this.dataset.id,true)");var c=document.createElement("img");c.dataset.number=t.creator.number,c.className="mdc-list-item__graphic material-icons",c.setAttribute("onerror","handleImageError(this)"),c.src=t.creator.photo;var r=document.createElement("span");r.classList.add("mdc-list-item__text");var o=document.createElement("span");o.className="mdc-list-item__primary-text bigBlackBold",o.textContent=e.activityName;var i=document.createElement("span");i.className="mdc-list-item__secondary-text",t.commentUser?i.textContent=t.commentUser+" : "+t.comment:i.textContent=""+t.comment,r.appendChild(o),r.appendChild(i);var d=document.createElement("span");if(d.classList.add("mdc-list-item__meta"),0!==t.count){var l=document.createElement("div"),s=document.createElement("span");s.textContent=t.count,s.className="count mdc-meta__custom-text",l.appendChild(s),n.classList.add("mdc-list-item","activity--list-item","count-active","mdc-elevation--z1"),d.appendChild(l)}else{var u=document.createElement("div");u.className="mdc-meta__custom-text",u.style.width="80px",u.style.fontSize="14px",u.textContent=moment(e.timestamp).calendar(),n.classList.add("mdc-list-item","activity--list-item","mdc-elevation--z1"),d.appendChild(u)}var m=document.createElement("span");m.classList.add("mdc-list-item__secondary-text","status-in-activity",""+e.status),document.createElement("i").className="material-icons";var p=document.createElement("i");p.classList.add("status-cancel","material-icons"),p.appendChild(document.createTextNode("clear"));var v=document.createElement("i");return v.classList.add("status-confirmed","material-icons"),v.appendChild(document.createTextNode("check")),"CONFIRMED"===e.status&&m.appendChild(v),"CANCELLED"===e.status&&m.appendChild(p),d.appendChild(m),a?(n.appendChild(c),n.appendChild(r),n.appendChild(d),n):(n.innerHTML+=c.outerHTML+r.outerHTML+d.outerHTML,n.outerHTML)}function appendActivityListToDom(e,t,a){t||(listPanel(),creatListHeader(a,!t)),document.getElementById("activity--list").innerHTML=e}function createActivityIcon(e){var a=e.transaction(["subscriptions"]).objectStore("subscriptions").count();a.onsuccess=function(){if(a.result){var e=document.createElement("button");e.className="mdc-fab create-activity",e.setAttribute("aria-label","Add");var t=document.createElement("span");t.className="mdc-fab_icon material-icons",t.textContent="add",e.appendChild(t),document.getElementById("activity--list").appendChild(e),document.querySelector(".create-activity").addEventListener("click",function(e){selectorUI(e,{record:"",store:"subscriptions"})})}}}function listPanel(){if(!document.getElementById("activity-list-main")){var e=document.createElement("div");e.className="mdc-card panel-card mdc-top-app-bar--fixed-adjust",e.id="activity-list-main";var t=document.createElement("ul");t.className="mdc-list mdc-list--two-line mdc-list--avatar-list",t.id="activity--list",e.appendChild(t),document.getElementById("app-current-panel").innerHTML=e.outerHTML}}function creatListHeader(e,t){var a=document.createElement("div");a.className="drawer--icons";var n=document.createElement("span");n.id="menu--panel";var c=document.createElement("i");c.className="material-icons",c.textContent=t?"keyboard_backspace":"menu";var r=document.createElement("span");r.className="current--selcted-filter",r.textContent="Cancelled"===e?"Trash":e,n.appendChild(c),n.appendChild(r),a.appendChild(n);var o=document.createElement("span");o.id="search--panel";var i=document.createElement("i");i.className="material-icons",i.textContent="search",o.appendChild(i),header(a.outerHTML,"","list");var d=new mdc.drawer.MDCTemporaryDrawer(document.querySelector(".mdc-drawer--temporary"));document.getElementById("menu--panel").addEventListener("click",function(){t?backNav():(d.open=!0,sendCurrentViewNameToAndroid("drawer"))})}function scrollToActivity(e){return localStorage.getItem("clickedActivity")?(document.querySelector('[data-id="'+localStorage.getItem("clickedActivity")+'"]').scrollIntoView({behavior:"instant",block:"center",inline:"center"}),void localStorage.removeItem("clickedActivity")):0==e?(localStorage.removeItem("clickedActivity"),void window.scrollTo(0,0)):void(0<e&&window.scrollTo(0,e))}function initMenu(c,e){var t=document.createElement("aside");t.className="mdc-drawer mdc-drawer--temporary mdc-typography",t.dataset.currentOffice=e?e.allOffices[0]:"all";var a=document.createElement("nav");a.className="mdc-drawer__drawer";var n=document.createElement("header");n.className="mdc-drawer__header drawer--header";var r=document.createElement("div");r.className="mdc-drawer__header-content";var o=document.createElement("div");o.className="drawer--header-div",o.onclick=function(){profileView(!0)};var i=document.createElement("img");i.className="drawer-header-icon",i.src=firebase.auth().currentUser.photoURL||"./img/empty-user.jpg",i.setAttribute("onerror","handleImageError(this)");var d=document.createElement("div");d.className="header--details";var l=document.createElement("div");l.className="mdc-typography--subtitle",l.textContent=firebase.auth().currentUser.displayName||firebase.auth().currentUser.phoneNumber;var s=document.createElement("div");s.textContent=e?e.allOffices[0]:"",s.className="mdc-typography--caption current--office-name";var u=document.createElement("div");d.appendChild(u),d.appendChild(l),d.appendChild(s),e&&e.hasMultipleOffice&&(u.className="material-icons",u.style.float="right",u.textContent="arrow_drop_down",u.onclick=function(){document.querySelector(".office-selection-lists")||createOfficeSelectionUI(e.allOffices,c)}),o.appendChild(i),r.appendChild(o),r.appendChild(d),n.appendChild(r);var m=document.createElement("nav");if(m.className="mdc-drawer__content mdc-list filter-sort--list",e&&e.hasMultipleOffice){var p=document.createElement("div");p.className="mdc-list-item mdc-list-item--activated";var v=document.createElement("i");v.className="material-icons mdc-list-item__graphic drawer--icons",v.setAttribute("aria-hidden","true"),v.textContent="all_inbox";var h=document.createElement("span");h.textContent="All offices",p.onclick=function(){var e=new mdc.drawer.MDCTemporaryDrawer(document.querySelector(".mdc-drawer--temporary"));allOffices("All Offices",c,!0),e.open=!1},p.appendChild(v),p.appendChild(h),m.appendChild(p)}[{type:"Incoming",icon:"call_received"},{type:"Outgoing",icon:"call_made"},{type:"Urgent",icon:"star_rate"},{type:"Recent",icon:"watch_later"},{type:"Nearby",icon:"near_me"},{type:"Pending",icon:""},{type:"Cancelled",icon:"delete"}].forEach(function(e){var t=document.createElement("div");t.className="mdc-list-item mdc-list-item--activated";var a=document.createElement("i");a.className="material-icons mdc-list-item__graphic drawer--icons",a.setAttribute("aria-hidden","true"),a.textContent=e.icon;var n=document.createElement("span");"Cancelled"===e.type?n.textContent="Trash":n.textContent=e.type,t.appendChild(a),t.appendChild(n),t.onclick=function(){window.scrollTo(0,0),"Pending"!==e.type&&"Cancelled"!==e.type||filterActivities(e.type,c,!0),"Incoming"!==e.type&&"Outgoing"!==e.type||sortByCreator(e.type,c,!0),"Urgent"===e.type&&sortByDates(e.type,c,!0),"Nearby"===e.type&&sortByLocation(e.type,c,!0),"Recent"===e.type&&listView(),new mdc.drawer.MDCTemporaryDrawer(document.querySelector(".mdc-drawer--temporary")).open=!1,sendCurrentViewNameToAndroid("listView"),document.querySelector(".current--selcted-filter").textContent=e.type},m.appendChild(t)}),a.appendChild(n),a.appendChild(m),t.appendChild(a),document.body.appendChild(t)}function createOfficeSelectionUI(e,t){document.querySelector(".filter-sort--list").classList.add("hidden");var n=document.createElement("nav");n.className="mdc-drawer__content mdc-list office-selection-lists",document.querySelector(".mdc-drawer__drawer").appendChild(n),e.forEach(function(t){if(t!==document.querySelector(".mdc-drawer--temporary").dataset.currentOffice&&!document.querySelector(".different-office-link")){var e=document.createElement("div");e.className="mdc-list-item mdc-list-item--activated different-office-link";var a=document.createElement("span");a.textContent=t,e.appendChild(a),e.onclick=function(){document.querySelector(".filter-sort--list").classList.remove("hidden"),n.remove();var e=new mdc.drawer.MDCTemporaryDrawer.attachTo(document.querySelector(".mdc-drawer--temporary"));e.root_.dataset.currentOffice=t,document.querySelector(".current--office-name").textContent=t,listView(),e.open=!1},n.appendChild(e)}})}function allOffices(a,n,e){e&&history.pushState(["allOffices",a],null,null);var t=n.transaction("activity").objectStore("activity").index("timestamp"),c="";t.openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;if(!t)return appendActivityListToDom(c,!1,a),void createActivityIcon(n);"subscription"!==t.value.template&&0===t.value.hidden&&createActivityList(n,t.value).then(function(e){c+=e}),t.continue()}}function filterActivities(n,c,e){e?history.pushState(["filterActivities",n],null,null):history.replaceState(["filterActivities",n],null,null);var t=c.transaction("activity").objectStore("activity").index("timestamp"),r=document.querySelector(".mdc-drawer--temporary").dataset.currentOffice,o="";t.openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;if(t)t.value.status===n.toUpperCase()&&t.value.office===r&&"subscription"!==t.value.template&&0===t.value.hidden&&createActivityList(c,t.value).then(function(e){o+=e}),t.continue();else{var a=window.pageYOffset;setTimeout(function(){appendActivityListToDom(o,!1,n),createActivityIcon(c),scrollToActivity(a)},300)}}}function sortByCreator(n,c,e){e?history.pushState(["sortByCreator",n],null,null):history.replaceState(["sortByCreator",n],null,null);var t=c.transaction("activity").objectStore("activity").index("timestamp"),r=document.querySelector(".mdc-drawer--temporary").dataset.currentOffice,o="",i=firebase.auth().currentUser.phoneNumber;t.openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;if(t)"Incoming"===n&&t.value.creator!==i&&t.value.office===r&&"subscription"!==t.value.template&&0===t.value.hidden&&createActivityList(c,t.value).then(function(e){o+=e}),"Outgoing"===n&&t.value.creator===i&&t.value.office===r&&"subscription"!==t.value.template&&0===t.value.hidden&&createActivityList(c,t.value).then(function(e){o+=e}),t.continue();else{var a=window.pageYOffset;setTimeout(function(){appendActivityListToDom(o,!1,n),createActivityIcon(c),scrollToActivity(a)},200)}}}function sortByDates(e,t,a){a?history.pushState(["sortByDates",e],null,null):history.replaceState(["sortByDates",e],null,null);var n=document.querySelector(".mdc-drawer--temporary").dataset.currentOffice,c=moment().format("YYYY-MM-DD"),r={HIGH:[],LOW:[]};t.transaction("calendar").objectStore("calendar").index("range").openCursor().onsuccess=function(e){var t=e.target.result;if(!t)return r.HIGH.sort(function(e,t){return moment(t.start).valueOf()-moment(e.start).valueOf()}),r.LOW.sort(function(e,t){return moment(t.end).valueOf()-moment(e.end).valueOf()}),void generateActivitiesByDate(sortBykeys(r));c>=t.value.start&&c<=t.value.end&&t.value.office===n?r.HIGH.push(t.value):r.LOW.push(t.value),t.continue()}}function generateActivitiesByDate(e){var t=firebase.auth().currentUser.uid,n=indexedDB.open(t),c="";n.onsuccess=function(){var a=n.result,t=a.transaction("activity").objectStore("activity");Object.keys(e.HIGH).forEach(function(e){t.get(e).onsuccess=function(e){var t=e.target.result;createActivityList(a,t).then(function(e){c+=e})}}),Object.keys(e.LOW).forEach(function(e){t.get(e).onsuccess=function(e){var t=e.target.result;createActivityList(a,t).then(function(e){c+=e})}}),setTimeout(function(){var e=window.pageYOffset;appendActivityListToDom(c,!1,"Urgent"),createActivityIcon(a),scrollToActivity(e)},600)}}function sortBykeys(e){console.log(e);for(var t=e.LOW,a=e.HIGH,n={LOW:{},HIGH:{}},c=t.length,r=0;r<c;r++)key=t[r],n.LOW.hasOwnProperty(key.activityId)||(n.LOW[key.activityId]=key);for(var o=a.length,i=0;i<o;i++)key=a[i],n.HIGH.hasOwnProperty(key.activityId)||(n.HIGH[key.activityId]=key);return n}function sortByLocation(e,t,a){a?history.pushState(["sortByLocation",e],null,null):history.replaceState(["sortByLocation",e],null,null);var n=firebase.auth().currentUser.uid,c=new Worker("./nearestLocationHandler.js");c.postMessage({dbName:n}),c.onmessage=function(e){sortActivitiesByLocation(t,e.data)},c.onerror=locationSortError}function sortActivitiesByLocation(t,e){for(var a="",n=document.querySelector(".mdc-drawer--temporary").dataset.currentOffice,c=t.transaction("activity").objectStore("activity"),r=0;r<e.length;r++)c.get(e[r].activityId).onsuccess=function(e){e.target.result.office===n&&"CANCELLED"!==e.target.result&&createActivityList(t,e.target.result).then(function(e){a+=e})};setTimeout(function(){var e=window.pageYOffset;appendActivityListToDom(a,!1,"Nearby"),createActivityIcon(t),scrollToActivity(e)},500)}function locationSortError(e){console.log(e)}function header(e,t,a){var n=document.createElement("header");n.className="mdc-top-app-bar mdc-top-app-bar--fixed mdc-elevation--z1","list"===a&&n.classList.add("header-list--gray");var c=document.createElement("div");c.className="mdc-top-app-bar__row";var r=document.createElement("section");r.className="mdc-top-app-bar__section mdc-top-app-bar__section--align-start";var o=document.createElement("div");o.id="view-type",o.innerHTML=e,r.appendChild(o);var i=document.createElement("div");i.className="mdc-top-app-bar__section mdc-top-app-bar__section--align-end";var d=document.createElement("div");if(d.id="action-data",t&&(d.innerHTML=t),i.appendChild(d),c.appendChild(r),c.appendChild(i),n.innerHTML=c.outerHTML,"selector"===a)return n;document.getElementById("header").innerHTML=n.outerHTML}function backIconHeader(e){var t=document.createElement("span");t.id=e;var a=document.createElement("i");a.className="material-icons",a.textContent="arrow_back",t.appendChild(a),header(t.outerHTML)}function createInputForProfile(e,t,a){var n=document.createElement("div");n.className="mdc-text-field mdc-text-field--dense "+a+" attachment--text-field",n.dataset.key=e,n.dataset.type=t,n.id=e.replace(/\s/g,"");var c=document.createElement("input");c.className="mdc-text-field__input",t&&"displayName"===e&&(c.placeholder="Your Name"),t&&"email"===e&&(c.placeholder="Your Email");var r=document.createElement("div");return r.className="mdc-line-ripple",n.appendChild(c),n.appendChild(r),n}firebase.initializeApp({apiKey:"AIzaSyA4s7gp7SFid_by1vLVZDmcKbkEcsStBAo",authDomain:"growthfile-207204.firebaseapp.com",databaseURL:"https://growthfile-207204.firebaseio.com",projectId:"growthfile-207204",storageBucket:"growthfile-207204.appspot.com",messagingSenderId:"701025551237"}),window.addEventListener("load",function(){window.onerror=function(e,t,a,n,c){requestCreator("instant",{message:{msg:e,url:t,lineNo:a,columnNo:n,error:c}})},startApp()}),moment.locale("en",{calendar:{lastDay:"[yesterday]",sameDay:"LT",nextDay:"[Tomorrow at] LT",lastWeek:"dddd",nextWeek:"dddd [at] LT",sameElse:"L"},months:["January","February","March","April","May","June","July","August","September","October","November","December"]}),window.scrollBy({top:100,left:0,behavior:"smooth"}),window.onpopstate=function(t){if(t.state)if("listView"!==t.state[0]&&"conversation"!==t.state[0]&&"updateCreateActivity"!==t.state[0]){var a=indexedDB.open(localStorage.getItem("dbexist"));a.onsuccess=function(){var e=a.result;window[t.state[0]](t.state[1],e,!1)}}else"listView"===t.state[0]?window[t.state[0]](!0):window[t.state[0]](t.state[1],!1)};var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function profileView(e){e&&history.pushState(["profileView"],null,null),new mdc.drawer.MDCTemporaryDrawer(document.querySelector(".mdc-drawer--temporary")).open=!1,document.body.style.backgroundColor="#eeeeee";var c=firebase.auth().currentUser,t=c.uid,r=indexedDB.open(t);r.onsuccess=function(){var a=r.result.transaction(["root"],"readwrite"),n=a.objectStore("root");n.get(t).onsuccess=function(e){var t=e.target.result;t.view="profile",n.put(t),a.oncomplete=function(){createProfileHeader(),createProfilePanel(),disableInputs(),document.getElementById("close-profile--panel").addEventListener("click",function(){backNav()}),showProfilePicture(firebase.auth().currentUser.photoURL),inputFile("uploadProfileImage").addEventListener("change",readUploadedFile),changeDisplayName(c),changeEmailAddress(c)}}},sendCurrentViewNameToAndroid("profile")}function createProfileHeader(){var e=document.createElement("span");e.id="close-profile--panel";var t=document.createElement("i");t.className="material-icons",t.textContent="arrow_back",e.appendChild(t),header(e.outerHTML)}function createProfilePanel(){var e=document.createElement("div");e.id="profile-view--container",e.className="mdc-top-app-bar--fixed-adjust mdc-theme--background";var t=document.createElement("button");t.className="mdc-fab";var a=document.createElement("label");a.setAttribute("for","uploadProfileImage");var n=document.createElement("span");n.className="mdc-fab__icon material-icons",n.textContent="add_a_photo",a.appendChild(n),t.appendChild(a);var c=document.createElement("input");c.type="file",c.style.display="none",c.id="uploadProfileImage",c.accept='accept="image/png,image/jpeg;capture=camera';var r=document.createElement("div");r.id="profile--image-container",r.className="profile-container--main";var o=document.createElement("img");o.src=firebase.auth().currentUser.photoURL,o.id="user-profile--image",o.setAttribute("onerror","handleImageError(this)");var i=document.createElement("div");i.className="insert-overlay",r.appendChild(o),r.appendChild(i),r.appendChild(t),r.appendChild(c);var d=document.createElement("div");d.id="name--change-container",d.className="profile-psuedo-card";var l=document.createElement("button");l.className="mdc-icon-button material-icons",l.id="edit--name",l.setAttribute("aria-hidden","true"),l.setAttribute("aria-pressed","false"),l.setAttribute("data-toggle-on-content","check"),l.setAttribute("data-toggle-on-label","check"),l.setAttribute("data-toggle-off-content","edit"),l.setAttribute("data-toggle-off-label","displayName"),l.textContent="edit",d.appendChild(createInputForProfile("displayName","Name")),d.appendChild(l);var s=document.createElement("div");s.id="email--change-container",s.className="profile-psuedo-card";var u=document.createElement("button");u.className="mdc-icon-button material-icons",u.id="edit--email",u.setAttribute("aria-hidden","true"),u.setAttribute("aria-pressed","false"),u.setAttribute("data-toggle-on-content","check"),u.setAttribute("data-toggle-on-label","check"),u.setAttribute("data-toggle-off-content","edit"),u.setAttribute("data-toggle-off-label","updateEmail"),u.textContent="email",s.appendChild(createInputForProfile("email","Email")),s.appendChild(u);var m=document.createElement("div");m.id="ui-auth",m.className="";var p=document.createElement("div");p.id="change--number-container";var v=document.createElement("div");v.id="phone-number--change-container",v.className="mdc-layout-grid__inner",p.appendChild(v),e.appendChild(r),e.appendChild(d),e.appendChild(s),e.appendChild(m),e.appendChild(p),document.getElementById("app-current-panel").innerHTML=e.outerHTML}function toggleIconData(e,t){var a=document.getElementById(e);new mdc.iconButton.MDCIconButtonToggle(a).root_.addEventListener("MDCIconButtonToggle:change",function(e){e.detail.isOn?(console.log(t),t.input_.style.borderBottom="1px solid rgba(0,0,0,.42)",t.input_.disabled=!1,t.lineRipple_.activate(),"Android"===localStorage.getItem("deviceType")&&openAndroidKeyboard.startKeyboard(),t.input_.focus()):(t.input_.disabled=!0,t.input_.style.borderBottom="none",handleFieldInput(this.dataset.toggleOffLabel,t.value),t.lineRipple_.deactivate())})}function handleFieldInput(e,t){var a=firebase.auth().currentUser;if(console.log(void 0===t?"undefined":_typeof(t)),"displayName"===e&&a.updateProfile(_defineProperty({},e,t)).then(function(){successDialog()}).catch(authUpdatedError),"updateEmail"===e){if(t===firebase.auth().currentUser.email)return void snacks("This email address already exists");timeDiff(firebase.auth().currentUser.metadata.lastSignInTime)<=5?(console.log("less than 5"),updateEmail(firebase.auth().currentUser,t)):newSignIn(t)}}function timeDiff(e){var t=moment().format("YYY-MM-DD HH:mm"),a=moment(e).format("YYY-MM-DD HH:mm");return moment(t).diff(moment(a),"minutes")}function newSignIn(e){var t=document.createElement("div");t.id="refresh-login",t.className="mdc-elevation--z3",document.getElementById("ui-auth").innerHTML=t.outerHTML,new firebaseui.auth.AuthUI(firebase.auth()).start("#refresh-login",firebaseUiConfig(e)),setTimeout(function(){document.querySelector(".firebaseui-id-phone-number").value=firebase.auth().currentUser.phoneNumber,document.querySelector(".firebaseui-id-phone-number").disabled=!0,document.querySelector(".firebaseui-label").remove()},300)}function readUploadedFile(e){console.log(e);var t=e.target.files[0],a=new FileReader;t&&(a.readAsDataURL(t),processImage(t))}function processImage(e){var t=firebase.auth().currentUser.uid,a=firebase.storage().ref("ProfileImage/"+t).put(e,{cacheControl:"public,max-age=31536000",contentType:"image/jpeg"});a.on(firebase.storage.TaskEvent.STATE_CHANGED,function(e){if(firebase.storage.TaskState.RUNNING){if(document.querySelector("#profile--image-container .loader"))return;document.querySelector(".insert-overlay").classList.add("middle"),document.getElementById("profile--image-container").appendChild(loader()),document.querySelector("#profile--image-container .loader").classList.add("profile--loader")}},function(e){console.log(e),requestCreator("instant",{message:e})},function(){a.snapshot.ref.getDownloadURL().then(updateAuth)})}function updateAuth(e){console.log(e),firebase.auth().currentUser.updateProfile({photoURL:e}).then(function(){removeLoader(e)}).catch(authUpdatedError)}function removeLoader(e){document.querySelector(".insert-overlay").classList.remove("middle");var t=document.getElementById("profile--image-container");t.children[0].classList.add("reset-opacity"),t.removeChild(t.lastChild),showProfilePicture(e)}function showProfilePicture(e){firebase.auth().currentUser;document.getElementById("user-profile--image").src=e||"../img/empty-user.jpg",document.querySelector(".drawer-header-icon").src=e||"../img/empty-user.jpg"}function authUpdatedError(e){snacks(e.message)}function changeDisplayName(e){var t=getInputText("#displayName");e.displayName&&(t.value=e.displayName),toggleIconData("edit--name",t)}function changeEmailAddress(e){var t=getInputText("#email");e.email&&(t.value=e.email),toggleIconData("edit--email",t)}function updateEmail(e,t){console.log(t),e.updateEmail(t).then(emailUpdateSuccess).catch(authUpdatedError)}function emailUpdateSuccess(){var e=firebase.auth().currentUser;console.log(e),e.sendEmailVerification().then(emailVerificationSuccess).catch(emailVerificationError)}function emailVerificationSuccess(){successDialog(),snacks("Verification link has been send to your email address")}function emailVerificationError(e){snacks(e.message)}function handleReauthError(e){console.log(e)}function disableInputs(){getInputText("#displayName").input_.disabled=!0,getInputText("#email").input_.disabled=!0}function initUserSelectorSearch(a,n){var e=document.getElementById("search--bar-selector"),c=e.value="",r=document.createDocumentFragment(),o={};n.record.assignees.forEach(function(e){o[e]=""}),e.addEventListener("input",function(e){var t=e.target.value;if(isNumber(t))return c=a.transaction("users").objectStore("users"),void searchUsersDB(formatNumber(t),c,r,o,n);r=document.createDocumentFragment(),c=a.transaction("users").objectStore("users").index("displayName"),searchUsersDB(formatName(t),c,r,o,n)})}function isNumber(e){return!isNaN(e)}function formatNumber(e){var t=e;return"91"===t.substring(0,2)?t="+"+t:"+91"!==t.substring(0,3)&&(t="+91"+t),t}function formatName(e){var t=e.split(" "),a=t.length,n=[],c=0;for(c=0;c<a;c++){var r=t[c];if(r.charAt(0).toUpperCase()===e.charAt(0).toUpperCase)return e;n.push(r.charAt(0).toUpperCase()+r.slice(1))}return n.join(" ")}function checkNumber(e){return/^\+[1-9]\d{11,14}$/.test(e)}function searchUsersDB(e,t,c,r,o){console.log(e);var a=IDBKeyRange.bound(e,e+"￿"),i=document.getElementById("data-list--container");t.openCursor(a).onsuccess=function(e){var t=e.target.result;if(!t){if(i.innerHTML="",0==c.children.length){var a=document.createElement("div");a.className="data-not-found";var n=document.createElement("p");return n.textContent="No Contact Found",n.className="mdc-typography--headline5",a.appendChild(n),void(document.querySelector(".data-not-found")||i.appendChild(a))}return i.appendChild(c),void document.querySelectorAll('[data-selected="true"]').forEach(function(e){new mdc.checkbox.MDCCheckbox.attachTo(e).checked=!0,e.children[1].style.animation="none",e.children[1].children[0].children[0].style.animation="none"})}o.attachment.present?c.appendChild(createSimpleAssigneeLi(t.value,!0,!1)):r.hasOwnProperty(t.value.mobile)||c.appendChild(createSimpleAssigneeLi(t.value,!0,!0)),t.continue()}}var offset="";function handleImageError(e){e.onerror=null,e.src="./img/empty-user.jpg";var t=window.indexedDB.open(firebase.auth().currentUser.uid);return t.onsuccess=function(){var a=t.result.transaction("users","readwrite").objectStore("users");a.get(e.dataset.number).onsuccess=function(e){var t=e.target.result;0!=t.isUpdated&&(t.isUpdated=0,a.put(t))}},!0}function handleImageErrorAttachment(e){return e.onerror=null,e.src="./img/placeholder.png",!0}function loader(e){var t=document.createElement("div");return t.className="loader "+e,t}function successDialog(){var e=document.createElement("aside");e.className="mdc-dialog mdc-dialog--open success--dialog",e.id="success--dialog";var t=document.createElement("div");t.className="mdc-dialog__surface round--surface";var a=document.createElement("section");a.className="mdc-dialog__body";var n=document.createElement("div");n.className="success--container";var c=document.createElement("div");c.className="success--check",n.appendChild(c),a.appendChild(n),t.appendChild(a),e.appendChild(t),document.body.appendChild(e),new mdc.dialog.MDCDialog(document.querySelector("#success--dialog")).show(),setTimeout(function(){document.getElementById("success--dialog").remove(),document.body.classList.remove("mdc-dialog-scroll-lock")},1200)}function enableGps(e){if(!document.getElementById("enable-gps")){var t=document.createElement("aside");t.className="mdc-dialog mdc-dialog--open",t.id="enable-gps";var a=document.createElement("div");a.className="mdc-dialog__surface",a.style.width="90%",a.style.height="auto";var n=document.createElement("section");n.className="mdc-dialog__body mock-main-body",n.textContent=e;var c=document.createElement("footer");c.className="mdc-dialog__footer mock-footer";var r=document.createElement("button");r.type="button",r.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--cancel",r.textContent="Ok",r.id="",r.style.backgroundColor="#3498db",c.appendChild(r),a.appendChild(n),a.appendChild(c),t.appendChild(a),document.body.appendChild(t)}new mdc.dialog.MDCDialog(document.querySelector("#enable-gps")).show()}function progressBar(){var e=document.createElement("div");e.className="mdc-linear-progress mdc-linear-progress--indeterminate progress--update",e.role="progressbar";var t=document.createElement("div");t.className="mdc-linear-progress__buffering-dots";var a=document.createElement("div");a.className="mdc-linear-progress__buffer";var n=document.createElement("div");n.className="mdc-linear-progress__bar mdc-linear-progress__primary-bar";var c=document.createElement("span");c.className="mdc-linear-progress__bar-inner",n.appendChild(c);var r=document.createElement("div");r.className="mdc-linear-progress__bar mdc-linear-progress__secondary-bar";var o=document.createElement("span");return o.className="mdc-linear-progress__bar-inner",r.appendChild(o),e.appendChild(t),e.appendChild(a),e.appendChild(n),e.appendChild(r),e}function snacks(e,t){var a=document.createElement("div");a.className="mdc-snackbar",a.setAttribute("aria-live","assertive"),a.setAttribute("aria-atomic","true"),a.setAttribute("aria-hidden","true");var n=document.createElement("div");n.className="mdc-snackbar__text mdc-typography--subtitle2";var c=document.createElement("div");c.className="mdc-snackbar__action-wrapper";var r=document.createElement("button");r.className="mdc-snackbar__action-button",c.appendChild(r),a.appendChild(n),a.appendChild(c),document.getElementById("snackbar-container").innerHTML=a.outerHTML;var o={message:e,actionText:t?t.btn:"OK",timeout:1e4,actionHandler:function(){t&&requestCreator("statusChange",{activityId:t.id,status:"PENDING"})}};mdc.snackbar.MDCSnackbar.attachTo(document.querySelector(".mdc-snackbar")).show(o)}function fetchCurrentTime(e){return Date.now()+e}function geolocationApi(e,c,r){return new Promise(function(t,a){var n=new XMLHttpRequest;n.open(e,c,!0),n.setRequestHeader("Content-Type","application/json"),n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status){var e=JSON.parse(n.responseText);t({latitude:e.location.lat,longitude:e.location.lng,accuracy:e.accuracy,provider:"Cellular",lastLocationTime:Date.now()})}else a(n.statusText)},r?(console.log(r),n.send(r)):t(void 0)}).catch(function(e){return e})}function manageLocation(){var n=void 0;if("Android"===localStorage.getItem("deviceType"))try{n=Towers.getCellularData(),console.log(n)}catch(e){requestCreator("instant",{message:e.message})}else n=!1;var e=indexedDB.open(firebase.auth().currentUser.uid);e.onsuccess=function(){e.result.transaction("root","readwrite").objectStore("root").get(firebase.auth().currentUser.uid).onsuccess=function(a){return new Promise(function(e){var t=a.target.result;geoFetchPromise=n?geolocationApi("POST","https://www.googleapis.com/geolocation/v1/geolocate?key=AIzaSyCtyIm3PBorFtIfRSjl1JtE4RlYXVx6U6c",n):{latitude:"",longitude:"",accuracy:999999},navigatorFetchPromise=locationInterval(t.provider),Promise.all([geoFetchPromise,navigatorFetchPromise]).then(function(e){updateLocationInRoot(sortedByAccuracy(e.filter(function(e){return void 0!==e})))}).catch(function(e){requestCreator("instant",{message:e})})})}}}function locationInterval(e){var c=[],r=0,o={latitude:"",longitude:"",accuracy:"",lastLocationTime:""},i=void 0,d=void 0;return new Promise(function(t,a){if("Mock"!==e){d||"Android"!==localStorage.getItem("deviceType")||(d=setTimeout(function(){if(""===o.latitude&&""===o.longitude)return clearInterval(n),clearTimeout(d),void t({latitude:"",longitude:"",accuracy:-1,provider:"Mock",lastLocationTime:0})},1e4));var n=setInterval(function(){navigator.geolocation.getCurrentPosition(function(e){if(e){if(0==c.length)return void c.push({latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy,lastLocationTime:Date.now()});if(c[0].latitude.toFixed(3)===e.coords.latitude.toFixed(3)&&c[0].longitude.toFixed(3)===e.coords.longitude.toFixed(3)){if(++r<3&&c.push({latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy,lastLocationTime:Date.now()}),3==r&&c[2].accuracy<350)return clearInterval(n),o.latitude=c[2].latitude,o.longitude=c[2].longitude,o.accuracy=c[2].accuracy,o.provider="HTML5",o.lastLocationTime=c[2].lastLocationTime,void t(o);i||(console.log("time out for low accurate location"),i=setTimeout(function(){var e=sortedByAccuracy(c);o.latitude=e.latitude,o.longitude=e.longitude,o.accuracy=e.accuracy,o.provider="HTML5",o.lastLocationTime=e.lastLocationTime,clearInterval(n),t(o)},2500))}}},function(e){a(e)})},500)}else t(void 0)}).catch(function(e){return e})}function sortedByAccuracy(e){return e.sort(function(e,t){return e.accuracy-t.accuracy})[0]}function updateLocationInRoot(n){if(n){var e=firebase.auth().currentUser.uid,t=indexedDB.open(e);t.onsuccess=function(){var a=t.result.transaction("root","readwrite").objectStore("root");a.get(e).onsuccess=function(e){var t=e.target.result;t.latitude=n.latitude,t.longitude=n.longitude,t.accuracy=n.accuracy,t.provider=n.provider,t.lastLocationTime=n.timestamp,a.put(t)}}}}function sendCurrentViewNameToAndroid(e){"Android"===localStorage.getItem("deviceType")&&Fetchview.startConversation(e)}function inputFile(e){return document.getElementById(e)}function requestCreator(e,n){var c=new Worker("./apiHandler.js"),r={type:e,body:""};if(n)if("instant"===e||"now"===e||"Null"===e)n&&(r.body=JSON.stringify(n)),c.postMessage(r);else{offset&&(clearTimeout(offset),offset=null);var t=firebase.auth().currentUser.uid,a=indexedDB.open(t);a.onsuccess=function(){a.result.transaction("root","readwrite").objectStore("root").get(t).onsuccess=function(e){var t=e.target.result;if(t.hasOwnProperty("latitude")&&t.hasOwnProperty("longitude")&&t.hasOwnProperty("accuracy"))if(t.latitude&&t.longitude&&t.accuracy){var a={latitude:t.latitude,longitude:t.longitude,accuracy:t.accuracy};n.timestamp=fetchCurrentTime(t.serverTime),n.geopoint=a,r.body=n,c.postMessage(r)}else enableGps("Fetching Location Please wait");else enableGps("Fetching Location Please wait")}}}else c.postMessage(r);c.onmessage=loadViewFromRoot,c.onerror=onErrorMessage}function loadViewFromRoot(a){if("notification"!==a.data.type)if("removeLocalStorage"!==a.data.type)if("manageLocation"!==a.data.type){if("error"===a.data.type)return document.querySelector("header .mdc-linear-progress")&&document.querySelector("header .mdc-linear-progress").remove(),document.querySelector(".loader")&&document.querySelector(".loader").remove(),document.querySelector(".delete-activity")&&(document.querySelector(".delete-activity").style.display="block"),document.querySelector(".undo-delete-loader")&&(document.querySelector(".undo-delete-loader").style.display="block"),void snacks(a.data.msg);if("create-success"!==a.data.type)if("reset-offset"!==a.data.type){var e=window.indexedDB.open(firebase.auth().currentUser.uid);e.onsuccess=function(){var t=e.result;if("updateAssigneesList"===a.data.type)return console.log("only update assingee list"),t.transaction("activity").objectStore("activity").get(a.data.params.id).onsuccess=function(e){e.target.result;readNameAndImageFromNumber([a.data.params.number],t)},void history.pushState(["listView"],null,null);if("redirect-to-list"!==a.data.type){if(history.state)return"updateCreateActivity"===history.state[0]?(toggleActionables(history.state[1].activityId),void handleTimeout()):void("profileView"!==history.state[0]&&(console.log("running view in state"),window[history.state[0]](history.state[1],!1),handleTimeout()));window.listView(!0)}else history.pushState(["listView"],null,null)}}else offset&&(console.log("removing offset"),clearTimeout(offset),offset=null);else listView()}else manageLocation();else localStorage.removeItem("dbexist");else successDialog()}function onErrorMessage(e){requestCreator("instant",{message:e.message,body:{"line-number":e.lineno,file:e.filename}}),console.table({"line-number":e.lineno,error:e.message,file:e.filename})}function handleTimeout(){offset=setTimeout(function(){requestCreator("Null"),manageLocation()},3e4)}function getInputText(e){return mdc.textField.MDCTextField.attachTo(document.querySelector(e))}