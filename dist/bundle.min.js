var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function conversation(e,t){window.removeEventListener("scroll",handleScroll,!1),checkIfRecordExists("activity",e).then(function(e){e?(t&&history.pushState(["conversation",e],null,null),fetchAddendumForComment(e)):listView()}).catch(handleError)}function checkIfRecordExists(o,c){return new Promise(function(a,e){var t=firebase.auth().currentUser,n=window.indexedDB.open(t.uid);n.onsuccess=function(){n.result.transaction(o).objectStore(o).get(c).onsuccess=function(e){var t=e.target.result;a(!!t&&c)}},n.onerror=function(){e({message:n.error.message+" from checkIfRecordExists"})}})}function fetchAddendumForComment(n){if(n){var o=firebase.auth().currentUser,c=window.indexedDB.open(o.uid);c.onsuccess=function(){var a=c.result,e=a.transaction(["addendum"],"readonly"),t=e.objectStore("addendum").index("activityId");createHeaderContent(a,n),commentPanel(n),statusChange(a,n),sendCurrentViewNameToAndroid("conversation"),reinitCount(a,n),t.openCursor(n).onsuccess=function(e){var t=e.target.result;t&&(document.getElementById(t.value.addendumId)||createComment(a,t.value,o).then(function(e){document.getElementById("chat-container")&&document.getElementById("chat-container").appendChild(e)}),t.continue())},e.oncomplete=function(){document.querySelector(".activity--chat-card-container")&&(document.querySelector(".activity--chat-card-container").scrollTop=document.querySelector(".activity--chat-card-container").scrollHeight)}}}}function commentPanel(e){if(!document.querySelector(".activity--chat-card-container")){var t=document.createElement("div");t.className="activity--chat-card-container  mdc-top-app-bar--fixed-adjust panel-card";var a=document.createElement("div");a.id="chat-container",a.className="mdc-card reverser-parent";var n=document.createElement("div");n.className="user-comment--container";var o=document.createElement("div");o.className="status--change-cont";var c=document.createElement("div");c.className="comment--container";var r=document.createElement("div");r.className="input--text-padding mdc-text-field mdc-text-field--dense",r.id="write--comment",r.style.width="100%";var i=document.createElement("input");i.className="mdc-text-field__input comment-field mdc-elevation--z4",i.type="text",r.appendChild(i),c.appendChild(r);var d=document.createElement("button");d.classList.add("mdc-fab","mdc-fab--mini","hidden"),d.id="send-chat--input";var s=document.createElement("span");s.classList.add("mdc-fac__icon","material-icons"),s.textContent="send",d.appendChild(s),c.appendChild(d),t.appendChild(a),n.appendChild(c),document.getElementById("app-current-panel").innerHTML=t.outerHTML+o.outerHTML+n.outerHTML,document.querySelector(".comment-field").oninput=function(e){e.target.value&&e.target.value.replace(/\s/g,"").length?showSendCommentButton():hideSendCommentButton()},document.getElementById("send-chat--input").onclick=function(){isLocationStatusWorking()&&sendComment(e)}}}function sendComment(e){requestCreator("comment",{activityId:e,comment:document.querySelector(".comment-field").value}),document.querySelector(".comment-field").value="",hideSendCommentButton()}function hideSendCommentButton(){document.getElementById("send-chat--input").classList.add("hidden"),document.getElementById("write--comment").style.width="100%",document.getElementById("write--comment").style.transition="0.3s ease",document.querySelector(".status--change-cont").style.transition="0.3s ease",document.querySelector(".status--change-cont").style.opacity="1"}function showSendCommentButton(){document.getElementById("send-chat--input").classList.remove("hidden"),document.getElementById("write--comment").style.width="80%",document.querySelector(".status--change-cont").style.opacity="0"}function statusChange(e,t){var s=document.createElement("label");s.setAttribute("for","toggle-status"),s.textContent="Done",e.transaction("activity").objectStore("activity").get(t).onsuccess=function(e){var t=document.querySelector(".status--change-cont"),a=e.target.result;if(!a.canEdit||"CANCELLED"===a.status){var n=document.createElement("span"),o=e.target.result;return n.textContent="Activity "+o.status.toLowerCase(),void(t&&(t.innerHTML=n.outerHTML,t.style.textAlign="center"))}if(0!=a.editable){if(!document.querySelector(".status-check")){var c=document.createElement("div");c.className="mdc-form-field form-field-status";var r=document.createElement("div");r.className="mdc-checkbox status-check";var i=document.createElement("input");i.className="mdc-checkbox__native-control",i.id="toggle-status",i.type="checkbox";var d=document.createElement("div");d.className="mdc-checkbox__background";document.createElement("div").className="mdc-checkbox__mixedmark",d.innerHTML='<svg class="mdc-checkbox__checkmark"\n      viewBox="0 0 24 24">\n      <path class="mdc-checkbox__checkmark-path"\n      fill="none"\n      d="M1.73,12.91 8.1,19.28 22.79,4.59"/>\n      </svg>\n      <div class="mdc-checkbox__mixedmark"></div>',r.appendChild(i),r.appendChild(d),c.appendChild(r),t&&(t.innerHTML=c.outerHTML+s.outerHTML)}document.querySelector(".mdc-checkbox")&&(switchControl=new mdc.checkbox.MDCCheckbox.attachTo(document.querySelector(".mdc-checkbox")),"CONFIRMED"===a.status&&(switchControl.checked=!0),document.querySelector(".mdc-checkbox").onclick=function(){isLocationStatusWorking()?changeStatusRequest(switchControl,a):resetStatusConfirmation(switchControl,a)})}else t&&(t.innerHTML=s.outerHTML+loader("status-loader").outerHTML)}}function resetStatusConfirmation(e,t){"CONFIRMED"===t.status?e.checked=!0:e.checked=!1}function changeStatusRequest(e,t){document.querySelector(".form-field-status").classList.add("hidden"),document.querySelector(".status--change-cont").appendChild(loader("status-loader")),e.checked?requestCreator("statusChange",{activityId:t.activityId,status:"CONFIRMED"}):requestCreator("statusChange",{activityId:t.activityId,status:"PENDING"})}function createComment(e,m,t){var u=!1;return new Promise(function(i){var d=document.createElement("div");d.classList.add("comment-box","talk-bubble","tri-right","round","btm-left"),t.phoneNumber===m.user?d.classList.add("current-user--comment","secondary-color-light"):d.classList.add("other-user--comment","mdc-theme--primary-bg"),d.id=m.addendumId;var s=document.createElement("div");s.classList.add("talktext");var l=document.createElement("p");l.classList.add("user-name--comment","mdc-typography--subtitle2"),getUserRecord(e,m.user).then(function(e){e.displayName?l.textContent=e.displayName:l.textContent=e.mobile;var t=document.createElement("p");t.classList.add("comment","mdc-typography--subtitle2"),t.textContent=m.comment;var a=document.createElement("span");a.className="comment--info";var n=document.createElement("span");n.textContent=moment(m.timestamp).format("DD-MM-YY H:mm"),n.classList.add("comment-date","mdc-typography--caption");var o=document.createElement("div"),c=document.createElement("i");c.classList.add("user-map--span","material-icons"),c.appendChild(document.createTextNode("location_on")),o.onclick=function(e){if(hasMapsApiLoaded()){u=!u;var t={lat:m.location._latitude,lng:m.location._longitude};maps(e,u,m.addendumId,t)}},c.dataset.latitude=m.location._latitude,c.dataset.longitude=m.location._longitude,o.appendChild(c);var r=document.createElement("div");r.className="map-convo",a.appendChild(n),a.appendChild(o),s.appendChild(l),s.appendChild(t),s.appendChild(a),d.appendChild(s),d.appendChild(r),i(d)})})}function getUserRecord(t,n){return new Promise(function(a,e){t.transaction("users").objectStore("users").get(n).onsuccess=function(e){var t=e.target.result;return a(t||{displayName:"",mobile:n,photoURL:""})}})}function hasMapsApiLoaded(){return"object"===("undefined"==typeof google?"undefined":_typeof(google))&&"object"===_typeof(google.maps)}function maps(e,t,a,n){var o="";if(o=e?document.getElementById(a).querySelector(".map-convo"):document.querySelector(".map-detail."+a),!t)return o.style.height="0px",void(e&&(e.target.textContent="location_on"));if(0!==o.children.length)return o.style.height="200px",void(e&&(e.target.textContent="arrow_drop_down"));e&&(e.target.textContent="arrow_drop_down"),o.style.height="200px";var c=new google.maps.Map(o,{zoom:16,center:n,disableDefaultUI:!0});if(!e){var r=document.createElement("div");new MapsCustomControl(r,c,n.lat,n.lng);r.index=1,c.controls[google.maps.ControlPosition.TOP_LEFT].push(r)}new google.maps.Marker({position:n,map:c})}function MapsCustomControl(e,t,a,n){var o=document.createElement("div");o.style.backgroundColor="#fff",o.style.border="2px solid #fff",o.style.borderRadius="3px",o.style.boxShadow="0 2px 6px rgba(0,0,0,.3)",o.style.cursor="pointer",o.style.marginBottom="22px",o.style.textAlign="center",o.style.padding="0px 5px 0px 5px",e.appendChild(o);var c=document.createElement("a");c.href="https://www.google.com/maps?q="+a+","+n,c.className="material-icons",c.style.color="rgb(25,25,25)",c.style.fontSize="16px",c.style.lineHeight="38px",c.style.paddingLeft="5px",c.style.paddingRight="5px",c.style.textDecoration="none",c.innerHTML="open_in_new",o.appendChild(c)}function createHeaderContent(t,e){var a=t.transaction("activity").objectStore("activity"),r=document.createElement("div"),i=document.createElement("div");i.className="back-icon",i.id="back-conv",i.style.float="left";var n=document.createElement("i");n.style.marginRight="5px",n.className="material-icons back-icon--large",n.textContent="arrow_back",i.appendChild(n),a.get(e).onsuccess=function(e){var c=e.target.result;getImageFromNumber(t,c.creator).then(function(e){var t=document.createElement("object");t.data=e||"./img/empty-user.jpg",t.className="header--icon-creator",t.type="image/jpeg";var a=document.createElement("img");a.src="./img/empty-user.jpg",a.className="header--icon-creator",t.appendChild(a),i.appendChild(t);var n=document.createElement("div");n.className="mdc-list-item__text comment-header-primary mdc-typography--subtitle2",n.textContent=c.activityName;var o=document.createElement("span");o.className="mdc-list-item__secondary-text",o.textContent="Click here to see details",n.appendChild(o),r.appendChild(i),r.appendChild(n),modifyHeader({id:"app-main-header",left:r.outerHTML}),document.getElementById("back-conv").addEventListener("click",function(){backNav()}),document.querySelector(".comment-header-primary").addEventListener("click",function(){checkIfRecordExists("activity",c.activityId).then(function(e){e?updateCreateActivity(c):listView()}).catch(handleError)})})}}function reinitCount(e,t){var a=e.transaction(["list"],"readwrite"),n=a.objectStore("list");n.get(t).onsuccess=function(e){var t=e.target.result;t&&(t.count=0,n.put(t))},a.oncomplete=function(){}}function getImageFromNumber(e,t){return new Promise(function(a){e.transaction("users").objectStore("users").get(t).onsuccess=function(e){var t=e.target.result;a(t?t.photoURL:"./img/empty-user.jpg")}})}function selectorUI(e,a){sendCurrentViewNameToAndroid("selector");var t=document.createElement("aside");t.id="dialog--component",t.className="mdc-dialog",t.role="alertdialog";var n=document.createElement("div");n.className="mdc-dialog__surface",n.appendChild(createHeader("dialog--surface-header"));var o=document.createElement("span");o.className="material-icons",o.textContent="search",o.id="selector--search";var c=document.createElement("span");c.className="material-icons dialog--header-back selector--type-"+a.store,c.textContent="arrow_back";var r=document.createElement("section");r.className="mdc-dialog__body--scrollable mdc-top-app-bar--fixed-adjust";var i=document.createElement("ul");i.id="data-list--container",i.className="mdc-list ",r.appendChild(i);var d=document.createElement("footer");d.className="mdc-dialog__footer";var s=document.createElement("button");s.className="mdc-fab mdc-dialog__footer__button mdc-dialog__footer__button--accept selector-send hidden",s.type="button";var l=document.createElement("span");l.className="mdc-fab__icon material-icons","users"===a.store?(l.textContent="add",s.dataset.clicktype="numpad"):l.textContent="send",s.appendChild(l),d.appendChild(s),n.appendChild(r),n.appendChild(d),t.appendChild(n);var m=document.createElement("div");m.className="mdc-dialog__backdrop",t.appendChild(m),document.body.appendChild(t),"subscriptions"===a.store||"children"===a.store?modifyHeader({id:"dialog--surface-header",left:c.outerHTML}):modifyHeader({id:"dialog--surface-header",left:c.outerHTML,right:o.outerHTML}),document.querySelector(".dialog--header-back").addEventListener("click",function(t){t.target.classList.contains("selector--type-users")&&"users-list-back"===t.target.dataset.state?resetSelectedContacts().then(function(e){handleRemoveDialogEvt(t,a)}):removeDialog()}),initializeSelectorWithData(e,a)}function removeDialog(){document.getElementById("dialog--component")&&(document.getElementById("dialog--component").remove(),document.getElementById("growthfile").classList.remove("mdc-dialog-scroll-lock"))}function handleRemoveDialogEvt(e,t){e&&"back-list"===e.target.dataset.type&&(resetSelectorUI(t),removeDialog())}function initializeSelectorWithData(e,t){var a=new mdc.dialog.MDCDialog(document.querySelector("#dialog--component")),n=t.record,o=firebase.auth().currentUser.uid,c=indexedDB.open(o);c.onsuccess=function(){var e=c.result;"map"===t.store&&getLocationForMapSelector(e.transaction([t.store]),t).then(function(){handleClickListnersForMap(e,a,t)}).catch(console.log);"subscriptions"===t.store&&fillSubscriptionInSelector(e,a,t),"users"===t.store&&(e.transaction(t.store).objectStore(t.store),resetSelectedContacts().then(function(){fillUsersInSelector(t,a)})),"children"===t.store&&fillChildrenInSelector(e.transaction(t.store).objectStore(t.store),n,a,t)},a.lastFocusedTarget=e.target,a.show()}function fillUsersInSelector(n,o){var c=document.getElementById("data-list--container"),r={};n.record.assignees.forEach(function(e){r[e]=""});var i=indexedDB.open(firebase.auth().currentUser.uid);i.onsuccess=function(){var e=i.result,t=e.transaction(["users"]),a=t.objectStore("users");document.querySelector(".selector-send").classList.remove("hidden"),o.acceptButton_.onclick=function(){if("numpad"===o.acceptButton_.dataset.clicktype)return document.getElementById("selector--search").style.display="none",removeChildNodes(document.getElementById("data-list--container")),document.querySelector(".mdc-dialog__footer").style.display="none",void addNewNumber(n,o);if(n.attachment.present){var e=new mdc.radio.MDCRadio(document.querySelector(".mdc-radio.radio-selected"));updateDomFromIDB(n.record,{hash:"",key:n.attachment.key},{primary:JSON.parse(e.value)}).then(removeDialog).catch(handleError)}else n.record.hasOwnProperty("create")?resetSelectedContacts().then(function(e){updateDomFromIDB(n.record,{hash:"addOnlyAssignees"},{primary:e}).then(removeDialog).catch(handleError)}):isLocationStatusWorking()&&shareReq(n)},a.openCursor().onsuccess=function(e){var t=e.target.result;if(t){var a=t.value;n.attachment.present?c.appendChild(createSimpleAssigneeLi(a,!0,!1)):r.hasOwnProperty(t.value.mobile)||c.appendChild(createSimpleAssigneeLi(a,!0,!0)),t.continue()}},t.oncomplete=function(){document.querySelectorAll('[data-selected="true"]').forEach(function(e){e&&(new mdc.checkbox.MDCCheckbox.attachTo(e).checked=!0,e.children[1].style.animation="none",e.children[1].children[0].children[0].style.animation="none")}),document.getElementById("selector--search").addEventListener("click",function(){initSearchForSelectors(e,"users",n)})}}}function shareReq(t){document.querySelector(".add--assignee-loader").appendChild(loader("user-loader")),document.querySelector(".add--assignee-loader .add--assignee-icon").style.display="none",resetSelectedContacts().then(function(e){requestCreator("share",{activityId:t.record.activityId,share:e}),removeDialog()})}function addNewNumber(a){var e=document.createElement("div");e.className="custom-number--container";var t=document.createElement("input");t.className="mdc-text-field__input",t.id="number-field",t.type="number",t.setAttribute("maxlength","10"),t.setAttribute("size","10"),t.required=!0,t.onkeypress=function(e){return 48<=e.charCode&&e.charCode<=57},t.oninput=function(){this.value.length>this.maxLength?this.value=this.value.slice(0,this.maxLength):this.value.length===this.maxLength?(document.querySelector(".message-field").classList.remove("error-message"),this.classList.add("valid-input"),document.querySelector(".message-field").textContent="",document.getElementById("new-contact").disabled=!1):(document.querySelector(".message-field").classList.add("error-message"),document.querySelector(".message-field").textContent="* Please Enter a valid Number",document.getElementById("new-contact").disabled=!0)};var n=document.createElement("button");n.className="mdc-button",n.textContent="Add Contact",n.id="new-contact",n.onclick=function(){var t=formatNumber(document.getElementById("number-field").value);checkNumber(t)?numberNotExist(t).then(function(e){if(e)return document.getElementById("new-contact").disabled=!0,document.querySelector(".message-field").classList.add("error-message"),void(document.querySelector(".message-field").textContent="* Contact already exist");a.attachment.present?updateDomFromIDB(a.record,{hash:"",key:a.attachment.key},{primary:[t]}).then(removeDialog).catch(handleError):a.record.hasOwnProperty("create")?updateDomFromIDB(a.record,{hash:"addOnlyAssignees"},{primary:[t]}).then(removeDialog).catch(handleError):isLocationVerified()&&newNumberReq(a,t)}):(document.querySelector(".message-field").classList.add("error-message"),document.querySelector(".message-field").textContent="* Please Enter a valid Number",document.getElementById("new-contact").disabled=!0)};var o=document.createElement("p");o.className="mdc-typography--subtitle2 message-field",o.textContent="Enter new phone contact without country code",o.id="helper-message",e.appendChild(t),e.appendChild(o),e.appendChild(n),document.querySelector("#dialog--component section.mdc-dialog__body--scrollable").appendChild(e);new mdc.ripple.MDCRipple.attachTo(document.getElementById("new-contact"))}function newNumberReq(e,t){requestCreator("share",{activityId:e.record.activityId,share:[t]}),removeDialog()}function numberNotExist(n){return new Promise(function(a){var e=firebase.auth().currentUser.uid,t=indexedDB.open(e);t.onsuccess=function(){t.result.transaction("users").objectStore("users").get(n).onsuccess=function(e){var t=e.target.result;a(!!t)}}})}function resetSelectedContacts(){return new Promise(function(n){var o=[],e=firebase.auth().currentUser.uid,t=indexedDB.open(e);t.onsuccess=function(){var a=t.result.transaction(["users"],"readwrite").objectStore("users");a.openCursor().onsuccess=function(e){var t=e.target.result;t?(t.value.isSelected&&(o.push(t.value.mobile),t.value.isSelected=!1,a.put(t.value)),t.continue()):n(o)}}})}function getLocationForMapSelector(r,i){return new Promise(function(e,t){var a=document.getElementById("data-list--container"),n=r.objectStore("map"),o=i.record.office,c=IDBKeyRange.bound([o,""],[o,"￿"]);n.index("byOffice").openCursor(c,"nextunique").onsuccess=function(e){var t=e.target.result;t&&(t.value.office===i.record.office&&t.value.location&&a.appendChild(createVenueLi(t.value,!1,i.record,!0)),t.continue())},r.oncomplete=function(){e(!0)},r.onerror=function(){t(r.error)}})}function checkMapStoreForNearByLocation(i,d){return new Promise(function(o,c){var r=indexedDB.open(firebase.auth().currentUser.uid);r.onsuccess=function(){var a=[],e=r.result.transaction(["map"]),t=e.objectStore("map").index("byOffice"),n=IDBKeyRange.bound([i,""],[i,"￿"]);t.openCursor(n,"nextunique").onsuccess=function(e){var t=e.target.result;t&&(t.value.location&&isLocationLessThanThreshold(calculateDistanceBetweenTwoPoints(t.value,d))&&a.push(t.value),t.continue())},e.oncomplete=function(){o(a)},e.onerror=function(){c(e.error)}}})}function handleClickListnersForMap(e,t,n){document.getElementById("selector--search")&&document.getElementById("selector--search").addEventListener("click",function(){initSearchForSelectors(e,"map",n)}),document.querySelector(".selector-send").classList.remove("hidden"),t.acceptButton_.onclick=function(){var e=document.querySelector(".mdc-radio.radio-selected");if(e){var t=new mdc.radio.MDCRadio(e),a=JSON.parse(t.value);updateDomFromIDB(n.record,{hash:"venue",key:n.key},{primary:a.location,secondary:{address:a.address,geopoint:a.geopoint}}).then(removeDialog).catch(handleError)}}}function fillChildrenInSelector(e,a,t,n){var o=document.getElementById("data-list--container");e.openCursor().onsuccess=function(e){var t=e.target.result;t&&(t.value.template===n.attachment.template&&t.value.office===n.attachment.office&&"CANCELLED"!=t.value.status&&(t.value.attachment.Name&&o.appendChild(createSimpleLi("children",t.value.attachment.Name.value)),t.value.attachment.Number&&o.appendChild(createSimpleLi("children",t.value.attachment.Number.value))),t.continue())},document.querySelector(".selector-send").classList.remove("hidden"),t.acceptButton_.onclick=function(){var e=new mdc.radio.MDCRadio(document.querySelector(".mdc-radio.radio-selected")),t=JSON.parse(e.value);updateDomFromIDB(a,{hash:"children",key:n.attachment.key},{primary:t.name}).then(removeDialog).catch(handleError)}}function fillSubscriptionInSelector(e,o,c){var r=document.getElementById("data-list--container"),i=document.createElement("div");i.className="mdc-list-group";var d=[],t=e.transaction(["subscriptions"]);t.objectStore("subscriptions").index("office").openCursor(null,"nextunique").onsuccess=function(e){var t=e.target.result;if(t){var a=document.createElement("h3");a.className="mdc-list-group__subheader subheader--group-small",a.textContent=t.value.office,a.dataset.groupOffice=t.value.office;var n=document.createElement("ul");n.className="mdc-list",n.dataset.selection=t.value.office,n.setAttribute("aria-orientation","vertical"),d.push(t.value.office),i.appendChild(a),i.appendChild(n),t.continue()}},t.oncomplete=function(){if(c.suggestCheckIn){var e=document.getElementById("data-list--container"),t=document.createElement("div");t.className="suggest-checkin--view";var a=document.createElement("span");a.className="material-icons suggestion-icon",a.textContent="add_alert",t.appendChild(a);var n=document.createElement("span");n.textContent="Check-In ?",n.className="suggest-checkin--text",t.appendChild(a),t.appendChild(n),e.insertBefore(t,e.childNodes[0])}insertTemplateByOffice(d,c.suggestCheckIn),r.appendChild(i),o.acceptButton_.onclick=function(){if(isLocationStatusWorking()&&document.querySelector(".mdc-radio.radio-selected")){var e=new mdc.radio.MDCRadio(document.querySelector(".mdc-radio.radio-selected")),t=JSON.parse(e.value);document.getElementById("app-current-panel").dataset.view="create",createTempRecord(t.office,t.template,c)}}}}function insertTemplateByOffice(e,a){var t=indexedDB.open(firebase.auth().currentUser.uid),n=(document.createDocumentFragment(),[]);t.onsuccess=function(){var e=t.result.transaction(["subscriptions"],"readonly");e.objectStore("subscriptions").index("office").openCursor().onsuccess=function(e){var t=e.target.result;if(t)if("CANCELLED"!==t.value.status)if(document.querySelector('[data-selection="'+t.value.office+'"] [data-template="'+t.value.template+'"]'))t.continue();else{if(a&&"check-in"===t.value.template)return n.push(_defineProperty({},t.value.office,createGroupList(t.value.office,t.value.template))),void t.continue();document.querySelector('[data-selection="'+t.value.office+'"]').appendChild(createGroupList(t.value.office,t.value.template)),t.continue()}else t.continue()},e.oncomplete=function(){n.forEach(function(a){Object.keys(a).forEach(function(e){var t=document.querySelector('[data-selection="'+e+'"]');t.insertBefore(a[e],t.childNodes[0])})}),document.querySelector(".selector-send").classList.remove("hidden")}}}function createTempRecord(a,r,e){var t=firebase.auth().currentUser.uid,n=indexedDB.open(t);n.onsuccess=function(){var e=n.result.transaction(["subscriptions"]).objectStore("subscriptions").index("officeTemplate"),t=IDBKeyRange.only([a,r]);e.get(t).onsuccess=function(e){var t=e.target.result;if(t){var a=[];t.schedule.forEach(function(e){var t={};t.name=e,t.startTime="",t.endTime="",a.push(t)});var n={office:t.office,template:t.template,venue:"",schedule:a,attachment:t.attachment,timestamp:Date.now(),canEdit:!0,assignees:[],activityName:t.template.toUpperCase(),create:!0},o=[];if("check-in"===r){var c={};return c.venueDescriptor=t.venue[0],c.location="",c.address="",c.geopoint={_latitude:"",_longitude:""},n.venue=[c],void getRootRecord().then(function(e){var t=isLastLocationOlderThanThreshold(e.location.lastLocationTime,5);if(!e.location||t)return appDialog("Fetching Location Please wait",!1),void window.addEventListener("location",function e(t){document.querySelector("#enable-gps")&&document.querySelector("#enable-gps").remove(),updateCreateActivity(n),removeDialog(),window.removeEventListener("location",e,!0)},!0);updateCreateActivity(n),removeDialog()})}t.venue.forEach(function(e){var t={};t.venueDescriptor=e,t.location="",t.address="",t.geopoint={_latitude:"",_longitude:""},o.push(t)}),n.venue=o,updateCreateActivity(n),removeDialog()}}}}function hasAnyValueInChildren(o,c,r){var e=firebase.auth().currentUser.uid,t=indexedDB.open(e);return new Promise(function(n){t.onsuccess=function(){var e=t.result.transaction("children").objectStore("children"),a=0;e.openCursor().onsuccess=function(e){var t=e.target.result;t?(t.value.template===c&&t.value.office===o&&"CANCELLED"!=r&&a++,t.continue()):n(0!==a)}}})}function updateDomFromIDB(i,d,s){return new Promise(function(o,c){var e=firebase.auth().currentUser.uid,r=indexedDB.open(e);r.onsuccess=function(){var t=r.result,a=i;if("venue"===d.hash)return a=updateVenue(a,d,s),changeTextContentForNewSelectedVenue(d,s),void updateLocalRecord(a,t).then(function(e){o(e)}).catch(function(e){c(e)});if("addOnlyAssignees"===d.hash){if(!s.primary.length)return;var n=document.getElementById("assignees--list");return s.primary.forEach(function(e){-1<a.assignees.indexOf(e)||(a.assignees.push(e),getUserRecord(t,e).then(function(e){n&&n.appendChild(createSimpleAssigneeLi(e))}))}),void o(!0)}"weekday"!==d.hash&&d.hasOwnProperty("key")&&(a.attachment[d.key].value=s.primary,updateLocalRecord(a,t).then(function(e){changeTextContentForNewSelectedVenue(d,s),o(e)}).catch(function(e){c(e)}))}})}function updateLocalRecord(c,r){return new Promise(function(e,t){var a=r.transaction(["activity"],"readwrite"),n=a.objectStore("activity"),o=c;o.hasOwnProperty("create")||n.put(o),a.oncomplete=function(){e("activity object store updated with value")},a.onerror=function(){t({message:a.error.message+" from updateLocalRecord"})}})}function changeTextContentForNewSelectedVenue(e,t){var a=document.getElementById(convertKeyToId(e.key));if(a){var n=a.querySelector("[data-primary]"),o=a.querySelector("[data-secondary]"),c=document.getElementById("send-activity");t.primary&&n&&(n.textContent=t.primary),t.hasOwnProperty("secondary")&&o&&(o.textContent=t.secondary.address),c&&(c.dataset.progress||c.classList.remove("hidden"))}}function updateVenue(e,t,a){return e.venue.forEach(function(e){e.venueDescriptor===t.key&&(e.location=a.primary,e.address=a.secondary.address,e.geopoint._latitude=a.secondary.geopoint._latitude,e.geopoint._longitude=a.secondary.geopoint._longitude)}),e}function convertKeyToId(e){return e.replace(/-/g,"--").replace(/\s/g,"-")}function convertIdToKey(e){return e.replace(/-/g," ").replace("  ","-")}function updateCreateContainer(e,t){var a=JSON.parse(e);document.body.style.backgroundColor="#eeeeee";var n=document.createElement("div");n.style.display="inline-flex";var o=document.createElement("span");o.className="material-icons",o.textContent="arrow_back",o.id="backToConv";var c=document.createElement("span");c.textContent=a.activityName,c.style.fontSize="18px",c.style.paddingLeft="10px",c.style.marginTop="6px",n.appendChild(o),n.appendChild(c),modifyHeader({id:"app-main-header",left:n.outerHTML}),document.getElementById("backToConv").addEventListener("click",function(){updateLocalRecord(a,t).then(function(){backNav()}).catch(handleError)});var r=document.createElement("div");r.className="mdc-top-app-bar--fixed-adjust update-create--activity";for(var i=["office","venue","schedule","attachment","assignees"],d=0;d<5;d++){var s=document.createElement("ul");s.className="mdc-list custom--list-margin";var l=document.createElement("div");switch(i[d]){case"office":s.classList.remove("custom--list-margin");break;case"schedule":l.className="mdc-list-group__subheader",l.id="schedule--group";break;case"venue":case"assignees":s.classList.add("mdc-list--two-line","mdc-list--avatar-list")}"schedule"===i[d]?r.appendChild(l):(s.id=i[d]+"--list",r.appendChild(s))}if(a.canEdit){var m=document.createElement("button");m.className="mdc-fab send--activity-fab",m.setAttribute("aria-label","Send"),m.id="send-activity",a.hasOwnProperty("create")||m.classList.add("hidden");var u=document.createElement("span");u.className="mdc-fab__icon material-icons",u.textContent="send",m.appendChild(u),r.appendChild(m)}return r}function updateCreateActivity(r){history.pushState(["updateCreateActivity",r],null,null);var e=firebase.auth().currentUser.uid,i=indexedDB.open(e);i.onsuccess=function(){var e=i.result,t=document.getElementById("app-current-panel"),a=JSON.stringify(r);t.innerHTML=updateCreateContainer(a,e).outerHTML,document.getElementById("office--list").appendChild(createSimpleLi("Office",{office:r.office,showLabel:!0})),createVenueSection(r),createScheduleTable(r),createAttachmentContainer(r),createAssigneeList(r,!0,e),createActivityCancellation(r),document.getElementById("send-activity")&&document.getElementById("send-activity").addEventListener("click",function(){isLocationStatusWorking()&&(this.dataset.progress=!0,sendActivity(r))});for(var n=document.querySelectorAll(".update-create--activity input"),o=0;o<n.length;o++)n[o].addEventListener("input",function(e){document.getElementById("send-activity").dataset.progress||document.getElementById("send-activity").classList.contains("hidden")&&document.getElementById("send-activity").classList.remove("hidden")});if(document.querySelector(".mdc-select")){var c=new mdc.select.MDCSelect(document.querySelector(".mdc-select"));c.listen("change",function(){updateDomFromIDB(r,{hash:"weekday",key:c.root_.dataset.value},{primary:c.value}).then(function(e){document.getElementById("send-activity").dataset.progress||document.getElementById("send-activity").classList.contains("hidden")&&document.getElementById("send-activity").classList.remove("hidden")}).catch(handleError)})}}}function createCheckInVenue(e){var t=document.createElement("div");t.className="mdc-radio checkin",t.value=JSON.stringify(e);var a=document.createElement("input");a.className="mdc-radio__native-control",a.type="radio",a.setAttribute("name","radios");var n=document.createElement("div");n.className="mdc-radio__background";var o=document.createElement("div");o.className="mdc-radio__outer-circle";var c=document.createElement("div");c.className="mdc-radio__inner-circle",n.appendChild(o),n.appendChild(c),t.appendChild(a),t.appendChild(n);return t}function createSimpleLi(e,t){var a=document.createElement("li");a.className="mdc-list-item mdc-ripple-upgraded";var n=document.createElement("span");n.className="detail--static-text";document.createElement("span");var o=document.createElement("span");if("Office"===e&&(o.className="data--value-list",o.textContent=t.office,n.textContent=e,a.appendChild(n),a.appendChild(o)),"children"===e){var c=document.createElement("span");c.className="mdc-list-item__meta",c.appendChild(createRadioInput()),a.textContent=t,a.appendChild(c),a.onclick=function(){checkRadioInput(this,{name:t})}}if("delete"===e&&(o.className="mdc-list-item__graphic material-icons",o.textContent=e,n.classList.remove("detail--static-text"),n.classList.add("delete-activity"),n.textContent=t.text,a.appendChild(o),a.appendChild(n)),"empty"===e&&(a.dataset.prop="delete"),"undo-deleted"===e){o.className="mdc-list-item__graphic material-icons",o.textContent="delete",n.classList.remove("detail--static-text"),n.classList.add("delete-activity"),n.textContent=t.text,a.appendChild(o),a.appendChild(n),a.classList.add("undo-delete-activity");var r=document.createElement("button");r.className="mdc-button mdc-ripple-upgraded mdc-list-item__meta undo-deleted",r.textContent="Undo",r.onclick=function(){isLocationStatusWorking()&&(document.querySelector(".undo-deleted").style.display="none",a.appendChild(loader("undo-delete-loader")),reqForUndoDeleted(t.id))},a.appendChild(r)}return a}function reqForUndoDeleted(e){requestCreator("statusChange",{activityId:e,status:"PENDING"})}function createGroupList(e,t){var a=document.createElement("li");a.className="mdc-list-item transition-ease",a.dataset.template=t;var n=document.createElement("span");n.className="mdc-list-item__text",n.textContent=t.toUpperCase();var o=document.createElement("span");return o.className="mdc-list-item__meta",o.appendChild(createRadioInput()),a.onclick=function(){checkRadioInput(this,{office:e,template:t})},a.appendChild(n),a.appendChild(o),a}function createVenueSection(r){console.log(r);var i=document.getElementById("venue--list");"check-in"===r.template&&r.hasOwnProperty("create")?getRootRecord().then(function(e){checkMapStoreForNearByLocation(r.office,e.location).then(function(e){if(e.length){var t=document.createElement("li");t.className="mdc-list-item label--text",t.textContent=r.venue[0].venueDescriptor,t.style.height="50px",t.style.paddingRight="11px";var a=document.createElement("span");a.className="mdc-list-item__meta";var n=document.createElement("label");n.id="uncheck-checkin",n.className="mdc-fab add--assignee-icon";var o=document.createElement("span");o.className="mdc-fab__icon material-icons",o.textContent="clear",n.appendChild(o),a.appendChild(n),t.appendChild(a),i.appendChild(t),e.forEach(function(e){var t=document.createElement("div");t.className="mdc-form-field check-in-form";var a=document.createElement("label");a.setAttribute("for","check-in-radio"),a.textContent=e.location,t.appendChild(a),t.appendChild(createCheckInVenue(e)),i.appendChild(t);var n=document.createElement("div");n.id="map-detail-check-in-create"+convertKeyToId(e.venueDescriptor),i.appendChild(n)});var c=document.getElementById("uncheck-checkin");c&&c.addEventListener("click",function(){document.querySelectorAll(".mdc-radio.checkin").forEach(function(e){new mdc.radio.MDCRadio(e).checked=!1})})}})}):(r.venue.forEach(function(e){i.appendChild(createVenueLi(e,!0,r));var t=document.createElement("div");t.className="map-detail "+convertKeyToId(e.venueDescriptor),i.appendChild(t)}),"check-in"===r.template&&(r.venue[0].location&&r.venue[0].address||(document.getElementById("venue--list").style.display="none")),0===r.venue.length&&(document.getElementById("venue--list").style.display="none"))}function createVenueLi(a,e,t,n){var o=!1,c=document.createElement("li");c.className="mdc-list-item mdc-ripple-upgraded",c.id=convertKeyToId(a.venueDescriptor);var r=document.createElement("div");r.className="mdc-list-item__text link--span";var i=document.createElement("span");i.className="mdc-list-item__primary-text";var d=document.createElement("span");d.className="mdc-list-item__meta";var s=document.createElement("label");s.className="mdc-fab add--assignee-icon attachment-selector-label";var l=document.createElement("span");if(l.className="mdc-fab__icon material-icons",l.textContent="add_location",s.appendChild(l),e){var m=document.createElement("span");m.className="detail--static-text",m.textContent=a.venueDescriptor;var u=document.createElement("span");u.className="data--value-list",u.textContent=a.location,u.dataset.primary="",i.appendChild(m),i.appendChild(u),r.appendChild(i),r.onclick=function(e){if(hasMapsApiLoaded()&&a.geopoint._latitude&&a.geopoint._longitude){o=!o;var t={lat:a.geopoint._latitude,lng:a.geopoint._longitude};maps("",o,convertKeyToId(a.venueDescriptor),t)}},t.canEdit&&(d.setAttribute("aria-hidden","true"),d.appendChild(s),s.onclick=function(e){selectorUI(e,{record:t,store:"map",attachment:{present:!1},key:a.venueDescriptor})})}else i.textContent=a.location,r.appendChild(i);var p=document.createElement("span");p.className="mdc-list-item__meta material-icons",n&&(p.appendChild(createRadioInput()),c.onclick=function(){checkRadioInput(this,{location:a.location,address:a.address,geopoint:{_latitude:a.latitude,_longitude:a.longitude},venueDesc:a.venueDescriptor})});var h=document.createElement("span");return h.className="mdc-list-item__secondary-text",t.hasOwnProperty("create")?"check-in"!==t.template||n||(a.showIcon?h.textContent=a.address:(h.style.paddingTop="3px",h.textContent="Not A Known Location")):h.textContent=a.address,h.dataset.secondary="",r.appendChild(h),c.appendChild(r),n?c.appendChild(p):"check-in"===t.template?a.showIcon&&c.appendChild(d):c.appendChild(d),c}function createScheduleTable(v){v.schedule.length||(document.getElementById("schedule--group").style.display="none");var g=0;v.schedule.forEach(function(e){g++;var t=document.createElement("h5");t.className="mdc-list-group__subheader label--text",t.textContent=e.name;var a=document.createElement("ul");a.className="mdc-list mdc-list--dense";var n=document.createElement("li");n.className="mdc-list-divider",n.setAttribute("role","separator");var o=document.createElement("li");o.className="mdc-list-item schedule-start-li";var c=document.createElement("div");c.className="mdc-text-field start--date"+g;var r=document.createElement("input");r.value=moment(e.startTime||new Date).format("YYYY-MM-DD"),r.type="date",r.disabled=!v.canEdit,r.className="mdc-text-field__input",c.appendChild(r);var i=document.createElement("span");i.className="mdc-list-item__meta";var d=document.createElement("div");d.className="mdc-text-field start--time"+g;var s=document.createElement("input");s.value=moment(e.startTime||new Date).format("HH:mm"),s.type="time",s.className="time--input",s.disabled=!v.canEdit,s.className="mdc-text-field__input",d.appendChild(s),i.appendChild(d);var l=document.createElement("li");l.className="mdc-list-item schedule-end-li";var m=document.createElement("div");m.className="mdc-text-field end--date"+g;var u=document.createElement("input");u.value=moment(e.endTime||new Date).format("YYYY-MM-DD"),u.type="date",u.disabled=!v.canEdit,u.className="mdc-text-field__input",m.appendChild(u);var p=document.createElement("span");p.className="mdc-list-item__meta";var h=document.createElement("div");h.className="mdc-text-field end--time"+g;var f=document.createElement("input");f.value=moment(e.endTime||new Date).format("HH:mm"),f.type="time",f.disabled=!v.canEdit,f.className="mdc-text-field__input",h.appendChild(f),p.appendChild(h),o.appendChild(c),o.appendChild(i),l.appendChild(m),l.appendChild(p),a.appendChild(o),a.appendChild(n),a.appendChild(l),document.getElementById("schedule--group").appendChild(t),document.getElementById("schedule--group").appendChild(a)})}function createAttachmentContainer(p){["Name","Number","Template","email","phoneNumber","HHMM","weekday","number","base64","string"].forEach(function(e){var t=document.createElement("div");t.className=e+"--group",document.getElementById("attachment--list").appendChild(t)});var h={phoneNumber:"",weekday:"","HH:MM":"",string:"",base64:"",number:"",email:""};Object.keys(p.attachment).forEach(function(t){var a=document.createElement("div");"HH:MM"===p.attachment[t].type?a.className="attachment-field HHMM":a.className="attachment-field "+p.attachment[t].type,a.id=convertKeyToId(t),p.canEdit&&a.classList.add("editable--true");var e=document.createElement("span");if(e.className="label--text","Name"===(e.textContent=t)||"Number"===t){a.appendChild(e);a.appendChild(createSimpleInput(p.attachment[t].value,p.canEdit,"",t,!0))}else"string"===p.attachment[t].type&&(a.appendChild(e),a.appendChild(createSimpleInput(p.attachment[t].value,p.canEdit,"",t)));if("number"===p.attachment[t].type&&(a.appendChild(e),a.appendChild(createNumberInput(p.attachment[t].value,p.canEdit))),"email"===p.attachment[t].type&&(a.appendChild(e),a.appendChild(createEmailInput(p.attachment[t].value,p.canEdit))),"phoneNumber"===p.attachment[t].type){a.classList.add("selector--margin");var n=document.createElement("label");n.className="mdc-fab add--assignee-icon attachment-selector-label";var o=document.createElement("span");o.className="mdc-fab__icon material-icons",o.textContent="person_add",n.appendChild(o);var c=document.createElement("span");c.className="data--value-list",c.dataset.primary="",p.canEdit&&(a.appendChild(n),n.onclick=function(e){selectorUI(e,{record:p,store:"users",attachment:{present:!0,key:t}})}),a.appendChild(e),c.textContent=p.attachment[t].value,a.appendChild(c)}if("HH:MM"==p.attachment[t].type&&(a.appendChild(e),a.appendChild(createTimeInput(p.attachment[t].value,p.canEdit,{simple:!1,type:"time"}))),"weekday"===p.attachment[t].type&&(a.appendChild(e),a.appendChild(createSelectMenu(t,p.attachment[t].value,p.canEdit))),"base64"===p.attachment[t].type){var r=document.createElement("label");r.className="mdc-fab attachment-selector-label add--assignee-icon",r.id="start-camera";var i=document.createElement("span");i.className="mdc-fab__icon material-icons",i.textContent="add_a_photo",r.appendChild(i);var d=document.createElement("ul");d.className="image-preview--attachment mdc-image-list standard-image-list mdc-image-list--with-text-protection",d.appendChild(setFilePath(p.attachment[t].value,t,!0)),a.appendChild(d),p.canEdit&&(a.appendChild(r),a.appendChild(d),r.onclick=function(){readCameraFile()})}if(!h.hasOwnProperty(p.attachment[t].type)){var s=document.createElement("label");s.className="mdc-fab add--assignee-icon attachment-selector-label";var l=document.createElement("span");l.className="mdc-fab__icon material-icons",l.textContent="add",s.appendChild(l),a.appendChild(e);var m=document.createElement("span");m.textContent=p.attachment[t].value,m.className="data--value-list",a.appendChild(m),p.canEdit&&hasAnyValueInChildren(p.office,p.attachment[t].type,p.status).then(function(e){e&&(a.appendChild(s),a.classList.add("selector--margin"),s.onclick=function(e){m.dataset.primary="",selectorUI(e,{record:p,store:"children",attachment:{present:!0,key:t,office:p.office,template:p.attachment[t].type,status:p.status}})})})}var u=document.createElement("hr");u.className="attachment--divider","HH:MM"===p.attachment[t].type?(document.querySelector(".HHMM--group").appendChild(a),document.querySelector(".HHMM--group").appendChild(u)):"Name"===t?(document.querySelector(".Name--group").appendChild(a),document.querySelector(".Name--group").appendChild(u)):h.hasOwnProperty(p.attachment[t].type)?(document.querySelector("."+p.attachment[t].type+"--group").appendChild(a),document.querySelector("."+p.attachment[t].type+"--group").appendChild(u)):(document.querySelector(".Template--group").appendChild(a),document.querySelector(".Template--group").appendChild(u))})}function createAssigneeList(t,e,a){var n=document.getElementById("assignees--list");if(e){var o=document.createElement("li");o.className="mdc-list-item label--text add--assignee-loader",o.textContent="Assignees";var c=document.createElement("span");c.className="mdc-list-item__meta";var r=document.createElement("div");r.className="mdc-fab add--assignee-icon",r.onclick=function(e){selectorUI(e,{record:t,store:"users",attachment:{present:!1}})};var i=document.createElement("span");i.className="mdc-fab__icon material-icons",i.textContent="person_add",r.appendChild(i),c.appendChild(r),t.canEdit&&o.appendChild(c),n.appendChild(o)}t.assignees.forEach(function(e){getUserRecord(a,e).then(function(e){n.appendChild(createSimpleAssigneeLi(e))})})}function createSimpleAssigneeLi(e,t,a){var n=document.createElement("li");if(n.classList.add("mdc-list-item","assignee-li"),!e)return n;n.dataset.value=e.mobile;var o=document.createElement("object");o.data=e.photoURL||"./img/empty-user.jpg",o.type="image/jpeg",o.className="mdc-list-item__graphic";var c=document.createElement("img");c.src="./img/empty-user.jpg",c.className="empty-user-assignee",o.appendChild(c);var r=document.createElement("span");r.classList.add("mdc-list-item__text");var i=document.createElement("span");i.className="mdc-list-item__primary-text";var d=document.createElement("span");d.classList.add("mdc-list-item__secondary-text"),e.displayName?(i.textContent=e.displayName,d.textContent=e.mobile):i.textContent=e.mobile,r.appendChild(i),r.appendChild(d);var s=document.createElement("span");return s.className="mdc-list-item__meta material-icons",t&&(a?s.appendChild(createCheckBox(e)):(s.appendChild(createRadioInput()),n.onclick=function(){checkRadioInput(this,n.dataset.value)})),n.appendChild(o),n.appendChild(r),n.appendChild(s),n}function createRadioInput(){var e=document.createElement("div");e.className="mdc-radio radio-control-selector";var t=document.createElement("input");t.className="mdc-radio__native-control",t.type="radio",t.name="radio";var a=document.createElement("div");a.className="mdc-radio__background";var n=document.createElement("div");n.className="mdc-radio__outer-circle";var o=document.createElement("div");return o.className="mdc-radio__inner-circle",a.appendChild(n),a.appendChild(o),e.appendChild(t),e.appendChild(a),e}function createCheckBox(t){var e=document.createElement("div");e.className="mdc-checkbox status-check",e.dataset.selected=t.isSelected;var a=document.createElement("input");a.className="mdc-checkbox__native-control",a.type="checkbox",a.onclick=function(e){checkCheckboxInput(e,t)};var n=document.createElement("div");n.className="mdc-checkbox__background";return document.createElement("div").className="mdc-checkbox__mixedmark",n.innerHTML='<svg class="mdc-checkbox__checkmark"\n    viewBox="0 0 24 24">\n    <path class="mdc-checkbox__checkmark-path"\n    fill="none"\n    d="M1.73,12.91 8.1,19.28 22.79,4.59"/>\n    </svg>\n    <div class="mdc-checkbox__mixedmark"></div>',e.appendChild(a),e.appendChild(n),e}function checkCheckboxInput(t,a){var e=firebase.auth().currentUser.uid,n=indexedDB.open(e);n.onsuccess=function(){var e=n.result.transaction("users","readwrite").objectStore("users");a.hasOwnProperty("isSelected")&&a.isSelected?(t.target.parentNode.dataset.selected=!1,a.isSelected=!1):(t.target.parentNode.dataset.selected=!0,a.isSelected=!0,document.querySelector(".selector-send span").textContent="send"),e.put(a),0==document.querySelectorAll('[data-selected="true"]').length?(document.querySelector(".selector-send span").textContent="add",document.querySelector(".selector-send").dataset.clicktype="numpad"):document.querySelector(".selector-send").dataset.clicktype=""}}function checkRadioInput(e,t){[].concat(_toConsumableArray(document.querySelectorAll(".radio-selected"))).forEach(function(e){e.classList.remove("radio-selected")});var a=e;if(a){var n=new mdc.radio.MDCRadio(a.querySelector(".radio-control-selector"));n.root_.classList.add("radio-selected"),document.querySelector(".selector-send span").textContent="send",document.querySelector(".selector-send").dataset.clicktype="",n.value=JSON.stringify(t)}}function setFilePath(e,t,a){if(document.querySelector(".image--list-li"))return document.getElementById("attachment-picture").data="data:image/jpg;base64,"+e,document.getElementById("attachment-picture").dataset.value="data:image/jpg;base64,"+e,void(document.getElementById("send-activity").dataset.progress||document.getElementById("send-activity").classList.remove("hidden"));var n=document.createElement("li");n.className="mdc-image-list__item image--list-li";var o=document.createElement("div"),c=document.createElement("object");c.data=e||"./img/placeholder.png",c.type="image/jpeg",c.id="attachment-picture",c.dataset.photoKey=t,c.className="profile-container--main mdc-image-list__image";var r=document.createElement("img");r.src="./img/placeholder.png",r.className="profile-container--main mdc-image-list__image",c.dataset.value=e?c.src=e:(c.data="./img/placeholder.png",""),c.appendChild(r),c.onclick=function(){openImage(this.data)},o.appendChild(c),n.appendChild(o);var i=document.createElement("div");i.className="mdc-image-list__supporting";var d=document.createElement("span");return d.textContent=t,d.className="mdc-image-list__label",d.id="label--image",i.appendChild(d),n.appendChild(i),a?n:void 0}function readCameraFile(){if("Android"===native.getName())try{AndroidInterface.startCamera()}catch(e){handleError({message:e.message+" from startCamera"})}else webkit.messageHandlers.takeImageForAttachment.postMessage("convert image to base 64")}function openImage(e){e&&(document.getElementById("viewImage--dialog-component").querySelector("img").src=e,new mdc.dialog.MDCDialog.attachTo(document.querySelector("#viewImage--dialog-component")).show())}function createActivityCancellation(e){if(e.canEdit){var t=document.createElement("div");if(t.className="status--cancel-cont",!e.hasOwnProperty("create"))if("CANCELLED"!==e.status){if("CANCELLED"!==e.status){if(t.appendChild(createSimpleLi("delete",{text:"CANCEL"})),document.querySelector(".update-create--activity").appendChild(t),!e.canEdit)return;document.getElementById("cancel-alert")||cancelAlertDialog();var a=new mdc.dialog.MDCDialog(document.querySelector("#cancel-alert"));document.getElementById("delete-allow").onclick=function(){isLocationStatusWorking()&&deleteActivityReq(e.activityId)},a.listen("MDCDialog:cancel",function(){}),document.querySelector(".delete-activity").addEventListener("click",function(e){a.lastFocusedTarget=e.target,a.show()})}}else{t.appendChild(createSimpleLi("undo-deleted",{text:"Cancelled",id:e.activityId})),document.querySelector(".update-create--activity").appendChild(t);new mdc.ripple.MDCRipple.attachTo(document.querySelector(".undo-deleted"))}}}function deleteActivityReq(e){document.querySelector(".delete-activity").style.display="none",document.querySelector(".status--cancel-cont li").appendChild(loader("cancel-loader")),requestCreator("statusChange",{activityId:e,status:"CANCELLED"})}function cancelAlertDialog(){var e=document.createElement("aside");e.className="mdc-dialog",e.id="cancel-alert";var t=document.createElement("div");t.className="mdc-dialog__surface";var a=document.createElement("section");a.className="mdc-dialog__body",a.textContent="Are you sure you want to delete this activity ? ";var n=document.createElement("footer");n.className="mdc-dialog__footer";var o=document.createElement("button");o.type="button",o.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--accept delete-btn",o.textContent="Delete",o.id="delete-allow";var c=document.createElement("button");c.type="button",c.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--cancel cancel-delete-btn",c.textContent="Cancel",n.appendChild(c),n.appendChild(o),t.appendChild(a),t.appendChild(n),e.appendChild(t);var r=document.createElement("div");r.className="mdc-dialog__backdrop",e.appendChild(r),document.body.appendChild(e)}function sendActivity(a){if(a.hasOwnProperty("create"))insertInputsIntoActivity(a);else{var e=firebase.auth().currentUser.uid,n=indexedDB.open(e);n.onsuccess=function(e){var t=n.result.transaction("activity","readwrite").objectStore("activity");t.get(a.activityId).onsuccess=function(e){insertInputsIntoActivity(e.target.result,t)}}}}function concatDateWithTime(e,t){var a=moment(e+" "+t);return moment(a).valueOf()}function insertInputsIntoActivity(a,e){for(var t=document.querySelectorAll(".string"),n=0;n<t.length;n++){var o=t[n].querySelector(".mdc-text-field__input").value;if(t[n].querySelector(".mdc-text-field__input").required&&checkSpacesInString(o))return void snacks("Please provide an input for the field “Name” ");a.attachment[convertIdToKey(t[n].id)].value=o}var c=document.querySelectorAll(".number");for(n=0;n<c.length;n++){var r=Number(c[n].querySelector(".mdc-text-field__input").value);a.attachment[convertIdToKey(c[n].id)].value=r}var i=document.querySelectorAll(".email");for(n=0;n<i.length;n++){var d=i[n].querySelector(".mdc-text-field__input").value;a.attachment[convertIdToKey(i[n].id)].value=d}var s=document.querySelectorAll(".HHMM");for(n=0;n<s.length;n++){var l=s[n].querySelector(".mdc-text-field__input").value;a.attachment[convertIdToKey(s[n].id)].value=l}for(var m=document.querySelectorAll(".image-preview--attachment  object"),u=0;u<m.length;u++)a.attachment[convertKeyToId(m[u].dataset.photoKey)].value=m[u].dataset.value;var p=void 0,h=void 0,f=void 0,v=void 0;for(n=1;n<a.schedule.length+1;n++){if(p=getInputText(".start--date"+n).value,h=getInputText(".start--time"+n).value,f=getInputText(".end--date"+n).value,v=getInputText(".end--time"+n).value,!concatDateWithTime(p,h)&&!concatDateWithTime(f,v))return void snacks("Please Select A Start Date and End Date");if(""===p)return void snacks("Please Select a Start Date");if(""===f)return void snacks("Please Select an End Date");if(concatDateWithTime(f,v)<concatDateWithTime(p,h))return void snacks("The End Date and Time should be greater or equal to the start time");a.schedule[n-1].startTime=concatDateWithTime(p,h)||"",a.schedule[n-1].endTime=concatDateWithTime(f,v)||""}if("check-in"===a.template)document.querySelectorAll(".mdc-radio.checkin").forEach(function(e){if(new mdc.radio.MDCRadio(e).checked){var t=JSON.parse(e.value);a.venue[0].geopoint={latitude:t.latitude,longitude:t.longitude},a.venue[0].location=t.location,a.venue[0].address=t.address}}),a.venue[0].location&&a.venue[0].address||(a.venue[0].geopoint={latitude:"",longitude:""});else for(n=0;n<a.venue.length;n++)a.venue[n].geopoint={latitude:a.venue[n].geopoint._latitude||"",longitude:a.venue[n].geopoint._longitude||""},a.venue[n].hasOwnProperty("showIcon")&&delete a.venue[n].showIcon;sendUpdateReq({venue:a.venue,schedule:a.schedule,attachment:a.attachment},a)}function sendUpdateReq(e,t){if(!t.hasOwnProperty("create"))return e.activityId=t.activityId,document.querySelector("header").appendChild(progressBar()),document.querySelector("#send-activity").classList.add("hidden"),void requestCreator("update",e);e.office=t.office,e.template=t.template,e.share=t.assignees,document.querySelector("header").appendChild(progressBar()),document.querySelector("#send-activity").classList.add("hidden"),requestCreator("create",e)}function checkSpacesInString(e){return!e.replace(/\s/g,"").length}function initSearchForSelectors(e,t,a){if(searchBarUI(t),"map"===t){var n=document.getElementById("search--bar-selector");return autocomplete=new google.maps.places.Autocomplete(n,{componentRestrictions:{country:"in"}}),void initializeAutocompleteGoogle(autocomplete,a.record,a)}"users"===t&&initUserSelectorSearch(e,a)}function searchBarUI(e){var t=document.getElementById("dialog--component"),a=t.querySelector("#dialog--surface-headeraction-data");a.className="search--cont",t.querySelector(".mdc-top-app-bar__section--align-end").classList.add("search-field-transform"),t.querySelector(".mdc-top-app-bar__section--align-start").style.backgroundColor="white",document.getElementById("search--bar--field")?document.getElementById("search--bar--field").style.display="block":a.appendChild(createSimpleInput("",!0,!0)),document.getElementById("selector--search").style.display="none",document.querySelector(".selector-send").dataset.clicktype="",document.querySelector(".selector-send span").textContent="send",t.querySelector("#dialog--surface-headerview-type span").dataset.type="back-list","users"===e&&(t.querySelector("#dialog--surface-headerview-type span").dataset.state="user-list-back"),t.querySelector("#dialog--surface-headerview-type span").style.color="#0399f4"}function resetSelectorUI(e){var t=document.getElementById("dialog--component"),a=t.querySelector("#dialog--surface-headeraction-data");t.querySelector("#dialog--surface-headerview-type span").dataset.type="",t.querySelector(".mdc-top-app-bar__section--align-end").classList.remove("search-field-transform"),a.querySelector("#search--bar--field").classList.remove("field-input"),a.classList.remove("search--cont"),document.getElementById("selector--search").style.display="block",document.querySelector(".selector-send").style.display="block",document.querySelector("#search--bar--field").style.display="none",t.querySelector(".mdc-top-app-bar__section--align-start").style.backgroundColor="#eeeeee",document.getElementById("data-list--container").style.display="block";var n=new mdc.dialog.MDCDialog(t);"users"===e.store&&(document.getElementById("data-list--container").innerHTML="",fillUsersInSelector(e,n)),"subscriptions"===e.store&&document.getElementById("data-list--container").querySelectorAll("li").forEach(function(e){e.style.display="flex"})}function initializeAutocompleteGoogle(n,o,c){document.querySelector("#dialog--component .mdc-dialog__surface").style.width="100vw",document.querySelector("#dialog--component .mdc-dialog__surface").style.height="100vh",n.addListener("place_changed",function(){var e=n.getPlace();if(e.geometry){var t="";e.address_components&&(t=[e.address_components[0]&&e.address_components[0].short_name||"",e.address_components[1]&&e.address_components[1].short_name||"",e.address_components[2]&&e.address_components[2].short_name||""].join(" "));var a={primary:e.name,secondary:{address:t,geopoint:{_latitude:e.geometry.location.lat(),_longitude:e.geometry.location.lng()}}};updateDomFromIDB(o,{hash:"venue",key:c.key},a).then(removeDialog).catch(handleError)}else snacks("Please select a valid location")})}function createSimpleInput(e,t,a,n,o){if(!t){var c=document.createElement("span");return c.className="data--value-list",c.textContent=e,c}var r=document.createElement("div");n&&n.length<15?r.className="mdc-text-field data--value-list":r.className="mdc-text-field data--value-list-small";var i=document.createElement("input");i.className="mdc-text-field__input input--value--update",i.style.paddingTop="0px",i.value=e,i.required=o;var d=document.createElement("div");if(d.className="mdc-line-ripple",a&&(r.id="search--bar--field",i.id="search--bar-selector",r.classList.add("field-input")),r.appendChild(i),r.appendChild(d),r)new mdc.textField.MDCTextField.attachTo(r);return r}function createNumberInput(e,t){if(!t){var a=document.createElement("span");return a.className="data--value-list",a.textContent=e,a}var n=document.createElement("div");n.className="mdc-text-field data--value-list";var o=document.createElement("input");o.className="mdc-text-field__input input--type-number",o.type="number",o.style.paddingTop="0px",o.value=e,o.setAttribute("onkeypress","return event.charCode >= 48 && event.charCode <= 57");var c=document.createElement("div");return c.className="mdc-line-ripple",n.appendChild(o),n.appendChild(c),n}function createEmailInput(e,t){if(!t){var a=document.createElement("span");return a.className="data--value-list",a.textContent=e,a}var n=document.createElement("div");n.className="mdc-text-field data--value-list";var o=document.createElement("input");o.className="mdc-text-field__input input--type-email",o.type="email",o.placeholder="johndoe@example.com",o.style.paddingTop="0px",o.value=e;var c=document.createElement("div");return c.className="mdc-line-ripple",n.appendChild(o),n.appendChild(c),n}function createTimeInput(e,t,a){if(!t){var n=document.createElement("span");return n.className="data--value-list","date"===a.type?n.textContent=moment(e).calendar():n.textContent=e,n}var o=document.createElement("div");o.className="mdc-text-field";var c=document.createElement("input");c.className="mdc-text-field__input input--type-time",c.type=a.type,c.style.borderBottom="none","date"===a.type?c.value=moment(e).format("YYYY-MM-DD"):c.value=e,"time"===a.type&&(o.classList.add("data--value-list"),c.style.width="100%",c.value=e||moment(new Date).format("HH:mm"));var r=document.createElement("div");return r.className="mdc-line-ripple",o.appendChild(c),o.appendChild(r),a.simple?(c.classList.remove("mdc-text-field__input"),c):o}function createSelectMenu(e,t,a){if(!a){var n=document.createElement("span");return n.className="data--value-list",n.textContent=t,n}var o=document.createElement("div");o.className="mdc-select data--value-list",o.style.height="32%;",o.id=convertKeyToId(e),o.dataset.value=e,o.dataset.primary="";var c=document.createElement("select");c.className="mdc-select__native-control",c.style.paddingRight="0px";for(var r=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],i=0;i<r.length;i++){var d=document.createElement("option");d.value=r[i],d.textContent=r[i],t===r[i]&&d.setAttribute("selected","true"),c.appendChild(d)}var s=document.createElement("label");s.className="mdc-floating-label",s.textContent="";var l=document.createElement("div");return l.className="mdc-line-ripple",o.appendChild(s),o.appendChild(c),o.appendChild(l),o}function toggleActionables(e){if(e&&"create"!==document.getElementById("app-current-panel").dataset.view){var t=indexedDB.open(firebase.auth().currentUser.uid);t.onsuccess=function(){t.result.transaction("activity").objectStore("activity").get(e).onsuccess=function(e){var t=e.target.result;if(t){document.querySelectorAll(".mdc-fab");t.editable&&(document.querySelector(".loader")&&(document.querySelector(".loader").remove(),document.querySelector(".add--assignee-loader .add--assignee-icon")&&(document.querySelector(".add--assignee-loader .add--assignee-icon").style.display="block")),document.querySelector(".progress--update")&&document.querySelector(".progress--update").remove())}else listView()}}}}var ui=void 0,native={setFCMToken:function(e){localStorage.setItem("token",e)},getFCMToken:function(){return localStorage.getItem("token")},setName:function(e){localStorage.setItem("deviceType",e)},getName:function(){return localStorage.getItem("deviceType")},setIosInfo:function(e){var t=e.split("&"),a={baseOs:t[0],deviceBrand:t[1],deviceModel:t[2],appVersion:Number(t[3]),osVersion:t[4],id:t[5],initConnection:t[6]};localStorage.setItem("iosUUID",JSON.stringify(a))},getIosInfo:function(){return localStorage.getItem("iosUUID")},getInfo:function(){if(!this.getName())return JSON.stringify({baseOs:"mac",deviceBrand:"",deviceModel:"",appVersion:7,osVersion:"",id:"123"});if("Android"===this.getName())try{return AndroidInterface.getDeviceId()}catch(e){return handleError({message:e.message+" from AndroidInterface.getDeviceId"}),JSON.stringify({baseOs:this.getName(),deviceBrand:"",deviceModel:"",appVersion:6,osVersion:"",id:""})}return this.getIosInfo()}},app={today:function(e){return e?moment().format(e):moment()},tomorrow:function(){return moment(this.today()).add(1,"day")},isNewDay:function(e){var t=localStorage.getItem("today");return"null"===t||null==t?(localStorage.setItem("today",moment().format("YYYY-MM-DD")),!0):!moment(moment().format("YYYY-MM-DD")).isSame(moment(t))&&(localStorage.setItem("today",moment().format("YYYY-MM-DD")),!0)},isCurrentTimeNearStart:function(e){var t=e.attachment["Daily Start Time"].value,a=moment(t,"hh:mm").subtract(15,"minutes"),n=moment(t,"hh:mm").add(15,"minutes");return moment().isBetween(a,n,null,"[]")},isCurrentTimeNearEnd:function(e){var t=e.attachment["Daily End Time"].value,a=moment(t,"hh:mm").subtract(15,"minutes"),n=moment(t,"hh:mm").add(15,"minutes");return moment().isBetween(a,n,null,"[]")}};function backNav(){history.back()}function firebaseUiConfig(t){return{callbacks:{signInSuccessWithAuthResult:function(e){if(t)return document.querySelector("#updateEmailDialog").remove(),updateEmail(e.user,t),!1},signInFailure:function(e){return handleUIError(e)},uiShown:function(){}},signInFlow:"popup",signInOptions:[{provider:firebase.auth.PhoneAuthProvider.PROVIDER_ID,recaptchaParameters:{type:"image",size:"normal",badge:"bottomleft"},defaultCountry:"IN",defaultNationalNumber:t?firebase.auth().currentUser.phoneNumber:""}]}}function userSignedOut(){var e=document.createElement("div");e.id="login-container",document.body.appendChild(e),ui||(ui=new firebaseui.auth.AuthUI(firebase.auth())),ui.start("#login-container",firebaseUiConfig())}function layoutGrid(){var e=document.createElement("div");e.classList.add("mdc-layout-grid","mdc-typography","app"),e.id="main-layout-app";var t=document.createElement("div");t.className="mdc-layout-grid__inner cell-space";var a=document.createElement("div");a.id="header";var n=document.createElement("div");n.id="app-current-panel",n.className="mdc-layout-grid__cell--span-12";var o=document.createElement("div");o.id="snackbar-container";var c=document.createElement("div");c.id="alert--box",a.appendChild(createHeader("app-main-header")),t.appendChild(a),t.appendChild(n),t.appendChild(o),e.appendChild(t),e.appendChild(c),document.body.innerHTML=e.outerHTML,imageViewDialog()}function createCheckInDialog(){var e=document.createElement("aside");e.className="mdc-dialog mdc-dialog--open hidden",e.id="suggest-checkIn-dialog";var t=document.createElement("div");t.className="mdc-dialog__surface",t.style.width="90%",t.style.height="auto";var a=document.createElement("header");a.className="mdc-dialog__header";var n=document.createElement("h2");n.className="mdc-dialog__header__title",n.textContent="Reminder",a.appendChild(n);var o=document.createElement("section");o.className="mdc-dialog__body",o.textContent="Check-in ?";var c=document.createElement("footer");c.className="mdc-dialog__footer";var r=document.createElement("button");r.type="button",r.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--accept",r.textContent="Okay",r.style.backgroundColor="#3498db";var i=document.createElement("button");i.type="button",i.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--cancel",i.textContent="Cancel",i.style.backgroundColor="#3498db",c.appendChild(i),c.appendChild(r),t.appendChild(a),t.appendChild(o),t.appendChild(c),e.appendChild(t);var d=document.createElement("div");return d.className="mdc-dialog__backdrop",e.appendChild(d),e}function createHeader(e){var t=document.createElement("header");t.className="mdc-top-app-bar mdc-top-app-bar--fixed mdc-elevation--z1",t.id=e;var a=document.createElement("div");a.className="mdc-top-app-bar__row";var n=document.createElement("section");n.className="mdc-top-app-bar__section mdc-top-app-bar__section--align-start";var o=document.createElement("div");o.id=e+"view-type",o.className="view-type",n.appendChild(o);var c=document.createElement("div");c.className="mdc-top-app-bar__section mdc-top-app-bar__section--align-end";var r=document.createElement("div");return r.id=e+"action-data",r.className="action-data",c.appendChild(r),a.appendChild(n),a.appendChild(c),t.appendChild(a),t}function imageViewDialog(){var e=document.createElement("aside");e.id="viewImage--dialog-component",e.className="mdc-dialog",e.role="alertdialog";var t=document.createElement("div");t.className="mdc-dialog__surface";var a=document.createElement("section");a.className="mdc-dialog__content";var n=document.createElement("img");n.src="",n.style.width="100%",a.appendChild(n),t.appendChild(a);var o=document.createElement("footer");o.className="mdc-dialog__footer";var c=document.createElement("button");c.type="button",c.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--cancel",c.textContent="cancel",c.style.backgroundColor="#3498db",o.appendChild(c),t.appendChild(o),e.appendChild(t);var r=document.createElement("div");r.className="mdc-dialog__backdrop",e.appendChild(r),document.body.appendChild(e)}function startApp(t){firebase.auth().onAuthStateChanged(function(e){if(!e)return localStorage.setItem("today",null),document.getElementById("main-layout-app").style.display="none",void userSignedOut();localStorage.getItem("error")||localStorage.setItem("error",JSON.stringify({})),t&&createIDBStore(e).then(function(){localStorage.setItem("dbexist",e.uid),init()}).catch(function(e){snacks("Please restart the app"),handleError(e)})})}function getEmployeeDetails(){return new Promise(function(o,c){var r=firebase.auth().currentUser,i=indexedDB.open(r.uid);i.onsuccess=function(){var e=i.result.transaction(["children"]),t=e.objectStore("children"),a=void 0,n=IDBKeyRange.bound(["employee","CONFIRMED"],["employee","PENDING"]);t.index("templateStatus").openCursor(n).onsuccess=function(e){var t=e.target.result;t&&(t.value.attachment["Employee Contact"].value===r.phoneNumber&&(a=t.value),t.continue())},e.oncomplete=function(){o(a)},e.onerror=function(){c({message:e.error.message+" from getEmployeeDetails"})}},i.onerror=function(){c({message:i.error.message+" from getEmployeeDetails"})}})}function isEmployeeOnLeave(){return new Promise(function(c,r){getEmployeeDetails().then(function(n){if(!n)return c(!1);n.onLeave=!1;var o=indexedDB.open(firebase.auth().currentUser.uid);o.onsuccess=function(){var e=o.result.transaction(["calendar"]),t=e.objectStore("calendar"),a=IDBKeyRange.bound(["leave","CONFIRMED",n.office],["leave","PENDING",n.office]);t.index("onLeave").openCursor(a).onsuccess=function(e){var t=e.target.result;t&&(moment(moment().format("YYYY-MM-DD")).isBetween(t.value.start,t.value.end,null,"[]")?n.onLeave=!0:t.continue())},e.oncomplete=function(){c(n)},e.onerror=function(){r({message:e.error.message+" from isEmployeeOnLeave"})}},o.onerror=function(){r({message:o.error.message+" from isEmployeeOnLeave"})}}).catch(function(e){r(e)})})}function createIDBStore(o){return new Promise(function(e,t){var a=indexedDB.open(o.uid,3),n=void 0;a.onupgradeneeded=function(e){(n=a.result).onerror=function(){t({message:n.error.message+" from createIDBStore on upgradeneeded"})},createObjectStores(n,o.uid)},a.onsuccess=function(){e(!0)},a.onerror=function(){console.log(a.error),t({message:a.error.message+" from createIDBStore"})}})}function createObjectStores(e,t){var a=e.createObjectStore("activity",{keyPath:"activityId"});a.createIndex("timestamp","timestamp"),a.createIndex("office","office"),a.createIndex("hidden","hidden");var n=e.createObjectStore("list",{keyPath:"activityId"});n.createIndex("timestamp","timestamp"),n.createIndex("status","status");var o=e.createObjectStore("users",{keyPath:"mobile"});o.createIndex("displayName","displayName"),o.createIndex("isUpdated","isUpdated"),o.createIndex("count","count"),e.createObjectStore("addendum",{autoIncrement:!0}).createIndex("activityId","activityId");var c=e.createObjectStore("subscriptions",{autoIncrement:!0});c.createIndex("office","office"),c.createIndex("template","template"),c.createIndex("officeTemplate",["office","template"]);var r=e.createObjectStore("calendar",{autoIncrement:!0});r.createIndex("activityId","activityId"),r.createIndex("timestamp","timestamp"),r.createIndex("start","start"),r.createIndex("end","end"),r.createIndex("urgent",["status","hidden"]),r.createIndex("onLeave",["template","status","office"]);var i=e.createObjectStore("map",{autoIncrement:!0});i.createIndex("activityId","activityId"),i.createIndex("location","location"),i.createIndex("latitude","latitude"),i.createIndex("longitude","longitude"),i.createIndex("nearby",["status","hidden"]),i.createIndex("byOffice",["office","location"]);var d=e.createObjectStore("children",{keyPath:"activityId"});d.createIndex("template","template"),d.createIndex("office","office"),d.createIndex("templateStatus",["template","status"]),e.createObjectStore("root",{keyPath:"uid"}).put({uid:t,fromTime:0,location:""})}function createNewIndex(){}function removeIDBInstance(o){return new Promise(function(e,t){var a={userMessage:"Please Restart The App",message:""},n=indexedDB.deleteDatabase(o.uid);n.onsuccess=function(){e(!0)},n.onblocked=function(){a.message="Couldnt delete DB because it is busy.App was openend when new code transition took place",t(a)},n.onerror=function(){a.message=n.error.message+" from removeIDBInstance",t(a)}})}function redirect(){firebase.auth().signOut().then(function(){window.location="https://www.growthfile.com"}).catch(function(e){window.location="https://www.growthfile.com",handleError({message:e+" from redirect"})})}function init(){document.getElementById("main-layout-app").style.display="block",openListWithChecks(),requestCreator("now",{device:native.getInfo(),from:"",registerToken:native.getFCMToken()})}function runAppChecks(){window.addEventListener("locationChanged",function(t){isEmployeeOnLeave().then(function(e){detectSuggestCheckinEvent(t.detail,e)}).catch(function(e){handleError(e),detectSuggestCheckinEvent(t.detail)})},!0)}function detectSuggestCheckinEvent(e,t){var a={urgent:!1,nearby:!1};a.checkin=!!t&&!t.onLeave;var n=app.isNewDay();if(e&&n)return a.nearby=!0,a.urgent=!0,void startInitializatioOfList(a);if(e)return a.nearby=!0,void startInitializatioOfList(a);if(n)return a.urgent=!0,localStorage.removeItem("dailyStartTimeCheckIn"),localStorage.removeItem("dailyEndTimeCheckIn"),void startInitializatioOfList(a);t&&(app.isCurrentTimeNearStart(t)?null==localStorage.getItem("dailyStartTimeCheckIn")&&(localStorage.setItem("dailyStartTimeCheckIn",!0),t.onLeave||(a.checkin=!0),startInitializatioOfList(a)):app.isCurrentTimeNearEnd(t)&&null==localStorage.getItem("dailyEndTimeCheckIn")&&(localStorage.setItem("dailyEndTimeCheckIn",!0),t.onLeave||(a.checkin=!0),startInitializatioOfList(a)))}function startInitializatioOfList(e){suggestCheckIn(e.checkin).then(function(){localStorage.removeItem("clickedActivity"),"listView"!==history.state[0]&&history.state||(document.getElementById("activity--list").innerHTML="",listView({urgent:e.urgent,nearby:e.nearby}))}).catch(function(e){handleError(e),document.getElementById("activity--list").innerHTML="",listView({urgent:!1,nearby:!1})})}function openListWithChecks(){listView({urgent:!1,nearby:!1}),runAppChecks(),setInterval(function(){manageLocation().then(function(e){updateLocationInRoot(e).then(locationUpdationSuccess).catch(handleError)}).catch(handleError)},5e3)}window.addEventListener("load",function(){var t="Your Device is Incompatible with Growthfile. Please Upgrade your Android Version";if(window.Worker||window.indexedDB)ui=firebaseui.auth.AuthUI.getInstance(),firebase.initializeApp({apiKey:"AIzaSyCadBqkHUJwdcgKT11rp_XWkbQLFAy80JQ",authDomain:"growthfilev2-0.firebaseapp.com",databaseURL:"https://growthfilev2-0.firebaseio.com",projectId:"growthfilev2-0",storageBucket:"growthfilev2-0.appspot.com",messagingSenderId:"1011478688238"}),moment.updateLocale("en",{calendar:{lastDay:"[yesterday]",sameDay:"LT",nextDay:"[Tomorrow at] LT",lastWeek:"dddd",nextWeek:"dddd [at] LT",sameElse:"L"},longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YY"},months:["January","February","March","April","May","June","July","August","September","October","November","December"]}),window.onpopstate=function(e){if(e.state){if("listView"===e.state[0]){var t=scroll_namespace.count;return t&&(scroll_namespace.size=t),scroll_namespace.count=0,void window[e.state[0]]()}window[e.state[0]](e.state[1],!1)}},layoutGrid(),startApp(!0);else try{AndroidInterface.showDialog("Device Incompatibility",t)}catch(e){handleError({message:e.message+" from showDialog during device Incompatibility check"}),appDialog(t)}}),window.addEventListener("onMessage",function(e){requestCreator("Null",!1)});var notification=new Worker("notification.js"),scroll_namespace={count:0,size:20,skip:!1};function initDomLoad(){document.querySelector(".init-loader")&&document.querySelector(".init-loader").remove(),document.querySelector(".mdc-linear-progress")&&document.querySelector(".mdc-linear-progress").remove(),listPanel(),creatListHeader("Activities"),createActivityIcon()}function listView(t){history.pushState(["listView"],null,null),initDomLoad(),getSizeOfListStore().then(function(e){e?getListViewData(t,e):appendTextContentInListView("No activities Found")}).catch(function(e){handleError({message:e+" from getSizeOfListStore"}),getListViewData(t)})}function getListViewData(e,a){getRootRecord().then(function(t){t.suggestCheckIn&&(document.getElementById("alert--box").innerHTML=createCheckInDialog().outerHTML,showSuggestCheckInDialog()),20<a&&window.addEventListener("scroll",handleScroll,!1),e?notificationWorker("urgent",e.urgent).then(function(){notificationWorker("nearBy",e.nearby).then(function(){fetchActivities(a,t.location)}).catch(function(e){handleError(e),fetchActivities(a,t.location)})}).catch(function(e){handleError(e),fetchActivities(a,t.location)}):fetchActivities(a,t.location)})}function appendTextContentInListView(e){var t=document.createElement("p");t.textContent=e,t.className="no-activity",document.getElementById("activity-list-main").appendChild(t),document.getElementById("activity-list-main").style.boxShadow="none"}function fetchActivities(e,t){e&&e<=20?loadActivitiesFromListStore(t):startCursor(t)}function getSizeOfListStore(){return new Promise(function(t,a){var n=indexedDB.open(firebase.auth().currentUser.uid);n.onsuccess=function(){var e=n.result.transaction(["list"]).objectStore("list").count();e.onsuccess=function(){t(e.result)},e.onerror=function(){a(e.error)}},n.onerror=function(){a(n.error)}})}function updateEl(a,r){var n=indexedDB.open(firebase.auth().currentUser.uid);n.onsuccess=function(){var e=n.result.transaction(["list","activity"]),o=e.objectStore("activity"),t=e.objectStore("list"),c=document.getElementById("activity--list");a.forEach(function(n){document.querySelector(".no-activity")&&document.querySelector(".no-activity").remove(),t.get(n.activityId).onsuccess=function(e){var t=e.target.result,a=document.querySelector('[data-id="'+n.activityId+'"]');a&&a.remove(),t&&(r.location?getActivityDataForList(o,t,r.location).then(function(e){c.insertBefore(e,c.childNodes[0])}):getActivityDataForList(o,t).then(function(e){c.insertBefore(e,c.childNodes[0])}))}})}}function handleScroll(e){getRootRecord().then(function(e){if(window.innerHeight+window.scrollY===document.body.scrollHeight){if(!document.getElementById("activity--list"))return;startCursor(e.location)}})}function loadActivitiesFromListStore(o){var c=indexedDB.open(firebase.auth().currentUser.uid);c.onsuccess=function(){var e=c.result.transaction(["list","activity","root"]),a=e.objectStore("activity"),t=e.objectStore("list").index("timestamp"),n=document.createDocumentFragment();t.openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;t&&(getActivityDataForList(a,t.value,o).then(function(e){n.appendChild(e)}),t.continue())},e.oncomplete=function(){var e=document.getElementById("activity--list");e&&(e.innerHTML="",e.appendChild(n),scrollToActivity())}}}function startCursor(r){console.log(r);var i=indexedDB.open(firebase.auth().currentUser.uid);i.onsuccess=function(){var e=i.result.transaction(["list","activity","root"]),a=e.objectStore("activity"),t=e.objectStore("list").index("timestamp"),n=0,o=scroll_namespace.count,c=document.createDocumentFragment();t.openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;t&&(o?scroll_namespace.skip?(getActivityDataForList(a,t.value,r).then(function(e){c.appendChild(e),n++}),runCursor(t,n)):(scroll_namespace.skip=!0,t.advance(o)):(getActivityDataForList(a,t.value,r).then(function(e){c.appendChild(e),n++}),runCursor(t,n)))},e.oncomplete=function(){var e=document.getElementById("activity--list");e&&(e.appendChild(c),scroll_namespace.count=scroll_namespace.count+scroll_namespace.size,scroll_namespace.skip=!1,scroll_namespace.size=20,scrollToActivity())}}}function runCursor(e,t){t<scroll_namespace.size&&e.continue()}function getActivityDataForList(t,s,l){return new Promise(function(i,e){var d=document.createElement("span");d.className="mdc-list-item__secondary-text",t.get(s.activityId).onsuccess=function(e){var t=e.target.result;if(t){var a=t.schedule,n=t.venue,o=t.status;if("PENDING"===o)d.appendChild(generateLastestSchedule(a));else if(a.length){var c=document.createElement("div");c.textContent=generateTextIfActivityIsNotPending(o),d.appendChild(c)}l&&d.appendChild(generateLatestVenue(n,l));var r=setMarginForSecondLine(d);i(activityListUI(s,r))}}})}function setMarginForSecondLine(e){var t=e.childNodes;return 1<t.length&&t[0].innerHTML&&t[1].innerHTML?e.style.marginTop="-42px":e.style.marginTop="-35px",e}function generateTextIfActivityIsNotPending(e){return{CONFIRMED:"Done",CANCELLED:"Cancelled"}[e]}function generateSecondLine(e,t){var a=document.createElement("div");return a.textContent=e&&t?e+" : "+t:"",a}function generateLastestSchedule(e){var t=void 0;switch(e.length){case 0:t=generateSecondLine("","");break;case 1:var a=getTimeTypeForSingleSchedule(e[0]);t=generateSecondLine(a.name,a.value);break;default:var n=formatDates(e),o=getTimeTypeForMultipleSchedule(sortDatesInAscendingOrderWithPivot({time:moment().valueOf(),pivot:!0},n));t=generateSecondLine(o.name,o.time)}return t}function getTimeTypeForSingleSchedule(e){var t=moment().format("DD-MM-YYYY"),a=moment(e.startTime).format("DD-MM-YYYY"),n={name:e.name,value:""};return a&&e.endTime&&(moment(a).isAfter(moment(t))?n.value=moment(a).calendar():n.value=moment(e.endTime).calendar()),n}function formatDates(e){var t=[];return e.forEach(function(e){t.push({time:e.startTime,name:e.name}),t.push({time:e.endTime,name:e.name})}),t}function sortDatesInAscendingOrderWithPivot(e,t){var a=t.slice();return a.push(e),a.sort(function(e,t){return e.time-t.time})}function getTimeTypeForMultipleSchedule(e){var t=e.slice(),a=positionOfPivot(t);return a===e.length-1?(t[a-1].time=moment(t[a-1].time).calendar(),t[a-1]):(t[a+1].time=moment(t[a+1].time).calendar(),t[a+1])}function positionOfPivot(e){return e.findIndex(function(e){if(e.pivot)return e})}function generateLatestVenue(e,o){var t="";switch(e.length){case 0:t=generateSecondLine("","");break;case 1:t=generateSecondLine(e[0].venueDescriptor,e[0].location);break;default:var c=[];if(e.forEach(function(e){var t=e.geopoint._latitude,a=e.geopoint._longitude;if(t&&a){var n={latitude:t,longitude:a};c.push({distance:calculateDistanceBetweenTwoPoints(n,o),desc:e.venueDescriptor,location:e.location})}}),c.length){var a=sortNearestLocation(c);t=generateSecondLine(a[0].desc,a[0].location)}else t=generateSecondLine("","")}return t}function sortNearestLocation(e){return e.slice().sort(function(e,t){return e.distance-t.distance})}function activityListUI(e,t){var a=document.createElement("li");a.dataset.id=e.activityId,a.onclick=function(){localStorage.setItem("clickedActivity",this.dataset.id),conversation(this.dataset.id,!0)},a.classList.add("mdc-list-item","activity--list-item","mdc-elevation--z1");var n=document.createElement("object");n.data=e.creator.photo||"./img/empty-user.jpg",n.type="image/jpeg",n.className="mdc-list-item__graphic material-icons";var o=document.createElement("img");o.src="./img/empty-user.jpg",o.className="empty-user-list",n.appendChild(o);var c=document.createElement("span");c.classList.add("mdc-list-item__text");var r=document.createElement("span");r.className="mdc-list-item__primary-text bigBlackBold",r.textContent=e.activityName,c.appendChild(r),c.appendChild(t);var i=document.createElement("span");i.classList.add("mdc-list-item__meta"),i.appendChild(generateIconByCondition(e,a));var d=document.createElement("span");d.classList.add("mdc-list-item__secondary-text","status-in-activity",""+e.status),document.createElement("i").className="material-icons";var s=document.createElement("i");s.classList.add("status-cancel","material-icons"),s.appendChild(document.createTextNode("clear"));var l=document.createElement("i");return l.classList.add("status-confirmed","material-icons"),l.appendChild(document.createTextNode("check")),"CONFIRMED"===e.status&&d.appendChild(l),"CANCELLED"===e.status&&d.appendChild(s),i.appendChild(d),a.appendChild(n),a.appendChild(c),a.appendChild(i),a}function generateIconByCondition(e,t){var a=document.createElement("i");if(a.className="material-icons notification",e.urgent)return a.textContent="alarm",a;if(e.nearby)return a.textContent="location_on",a;if(e.count){var n=document.createElement("div"),o=document.createElement("span");return o.textContent=e.count,o.className="count mdc-meta__custom-text",n.appendChild(o),t.classList.add("count-active"),n}var c=document.createElement("div");return c.className="mdc-meta__custom-text",c.style.width="76px",c.style.fontSize="16px",c.textContent=moment(e.timestamp).calendar(),c}function appendActivityListToDom(e){var t=document.getElementById("activity--list");t&&t.appendChild(e)}function getRootRecord(){return new Promise(function(t,a){var n=void 0,o=firebase.auth().currentUser.uid,c=indexedDB.open(o);c.onsuccess=function(){var e=c.result.transaction(["root"],"readwrite");e.objectStore("root").get(o).onsuccess=function(e){var t=e.target.result;n=t||null},e.oncomplete=function(){n?t(n):a({message:"No root record found from getRootRecord"})},e.onerror=function(){a({message:e.error.message+" from getRootRecord"})}},c.onerror=function(){a({message:c.error+" from getRootRecord"})}})}function createActivityIcon(){document.getElementById("create-activity")||getCountOfTemplates().then(function(e){Object.keys(e).length&&createActivityIconDom()}).catch(handleError)}function getCountOfTemplates(){return new Promise(function(t,a){var n=0,o={},c=indexedDB.open(firebase.auth().currentUser.uid);c.onsuccess=function(){var e=c.result.transaction(["subscriptions"],"readonly");e.objectStore("subscriptions").index("office").openCursor(null,"nextunique").onsuccess=function(e){var t=e.target.result;t&&(n++,o[t.value.office]=n,t.continue())},e.oncomplete=function(){t(o)},e.onerror=function(){a({message:e.error.message+" from getCountOfTemplates"})}},c.onerror=function(){a({message:c.error.message+" from getCountOfTemplates"})}})}function createActivityIconDom(){var e=document.getElementById("create-activity--parent"),t=document.createElement("button");t.className="mdc-fab create-activity",t.id="create-activity",t.setAttribute("aria-label","Add");var a=document.createElement("span");a.className="mdc-fab_icon material-icons",a.id="activity-create--icon",a.textContent="add",t.appendChild(a),e.innerHTML=t.outerHTML,document.querySelector(".create-activity").addEventListener("click",function(e){callSubscriptionSelectorUI(e)})}function callSubscriptionSelectorUI(e,t){selectorUI(e,{record:"",store:"subscriptions",suggestCheckIn:t})}function listPanel(){if(!document.getElementById("activity-list-main")){var e=document.createElement("div");e.className="mdc-card panel-card mdc-top-app-bar--fixed-adjust",e.id="activity-list-main";var t=document.createElement("ul");t.className="mdc-list mdc-list--two-line mdc-list--avatar-list",t.id="activity--list",e.appendChild(t);var a=document.createElement("div");a.id="create-activity--parent",e.appendChild(a),document.getElementById("app-current-panel").innerHTML=e.outerHTML}}function creatListHeader(r){var e=indexedDB.open(firebase.auth().currentUser.uid);e.onsuccess=function(){getImageFromNumber(e.result,firebase.auth().currentUser.phoneNumber).then(function(e){var t=document.createElement("div");t.className="profile--icon-header";var a=document.createElement("div");a.id="menu--panel";var n=document.createElement("object");n.className="list-photo-header",n.type="image/jpeg",n.data=e||"./img/empty-user.jpg";var o=document.createElement("img");o.src="./img/empty-user.jpg",o.className="list-photo-header",n.appendChild(o),a.appendChild(n);var c=document.createElement("p");c.textContent=r,a.appendChild(c),t.appendChild(a),modifyHeader({id:"app-main-header",left:t.outerHTML,right:""}),document.querySelector(".list-photo-header").addEventListener("click",function(){profileView(!0)})})}}function scrollToActivity(){var e=localStorage.getItem("clickedActivity");if(document.querySelector('[data-id="'+e+'"]'))return document.querySelector('[data-id="'+e+'"]').scrollIntoView({behavior:"instant",block:"center",inline:"center"}),void localStorage.removeItem("clickedActivity")}function notificationWorker(e,n){return new Promise(function(t,a){notification.postMessage({dbName:firebase.auth().currentUser.uid,type:e,updateTimestamp:n}),notification.onmessage=function(e){t(e.data)},notification.onerror=function(e){a({message:e.message+" from notificationWorker at "+e.lineno})}})}function modifyHeader(e){e.left&&(document.getElementById(e.id+"view-type").innerHTML=e.left);e.right&&(document.getElementById(e.id+"action-data").innerHTML=e.right)}function suggestCheckIn(r){return new Promise(function(o,c){getRootRecord().then(function(a){var n=indexedDB.open(firebase.auth().currentUser.uid);n.onsuccess=function(){var e=n.result.transaction(["root"],"readwrite"),t=e.objectStore("root");a.suggestCheckIn!==r&&(a.suggestCheckIn=r,t.put(a)),e.oncomplete=function(){o(!0)},e.onerror=function(){c({message:e.error.message+" from suggestCheckIn"})}},n.onerror=function(){c({message:n.error+" from suggestCheckIn"})}}).catch(function(e){c(e)})})}function profileView(e){e&&history.pushState(["profileView"],null,null),window.addEventListener&&window.removeEventListener("scroll",handleScroll,!1),document.body.style.backgroundColor="#eeeeee";var c=firebase.auth().currentUser,t=c.uid,r=indexedDB.open(t);r.onsuccess=function(){var a=r.result,n=a.transaction(["root"],"readwrite"),o=n.objectStore("root");o.get(t).onsuccess=function(e){var t=e.target.result;o.put(t),n.oncomplete=function(){createProfileHeader(),createProfilePanel(a).then(function(e){document.getElementById("app-current-panel")&&(document.getElementById("app-current-panel").innerHTML=e.outerHTML,document.getElementById("close-profile--panel").addEventListener("click",function(){backNav()}),"Android"===native.getName()?document.getElementById("uploadProfileImage").addEventListener("click",function(){AndroidInterface.openImagePicker()}):inputFile("uploadProfileImage").addEventListener("change",function(){readUploadedFile()}),changeDisplayName(c),changeEmailAddress(c))})}}}}function inputFile(e){return document.getElementById(e)}function createProfileHeader(){var e=document.createElement("span");e.id="close-profile--panel";var t=document.createElement("i");t.className="material-icons",t.textContent="arrow_back",e.appendChild(t),modifyHeader({id:"app-main-header",left:e.outerHTML})}function createProfilePanel(e){return new Promise(function(v){getImageFromNumber(e,firebase.auth().currentUser.phoneNumber).then(function(e){var t=document.createElement("div");t.id="profile-view--container",t.className="mdc-top-app-bar--fixed-adjust mdc-theme--background";var a=document.createElement("button");a.className="mdc-fab","Android"===native.getName()&&(a.id="uploadProfileImage");var n=document.createElement("label");n.setAttribute("for","uploadProfileImage");var o=document.createElement("span");o.className="mdc-fab__icon material-icons",o.textContent="add_a_photo",n.appendChild(o),a.appendChild(n);var c=void 0;"Android"!==native.getName()&&((c=document.createElement("input")).type="file",c.style.display="none",c.id="uploadProfileImage",c.accept="image/jpeg;");var r=document.createElement("div");r.id="profile--image-container",r.className="profile-container--main";var i=document.createElement("object");i.type="image/jpeg",i.data=e||"./img/empty-user-big.jpg",i.id="user-profile--image";var d=document.createElement("img");d.src="./img/empty-user-big.jpg",d.className="empty-user-profile",i.appendChild(d);var s=document.createElement("div");s.className="insert-overlay",r.appendChild(i),r.appendChild(s),r.appendChild(a),"Android"!==native.getName()&&n.appendChild(c);var l=document.createElement("div");l.id="name--change-container",l.className="profile-psuedo-card";var m=document.createElement("button");m.className="mdc-icon-button material-icons hidden",m.id="edit--name",m.setAttribute("aria-hidden","true"),m.setAttribute("aria-pressed","false"),m.textContent="check";var u=firebase.auth().currentUser.displayName;l.innerHTML='<div class="mdc-text-field" id=\'name-change-field\'>\n        <input autocomplete="off" type="text"  placeholder="'+(u?"":"Enter Your Name")+'"  id="pre-filled-name" class="mdc-text-field__input" value="'+(u||"")+'">\n        <label class="mdc-floating-label mdc-floating-label--float-above" for="pre-filled-name">\n         Your Name\n        </label>\n        <div class="mdc-line-ripple"></div>\n      </div>\n      ',l.appendChild(m);var p=document.createElement("div");p.id="email--change-container",p.className="profile-psuedo-card";var h=document.createElement("button");h.className="mdc-icon-button material-icons hidden",h.id="edit--email",h.setAttribute("aria-hidden","true"),h.setAttribute("aria-pressed","false"),h.textContent="check";var f=firebase.auth().currentUser.email;p.innerHTML='<div class="mdc-text-field" id=\'email-change-field\'>\n        <input  autocomplete="off" type="text" id="pre-filled-email" class="mdc-text-field__input" value="'+(f||"")+'" placeholder="'+(f?"":"Enter your Email")+'">\n        <label class="mdc-floating-label mdc-floating-label--float-above" for="pre-filled-email">\n         Your Email\n        </label>\n        <div class="mdc-line-ripple"></div>\n      </div>\n      ',p.appendChild(h),t.appendChild(r),t.appendChild(l),t.appendChild(p),v(t)})})}function updateEmailDialog(){if(!document.getElementById("updateEmailDialog")){var e=document.createElement("aside");e.className="mdc-dialog mdc-dialog--open",e.id="updateEmailDialog";var t=document.createElement("div");t.className="mdc-dialog__surface",t.style.width="90%",t.style.height="auto";var a=document.createElement("section");a.className="mdc-dialog__body",a.id="refresh-login";var n=document.createElement("footer");n.className="mdc-dialog__footer";var o=document.createElement("button");o.type="button",o.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--cancel update-email-cancel",o.textContent="Cancel",o.style.backgroundColor="#3498db",n.appendChild(o),t.appendChild(a),t.appendChild(n),e.appendChild(t),document.body.appendChild(e)}}function timeDiff(e){var t=moment().format("YYY-MM-DD HH:mm"),a=moment(e).format("YYY-MM-DD HH:mm");return moment(t).diff(moment(a),"minutes")}function newSignIn(e,t){updateEmailDialog();var a=document.querySelector("#updateEmailDialog"),n=new mdc.dialog.MDCDialog(a);n.show();try{ui.start("#refresh-login",firebaseUiConfig(e)),setTimeout(function(){document.querySelector(".firebaseui-id-phone-number").disabled=!0,document.querySelector(".firebaseui-label").remove(),document.querySelector(".firebaseui-title").textContent="Verify your phone Number to Update your Email address"},500),n.listen("MDCDialog:cancel",function(){t.value=firebase.auth().currentUser.email,a.remove()})}catch(e){a.remove(),console.log(e),handleError({message:e.message+" from newSignIn function during email updation"}),snacks("Please try again later")}}function readUploadedFile(e){if("Android"!==native.getName()){var t=inputFile("uploadProfileImage").files[0],a=new FileReader;a.addEventListener("load",function(){sendBase64ImageToBackblaze(a.result)},!1),t&&a.readAsDataURL(t)}else sendBase64ImageToBackblaze(e)}function sendBase64ImageToBackblaze(e){var t=document.getElementById("user-profile--image"),a=document.getElementById("profile--image-container"),n="data:image/jpeg;base64,";t&&(t.data=n+e),a&&document.getElementById("profile--image-container").appendChild(loader("profile--loader")),requestCreator("backblaze",{imageBase64:n+e})}function authUpdatedError(e){"auth/invalid-email"!==e.message&&handleError({message:e.message+" from authUpdatedError"}),document.querySelector(".init-loader")&&document.querySelector(".init-loader").remove(),snacks(e.message)}function changeDisplayName(){var e=document.getElementById("name-change-field"),t=new mdc.textField.MDCTextField(e),a=document.getElementById("edit--name");firebase.auth().currentUser.displayName;e.addEventListener("click",function(){document.getElementById("pre-filled-name").placeholder="",a.classList.remove("hidden"),e.classList.add("short")}),e.addEventListener("keydown",function(e){13==e.keyCode&&updateName(t.value)}),a.addEventListener("click",function(){updateName(t.value)})}function updateName(e){e?firebase.auth().currentUser.updateProfile({displayName:e}).then(successDialog).catch(function(e){snacks("Please Try again later"),handleError({message:e+" at updateProfile in changeDisplayName"})}):snacks("Please Enter a Name")}function changeEmailAddress(){var e=document.getElementById("email-change-field"),t=new mdc.textField.MDCTextField(e),a=document.getElementById("edit--email");e.addEventListener("click",function(){document.getElementById("pre-filled-email").placeholder="",a.classList.remove("hidden"),e.classList.add("short")}),e.addEventListener("keydown",function(e){13==e.keyCode&&emailValidation(t)}),a.addEventListener("click",function(){emailValidation(t)})}function emailValidation(e){var t=firebase.auth().currentUser,a=e.value;a?a!==t.email?timeDiff(t.metadata.lastSignInTime)<=2?updateEmail(t,a):newSignIn(a,e):snacks("You have already set this as your email address"):snacks("Enter a valid Email Id")}function updateEmail(e,t){document.getElementById("growthfile").appendChild(loader("init-loader")),e.updateEmail(t).then(emailUpdateSuccess).catch(authUpdatedError)}function emailUpdateSuccess(){firebase.auth().currentUser.sendEmailVerification().then(emailVerificationSuccess).catch(emailVerificationError)}function emailVerificationSuccess(){successDialog(),snacks("Verification link has been send to your email address")}function emailVerificationError(e){snacks(e.message),document.querySelector(".init-loader")&&document.querySelector(".init-loader").remove(),handleError({message:e.message+" from emailVerificationError"})}function initUserSelectorSearch(a,n){var e=document.getElementById("search--bar-selector"),o=e.value="",c=document.createDocumentFragment(),r={};n.record.assignees.forEach(function(e){r[e]=""}),e.addEventListener("input",function(e){var t=e.target.value;if(isNumber(t))return o=a.transaction("users").objectStore("users"),void searchUsersDB(formatNumber(t),o,c,r,n);c=document.createDocumentFragment(),o=a.transaction("users").objectStore("users").index("displayName"),searchUsersDB(formatName(t),o,c,r,n)})}function isNumber(e){return!isNaN(e)}function formatNumber(e){var t=e;return"91"===t.substring(0,2)?t="+"+t:"+91"!==t.substring(0,3)&&(t="+91"+t),t}function formatName(e){var t=e.split(" "),a=t.length,n=[],o=0;for(o=0;o<a;o++){var c=t[o];if(c.charAt(0).toUpperCase()===e.charAt(0).toUpperCase)return e;n.push(c.charAt(0).toUpperCase()+c.slice(1))}return n.join(" ")}function checkNumber(e){return/^\+[1-9]\d{11,14}$/.test(e)}function searchUsersDB(e,t,o,c,r){console.log(e);var a=IDBKeyRange.bound(e,e+"￿"),i=document.getElementById("data-list--container");t.openCursor(a).onsuccess=function(e){var t=e.target.result;if(!t){if(i.innerHTML="",0!=o.children.length)return i.appendChild(o),void document.querySelectorAll('[data-selected="true"]').forEach(function(e){new mdc.checkbox.MDCCheckbox.attachTo(e).checked=!0,e.children[1].style.animation="none",e.children[1].children[0].children[0].style.animation="none"});var a=document.createElement("div");a.className="data-not-found";var n=document.createElement("p");return n.textContent="No Contact Found",n.className="mdc-typography--headline5",a.appendChild(n),void(document.querySelector(".data-not-found")||i.appendChild(a))}r.attachment.present?o.appendChild(createSimpleAssigneeLi(t.value,!0,!1)):c.hasOwnProperty(t.value.mobile)||o.appendChild(createSimpleAssigneeLi(t.value,!0,!0)),t.continue()}}var apiHandler=new Worker("apiHandler.js");function handleError(e){var t=JSON.parse(localStorage.getItem("error"));if(!t.hasOwnProperty(e.message))return t[e.message]=!0,localStorage.setItem("error",JSON.stringify(t)),e.device=native.getInfo(),e.stack&&(e.stack=e.stack),void requestCreator("instant",JSON.stringify(e))}function loader(e){var t=document.createElement("div");return t.className="loader "+e,t}function successDialog(){var e=document.createElement("aside");e.className="mdc-dialog mdc-dialog--open success--dialog",e.id="success--dialog";var t=document.createElement("div");t.className="mdc-dialog__surface round--surface";var a=document.createElement("section");a.className="mdc-dialog__body";var n=document.createElement("div");n.className="success--container";var o=document.createElement("div");o.className="success--check",n.appendChild(o),a.appendChild(n),t.appendChild(a),e.appendChild(t),document.body.appendChild(e),new mdc.dialog.MDCDialog(document.querySelector("#success--dialog")).show(),setTimeout(function(){document.getElementById("success--dialog").remove(),document.body.classList.remove("mdc-dialog-scroll-lock")},1200),scroll_namespace.count=0,scroll_namespace.size=20,localStorage.removeItem("clickedActivity"),listView({urgent:!1,nearBy:!1})}function appDialog(e,t){if(!document.getElementById("enable-gps")){var a=document.createElement("aside");a.className="mdc-dialog mdc-dialog--open",a.id="enable-gps";var n=document.createElement("div");n.className="mdc-dialog__surface",n.style.width="90%",n.style.height="auto";var o=document.createElement("section");o.className="mdc-dialog__body mock-main-body",o.textContent=e;var c=document.createElement("footer");c.className="mdc-dialog__footer mock-footer";var r=document.createElement("button");r.type="button",r.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--accept",r.textContent="Ok",t||r.classList.add("hidden"),r.style.backgroundColor="#3498db",c.appendChild(r),n.appendChild(o),n.appendChild(c),a.appendChild(n),document.body.appendChild(a)}var i=new mdc.dialog.MDCDialog(document.querySelector("#enable-gps"));i.listen("MDCDialog:accept",function(){listView({nearby:!1,urgent:!1})}),i.show()}function appUpdateDialog(e,t){if(!document.getElementById("app-update-dialog")){var a=document.createElement("aside");a.className="mdc-dialog mdc-dialog--open",a.id="app-update-dialog";var n=document.createElement("div");n.className="mdc-dialog__surface",n.style.width="90%",n.style.height="auto";var o=document.createElement("header");o.className="mdc-dialog__header";var c=document.createElement("h2");c.className="mdc-dialog__header__title",c.textContent=t,o.appendChild(c);var r=document.createElement("section");r.className="mdc-dialog__body",r.textContent=e;var i=document.createElement("footer");i.className="mdc-dialog__footer",n.appendChild(o),n.appendChild(r),n.appendChild(i),a.appendChild(n),document.body.appendChild(a)}new mdc.dialog.MDCDialog(document.querySelector("#app-update-dialog")).show()}function progressBar(){var e=document.createElement("div");e.className="mdc-linear-progress mdc-linear-progress--indeterminate progress--update",e.role="progressbar";var t=document.createElement("div");t.className="mdc-linear-progress__buffering-dots";var a=document.createElement("div");a.className="mdc-linear-progress__buffer";var n=document.createElement("div");n.className="mdc-linear-progress__bar mdc-linear-progress__primary-bar";var o=document.createElement("span");o.className="mdc-linear-progress__bar-inner",n.appendChild(o);var c=document.createElement("div");c.className="mdc-linear-progress__bar mdc-linear-progress__secondary-bar";var r=document.createElement("span");return r.className="mdc-linear-progress__bar-inner",c.appendChild(r),e.appendChild(t),e.appendChild(a),e.appendChild(n),e.appendChild(c),e}function snacks(e,t){var a=document.createElement("div");a.className="mdc-snackbar",a.setAttribute("aria-live","assertive"),a.setAttribute("aria-atomic","true"),a.setAttribute("aria-hidden","true");var n=document.createElement("div");n.className="mdc-snackbar__text mdc-typography--subtitle2";var o=document.createElement("div");o.className="mdc-snackbar__action-wrapper";var c=document.createElement("button");c.className="mdc-snackbar__action-button",o.appendChild(c),a.appendChild(n),a.appendChild(o),document.getElementById("snackbar-container").innerHTML=a.outerHTML;var r={message:e,actionText:t?t.btn:"OK",timeout:1e4,actionHandler:function(){}};mdc.snackbar.MDCSnackbar.attachTo(document.querySelector(".mdc-snackbar")).show(r)}function fetchCurrentTime(e){return Date.now()+e}function geolocationApi(o){return new Promise(function(t,a){var n=new XMLHttpRequest;n.open(o.method,o.url,!0),n.setRequestHeader("Content-Type","application/json"),n.onreadystatechange=function(){if(4===n.readyState){if(400<=n.status)return"notFound"===JSON.parse(n.response).error.errors[0].reason?1===o.retry?a({message:JSON.parse(n.response).error.errors[0].message,body:{cellular:o.body,tries:"Retried 3 times"}}):(o.retry--,void geolocationApi(o).then().catch(function(e){a(e)})):a({message:JSON.parse(n.response).error.errors[0].message,body:o.body});if(!n.responseText)return a({message:"No response text from google",body:o.body});var e=JSON.parse(n.responseText);if(!e)return a({message:"Response text is not parseable",body:o.body});t({latitude:e.location.lat,longitude:e.location.lng,accuracy:e.accuracy,provider:{cellular:JSON.parse(o.body)}})}},n.send(o.body)})}function getCellTowerInfo(){return new Promise(function(t,a){var e="";try{e=AndroidInterface.getCellularData()}catch(e){a({message:e.message+" from getCellularData"})}if(e){geolocationApi({method:"POST",url:"https://www.googleapis.com/geolocation/v1/geolocate?key=AIzaSyCadBqkHUJwdcgKT11rp_XWkbQLFAy80JQ",body:e,retry:3}).then(function(e){t(e)}).catch(function(e){a(e)})}else a({message:"empty cell tower from android."})})}function manageLocation(){return new Promise(function(t,a){"Android"!==native.getName()?html5Geolocation().then(function(e){t(e)}).catch(function(e){a(e)}):getCellTowerInfo().then(function(e){t(e)}).catch(function(e){return handleError(e),html5Geolocation()}).then(function(e){t(e)}).catch(function(e){a({error:e,meta:"Both geolocation and html5 failed to get location"})})})}function html5Geolocation(){return new Promise(function(a,t){var n=[],o=0,c=0,r=setInterval(function(){navigator.geolocation.getCurrentPosition(function(e){if(1!==++o){if(n.push({latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy,provider:"HTML5"}),n[0].latitude.toFixed(3)===e.coords.latitude.toFixed(3)&&n[0].longitude.toFixed(3)===e.coords.longitude.toFixed(3)&&3==++c)return clearInterval(r),r=null,a(n[0]);if(5<=o){clearInterval(r),r=null;var t=sortedByAccuracy(n);return a(t)}}},function(e){clearInterval(r),r=null,t({message:e.message+" from html5Geolocation"})})},500)})}function locationUpdationSuccess(e){if(e.prev.latitude&&e.prev.longitude&&e.new.latitude&&e.new.longitude){var t=new CustomEvent("location",{detail:e.new});window.dispatchEvent(t);var a=calculateDistanceBetweenTwoPoints(e.prev,e.new),n=new CustomEvent("locationChanged",{detail:isLocationMoreThanThreshold(a)});window.dispatchEvent(n)}}function showSuggestCheckInDialog(){var e=document.querySelector("#suggest-checkIn-dialog");if(e){var t=new mdc.dialog.MDCDialog(e);t&&(document.getElementById("dialog--component")||(t.root_.classList.remove("hidden"),t.show(),t.listen("MDCDialog:accept",function(t){getRootRecord().then(function(e){suggestCheckIn(!1).then(function(){isLocationStatusWorking()&&(1===e.offices.length?createTempRecord(e.offices[0],"check-in",{suggestCheckIn:!0}):callSubscriptionSelectorUI(t,!0))})}).catch(console.log)}),t.listen("MDCDialog:cancel",function(e){suggestCheckIn(!1).then(console.log).catch(console.log)})))}}function isDialogOpened(e){var t=document.querySelector(e);return!!t&&t.classList.contains("mdc-dialog--open")}function updateLocationInRoot(i){return new Promise(function(t,n){var o={latitude:"",longitude:"",accuracy:"",provider:"",lastLocationTime:""},c=firebase.auth().currentUser.uid,r=indexedDB.open(c,3);r.onsuccess=function(){var e=r.result.transaction(["root"],"readwrite"),a=e.objectStore("root");a.get(c).onsuccess=function(e){var t=e.target.result;t.location&&(o=t.location),t.location=i,t.location.lastLocationTime=Date.now(),a.put(t)},e.oncomplete=function(){t({prev:o,new:i})},e.onerror=function(){n({message:e.error.message+" from updateLocationInRoot",body:e.error.name})}},r.onerror=function(){n({message:r.error.message+" from updateLocationInRoot",body:r.error.name})}})}function toRad(e){return e*Math.PI/180}function calculateDistanceBetweenTwoPoints(e,t){var a=toRad(t.latitude-e.latitude),n=toRad(t.longitude-e.longitude),o=toRad(t.latitude),c=toRad(e.latitude),r=Math.sin(a/2)*Math.sin(a/2)+Math.sin(n/2)*Math.sin(n/2)*Math.cos(o)*Math.cos(c);return 6371*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))}function isLocationMoreThanThreshold(e){return 1<=e}function isLocationLessThanThreshold(e){return e<=1}function sortedByAccuracy(e){return e.sort(function(e,t){return e.accuracy-t.accuracy})[0]}function sendCurrentViewNameToAndroid(e){if("Android"===native.getName())try{AndroidInterface.startConversation(e)}catch(e){handleError({message:e.message+" from startConversation"})}}var locationPermission={checkGps:function(){try{return AndroidInterface.isGpsEnabled()}catch(e){return handleError({message:e.message+" from isGpsEnabled"}),!0}},checkLocationPermission:function(){try{return AndroidInterface.isLocationPermissionGranted()}catch(e){return handleError({message:e.message+" from isLocationPermissionGranted"}),!0}}};function createAndroidDialog(e,t){try{AndroidInterface.showDialog(e,t)}catch(e){handleError({message:e.message+" from showDialog"}),appDialog(t,!0)}}function isLocationStatusWorking(){if("Android"!==native.getName())return!0;if(locationPermission.checkLocationPermission()){if(AndroidInterface.isConnectionActive())return!0;createAndroidDialog("No Connectivity","Please Check your Internet Connectivity")}else createAndroidDialog("Location Permission","Please Allow Growthfile location access.")}function requestCreator(e,n){var o=firebase.auth().currentUser,c={type:e,body:"",user:{token:"",uid:o.uid,displayName:o.displayName,photoURL:o.photoURL,phoneNumber:o.phoneNumber}};"instant"===e||"now"===e||"Null"===e||"backblaze"===e?o.getIdToken(!1).then(function(e){c.body=n,c.user.token=e,apiHandler.postMessage(c)}).catch(function(e){handleError({message:e.code})}):getRootRecord().then(function(e){var a=e.location,t=isLastLocationOlderThanThreshold(a.lastLocationTime,5);n.timestamp=fetchCurrentTime(e.serverTime),t?handleWaitForLocation(n,c):o.getIdToken(!1).then(function(e){var t={latitude:a.latitude,longitude:a.longitude,accuracy:a.accuracy,provider:a.provider};n.geopoint=t,c.body=n,c.user.token=e,sendRequest(a,c)}).catch(function(e){handleError({message:e.code})})}),apiHandler.onmessage=messageReceiver,apiHandler.onerror=onErrorMessage}function handleWaitForLocation(o,c){window.addEventListener("location",function e(n){firebase.auth().currentUser.getIdToken(!1).then(function(e){var t=n.detail,a={latitude:t.latitude,longitude:t.longitude,accuracy:t.accuracy,provider:t.provider};o.geopoint=a,c.body=o,c.user.token=e,sendRequest(a,c)}).catch(function(e){handleError({message:e.code})}),window.removeEventListener("location",e,!0)},!0)}function sendRequest(e,t){e.latitude&&e.longitude&&e.accuracy?apiHandler.postMessage(t):(appDialog("Fetching Location Please wait.",!0),getRootRecord().then(function(e){var t=void 0;try{t=AndroidInterface.getCellularData()}catch(e){t=e.message}handleError({message:"No location found in indexedDB",body:{deviceInfo:native.getInfo(),storedLocation:e.location,cellTower:t}})}))}function isLastLocationOlderThanThreshold(e,t){var a=moment(moment().valueOf()),n=e;return t<moment.duration(a.diff(n)).asSeconds()}var receiverCaller={initFirstLoad:initFirstLoad,"update-app":updateApp,"revoke-session":revokeSession,notification:successDialog,"android-stop-refreshing":androidStopRefreshing,loadView:loadView,apiFail:apiFail,backblazeRequest:urlFromBase64Image};function messageReceiver(e){receiverCaller[e.data.type](e.data)}function initFirstLoad(t){console.log(t),"listView"===history.state[0]&&(t.msg.hasOwnProperty("activity")&&t.msg.activity.length&&getRootRecord().then(function(e){updateEl(t.msg.activity,e)}),t.msg.hasOwnProperty("template")&&createActivityIcon())}function updateApp(t){if("Android"!==native.getName())webkit.messageHandlers.updateApp.postMessage("Update App");else try{AndroidInterface.updateApp(t.msg)}catch(e){appUpdateDialog("Please Install the Latest version from google play store , to Use Growthfile. After Updating the App, close Growthfile and open again ",JSON.parse(t.msg).message)}}function revokeSession(){firebase.auth().signOut().then(function(){}).catch(function(e){handleError({message:"Sign out error",body:e})})}function apiFail(e){document.getElementById("send-activity")&&(document.getElementById("send-activity").style.display="block"),document.querySelector("header .mdc-linear-progress")&&document.querySelector("header .mdc-linear-progress").remove(),document.querySelector(".loader")&&document.querySelector(".loader").remove(),document.querySelector(".delete-activity")&&(document.querySelector(".delete-activity").style.display="block"),document.querySelector(".undo-delete-loader")&&(document.querySelector(".undo-delete-loader").style.display="block"),document.querySelector(".form-field-status")&&document.querySelector(".form-field-status").classList.contains("hidden")&&document.querySelector(".form-field-status").classList.remove("hidden"),snacks(e.msg.message)}function urlFromBase64Image(e){if(200===e.code&&"profileView"===history.state[0]){var t=document.querySelector("#profile--image-container .profile--loader ");return t&&t.remove(),void(document.getElementById("user-profile--image").src=firebase.auth().currentUser.photoURL)}}function loadView(e){"updateCreateActivity"!==history.state[0]?"profileView"!==history.state[0]&&window[history.state[0]](history.state[1],!1):toggleActionables(history.state[1].activityId)}function androidStopRefreshing(){if("Android"===native.getName())try{AndroidInterface.stopRefreshing(!0)}catch(e){handleError({message:e.message+" from androidStopRefreshing"})}}function onErrorMessage(e){var t={"line-number":e.lineno,file:e.filename};handleError({message:e.message+" from apiHandler.js at "+e.lineno,body:t})}function getInputText(e){return mdc.textField.MDCTextField.attachTo(document.querySelector(e))}function runRead(e){localStorage.getItem("dbexist")&&requestCreator("Null",e)}function removeChildNodes(e){for(;e.firstChild;)e.removeChild(e.firstChild)}