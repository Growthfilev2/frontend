var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function conversation(e,t){window.removeEventListener("scroll",handleScroll,!1),checkIfRecordExists("activity",e).then(function(e){e?(t&&history.pushState(["conversation",e],null,null),fetchAddendumForComment(e)):listView()}).catch(handleError)}function checkIfRecordExists(o,r){return new Promise(function(n,e){var t=firebase.auth().currentUser,a=window.indexedDB.open(t.uid);a.onsuccess=function(){a.result.transaction(o).objectStore(o).get(r).onsuccess=function(e){var t=e.target.result;n(!!t&&r)}},a.onerror=function(){e({message:a.error.message+" from checkIfRecordExists"})}})}function fetchAddendumForComment(a){if(a){var o=firebase.auth().currentUser,r=window.indexedDB.open(o.uid);r.onsuccess=function(){var n=r.result,e=n.transaction(["addendum"],"readonly"),t=e.objectStore("addendum").index("activityId");createHeaderContent(n,a),commentPanel(a),statusChange(n,a),sendCurrentViewNameToAndroid("conversation"),reinitCount(n,a),t.openCursor(a).onsuccess=function(e){var t=e.target.result;t&&(document.getElementById(t.value.addendumId)||createComment(n,t.value,o).then(function(e){document.getElementById("chat-container")&&document.getElementById("chat-container").appendChild(e)}),t.continue())},e.oncomplete=function(){document.querySelector(".activity--chat-card-container")&&(document.querySelector(".activity--chat-card-container").scrollTop=document.querySelector(".activity--chat-card-container").scrollHeight)}}}}function commentPanel(e){if(!document.querySelector(".activity--chat-card-container")){var t=document.createElement("div");t.className="activity--chat-card-container  mdc-top-app-bar--fixed-adjust panel-card";var n=document.createElement("div");n.id="chat-container",n.className="mdc-card reverser-parent";var a=document.createElement("div");a.className="user-comment--container";var o=document.createElement("div");o.className="status--change-cont";var r=document.createElement("div");r.className="comment--container";var c=document.createElement("div");c.className="input--text-padding mdc-text-field mdc-text-field--dense",c.id="write--comment",c.style.width="100%";var i=document.createElement("input");i.className="mdc-text-field__input comment-field mdc-elevation--z4",i.type="text",c.appendChild(i),r.appendChild(c);var d=document.createElement("button");d.classList.add("mdc-fab","mdc-fab--mini","hidden"),d.id="send-chat--input";var s=document.createElement("span");s.classList.add("mdc-fac__icon","material-icons"),s.textContent="send",d.appendChild(s),r.appendChild(d),t.appendChild(n),a.appendChild(r),document.getElementById("app-current-panel").innerHTML=t.outerHTML+o.outerHTML+a.outerHTML,document.querySelector(".comment-field").oninput=function(e){e.target.value&&e.target.value.replace(/\s/g,"").length?showSendCommentButton():hideSendCommentButton()},document.getElementById("send-chat--input").onclick=function(){isLocationStatusWorking()&&sendComment(e)}}}function sendComment(e){requestCreator("comment",{activityId:e,comment:document.querySelector(".comment-field").value}),document.querySelector(".comment-field").value="",hideSendCommentButton()}function hideSendCommentButton(){document.getElementById("send-chat--input").classList.add("hidden"),document.getElementById("write--comment").style.width="100%",document.getElementById("write--comment").style.transition="0.3s ease",document.querySelector(".status--change-cont").style.transition="0.3s ease",document.querySelector(".status--change-cont").style.opacity="1"}function showSendCommentButton(){document.getElementById("send-chat--input").classList.remove("hidden"),document.getElementById("write--comment").style.width="80%",document.querySelector(".status--change-cont").style.opacity="0"}function statusChange(e,t){var s=document.createElement("label");s.setAttribute("for","toggle-status"),s.textContent="Done",e.transaction("activity").objectStore("activity").get(t).onsuccess=function(e){var t=document.querySelector(".status--change-cont"),n=e.target.result;if(!n.canEdit||"CANCELLED"===n.status){var a=document.createElement("span"),o=e.target.result;return a.textContent="Activity "+o.status.toLowerCase(),void(t&&(t.innerHTML=a.outerHTML,t.style.textAlign="center"))}if(0!=n.editable){if(!document.querySelector(".status-check")){var r=document.createElement("div");r.className="mdc-form-field form-field-status";var c=document.createElement("div");c.className="mdc-checkbox status-check";var i=document.createElement("input");i.className="mdc-checkbox__native-control",i.id="toggle-status",i.type="checkbox";var d=document.createElement("div");d.className="mdc-checkbox__background";document.createElement("div").className="mdc-checkbox__mixedmark",d.innerHTML='<svg class="mdc-checkbox__checkmark"\n      viewBox="0 0 24 24">\n      <path class="mdc-checkbox__checkmark-path"\n      fill="none"\n      d="M1.73,12.91 8.1,19.28 22.79,4.59"/>\n      </svg>\n      <div class="mdc-checkbox__mixedmark"></div>',c.appendChild(i),c.appendChild(d),r.appendChild(c),t&&(t.innerHTML=r.outerHTML+s.outerHTML)}document.querySelector(".mdc-checkbox")&&(switchControl=new mdc.checkbox.MDCCheckbox.attachTo(document.querySelector(".mdc-checkbox")),"CONFIRMED"===n.status&&(switchControl.checked=!0),document.querySelector(".mdc-checkbox").onclick=function(){isLocationStatusWorking()?changeStatusRequest(switchControl,n):resetStatusConfirmation(switchControl,n)})}else t&&(t.innerHTML=s.outerHTML+loader("status-loader").outerHTML)}}function resetStatusConfirmation(e,t){"CONFIRMED"===t.status?e.checked=!0:e.checked=!1}function changeStatusRequest(e,t){document.querySelector(".form-field-status").classList.add("hidden"),document.querySelector(".status--change-cont").appendChild(loader("status-loader")),e.checked?requestCreator("statusChange",{activityId:t.activityId,status:"CONFIRMED"}):requestCreator("statusChange",{activityId:t.activityId,status:"PENDING"})}function createComment(e,u,t){var m=!1;return new Promise(function(i){var d=document.createElement("div");d.classList.add("comment-box","talk-bubble","tri-right","round","btm-left"),t.phoneNumber===u.user?d.classList.add("current-user--comment","secondary-color-light"):d.classList.add("other-user--comment","mdc-theme--primary-bg"),d.id=u.addendumId;var s=document.createElement("div");s.classList.add("talktext");var l=document.createElement("p");l.classList.add("user-name--comment","mdc-typography--subtitle2"),getUserRecord(e,u.user).then(function(e){e.displayName?l.textContent=e.displayName:l.textContent=e.mobile;var t=document.createElement("p");t.classList.add("comment","mdc-typography--subtitle2"),t.textContent=u.comment;var n=document.createElement("span");n.className="comment--info";var a=document.createElement("span");a.textContent=moment(u.timestamp).format("DD-MM-YY H:mm"),a.classList.add("comment-date","mdc-typography--caption");var o=document.createElement("div"),r=document.createElement("i");r.classList.add("user-map--span","material-icons"),r.appendChild(document.createTextNode("location_on")),o.onclick=function(e){if(hasMapsApiLoaded()){m=!m;var t={lat:u.location._latitude,lng:u.location._longitude};maps(e,m,u.addendumId,t)}},r.dataset.latitude=u.location._latitude,r.dataset.longitude=u.location._longitude,o.appendChild(r);var c=document.createElement("div");c.className="map-convo",n.appendChild(a),n.appendChild(o),s.appendChild(l),s.appendChild(t),s.appendChild(n),d.appendChild(s),d.appendChild(c),i(d)})})}function getUserRecord(t,a){return new Promise(function(n,e){t.transaction("users").objectStore("users").get(a).onsuccess=function(e){var t=e.target.result;return n(t||{displayName:"",mobile:a,photoURL:""})}})}function hasMapsApiLoaded(){return"object"===("undefined"==typeof google?"undefined":_typeof(google))&&"object"===_typeof(google.maps)}function maps(e,t,n,a){var o="";if(o=e?document.getElementById(n).querySelector(".map-convo"):document.querySelector(".map-detail."+n),!t)return o.style.height="0px",void(e&&(e.target.textContent="location_on"));if(0!==o.children.length)return o.style.height="200px",void(e&&(e.target.textContent="arrow_drop_down"));e&&(e.target.textContent="arrow_drop_down"),o.style.height="200px";var r=new google.maps.Map(o,{zoom:16,center:a,disableDefaultUI:!0});if(!e){var c=document.createElement("div");new MapsCustomControl(c,r,a.lat,a.lng);c.index=1,r.controls[google.maps.ControlPosition.TOP_LEFT].push(c)}new google.maps.Marker({position:a,map:r})}function MapsCustomControl(e,t,n,a){var o=document.createElement("div");o.style.backgroundColor="#fff",o.style.border="2px solid #fff",o.style.borderRadius="3px",o.style.boxShadow="0 2px 6px rgba(0,0,0,.3)",o.style.cursor="pointer",o.style.marginBottom="22px",o.style.textAlign="center",o.style.padding="0px 5px 0px 5px",e.appendChild(o);var r=document.createElement("a");r.href="https://www.google.com/maps?q="+n+","+a,r.className="material-icons",r.style.color="rgb(25,25,25)",r.style.fontSize="16px",r.style.lineHeight="38px",r.style.paddingLeft="5px",r.style.paddingRight="5px",r.style.textDecoration="none",r.innerHTML="open_in_new",o.appendChild(r)}function createHeaderContent(t,e){var n=t.transaction("activity").objectStore("activity"),c=document.createElement("div"),i=document.createElement("div");i.className="back-icon",i.id="back-conv",i.style.float="left";var a=document.createElement("i");a.style.marginRight="5px",a.className="material-icons back-icon--large",a.textContent="arrow_back",i.appendChild(a),n.get(e).onsuccess=function(e){var r=e.target.result;getImageFromNumber(t,r.creator).then(function(e){var t=document.createElement("object");t.data=e||"./img/empty-user.jpg",t.className="header--icon-creator",t.type="image/jpeg";var n=document.createElement("img");n.src="./img/empty-user.jpg",n.className="header--icon-creator",t.appendChild(n),i.appendChild(t);var a=document.createElement("div");a.className="mdc-list-item__text comment-header-primary mdc-typography--subtitle2",a.textContent=r.activityName;var o=document.createElement("span");o.className="mdc-list-item__secondary-text",o.textContent="Click here to see details",a.appendChild(o),c.appendChild(i),c.appendChild(a),modifyHeader({id:"app-main-header",left:c.outerHTML}),document.getElementById("back-conv").addEventListener("click",function(){backNav()}),document.querySelector(".comment-header-primary").addEventListener("click",function(){checkIfRecordExists("activity",r.activityId).then(function(e){e?updateCreateActivity(r):listView()}).catch(handleError)})})}}function reinitCount(e,t){var n=e.transaction(["list"],"readwrite"),a=n.objectStore("list");a.get(t).onsuccess=function(e){var t=e.target.result;t&&(t.count=0,a.put(t))},n.oncomplete=function(){}}function getImageFromNumber(e,t){return new Promise(function(n){e.transaction("users").objectStore("users").get(t).onsuccess=function(e){var t=e.target.result;n(t?t.photoURL:"./img/empty-user.jpg")}})}function selectorUI(e,n){sendCurrentViewNameToAndroid("selector");var t=document.createElement("aside");t.id="dialog--component",t.className="mdc-dialog",t.role="alertdialog";var a=document.createElement("div");a.className="mdc-dialog__surface",a.appendChild(createHeader("dialog--surface-header"));var o=document.createElement("span");o.className="material-icons",o.textContent="search",o.id="selector--search";var r=document.createElement("span");r.className="material-icons dialog--header-back selector--type-"+n.store,r.textContent="arrow_back";var c=document.createElement("section");c.className="mdc-dialog__body--scrollable mdc-top-app-bar--fixed-adjust";var i=document.createElement("ul");i.id="data-list--container",i.className="mdc-list ",c.appendChild(i);var d=document.createElement("footer");d.className="mdc-dialog__footer";var s=document.createElement("button");s.className="mdc-fab mdc-dialog__footer__button mdc-dialog__footer__button--accept selector-send hidden",s.type="button";var l=document.createElement("span");l.className="mdc-fab__icon material-icons","users"===n.store?(l.textContent="add",s.dataset.clicktype="numpad"):l.textContent="send",s.appendChild(l),d.appendChild(s),a.appendChild(c),a.appendChild(d),t.appendChild(a);var u=document.createElement("div");u.className="mdc-dialog__backdrop",t.appendChild(u),document.body.appendChild(t),"subscriptions"===n.store||"children"===n.store?modifyHeader({id:"dialog--surface-header",left:r.outerHTML}):modifyHeader({id:"dialog--surface-header",left:r.outerHTML,right:o.outerHTML}),document.querySelector(".dialog--header-back").addEventListener("click",function(t){t.target.classList.contains("selector--type-users")&&"users-list-back"===t.target.dataset.state?resetSelectedContacts().then(function(e){handleRemoveDialogEvt(t,n)}):removeDialog()}),initializeSelectorWithData(e,n)}function removeDialog(){document.getElementById("dialog--component")&&(document.getElementById("dialog--component").remove(),document.getElementById("growthfile").classList.remove("mdc-dialog-scroll-lock"))}function handleRemoveDialogEvt(e,t){e&&"back-list"===e.target.dataset.type&&(resetSelectorUI(t),removeDialog())}function initializeSelectorWithData(e,t){var n=new mdc.dialog.MDCDialog(document.querySelector("#dialog--component")),a=t.record,o=firebase.auth().currentUser.uid,r=indexedDB.open(o);r.onsuccess=function(){var e=r.result;"map"===t.store&&fillMapInSelector(e,e.transaction([t.store]),n,t);"subscriptions"===t.store&&fillSubscriptionInSelector(e,n,t),"users"===t.store&&(e.transaction(t.store).objectStore(t.store),resetSelectedContacts().then(function(){fillUsersInSelector(t,n)})),"children"===t.store&&fillChildrenInSelector(e.transaction(t.store).objectStore(t.store),a,n,t)},n.lastFocusedTarget=e.target,n.show()}function fillUsersInSelector(a,o){var r=document.getElementById("data-list--container"),c={};a.record.assignees.forEach(function(e){c[e]=""});var i=indexedDB.open(firebase.auth().currentUser.uid);i.onsuccess=function(){var e=i.result,t=e.transaction(["users"]),n=t.objectStore("users");document.querySelector(".selector-send").classList.remove("hidden"),n.openCursor().onsuccess=function(e){var t=e.target.result;if(t){var n=t.value;a.attachment.present?r.appendChild(createSimpleAssigneeLi(n,!0,!1)):c.hasOwnProperty(t.value.mobile)||r.appendChild(createSimpleAssigneeLi(n,!0,!0)),t.continue()}},t.oncomplete=function(){document.querySelectorAll('[data-selected="true"]').forEach(function(e){e&&(new mdc.checkbox.MDCCheckbox.attachTo(e).checked=!0,e.children[1].style.animation="none",e.children[1].children[0].children[0].style.animation="none")}),document.getElementById("selector--search").addEventListener("click",function(){initSearchForSelectors(e,"users",a)}),o.acceptButton_.onclick=function(){if("numpad"===o.acceptButton_.dataset.clicktype)return document.getElementById("selector--search").style.display="none",removeChildNodes(document.getElementById("data-list--container")),document.querySelector(".mdc-dialog__footer").style.display="none",void addNewNumber(a,o);if(a.attachment.present){var e=new mdc.radio.MDCRadio(document.querySelector(".mdc-radio.radio-selected"));updateDomFromIDB(a.record,{hash:"",key:a.attachment.key},{primary:JSON.parse(e.value)}).then(removeDialog).catch(handleError)}else a.record.hasOwnProperty("create")?resetSelectedContacts().then(function(e){updateDomFromIDB(a.record,{hash:"addOnlyAssignees"},{primary:e}).then(removeDialog).catch(handleError)}):isLocationStatusWorking()&&shareReq(a)}}}}function shareReq(t){document.querySelector(".add--assignee-loader").appendChild(loader("user-loader")),document.querySelector(".add--assignee-loader .add--assignee-icon").style.display="none",resetSelectedContacts().then(function(e){requestCreator("share",{activityId:t.record.activityId,share:e}),removeDialog()})}function addNewNumber(n){var e=document.createElement("div");e.className="custom-number--container";var t=document.createElement("input");t.className="mdc-text-field__input",t.id="number-field",t.type="number",t.setAttribute("maxlength","10"),t.setAttribute("size","10"),t.required=!0,t.onkeypress=function(e){return 48<=e.charCode&&e.charCode<=57},t.oninput=function(){this.value.length>this.maxLength?this.value=this.value.slice(0,this.maxLength):this.value.length===this.maxLength?(document.querySelector(".message-field").classList.remove("error-message"),this.classList.add("valid-input"),document.querySelector(".message-field").textContent="",document.getElementById("new-contact").disabled=!1):(document.querySelector(".message-field").classList.add("error-message"),document.querySelector(".message-field").textContent="* Please Enter a valid Number",document.getElementById("new-contact").disabled=!0)};var a=document.createElement("button");a.className="mdc-button",a.textContent="Add Contact",a.id="new-contact",a.onclick=function(){var t=formatNumber(document.getElementById("number-field").value);checkNumber(t)?numberNotExist(t).then(function(e){if(e)return document.getElementById("new-contact").disabled=!0,document.querySelector(".message-field").classList.add("error-message"),void(document.querySelector(".message-field").textContent="* Contact already exist");n.attachment.present?updateDomFromIDB(n.record,{hash:"",key:n.attachment.key},{primary:[t]}).then(removeDialog).catch(handleError):n.record.hasOwnProperty("create")?updateDomFromIDB(n.record,{hash:"addOnlyAssignees"},{primary:[t]}).then(removeDialog).catch(handleError):isLocationVerified()&&newNumberReq(n,t)}):(document.querySelector(".message-field").classList.add("error-message"),document.querySelector(".message-field").textContent="* Please Enter a valid Number",document.getElementById("new-contact").disabled=!0)};var o=document.createElement("p");o.className="mdc-typography--subtitle2 message-field",o.textContent="Enter new phone contact without country code",o.id="helper-message",e.appendChild(t),e.appendChild(o),e.appendChild(a),document.querySelector("#dialog--component section.mdc-dialog__body--scrollable").appendChild(e);new mdc.ripple.MDCRipple.attachTo(document.getElementById("new-contact"))}function newNumberReq(e,t){requestCreator("share",{activityId:e.record.activityId,share:[t]}),removeDialog()}function numberNotExist(a){return new Promise(function(n){var e=firebase.auth().currentUser.uid,t=indexedDB.open(e);t.onsuccess=function(){t.result.transaction("users").objectStore("users").get(a).onsuccess=function(e){var t=e.target.result;n(!!t)}}})}function resetSelectedContacts(){return new Promise(function(a){var o=[],e=firebase.auth().currentUser.uid,t=indexedDB.open(e);t.onsuccess=function(){var n=t.result.transaction(["users"],"readwrite").objectStore("users");n.openCursor().onsuccess=function(e){var t=e.target.result;t?(t.value.isSelected&&(o.push(t.value.mobile),t.value.isSelected=!1,n.put(t.value)),t.continue()):a(o)}}})}function fillMapInSelector(t,e,n,a){if("check-in"===a.record.template){document.getElementById("selector--search").classList.add("hidden");var o=document.getElementById("data-list--container");getRootRecord().then(function(e){checkMapStoreForNearByLocation(a.record.office,e.location).then(function(e){e.forEach(function(e){o.appendChild(createVenueLi(e,!1,a.record,!0))}),handleClickListnersForMap(t,n,a)})})}else getLocationForMapSelector(e,a).then(function(){handleClickListnersForMap(t,n,a)}).catch(console.log)}function getLocationForMapSelector(c,i){return new Promise(function(e,t){var n=document.getElementById("data-list--container"),a=c.objectStore("map"),o=i.record.office,r=IDBKeyRange.bound([o,""],[o,"￿"]);a.index("byOffice").openCursor(r,"nextunique").onsuccess=function(e){var t=e.target.result;t&&(t.value.office===i.record.office&&t.value.location&&n.appendChild(createVenueLi(t.value,!1,i.record,!0)),t.continue())},c.oncomplete=function(){e(!0)},c.onerror=function(){t(c.error)}})}function checkMapStoreForNearByLocation(i,d){return new Promise(function(o,r){var c=indexedDB.open(firebase.auth().currentUser.uid);c.onsuccess=function(){var n=[],e=c.result.transaction(["map"]),t=e.objectStore("map").index("byOffice"),a=IDBKeyRange.bound([i,""],[i,"￿"]);t.openCursor(a,"nextunique").onsuccess=function(e){var t=e.target.result;t&&(t.value.location&&isLocationLessThanThreshold(calculateDistanceBetweenTwoPoints(t.value,d))&&n.push(t.value),t.continue())},e.oncomplete=function(){o(n)},e.onerror=function(){r(e.error)}}})}function handleClickListnersForMap(e,t,a){document.getElementById("selector--search")&&document.getElementById("selector--search").addEventListener("click",function(){initSearchForSelectors(e,"map",a)}),document.querySelector(".selector-send").classList.remove("hidden"),t.acceptButton_.onclick=function(){var e=document.querySelector(".mdc-radio.radio-selected");if(e){var t=new mdc.radio.MDCRadio(e),n=JSON.parse(t.value);updateDomFromIDB(a.record,{hash:"venue",key:a.key},{primary:n.location,secondary:{address:n.address,geopoint:n.geopoint}}).then(removeDialog).catch(handleError)}}}function fillChildrenInSelector(e,n,t,a){var o=document.getElementById("data-list--container");e.openCursor().onsuccess=function(e){var t=e.target.result;t&&(t.value.template===a.attachment.template&&t.value.office===a.attachment.office&&"CANCELLED"!=t.value.status&&(t.value.attachment.Name&&o.appendChild(createSimpleLi("children",t.value.attachment.Name.value)),t.value.attachment.Number&&o.appendChild(createSimpleLi("children",t.value.attachment.Number.value))),t.continue())},document.querySelector(".selector-send").classList.remove("hidden"),t.acceptButton_.onclick=function(){var e=new mdc.radio.MDCRadio(document.querySelector(".mdc-radio.radio-selected")),t=JSON.parse(e.value);updateDomFromIDB(n,{hash:"children",key:a.attachment.key},{primary:t.name}).then(removeDialog).catch(handleError)}}function fillSubscriptionInSelector(e,o,r){var c=document.getElementById("data-list--container"),i=document.createElement("div");i.className="mdc-list-group";var d=[],t=e.transaction(["subscriptions"]);t.objectStore("subscriptions").index("office").openCursor(null,"nextunique").onsuccess=function(e){var t=e.target.result;if(t){var n=document.createElement("h3");n.className="mdc-list-group__subheader subheader--group-small",n.textContent=t.value.office,n.dataset.groupOffice=t.value.office;var a=document.createElement("ul");a.className="mdc-list",a.dataset.selection=t.value.office,a.setAttribute("aria-orientation","vertical"),d.push(t.value.office),i.appendChild(n),i.appendChild(a),t.continue()}},t.oncomplete=function(){if(r.suggestCheckIn){var e=document.getElementById("data-list--container"),t=document.createElement("div");t.className="suggest-checkin--view";var n=document.createElement("span");n.className="material-icons suggestion-icon",n.textContent="add_alert",t.appendChild(n);var a=document.createElement("span");a.textContent="Check-In ?",a.className="suggest-checkin--text",t.appendChild(n),t.appendChild(a),e.insertBefore(t,e.childNodes[0])}insertTemplateByOffice(d,r.suggestCheckIn),c.appendChild(i),o.acceptButton_.onclick=function(){if(isLocationStatusWorking()&&document.querySelector(".mdc-radio.radio-selected")){var e=new mdc.radio.MDCRadio(document.querySelector(".mdc-radio.radio-selected")),t=JSON.parse(e.value);document.getElementById("app-current-panel").dataset.view="create",createTempRecord(t.office,t.template,r)}}}}function insertTemplateByOffice(e,n){var t=indexedDB.open(firebase.auth().currentUser.uid),a=(document.createDocumentFragment(),[]);t.onsuccess=function(){var e=t.result.transaction(["subscriptions"],"readonly");e.objectStore("subscriptions").index("office").openCursor().onsuccess=function(e){var t=e.target.result;if(t)if("CANCELLED"!==t.value.status)if(document.querySelector('[data-selection="'+t.value.office+'"] [data-template="'+t.value.template+'"]'))t.continue();else{if(n&&"check-in"===t.value.template)return a.push(_defineProperty({},t.value.office,createGroupList(t.value.office,t.value.template))),void t.continue();document.querySelector('[data-selection="'+t.value.office+'"]').appendChild(createGroupList(t.value.office,t.value.template)),t.continue()}else t.continue()},e.oncomplete=function(){a.forEach(function(n){Object.keys(n).forEach(function(e){var t=document.querySelector('[data-selection="'+e+'"]');t.insertBefore(n[e],t.childNodes[0])})}),document.querySelector(".selector-send").classList.remove("hidden")}}}function createTempRecord(n,c,e){var t=firebase.auth().currentUser.uid,a=indexedDB.open(t);a.onsuccess=function(){var e=a.result.transaction(["subscriptions"]).objectStore("subscriptions").index("officeTemplate"),t=IDBKeyRange.only([n,c]);e.get(t).onsuccess=function(e){var a=e.target.result;if(a){var n=[];a.schedule.forEach(function(e){var t={};t.name=e,t.startTime="",t.endTime="",n.push(t)});var o={office:a.office,template:a.template,venue:"",schedule:n,attachment:a.attachment,timestamp:Date.now(),canEdit:!0,assignees:[],activityName:a.template.toUpperCase(),create:!0},r=[];"check-in"!==c?(a.venue.forEach(function(e){var t={};t.venueDescriptor=e,t.location="",t.address="",t.geopoint={_latitude:"",_longitude:""},r.push(t)}),o.venue=r,updateCreateActivity(o),removeDialog()):getRootRecord().then(function(e){if(isLastLocationOlderThanThreshold(e.location.lastLocationTime,5))return appDialog("Fetching Location Please wait",!1),void window.addEventListener("location",function e(t){var n=t.detail;document.querySelector("#enable-gps")&&document.querySelector("#enable-gps").remove(),prefillLocationForCheckIn(o,a.venue[0],n),window.removeEventListener("location",e,!0)},!0);prefillLocationForCheckIn(o,a.venue[0],e.location)})}}}}function prefillLocationForCheckIn(o,r,e){checkMapStoreForNearByLocation(o.office,e).then(function(e){var t=[],n={};if(n.venueDescriptor=r,n.location="",n.address="",n.geopoint={_latitude:"",_longitude:""},e.length?n.showIcon=!0:n.showIcon=!1,1===e.length){var a=e[0];n.location=a.location,n.address=a.address,n.geopoint={_latitude:a.latitude,_longitude:a.longitude}}t.push(n),o.venue=t,updateCreateActivity(o),removeDialog()})}function hasAnyValueInChildren(o,r,c){var e=firebase.auth().currentUser.uid,t=indexedDB.open(e);return new Promise(function(a){t.onsuccess=function(){var e=t.result.transaction("children").objectStore("children"),n=0;e.openCursor().onsuccess=function(e){var t=e.target.result;t?(t.value.template===r&&t.value.office===o&&"CANCELLED"!=c&&n++,t.continue()):a(0!==n)}}})}function updateDomFromIDB(i,d,s){return new Promise(function(o,r){var e=firebase.auth().currentUser.uid,c=indexedDB.open(e);c.onsuccess=function(){var t=c.result,n=i;if("venue"===d.hash)return n=updateVenue(n,d,s),changeTextContentForNewSelectedVenue(d,s),void updateLocalRecord(n,t).then(function(e){o(e)}).catch(function(e){r(e)});if("addOnlyAssignees"===d.hash){if(!s.primary.length)return;var a=document.getElementById("assignees--list");return s.primary.forEach(function(e){-1<n.assignees.indexOf(e)||(n.assignees.push(e),getUserRecord(t,e).then(function(e){a&&a.appendChild(createSimpleAssigneeLi(e))}))}),void o(!0)}"weekday"!==d.hash&&d.hasOwnProperty("key")&&(n.attachment[d.key].value=s.primary,updateLocalRecord(n,t).then(function(e){changeTextContentForNewSelectedVenue(d,s),o(e)}).catch(function(e){r(e)}))}})}function updateLocalRecord(r,c){return new Promise(function(e,t){var n=c.transaction(["activity"],"readwrite"),a=n.objectStore("activity"),o=r;o.hasOwnProperty("create")||a.put(o),n.oncomplete=function(){e("activity object store updated with value")},n.onerror=function(){t({message:n.error.message+" from updateLocalRecord"})}})}function changeTextContentForNewSelectedVenue(e,t){var n=document.getElementById(convertKeyToId(e.key));if(n){var a=n.querySelector("[data-primary]"),o=n.querySelector("[data-secondary]"),r=document.getElementById("send-activity");t.primary&&a&&(a.textContent=t.primary),t.hasOwnProperty("secondary")&&o&&(o.textContent=t.secondary.address),r&&(r.dataset.progress||r.classList.remove("hidden"))}}function updateVenue(e,t,n){return e.venue.forEach(function(e){e.venueDescriptor===t.key&&(e.location=n.primary,e.address=n.secondary.address,e.geopoint._latitude=n.secondary.geopoint._latitude,e.geopoint._longitude=n.secondary.geopoint._longitude)}),e}function convertKeyToId(e){return e.replace(/-/g,"--").replace(/\s/g,"-")}function convertIdToKey(e){return e.replace(/-/g," ").replace("  ","-")}function updateCreateContainer(e,t){var n=JSON.parse(e);document.body.style.backgroundColor="#eeeeee";var a=document.createElement("div");a.style.display="inline-flex";var o=document.createElement("span");o.className="material-icons",o.textContent="arrow_back",o.id="backToConv";var r=document.createElement("span");r.textContent=n.activityName,r.style.fontSize="18px",r.style.paddingLeft="10px",r.style.marginTop="6px",a.appendChild(o),a.appendChild(r),modifyHeader({id:"app-main-header",left:a.outerHTML}),document.getElementById("backToConv").addEventListener("click",function(){updateLocalRecord(n,t).then(function(){backNav()}).catch(handleError)});var c=document.createElement("div");c.className="mdc-top-app-bar--fixed-adjust update-create--activity";for(var i=["office","venue","schedule","attachment","assignees"],d=0;d<5;d++){var s=document.createElement("ul");s.className="mdc-list custom--list-margin";var l=document.createElement("div");switch(i[d]){case"office":s.classList.remove("custom--list-margin");break;case"schedule":l.className="mdc-list-group__subheader",l.id="schedule--group";break;case"venue":case"assignees":s.classList.add("mdc-list--two-line","mdc-list--avatar-list")}"schedule"===i[d]?c.appendChild(l):(s.id=i[d]+"--list",c.appendChild(s))}if(n.canEdit){var u=document.createElement("button");u.className="mdc-fab send--activity-fab",u.setAttribute("aria-label","Send"),u.id="send-activity",n.hasOwnProperty("create")||u.classList.add("hidden");var m=document.createElement("span");m.className="mdc-fab__icon material-icons",m.textContent="send",u.appendChild(m),c.appendChild(u)}return c}function updateCreateActivity(c){history.pushState(["updateCreateActivity",c],null,null);var e=firebase.auth().currentUser.uid,i=indexedDB.open(e);i.onsuccess=function(){var e=i.result,t=document.getElementById("app-current-panel"),n=JSON.stringify(c);t.innerHTML=updateCreateContainer(n,e).outerHTML,document.getElementById("office--list").appendChild(createSimpleLi("Office",{office:c.office,showLabel:!0})),createVenueSection(c),createScheduleTable(c),createAttachmentContainer(c),createAssigneeList(c,!0,e),createActivityCancellation(c),document.getElementById("send-activity")&&document.getElementById("send-activity").addEventListener("click",function(){isLocationStatusWorking()&&(this.dataset.progress=!0,sendActivity(c))});for(var a=document.querySelectorAll(".update-create--activity input"),o=0;o<a.length;o++)a[o].addEventListener("input",function(e){document.getElementById("send-activity").dataset.progress||document.getElementById("send-activity").classList.contains("hidden")&&document.getElementById("send-activity").classList.remove("hidden")});if(document.querySelector(".mdc-select")){var r=new mdc.select.MDCSelect(document.querySelector(".mdc-select"));r.listen("change",function(){updateDomFromIDB(c,{hash:"weekday",key:r.root_.dataset.value},{primary:r.value}).then(function(e){document.getElementById("send-activity").dataset.progress||document.getElementById("send-activity").classList.contains("hidden")&&document.getElementById("send-activity").classList.remove("hidden")}).catch(handleError)})}}}function createSimpleLi(e,t){var n=document.createElement("li");n.className="mdc-list-item mdc-ripple-upgraded";var a=document.createElement("span");a.className="detail--static-text";document.createElement("span");var o=document.createElement("span");if("Office"===e&&(o.className="data--value-list",o.textContent=t.office,a.textContent=e,n.appendChild(a),n.appendChild(o)),"children"===e){var r=document.createElement("span");r.className="mdc-list-item__meta",r.appendChild(createRadioInput()),n.textContent=t,n.appendChild(r),n.onclick=function(){checkRadioInput(this,{name:t})}}if("delete"===e&&(o.className="mdc-list-item__graphic material-icons",o.textContent=e,a.classList.remove("detail--static-text"),a.classList.add("delete-activity"),a.textContent=t.text,n.appendChild(o),n.appendChild(a)),"empty"===e&&(n.dataset.prop="delete"),"undo-deleted"===e){o.className="mdc-list-item__graphic material-icons",o.textContent="delete",a.classList.remove("detail--static-text"),a.classList.add("delete-activity"),a.textContent=t.text,n.appendChild(o),n.appendChild(a),n.classList.add("undo-delete-activity");var c=document.createElement("button");c.className="mdc-button mdc-ripple-upgraded mdc-list-item__meta undo-deleted",c.textContent="Undo",c.onclick=function(){isLocationStatusWorking()&&(document.querySelector(".undo-deleted").style.display="none",n.appendChild(loader("undo-delete-loader")),reqForUndoDeleted(t.id))},n.appendChild(c)}return n}function reqForUndoDeleted(e){requestCreator("statusChange",{activityId:e,status:"PENDING"})}function createGroupList(e,t){var n=document.createElement("li");n.className="mdc-list-item transition-ease",n.dataset.template=t;var a=document.createElement("span");a.className="mdc-list-item__text",a.textContent=t.toUpperCase();var o=document.createElement("span");return o.className="mdc-list-item__meta",o.appendChild(createRadioInput()),n.onclick=function(){checkRadioInput(this,{office:e,template:t})},n.appendChild(a),n.appendChild(o),n}function createVenueSection(n){var a=document.getElementById("venue--list");n.venue.forEach(function(e){a.appendChild(createVenueLi(e,!0,n));var t=document.createElement("div");t.className="map-detail "+convertKeyToId(e.venueDescriptor),a.appendChild(t)}),0===n.venue.length&&(document.getElementById("venue--list").style.display="none")}function createVenueLi(n,e,t,a){var o=!1,r=document.createElement("li");r.className="mdc-list-item mdc-ripple-upgraded",r.id=convertKeyToId(n.venueDescriptor);var c=document.createElement("div");c.className="mdc-list-item__text link--span";var i=document.createElement("span");i.className="mdc-list-item__primary-text";var d=document.createElement("span");d.className="mdc-list-item__meta";var s=document.createElement("label");s.className="mdc-fab add--assignee-icon attachment-selector-label";var l=document.createElement("span");if(l.className="mdc-fab__icon material-icons",l.textContent="add_location",s.appendChild(l),e){var u=document.createElement("span");u.className="detail--static-text",u.textContent=n.venueDescriptor;var m=document.createElement("span");m.className="data--value-list",m.textContent=n.location,m.dataset.primary="",i.appendChild(u),i.appendChild(m),c.appendChild(i),c.onclick=function(e){if(hasMapsApiLoaded()&&n.geopoint._latitude&&n.geopoint._longitude){o=!o;var t={lat:n.geopoint._latitude,lng:n.geopoint._longitude};maps("",o,convertKeyToId(n.venueDescriptor),t)}},t.canEdit&&(d.setAttribute("aria-hidden","true"),d.appendChild(s),s.onclick=function(e){selectorUI(e,{record:t,store:"map",attachment:{present:!1},key:n.venueDescriptor})})}else i.textContent=n.location,c.appendChild(i);var p=document.createElement("span");p.className="mdc-list-item__meta material-icons",a&&(p.appendChild(createRadioInput()),r.onclick=function(){checkRadioInput(this,{location:n.location,address:n.address,geopoint:{_latitude:n.latitude,_longitude:n.longitude},venueDesc:n.venueDescriptor})});var h=document.createElement("span");return h.className="mdc-list-item__secondary-text",t.hasOwnProperty("create")?"check-in"!==t.template||a||(n.showIcon?h.textContent=n.address:(h.style.paddingTop="3px",h.textContent="Not A Known Location")):h.textContent=n.address,h.dataset.secondary="",c.appendChild(h),r.appendChild(c),a?r.appendChild(p):"check-in"===t.template?n.showIcon&&r.appendChild(d):r.appendChild(d),r}function createScheduleTable(v){v.schedule.length||(document.getElementById("schedule--group").style.display="none");var g=0;v.schedule.forEach(function(e){g++;var t=document.createElement("h5");t.className="mdc-list-group__subheader label--text",t.textContent=e.name;var n=document.createElement("ul");n.className="mdc-list mdc-list--dense";var a=document.createElement("li");a.className="mdc-list-divider",a.setAttribute("role","separator");var o=document.createElement("li");o.className="mdc-list-item schedule-start-li";var r=document.createElement("div");r.className="mdc-text-field start--date"+g;var c=document.createElement("input");c.value=moment(e.startTime||new Date).format("YYYY-MM-DD"),c.type="date",c.disabled=!v.canEdit,c.className="mdc-text-field__input",r.appendChild(c);var i=document.createElement("span");i.className="mdc-list-item__meta";var d=document.createElement("div");d.className="mdc-text-field start--time"+g;var s=document.createElement("input");s.value=moment(e.startTime||new Date).format("HH:mm"),s.type="time",s.className="time--input",s.disabled=!v.canEdit,s.className="mdc-text-field__input",d.appendChild(s),i.appendChild(d);var l=document.createElement("li");l.className="mdc-list-item schedule-end-li";var u=document.createElement("div");u.className="mdc-text-field end--date"+g;var m=document.createElement("input");m.value=moment(e.endTime||new Date).format("YYYY-MM-DD"),m.type="date",m.disabled=!v.canEdit,m.className="mdc-text-field__input",u.appendChild(m);var p=document.createElement("span");p.className="mdc-list-item__meta";var h=document.createElement("div");h.className="mdc-text-field end--time"+g;var f=document.createElement("input");f.value=moment(e.endTime||new Date).format("HH:mm"),f.type="time",f.disabled=!v.canEdit,f.className="mdc-text-field__input",h.appendChild(f),p.appendChild(h),o.appendChild(r),o.appendChild(i),l.appendChild(u),l.appendChild(p),n.appendChild(o),n.appendChild(a),n.appendChild(l),document.getElementById("schedule--group").appendChild(t),document.getElementById("schedule--group").appendChild(n)})}function createAttachmentContainer(p){["Name","Number","Template","email","phoneNumber","HHMM","weekday","number","base64","string"].forEach(function(e){var t=document.createElement("div");t.className=e+"--group",document.getElementById("attachment--list").appendChild(t)});var h={phoneNumber:"",weekday:"","HH:MM":"",string:"",base64:"",number:"",email:""};Object.keys(p.attachment).forEach(function(t){var n=document.createElement("div");"HH:MM"===p.attachment[t].type?n.className="attachment-field HHMM":n.className="attachment-field "+p.attachment[t].type,n.id=convertKeyToId(t),p.canEdit&&n.classList.add("editable--true");var e=document.createElement("span");if(e.className="label--text","Name"===(e.textContent=t)||"Number"===t){n.appendChild(e);n.appendChild(createSimpleInput(p.attachment[t].value,p.canEdit,"",t,!0))}else"string"===p.attachment[t].type&&(n.appendChild(e),n.appendChild(createSimpleInput(p.attachment[t].value,p.canEdit,"",t)));if("number"===p.attachment[t].type&&(n.appendChild(e),n.appendChild(createNumberInput(p.attachment[t].value,p.canEdit))),"email"===p.attachment[t].type&&(n.appendChild(e),n.appendChild(createEmailInput(p.attachment[t].value,p.canEdit))),"phoneNumber"===p.attachment[t].type){n.classList.add("selector--margin");var a=document.createElement("label");a.className="mdc-fab add--assignee-icon attachment-selector-label";var o=document.createElement("span");o.className="mdc-fab__icon material-icons",o.textContent="person_add",a.appendChild(o);var r=document.createElement("span");r.className="data--value-list",r.dataset.primary="",p.canEdit&&(n.appendChild(a),a.onclick=function(e){selectorUI(e,{record:p,store:"users",attachment:{present:!0,key:t}})}),n.appendChild(e),r.textContent=p.attachment[t].value,n.appendChild(r)}if("HH:MM"==p.attachment[t].type&&(n.appendChild(e),n.appendChild(createTimeInput(p.attachment[t].value,p.canEdit,{simple:!1,type:"time"}))),"weekday"===p.attachment[t].type&&(n.appendChild(e),n.appendChild(createSelectMenu(t,p.attachment[t].value,p.canEdit))),"base64"===p.attachment[t].type){var c=document.createElement("label");c.className="mdc-fab attachment-selector-label add--assignee-icon",c.id="start-camera";var i=document.createElement("span");i.className="mdc-fab__icon material-icons",i.textContent="add_a_photo",c.appendChild(i);var d=document.createElement("ul");d.className="image-preview--attachment mdc-image-list standard-image-list mdc-image-list--with-text-protection",d.appendChild(setFilePath(p.attachment[t].value,t,!0)),n.appendChild(d),p.canEdit&&(n.appendChild(c),n.appendChild(d),c.onclick=function(){readCameraFile()})}if(!h.hasOwnProperty(p.attachment[t].type)){var s=document.createElement("label");s.className="mdc-fab add--assignee-icon attachment-selector-label";var l=document.createElement("span");l.className="mdc-fab__icon material-icons",l.textContent="add",s.appendChild(l),n.appendChild(e);var u=document.createElement("span");u.textContent=p.attachment[t].value,u.className="data--value-list",n.appendChild(u),p.canEdit&&hasAnyValueInChildren(p.office,p.attachment[t].type,p.status).then(function(e){e&&(n.appendChild(s),n.classList.add("selector--margin"),s.onclick=function(e){u.dataset.primary="",selectorUI(e,{record:p,store:"children",attachment:{present:!0,key:t,office:p.office,template:p.attachment[t].type,status:p.status}})})})}var m=document.createElement("hr");m.className="attachment--divider","HH:MM"===p.attachment[t].type?(document.querySelector(".HHMM--group").appendChild(n),document.querySelector(".HHMM--group").appendChild(m)):"Name"===t?(document.querySelector(".Name--group").appendChild(n),document.querySelector(".Name--group").appendChild(m)):h.hasOwnProperty(p.attachment[t].type)?(document.querySelector("."+p.attachment[t].type+"--group").appendChild(n),document.querySelector("."+p.attachment[t].type+"--group").appendChild(m)):(document.querySelector(".Template--group").appendChild(n),document.querySelector(".Template--group").appendChild(m))})}function createAssigneeList(t,e,n){var a=document.getElementById("assignees--list");if(e){var o=document.createElement("li");o.className="mdc-list-item label--text add--assignee-loader",o.textContent="Assignees";var r=document.createElement("span");r.className="mdc-list-item__meta";var c=document.createElement("div");c.className="mdc-fab add--assignee-icon",c.onclick=function(e){selectorUI(e,{record:t,store:"users",attachment:{present:!1}})};var i=document.createElement("span");i.className="mdc-fab__icon material-icons",i.textContent="person_add",c.appendChild(i),r.appendChild(c),t.canEdit&&o.appendChild(r),a.appendChild(o)}t.assignees.forEach(function(e){getUserRecord(n,e).then(function(e){a.appendChild(createSimpleAssigneeLi(e))})})}function createSimpleAssigneeLi(e,t,n){var a=document.createElement("li");if(a.classList.add("mdc-list-item","assignee-li"),!e)return a;a.dataset.value=e.mobile;var o=document.createElement("object");o.data=e.photoURL||"./img/empty-user.jpg",o.type="image/jpeg",o.className="mdc-list-item__graphic";var r=document.createElement("img");r.src="./img/empty-user.jpg",r.className="empty-user-assignee",o.appendChild(r);var c=document.createElement("span");c.classList.add("mdc-list-item__text");var i=document.createElement("span");i.className="mdc-list-item__primary-text";var d=document.createElement("span");d.classList.add("mdc-list-item__secondary-text"),e.displayName?(i.textContent=e.displayName,d.textContent=e.mobile):i.textContent=e.mobile,c.appendChild(i),c.appendChild(d);var s=document.createElement("span");return s.className="mdc-list-item__meta material-icons",t&&(n?s.appendChild(createCheckBox(e)):(s.appendChild(createRadioInput()),a.onclick=function(){checkRadioInput(this,a.dataset.value)})),a.appendChild(o),a.appendChild(c),a.appendChild(s),a}function createRadioInput(){var e=document.createElement("div");e.className="mdc-radio radio-control-selector";var t=document.createElement("input");t.className="mdc-radio__native-control",t.type="radio",t.name="radio";var n=document.createElement("div");n.className="mdc-radio__background";var a=document.createElement("div");a.className="mdc-radio__outer-circle";var o=document.createElement("div");return o.className="mdc-radio__inner-circle",n.appendChild(a),n.appendChild(o),e.appendChild(t),e.appendChild(n),e}function createCheckBox(t){var e=document.createElement("div");e.className="mdc-checkbox status-check",e.dataset.selected=t.isSelected;var n=document.createElement("input");n.className="mdc-checkbox__native-control",n.type="checkbox",n.onclick=function(e){checkCheckboxInput(e,t)};var a=document.createElement("div");a.className="mdc-checkbox__background";return document.createElement("div").className="mdc-checkbox__mixedmark",a.innerHTML='<svg class="mdc-checkbox__checkmark"\n    viewBox="0 0 24 24">\n    <path class="mdc-checkbox__checkmark-path"\n    fill="none"\n    d="M1.73,12.91 8.1,19.28 22.79,4.59"/>\n    </svg>\n    <div class="mdc-checkbox__mixedmark"></div>',e.appendChild(n),e.appendChild(a),e}function checkCheckboxInput(t,n){var e=firebase.auth().currentUser.uid,a=indexedDB.open(e);a.onsuccess=function(){var e=a.result.transaction("users","readwrite").objectStore("users");n.hasOwnProperty("isSelected")&&n.isSelected?(t.target.parentNode.dataset.selected=!1,n.isSelected=!1):(t.target.parentNode.dataset.selected=!0,n.isSelected=!0,document.querySelector(".selector-send span").textContent="send"),e.put(n),0==document.querySelectorAll('[data-selected="true"]').length?(document.querySelector(".selector-send span").textContent="add",document.querySelector(".selector-send").dataset.clicktype="numpad"):document.querySelector(".selector-send").dataset.clicktype=""}}function checkRadioInput(e,t){[].concat(_toConsumableArray(document.querySelectorAll(".radio-selected"))).forEach(function(e){e.classList.remove("radio-selected")});var n=e;if(n){var a=new mdc.radio.MDCRadio(n.querySelector(".radio-control-selector"));a.root_.classList.add("radio-selected"),document.querySelector(".selector-send span").textContent="send",document.querySelector(".selector-send").dataset.clicktype="",a.value=JSON.stringify(t)}}function setFilePath(e,t,n){if(document.querySelector(".image--list-li"))return document.getElementById("attachment-picture").data="data:image/jpg;base64,"+e,document.getElementById("attachment-picture").dataset.value="data:image/jpg;base64,"+e,void(document.getElementById("send-activity").dataset.progress||document.getElementById("send-activity").classList.remove("hidden"));var a=document.createElement("li");a.className="mdc-image-list__item image--list-li";var o=document.createElement("div"),r=document.createElement("object");r.data=e||"./img/placeholder.png",r.type="image/jpeg",r.id="attachment-picture",r.dataset.photoKey=t,r.className="profile-container--main mdc-image-list__image";var c=document.createElement("img");c.src="./img/placeholder.png",c.className="profile-container--main mdc-image-list__image",r.dataset.value=e?r.src=e:(r.data="./img/placeholder.png",""),r.appendChild(c),r.onclick=function(){openImage(this.data)},o.appendChild(r),a.appendChild(o);var i=document.createElement("div");i.className="mdc-image-list__supporting";var d=document.createElement("span");return d.textContent=t,d.className="mdc-image-list__label",d.id="label--image",i.appendChild(d),a.appendChild(i),n?a:void 0}function readCameraFile(){if("Android"===native.getName())try{AndroidInterface.startCamera()}catch(e){handleError({message:e.message+" from startCamera"})}else webkit.messageHandlers.takeImageForAttachment.postMessage("convert image to base 64")}function openImage(e){e&&(document.getElementById("viewImage--dialog-component").querySelector("img").src=e,new mdc.dialog.MDCDialog.attachTo(document.querySelector("#viewImage--dialog-component")).show())}function createActivityCancellation(e){if(e.canEdit){var t=document.createElement("div");if(t.className="status--cancel-cont",!e.hasOwnProperty("create"))if("CANCELLED"!==e.status){if("CANCELLED"!==e.status){if(t.appendChild(createSimpleLi("delete",{text:"CANCEL"})),document.querySelector(".update-create--activity").appendChild(t),!e.canEdit)return;document.getElementById("cancel-alert")||cancelAlertDialog();var n=new mdc.dialog.MDCDialog(document.querySelector("#cancel-alert"));document.getElementById("delete-allow").onclick=function(){isLocationStatusWorking()&&deleteActivityReq(e.activityId)},n.listen("MDCDialog:cancel",function(){}),document.querySelector(".delete-activity").addEventListener("click",function(e){n.lastFocusedTarget=e.target,n.show()})}}else{t.appendChild(createSimpleLi("undo-deleted",{text:"Cancelled",id:e.activityId})),document.querySelector(".update-create--activity").appendChild(t);new mdc.ripple.MDCRipple.attachTo(document.querySelector(".undo-deleted"))}}}function deleteActivityReq(e){document.querySelector(".delete-activity").style.display="none",document.querySelector(".status--cancel-cont li").appendChild(loader("cancel-loader")),requestCreator("statusChange",{activityId:e,status:"CANCELLED"})}function cancelAlertDialog(){var e=document.createElement("aside");e.className="mdc-dialog",e.id="cancel-alert";var t=document.createElement("div");t.className="mdc-dialog__surface";var n=document.createElement("section");n.className="mdc-dialog__body",n.textContent="Are you sure you want to delete this activity ? ";var a=document.createElement("footer");a.className="mdc-dialog__footer";var o=document.createElement("button");o.type="button",o.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--accept delete-btn",o.textContent="Delete",o.id="delete-allow";var r=document.createElement("button");r.type="button",r.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--cancel cancel-delete-btn",r.textContent="Cancel",a.appendChild(r),a.appendChild(o),t.appendChild(n),t.appendChild(a),e.appendChild(t);var c=document.createElement("div");c.className="mdc-dialog__backdrop",e.appendChild(c),document.body.appendChild(e)}function sendActivity(n){if(n.hasOwnProperty("create"))insertInputsIntoActivity(n);else{var e=firebase.auth().currentUser.uid,a=indexedDB.open(e);a.onsuccess=function(e){var t=a.result.transaction("activity","readwrite").objectStore("activity");t.get(n.activityId).onsuccess=function(e){insertInputsIntoActivity(e.target.result,t)}}}}function concatDateWithTime(e,t){var n=moment(e+" "+t);return moment(n).valueOf()}function insertInputsIntoActivity(e,t){for(var n=document.querySelectorAll(".string"),a=0;a<n.length;a++){var o=n[a].querySelector(".mdc-text-field__input").value;if(n[a].querySelector(".mdc-text-field__input").required&&checkSpacesInString(o))return void snacks("Please provide an input for the field “Name” ");e.attachment[convertIdToKey(n[a].id)].value=o}var r=document.querySelectorAll(".number");for(a=0;a<r.length;a++){var c=Number(r[a].querySelector(".mdc-text-field__input").value);e.attachment[convertIdToKey(r[a].id)].value=c}var i=document.querySelectorAll(".email");for(a=0;a<i.length;a++){var d=i[a].querySelector(".mdc-text-field__input").value;e.attachment[convertIdToKey(i[a].id)].value=d}var s=document.querySelectorAll(".HHMM");for(a=0;a<s.length;a++){var l=s[a].querySelector(".mdc-text-field__input").value;e.attachment[convertIdToKey(s[a].id)].value=l}for(var u=document.querySelectorAll(".image-preview--attachment  object"),m=0;m<u.length;m++)e.attachment[convertKeyToId(u[m].dataset.photoKey)].value=u[m].dataset.value;var p=void 0,h=void 0,f=void 0,v=void 0;for(a=1;a<e.schedule.length+1;a++){if(p=getInputText(".start--date"+a).value,h=getInputText(".start--time"+a).value,f=getInputText(".end--date"+a).value,v=getInputText(".end--time"+a).value,!concatDateWithTime(p,h)&&!concatDateWithTime(f,v))return void snacks("Please Select A Start Date and End Date");if(""===p)return void snacks("Please Select a Start Date");if(""===f)return void snacks("Please Select an End Date");if(concatDateWithTime(f,v)<concatDateWithTime(p,h))return void snacks("The End Date and Time should be greater or equal to the start time");e.schedule[a-1].startTime=concatDateWithTime(p,h)||"",e.schedule[a-1].endTime=concatDateWithTime(f,v)||""}for(a=0;a<e.venue.length;a++)e.venue[a].geopoint={latitude:e.venue[a].geopoint._latitude||"",longitude:e.venue[a].geopoint._longitude||""},e.venue[a].hasOwnProperty("showIcon")&&delete e.venue[a].showIcon;sendUpdateReq({venue:e.venue,schedule:e.schedule,attachment:e.attachment},e)}function sendUpdateReq(e,t){if(!t.hasOwnProperty("create"))return e.activityId=t.activityId,document.querySelector("header").appendChild(progressBar()),document.querySelector("#send-activity").classList.add("hidden"),void requestCreator("update",e);e.office=t.office,e.template=t.template,e.share=t.assignees,document.querySelector("header").appendChild(progressBar()),document.querySelector("#send-activity").classList.add("hidden"),requestCreator("create",e)}function checkSpacesInString(e){return!e.replace(/\s/g,"").length}function initSearchForSelectors(e,t,n){if(searchBarUI(t),"map"===t){var a=document.getElementById("search--bar-selector");return autocomplete=new google.maps.places.Autocomplete(a,{componentRestrictions:{country:"in"}}),void initializeAutocompleteGoogle(autocomplete,n.record,n)}"users"===t&&initUserSelectorSearch(e,n)}function searchBarUI(e){var t=document.getElementById("dialog--component"),n=t.querySelector("#dialog--surface-headeraction-data");n.className="search--cont",t.querySelector(".mdc-top-app-bar__section--align-end").classList.add("search-field-transform"),t.querySelector(".mdc-top-app-bar__section--align-start").style.backgroundColor="white",document.getElementById("search--bar--field")?document.getElementById("search--bar--field").style.display="block":n.appendChild(createSimpleInput("",!0,!0)),document.getElementById("selector--search").style.display="none",document.querySelector(".selector-send").dataset.clicktype="",document.querySelector(".selector-send span").textContent="send",t.querySelector("#dialog--surface-headerview-type span").dataset.type="back-list","users"===e&&(t.querySelector("#dialog--surface-headerview-type span").dataset.state="user-list-back"),t.querySelector("#dialog--surface-headerview-type span").style.color="#0399f4"}function resetSelectorUI(e){var t=document.getElementById("dialog--component"),n=t.querySelector("#dialog--surface-headeraction-data");t.querySelector("#dialog--surface-headerview-type span").dataset.type="",t.querySelector(".mdc-top-app-bar__section--align-end").classList.remove("search-field-transform"),n.querySelector("#search--bar--field").classList.remove("field-input"),n.classList.remove("search--cont"),document.getElementById("selector--search").style.display="block",document.querySelector(".selector-send").style.display="block",document.querySelector("#search--bar--field").style.display="none",t.querySelector(".mdc-top-app-bar__section--align-start").style.backgroundColor="#eeeeee",document.getElementById("data-list--container").style.display="block";var a=new mdc.dialog.MDCDialog(t);"users"===e.store&&(document.getElementById("data-list--container").innerHTML="",fillUsersInSelector(e,a)),"subscriptions"===e.store&&document.getElementById("data-list--container").querySelectorAll("li").forEach(function(e){e.style.display="flex"})}function initializeAutocompleteGoogle(a,o,r){document.querySelector("#dialog--component .mdc-dialog__surface").style.width="100vw",document.querySelector("#dialog--component .mdc-dialog__surface").style.height="100vh",a.addListener("place_changed",function(){var e=a.getPlace();if(e.geometry){var t="";e.address_components&&(t=[e.address_components[0]&&e.address_components[0].short_name||"",e.address_components[1]&&e.address_components[1].short_name||"",e.address_components[2]&&e.address_components[2].short_name||""].join(" "));var n={primary:e.name,secondary:{address:t,geopoint:{_latitude:e.geometry.location.lat(),_longitude:e.geometry.location.lng()}}};updateDomFromIDB(o,{hash:"venue",key:r.key},n).then(removeDialog).catch(handleError)}else snacks("Please select a valid location")})}function createSimpleInput(e,t,n,a,o){if(!t){var r=document.createElement("span");return r.className="data--value-list",r.textContent=e,r}var c=document.createElement("div");a&&a.length<15?c.className="mdc-text-field data--value-list":c.className="mdc-text-field data--value-list-small";var i=document.createElement("input");i.className="mdc-text-field__input input--value--update",i.style.paddingTop="0px",i.value=e,i.required=o;var d=document.createElement("div");if(d.className="mdc-line-ripple",n&&(c.id="search--bar--field",i.id="search--bar-selector",c.classList.add("field-input")),c.appendChild(i),c.appendChild(d),c)new mdc.textField.MDCTextField.attachTo(c);return c}function createNumberInput(e,t){if(!t){var n=document.createElement("span");return n.className="data--value-list",n.textContent=e,n}var a=document.createElement("div");a.className="mdc-text-field data--value-list";var o=document.createElement("input");o.className="mdc-text-field__input input--type-number",o.type="number",o.style.paddingTop="0px",o.value=e,o.setAttribute("onkeypress","return event.charCode >= 48 && event.charCode <= 57");var r=document.createElement("div");return r.className="mdc-line-ripple",a.appendChild(o),a.appendChild(r),a}function createEmailInput(e,t){if(!t){var n=document.createElement("span");return n.className="data--value-list",n.textContent=e,n}var a=document.createElement("div");a.className="mdc-text-field data--value-list";var o=document.createElement("input");o.className="mdc-text-field__input input--type-email",o.type="email",o.placeholder="johndoe@example.com",o.style.paddingTop="0px",o.value=e;var r=document.createElement("div");return r.className="mdc-line-ripple",a.appendChild(o),a.appendChild(r),a}function createTimeInput(e,t,n){if(!t){var a=document.createElement("span");return a.className="data--value-list","date"===n.type?a.textContent=moment(e).calendar():a.textContent=e,a}var o=document.createElement("div");o.className="mdc-text-field";var r=document.createElement("input");r.className="mdc-text-field__input input--type-time",r.type=n.type,r.style.borderBottom="none","date"===n.type?r.value=moment(e).format("YYYY-MM-DD"):r.value=e,"time"===n.type&&(o.classList.add("data--value-list"),r.style.width="100%",r.value=e||moment(new Date).format("HH:mm"));var c=document.createElement("div");return c.className="mdc-line-ripple",o.appendChild(r),o.appendChild(c),n.simple?(r.classList.remove("mdc-text-field__input"),r):o}function createSelectMenu(e,t,n){if(!n){var a=document.createElement("span");return a.className="data--value-list",a.textContent=t,a}var o=document.createElement("div");o.className="mdc-select data--value-list",o.style.height="32%;",o.id=convertKeyToId(e),o.dataset.value=e,o.dataset.primary="";var r=document.createElement("select");r.className="mdc-select__native-control",r.style.paddingRight="0px";for(var c=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],i=0;i<c.length;i++){var d=document.createElement("option");d.value=c[i],d.textContent=c[i],t===c[i]&&d.setAttribute("selected","true"),r.appendChild(d)}var s=document.createElement("label");s.className="mdc-floating-label",s.textContent="";var l=document.createElement("div");return l.className="mdc-line-ripple",o.appendChild(s),o.appendChild(r),o.appendChild(l),o}function toggleActionables(e){if(e&&"create"!==document.getElementById("app-current-panel").dataset.view){var t=indexedDB.open(firebase.auth().currentUser.uid);t.onsuccess=function(){t.result.transaction("activity").objectStore("activity").get(e).onsuccess=function(e){var t=e.target.result;if(t){document.querySelectorAll(".mdc-fab");t.editable&&(document.querySelector(".loader")&&(document.querySelector(".loader").remove(),document.querySelector(".add--assignee-loader .add--assignee-icon")&&(document.querySelector(".add--assignee-loader .add--assignee-icon").style.display="block")),document.querySelector(".progress--update")&&document.querySelector(".progress--update").remove())}else listView()}}}}var ui=void 0,native={setFCMToken:function(e){localStorage.setItem("token",e)},getFCMToken:function(){return localStorage.getItem("token")},setName:function(e){localStorage.setItem("deviceType",e)},getName:function(){return localStorage.getItem("deviceType")},setIosInfo:function(e){var t=e.split("&"),n={baseOs:t[0],deviceBrand:t[1],deviceModel:t[2],appVersion:Number(t[3]),osVersion:t[4],id:t[5],initConnection:t[6]};localStorage.setItem("iosUUID",JSON.stringify(n))},getIosInfo:function(){return localStorage.getItem("iosUUID")},getInfo:function(){if(!this.getName())return!1;if("Android"===this.getName())try{return AndroidInterface.getDeviceId()}catch(e){return handleError({message:e.message+" from AndroidInterface.getDeviceId"}),JSON.stringify({baseOs:this.getName(),deviceBrand:"",deviceModel:"",appVersion:7,osVersion:"",id:""})}return this.getIosInfo()}},app={today:function(e){return e?moment().format(e):moment()},tomorrow:function(){return moment(this.today()).add(1,"day")},isNewDay:function(e){var t=localStorage.getItem("today");return"null"===t||null==t?(localStorage.setItem("today",moment().format("YYYY-MM-DD")),!0):!moment(moment().format("YYYY-MM-DD")).isSame(moment(t))&&(localStorage.setItem("today",moment().format("YYYY-MM-DD")),!0)},isCurrentTimeNearStart:function(e){var t=e.attachment["Daily Start Time"].value,n=moment(t,"hh:mm").subtract(15,"minutes"),a=moment(t,"hh:mm").add(15,"minutes");return moment().isBetween(n,a,null,"[]")},isCurrentTimeNearEnd:function(e){var t=e.attachment["Daily End Time"].value,n=moment(t,"hh:mm").subtract(15,"minutes"),a=moment(t,"hh:mm").add(15,"minutes");return moment().isBetween(n,a,null,"[]")}};function backNav(){history.back()}function firebaseUiConfig(t){return{callbacks:{signInSuccessWithAuthResult:function(e){if(t)return document.querySelector("#updateEmailDialog").remove(),updateEmail(e.user,t),!1},signInFailure:function(e){return handleUIError(e)},uiShown:function(){}},signInFlow:"popup",signInOptions:[{provider:firebase.auth.PhoneAuthProvider.PROVIDER_ID,recaptchaParameters:{type:"image",size:"normal",badge:"bottomleft"},defaultCountry:"IN",defaultNationalNumber:t?firebase.auth().currentUser.phoneNumber:""}]}}function userSignedOut(){var e=document.createElement("div");e.id="login-container",document.body.appendChild(e),ui||(ui=new firebaseui.auth.AuthUI(firebase.auth())),ui.start("#login-container",firebaseUiConfig())}function layoutGrid(){var e=document.createElement("div");e.classList.add("mdc-layout-grid","mdc-typography","app"),e.id="main-layout-app";var t=document.createElement("div");t.className="mdc-layout-grid__inner cell-space";var n=document.createElement("div");n.id="header";var a=document.createElement("div");a.id="app-current-panel",a.className="mdc-layout-grid__cell--span-12";var o=document.createElement("div");o.id="snackbar-container";var r=document.createElement("div");r.id="alert--box",n.appendChild(createHeader("app-main-header")),t.appendChild(n),t.appendChild(a),t.appendChild(o),e.appendChild(t),e.appendChild(r),document.body.innerHTML=e.outerHTML,imageViewDialog()}function createCheckInDialog(){var e=document.createElement("aside");e.className="mdc-dialog mdc-dialog--open hidden",e.id="suggest-checkIn-dialog";var t=document.createElement("div");t.className="mdc-dialog__surface",t.style.width="90%",t.style.height="auto";var n=document.createElement("header");n.className="mdc-dialog__header";var a=document.createElement("h2");a.className="mdc-dialog__header__title",a.textContent="Reminder",n.appendChild(a);var o=document.createElement("section");o.className="mdc-dialog__body",o.textContent="Check-in ?";var r=document.createElement("footer");r.className="mdc-dialog__footer";var c=document.createElement("button");c.type="button",c.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--accept",c.textContent="Okay",c.style.backgroundColor="#3498db";var i=document.createElement("button");i.type="button",i.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--cancel",i.textContent="Cancel",i.style.backgroundColor="#3498db",r.appendChild(i),r.appendChild(c),t.appendChild(n),t.appendChild(o),t.appendChild(r),e.appendChild(t);var d=document.createElement("div");return d.className="mdc-dialog__backdrop",e.appendChild(d),e}function createHeader(e){var t=document.createElement("header");t.className="mdc-top-app-bar mdc-top-app-bar--fixed mdc-elevation--z1",t.id=e;var n=document.createElement("div");n.className="mdc-top-app-bar__row";var a=document.createElement("section");a.className="mdc-top-app-bar__section mdc-top-app-bar__section--align-start";var o=document.createElement("div");o.id=e+"view-type",o.className="view-type",a.appendChild(o);var r=document.createElement("div");r.className="mdc-top-app-bar__section mdc-top-app-bar__section--align-end";var c=document.createElement("div");return c.id=e+"action-data",c.className="action-data",r.appendChild(c),n.appendChild(a),n.appendChild(r),t.appendChild(n),t}function imageViewDialog(){var e=document.createElement("aside");e.id="viewImage--dialog-component",e.className="mdc-dialog",e.role="alertdialog";var t=document.createElement("div");t.className="mdc-dialog__surface";var n=document.createElement("section");n.className="mdc-dialog__content";var a=document.createElement("img");a.src="",a.style.width="100%",n.appendChild(a),t.appendChild(n);var o=document.createElement("footer");o.className="mdc-dialog__footer";var r=document.createElement("button");r.type="button",r.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--cancel",r.textContent="cancel",r.style.backgroundColor="#3498db",o.appendChild(r),t.appendChild(o),e.appendChild(t);var c=document.createElement("div");c.className="mdc-dialog__backdrop",e.appendChild(c),document.body.appendChild(e)}function startApp(t){firebase.auth().onAuthStateChanged(function(e){if(!e)return document.getElementById("main-layout-app").style.display="none",void userSignedOut();t&&init(e)})}function getEmployeeDetails(){return new Promise(function(o,r){var c=firebase.auth().currentUser,i=indexedDB.open(c.uid);i.onsuccess=function(){var e=i.result.transaction(["children"]),t=e.objectStore("children"),n=void 0,a=IDBKeyRange.bound(["employee","CONFIRMED"],["employee","PENDING"]);t.index("templateStatus").openCursor(a).onsuccess=function(e){var t=e.target.result;t&&(t.value.attachment["Employee Contact"].value===c.phoneNumber&&(n=t.value),t.continue())},e.oncomplete=function(){o(n)},e.onerror=function(){r({message:e.error.message+" from getEmployeeDetails"})}},i.onerror=function(){r({message:i.error.message+" from getEmployeeDetails"})}})}function isEmployeeOnLeave(){return new Promise(function(r,c){getEmployeeDetails().then(function(a){if(!a)return r(!1);a.onLeave=!1;var o=indexedDB.open(firebase.auth().currentUser.uid);o.onsuccess=function(){var e=o.result.transaction(["calendar"]),t=e.objectStore("calendar"),n=IDBKeyRange.bound(["leave","CONFIRMED",a.office],["leave","PENDING",a.office]);t.index("onLeave").openCursor(n).onsuccess=function(e){var t=e.target.result;t&&(moment(moment().format("YYYY-MM-DD")).isBetween(t.value.start,t.value.end,null,"[]")?a.onLeave=!0:t.continue())},e.oncomplete=function(){r(a)},e.onerror=function(){c({message:e.error.message+" from isEmployeeOnLeave"})}},o.onerror=function(){c({message:o.error.message+" from isEmployeeOnLeave"})}}).catch(function(e){c(e)})})}function idbVersionLessThan3(o){return new Promise(function(e,t){var n=indexedDB.open(o.uid,3),a={value:!1,version:""};n.onupgradeneeded=function(e){switch(e.oldVersion){case 1:a.value=!0,a.version=1;break;case 2:value=!1,a.version=2,n.transaction.objectStore("calendar").createIndex("onLeave",["template","status","office"]),n.transaction.objectStore("children").createIndex("templateStatus",["template","status"]),n.transaction.objectStore("map").createIndex("byOffice",["office","location"]);break;case 3:value=!1,a.version=3;break;default:a.value=!0,a.version=""}},n.onsuccess=function(){n.result.close(),e(a)},n.onerror=function(){t({message:n.error.message+" from idbVersionLessThan3"})}})}function createNewIndex(){}function removeIDBInstance(o){return new Promise(function(e,t){var n={userMessage:"Please Restart The App",message:""},a=indexedDB.deleteDatabase(o.uid);a.onsuccess=function(){e(!0)},a.onblocked=function(){n.message="Couldnt delete DB because it is busy.App was openend when new code transition took place",t(n)},a.onerror=function(){n.message=a.error.message+" from removeIDBInstance",t(n)}})}function redirect(){firebase.auth().signOut().then(function(){window.location="https://www.growthfile.com"}).catch(function(e){window.location="https://www.growthfile.com",handleError({message:e+" from redirect"})})}function init(t){native.getName()?(document.getElementById("main-layout-app").style.display="block",idbVersionLessThan3(t).then(function(e){if(localStorage.getItem("dbexist"))return from=1,e.value?void resetApp(t,from):(requestCreator("now",{device:native.getInfo(),from:"",registerToken:native.getFCMToken()}),void openListWithChecks());resetApp(t,0)}).catch(handleError)):redirect()}function resetApp(e,t){removeIDBInstance(e).then(function(){localStorage.removeItem("dbexist"),history.pushState(null,null,null),document.getElementById("growthfile").appendChild(loader("init-loader")),setTimeout(function(){snacks("Growthfile is Loading. Please Wait")},1e3),requestCreator("now",{device:native.getInfo(),from:t,registerToken:native.getFCMToken()})}).catch(function(e){snacks(e.userMessage),handleError(e)})}function runAppChecks(){window.addEventListener("locationChanged",function(t){isEmployeeOnLeave().then(function(e){detectSuggestCheckinEvent(t.detail,e)}).catch(function(e){handleError(e),detectSuggestCheckinEvent(t.detail)})},!0)}function detectSuggestCheckinEvent(e,t){var n={urgent:!1,nearby:!1};n.checkin=!!t&&!t.onLeave;var a=app.isNewDay();if(e&&a)return n.nearby=!0,n.urgent=!0,void startInitializatioOfList(n);if(e)return n.nearby=!0,void startInitializatioOfList(n);if(a)return n.urgent=!0,localStorage.removeItem("dailyStartTimeCheckIn"),localStorage.removeItem("dailyEndTimeCheckIn"),void startInitializatioOfList(n);t&&(app.isCurrentTimeNearStart(t)?null==localStorage.getItem("dailyStartTimeCheckIn")&&(localStorage.setItem("dailyStartTimeCheckIn",!0),t.onLeave||(n.checkin=!0),startInitializatioOfList(n)):app.isCurrentTimeNearEnd(t)&&null==localStorage.getItem("dailyEndTimeCheckIn")&&(localStorage.setItem("dailyEndTimeCheckIn",!0),t.onLeave||(n.checkin=!0),startInitializatioOfList(n)))}function startInitializatioOfList(e){suggestCheckIn(e.checkin).then(function(){localStorage.removeItem("clickedActivity"),"listView"!==history.state[0]&&history.state||listView({urgent:e.urgent,nearby:e.nearby})}).catch(function(e){handleError(e),listView({urgent:!1,nearby:!1})})}function openListWithChecks(){listView({urgent:!1,nearby:!1}),runAppChecks(),setInterval(function(){manageLocation().then(function(e){updateLocationInRoot(e).then(locationUpdationSuccess).catch(handleError)}).catch(handleError)},5e3)}window.addEventListener("load",function(){this.localStorage.getItem("error")||this.localStorage.setItem("error",JSON.stringify({}));var t="Your Device is Incompatible with Growthfile. Please Upgrade your Android Version";if(window.Worker||window.indexedDB)firebase.initializeApp({apiKey:"AIzaSyCoGolm0z6XOtI_EYvDmxaRJV_uIVekL_w",authDomain:"growthfilev2-0.firebaseapp.com",databaseURL:"https://growthfilev2-0.firebaseio.com",projectId:"growthfilev2-0",storageBucket:"growthfilev2-0.appspot.com",messagingSenderId:"1011478688238"}),ui=firebaseui.auth.AuthUI.getInstance(),moment.updateLocale("en",{calendar:{lastDay:"[yesterday]",sameDay:"LT",nextDay:"[Tomorrow at] LT",lastWeek:"dddd",nextWeek:"dddd [at] LT",sameElse:"L"},longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YY"},months:["January","February","March","April","May","June","July","August","September","October","November","December"]}),window.onpopstate=function(e){if(e.state){if("listView"===e.state[0]){var t=scroll_namespace.count;return scroll_namespace.size=t,scroll_namespace.count=0,void window[e.state[0]]()}window[e.state[0]](e.state[1],!1)}},layoutGrid(),startApp(!0);else try{AndroidInterface.showDialog("Device Incompatibility",t)}catch(e){handleError({message:e.message+" from showDialog during device Incompatibility check"}),appDialog(t)}}),window.addEventListener("onMessage",function(e){requestCreator("Null",!1)});var notification=new Worker("notification.js"),scroll_namespace={count:0,size:20,skip:!1};function initDomLoad(){document.querySelector(".init-loader")&&document.querySelector(".init-loader").remove(),document.querySelector(".mdc-linear-progress")&&document.querySelector(".mdc-linear-progress").remove(),listPanel(),creatListHeader("Activities"),createActivityIcon()}function listView(n){history.pushState(["listView"],null,null),initDomLoad(),getSizeOfListStore().then(function(e){if(!e){var t=document.createElement("p");return t.textContent="No Activities Found",t.className="no-activity",document.getElementById("activity-list-main").appendChild(t),void(document.getElementById("activity-list-main").style.boxShadow="none")}getListViewData(n,e)}).catch(function(e){handleError({message:e+" from getSizeOfListStore"}),getListViewData(n)})}function getListViewData(e,n){getRootRecord().then(function(t){t.suggestCheckIn&&(document.getElementById("alert--box").innerHTML=createCheckInDialog().outerHTML,showSuggestCheckInDialog()),window.addEventListener("scroll",handleScroll,!1),e?notificationWorker("urgent",e.urgent).then(function(){notificationWorker("nearBy",e.nearby).then(function(){fetchActivities(n,t.location)}).catch(function(e){handleError(e),fetchActivities(n,t.location)})}).catch(function(e){handleError(e),fetchActivities(n,t.location)}):fetchActivities(n,t.location)})}function fetchActivities(e,t){e&&e<=20?loadActivitiesFromListStore(t):startCursor(t)}function getSizeOfListStore(){return new Promise(function(t,n){var a=indexedDB.open(firebase.auth().currentUser.uid);a.onsuccess=function(){var e=a.result.transaction(["list"]).objectStore("list").count();e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}},a.onerror=function(){n(a.error)}})}function updateEl(n,c){var a=indexedDB.open(firebase.auth().currentUser.uid);a.onsuccess=function(){var e=a.result.transaction(["list","activity"]),o=e.objectStore("activity"),t=e.objectStore("list"),r=document.getElementById("activity--list");n.forEach(function(a){t.get(a.activityId).onsuccess=function(e){var t=e.target.result,n=document.querySelector('[data-id="'+a.activityId+'"]');n&&n.remove(),t&&getActivityDataForList(o,t,c).then(function(e){r.insertBefore(e,r.childNodes[0])})}})}}function handleScroll(e){getRootRecord().then(function(e){if(window.innerHeight+window.scrollY===document.body.scrollHeight){if(!document.getElementById("activity--list"))return;startCursor(e.location)}})}function loadActivitiesFromListStore(o){var r=indexedDB.open(firebase.auth().currentUser.uid);r.onsuccess=function(){var e=r.result.transaction(["list","activity","root"]),n=e.objectStore("activity"),t=e.objectStore("list").index("timestamp"),a=document.createDocumentFragment();t.openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;t&&(getActivityDataForList(n,t.value,o).then(function(e){a.appendChild(e)}),t.continue())},e.oncomplete=function(){var e=document.getElementById("activity--list");e&&(e.appendChild(a),scrollToActivity())}}}function startCursor(c){var i=indexedDB.open(firebase.auth().currentUser.uid);i.onsuccess=function(){var e=i.result.transaction(["list","activity","root"]),n=e.objectStore("activity"),t=e.objectStore("list").index("timestamp"),a=0,o=scroll_namespace.count,r=document.createDocumentFragment();t.openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;t&&(o?scroll_namespace.skip?(getActivityDataForList(n,t.value,c).then(function(e){r.appendChild(e),a++}),runCursor(t,a)):(scroll_namespace.skip=!0,t.advance(o)):(getActivityDataForList(n,t.value,c).then(function(e){r.appendChild(e),a++}),runCursor(t,a)))},e.oncomplete=function(){var e=document.getElementById("activity--list");e&&(e.appendChild(r),scroll_namespace.count=scroll_namespace.count+scroll_namespace.size,scroll_namespace.skip=!1,scroll_namespace.size=20,scrollToActivity())}}}function runCursor(e,t){t<scroll_namespace.size&&e.continue()}function getActivityDataForList(t,s,l){return new Promise(function(i,e){var d=document.createElement("span");d.className="mdc-list-item__secondary-text",t.get(s.activityId).onsuccess=function(e){var t=e.target.result;if(t){var n=t.schedule,a=t.venue,o=t.status;if("PENDING"===o)d.appendChild(generateLastestSchedule(n));else if(n.length){var r=document.createElement("div");r.textContent=generateTextIfActivityIsNotPending(o),d.appendChild(r)}d.appendChild(generateLatestVenue(a,l));var c=setMarginForSecondLine(d);i(activityListUI(s,c))}}})}function setMarginForSecondLine(e){var t=e.childNodes;return 1<t.length&&t[0].innerHTML&&t[1].innerHTML?e.style.marginTop="-42px":e.style.marginTop="-35px",e}function generateTextIfActivityIsNotPending(e){return{CONFIRMED:"Done",CANCELLED:"Cancelled"}[e]}function generateSecondLine(e,t){var n=document.createElement("div");return n.textContent=e&&t?e+" : "+t:"",n}function generateLastestSchedule(e){var t=void 0;switch(e.length){case 0:t=generateSecondLine("","");break;case 1:var n=getTimeTypeForSingleSchedule(e[0]);t=generateSecondLine(n.name,n.value);break;default:var a=formatDates(e),o=getTimeTypeForMultipleSchedule(sortDatesInAscendingOrderWithPivot({time:moment().valueOf(),pivot:!0},a));t=generateSecondLine(o.name,o.time)}return t}function getTimeTypeForSingleSchedule(e){var t=moment().format("DD-MM-YYYY"),n=moment(e.startTime).format("DD-MM-YYYY"),a={name:e.name,value:""};return n&&e.endTime&&(moment(n).isAfter(moment(t))?a.value=moment(n).calendar():a.value=moment(e.endTime).calendar()),a}function formatDates(e){var t=[];return e.forEach(function(e){t.push({time:e.startTime,name:e.name}),t.push({time:e.endTime,name:e.name})}),t}function sortDatesInAscendingOrderWithPivot(e,t){var n=t.slice();return n.push(e),n.sort(function(e,t){return e.time-t.time})}function getTimeTypeForMultipleSchedule(e){var t=e.slice(),n=positionOfPivot(t);return n===e.length-1?(t[n-1].time=moment(t[n-1].time).calendar(),t[n-1]):(t[n+1].time=moment(t[n+1].time).calendar(),t[n+1])}function positionOfPivot(e){return e.findIndex(function(e){if(e.pivot)return e})}function generateLatestVenue(e,o){var t="";switch(e.length){case 0:t=generateSecondLine("","");break;case 1:t=generateSecondLine(e[0].venueDescriptor,e[0].location);break;default:var r=[];if(e.forEach(function(e){var t=e.geopoint._latitude,n=e.geopoint._longitude;if(t&&n){var a={latitude:t,longitude:n};r.push({distance:calculateDistanceBetweenTwoPoints(a,o),desc:e.venueDescriptor,location:e.location})}}),r.length){var n=sortNearestLocation(r);t=generateSecondLine(n[0].desc,n[0].location)}else t=generateSecondLine("","")}return t}function sortNearestLocation(e){return e.slice().sort(function(e,t){return e.distance-t.distance})}function activityListUI(e,t){var n=document.createElement("li");n.dataset.id=e.activityId,n.onclick=function(){localStorage.setItem("clickedActivity",this.dataset.id),conversation(this.dataset.id,!0)},n.classList.add("mdc-list-item","activity--list-item","mdc-elevation--z1");var a=document.createElement("object");a.data=e.creator.photo||"./img/empty-user.jpg",a.type="image/jpeg",a.className="mdc-list-item__graphic material-icons";var o=document.createElement("img");o.src="./img/empty-user.jpg",o.className="empty-user-list",a.appendChild(o);var r=document.createElement("span");r.classList.add("mdc-list-item__text");var c=document.createElement("span");c.className="mdc-list-item__primary-text bigBlackBold",c.textContent=e.activityName,r.appendChild(c),r.appendChild(t);var i=document.createElement("span");i.classList.add("mdc-list-item__meta"),i.appendChild(generateIconByCondition(e,n));var d=document.createElement("span");d.classList.add("mdc-list-item__secondary-text","status-in-activity",""+e.status),document.createElement("i").className="material-icons";var s=document.createElement("i");s.classList.add("status-cancel","material-icons"),s.appendChild(document.createTextNode("clear"));var l=document.createElement("i");return l.classList.add("status-confirmed","material-icons"),l.appendChild(document.createTextNode("check")),"CONFIRMED"===e.status&&d.appendChild(l),"CANCELLED"===e.status&&d.appendChild(s),i.appendChild(d),n.appendChild(a),n.appendChild(r),n.appendChild(i),n}function generateIconByCondition(e,t){var n=document.createElement("i");if(n.className="material-icons notification",e.urgent)return n.textContent="alarm",n;if(e.nearby)return n.textContent="location_on",n;if(e.count){var a=document.createElement("div"),o=document.createElement("span");return o.textContent=e.count,o.className="count mdc-meta__custom-text",a.appendChild(o),t.classList.add("count-active"),a}var r=document.createElement("div");return r.className="mdc-meta__custom-text",r.style.width="76px",r.style.fontSize="16px",r.textContent=moment(e.timestamp).calendar(),r}function appendActivityListToDom(e){var t=document.getElementById("activity--list");t&&t.appendChild(e)}function getRootRecord(){return new Promise(function(t,n){var a=void 0,o=localStorage.getItem("dbexist"),r=indexedDB.open(o);r.onsuccess=function(){var e=r.result.transaction(["root"],"readwrite");e.objectStore("root").get(o).onsuccess=function(e){var t=e.target.result;a=t||null},e.oncomplete=function(){a?t(a):n({message:"No root record found from getRootRecord"})},e.onerror=function(){n({message:e.error.message+" from getRootRecord"})}},r.onerror=function(){n({message:r.error+" from getRootRecord"})}})}function createActivityIcon(){document.getElementById("create-activity")||getCountOfTemplates().then(function(e){Object.keys(e).length&&createActivityIconDom()}).catch(handleError)}function getCountOfTemplates(){return new Promise(function(t,n){var a=0,o={},r=indexedDB.open(firebase.auth().currentUser.uid);r.onsuccess=function(){var e=r.result.transaction(["subscriptions"],"readonly");e.objectStore("subscriptions").index("office").openCursor(null,"nextunique").onsuccess=function(e){var t=e.target.result;t&&(a++,o[t.value.office]=a,t.continue())},e.oncomplete=function(){t(o)},e.onerror=function(){n({message:e.error.message+" from getCountOfTemplates"})}},r.onerror=function(){n({message:r.error.message+" from getCountOfTemplates"})}})}function createActivityIconDom(){var e=document.getElementById("create-activity--parent"),t=document.createElement("button");t.className="mdc-fab create-activity",t.id="create-activity",t.setAttribute("aria-label","Add");var n=document.createElement("span");n.className="mdc-fab_icon material-icons",n.id="activity-create--icon",n.textContent="add",t.appendChild(n),e.innerHTML=t.outerHTML,document.querySelector(".create-activity").addEventListener("click",function(e){callSubscriptionSelectorUI(e)})}function callSubscriptionSelectorUI(e,t){selectorUI(e,{record:"",store:"subscriptions",suggestCheckIn:t})}function listPanel(){if(!document.getElementById("activity-list-main")){var e=document.createElement("div");e.className="mdc-card panel-card mdc-top-app-bar--fixed-adjust",e.id="activity-list-main";var t=document.createElement("ul");t.className="mdc-list mdc-list--two-line mdc-list--avatar-list",t.id="activity--list",e.appendChild(t);var n=document.createElement("div");n.id="create-activity--parent",e.appendChild(n),document.getElementById("app-current-panel").innerHTML=e.outerHTML}}function creatListHeader(c){var e=indexedDB.open(firebase.auth().currentUser.uid);e.onsuccess=function(){getImageFromNumber(e.result,firebase.auth().currentUser.phoneNumber).then(function(e){var t=document.createElement("div");t.className="profile--icon-header";var n=document.createElement("div");n.id="menu--panel";var a=document.createElement("object");a.className="list-photo-header",a.type="image/jpeg",a.data=e||"./img/empty-user.jpg";var o=document.createElement("img");o.src="./img/empty-user.jpg",o.className="list-photo-header",a.appendChild(o),n.appendChild(a);var r=document.createElement("p");r.textContent=c,n.appendChild(r),t.appendChild(n),modifyHeader({id:"app-main-header",left:t.outerHTML,right:""}),document.querySelector(".list-photo-header").addEventListener("click",function(){profileView(!0)})})}}function scrollToActivity(){var e=localStorage.getItem("clickedActivity");if(document.querySelector('[data-id="'+e+'"]'))return document.querySelector('[data-id="'+e+'"]').scrollIntoView({behavior:"instant",block:"center",inline:"center"}),void localStorage.removeItem("clickedActivity")}function notificationWorker(e,a){return new Promise(function(t,n){notification.postMessage({dbName:firebase.auth().currentUser.uid,type:e,updateTimestamp:a}),notification.onmessage=function(e){t(e.data)},notification.onerror=function(e){n({message:e.message+" from notificationWorker at "+e.lineno})}})}function modifyHeader(e){e.left&&(document.getElementById(e.id+"view-type").innerHTML=e.left);e.right&&(document.getElementById(e.id+"action-data").innerHTML=e.right)}function suggestCheckIn(c){return new Promise(function(o,r){getRootRecord().then(function(n){var a=indexedDB.open(firebase.auth().currentUser.uid);a.onsuccess=function(){var e=a.result.transaction(["root"],"readwrite"),t=e.objectStore("root");n.suggestCheckIn!==c&&(n.suggestCheckIn=c,t.put(n)),e.oncomplete=function(){o(!0)},e.onerror=function(){r({message:e.error.message+" from suggestCheckIn"})}},a.onerror=function(){r({message:a.error+" from suggestCheckIn"})}}).catch(function(e){r(e)})})}function profileView(e){e&&history.pushState(["profileView"],null,null),window.addEventListener&&window.removeEventListener("scroll",handleScroll,!1),document.body.style.backgroundColor="#eeeeee";var r=firebase.auth().currentUser,t=r.uid,c=indexedDB.open(t);c.onsuccess=function(){var n=c.result,a=n.transaction(["root"],"readwrite"),o=a.objectStore("root");o.get(t).onsuccess=function(e){var t=e.target.result;o.put(t),a.oncomplete=function(){createProfileHeader(),createProfilePanel(n).then(function(e){document.getElementById("app-current-panel")&&(document.getElementById("app-current-panel").innerHTML=e.outerHTML,document.getElementById("close-profile--panel").addEventListener("click",function(){backNav()}),"Android"===native.getName()?document.getElementById("uploadProfileImage").addEventListener("click",function(){AndroidInterface.openImagePicker()}):inputFile("uploadProfileImage").addEventListener("change",function(){readUploadedFile()}),changeDisplayName(r),changeEmailAddress(r))})}}}}function inputFile(e){return document.getElementById(e)}function createProfileHeader(){var e=document.createElement("span");e.id="close-profile--panel";var t=document.createElement("i");t.className="material-icons",t.textContent="arrow_back",e.appendChild(t),modifyHeader({id:"app-main-header",left:e.outerHTML})}function createProfilePanel(e){return new Promise(function(v){getImageFromNumber(e,firebase.auth().currentUser.phoneNumber).then(function(e){var t=document.createElement("div");t.id="profile-view--container",t.className="mdc-top-app-bar--fixed-adjust mdc-theme--background";var n=document.createElement("button");n.className="mdc-fab","Android"===native.getName()&&(n.id="uploadProfileImage");var a=document.createElement("label");a.setAttribute("for","uploadProfileImage");var o=document.createElement("span");o.className="mdc-fab__icon material-icons",o.textContent="add_a_photo",a.appendChild(o),n.appendChild(a);var r=void 0;"Android"!==native.getName()&&((r=document.createElement("input")).type="file",r.style.display="none",r.id="uploadProfileImage",r.accept="image/jpeg;");var c=document.createElement("div");c.id="profile--image-container",c.className="profile-container--main";var i=document.createElement("object");i.type="image/jpeg",i.data=e||"./img/empty-user-big.jpg",i.id="user-profile--image";var d=document.createElement("img");d.src="./img/empty-user-big.jpg",d.className="empty-user-profile",i.appendChild(d);var s=document.createElement("div");s.className="insert-overlay",c.appendChild(i),c.appendChild(s),c.appendChild(n),"Android"!==native.getName()&&a.appendChild(r);var l=document.createElement("div");l.id="name--change-container",l.className="profile-psuedo-card";var u=document.createElement("button");u.className="mdc-icon-button material-icons hidden",u.id="edit--name",u.setAttribute("aria-hidden","true"),u.setAttribute("aria-pressed","false"),u.textContent="check";var m=firebase.auth().currentUser.displayName;l.innerHTML='<div class="mdc-text-field" id=\'name-change-field\'>\n        <input autocomplete="off" type="text"  placeholder="'+(m?"":"Enter Your Name")+'"  id="pre-filled-name" class="mdc-text-field__input" value="'+(m||"")+'">\n        <label class="mdc-floating-label mdc-floating-label--float-above" for="pre-filled-name">\n         Your Name\n        </label>\n        <div class="mdc-line-ripple"></div>\n      </div>\n      ',l.appendChild(u);var p=document.createElement("div");p.id="email--change-container",p.className="profile-psuedo-card";var h=document.createElement("button");h.className="mdc-icon-button material-icons hidden",h.id="edit--email",h.setAttribute("aria-hidden","true"),h.setAttribute("aria-pressed","false"),h.textContent="check";var f=firebase.auth().currentUser.email;p.innerHTML='<div class="mdc-text-field" id=\'email-change-field\'>\n        <input  autocomplete="off" type="text" id="pre-filled-email" class="mdc-text-field__input" value="'+(f||"")+'" placeholder="'+(f?"":"Enter your Email")+'">\n        <label class="mdc-floating-label mdc-floating-label--float-above" for="pre-filled-email">\n         Your Email\n        </label>\n        <div class="mdc-line-ripple"></div>\n      </div>\n      ',p.appendChild(h),t.appendChild(c),t.appendChild(l),t.appendChild(p),v(t)})})}function updateEmailDialog(){if(!document.getElementById("updateEmailDialog")){var e=document.createElement("aside");e.className="mdc-dialog mdc-dialog--open",e.id="updateEmailDialog";var t=document.createElement("div");t.className="mdc-dialog__surface",t.style.width="90%",t.style.height="auto";var n=document.createElement("section");n.className="mdc-dialog__body",n.id="refresh-login";var a=document.createElement("footer");a.className="mdc-dialog__footer";var o=document.createElement("button");o.type="button",o.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--cancel update-email-cancel",o.textContent="Cancel",o.style.backgroundColor="#3498db",a.appendChild(o),t.appendChild(n),t.appendChild(a),e.appendChild(t),document.body.appendChild(e)}}function timeDiff(e){var t=moment().format("YYY-MM-DD HH:mm"),n=moment(e).format("YYY-MM-DD HH:mm");return moment(t).diff(moment(n),"minutes")}function newSignIn(e,t){updateEmailDialog();var n=document.querySelector("#updateEmailDialog"),a=new mdc.dialog.MDCDialog(n);a.show();try{ui||(ui=new firebaseui.auth.AuthUI(firebase.auth())),ui.start("#refresh-login",firebaseUiConfig(e)),setTimeout(function(){document.querySelector(".firebaseui-id-phone-number").disabled=!0,document.querySelector(".firebaseui-label").remove(),document.querySelector(".firebaseui-title").textContent="Verify your phone Number to Update your Email address"},500),a.listen("MDCDialog:cancel",function(){t.value=firebase.auth().currentUser.email,n.remove()})}catch(e){n.remove(),console.log(e),handleError({message:e.message+" from newSignIn function during email updation"}),snacks("Please try again later")}}function readUploadedFile(e){if("Android"!==native.getName()){var t=inputFile("uploadProfileImage").files[0],n=new FileReader;n.addEventListener("load",function(){sendBase64ImageToBackblaze(n.result)},!1),t&&n.readAsDataURL(t)}else sendBase64ImageToBackblaze(e)}function sendBase64ImageToBackblaze(e){var t=document.getElementById("user-profile--image"),n=document.getElementById("profile--image-container"),a="data:image/jpeg;base64,";t&&(t.data=a+e),n&&document.getElementById("profile--image-container").appendChild(loader("profile--loader")),requestCreator("backblaze",{imageBase64:a+e})}function authUpdatedError(e){"auth/invalid-email"!==e.message&&handleError({message:e.message+" from authUpdatedError"}),document.querySelector(".init-loader")&&document.querySelector(".init-loader").remove(),snacks(e.message)}function changeDisplayName(){var e=document.getElementById("name-change-field"),t=new mdc.textField.MDCTextField(e),n=document.getElementById("edit--name");firebase.auth().currentUser.displayName;e.addEventListener("click",function(){document.getElementById("pre-filled-name").placeholder="",n.classList.remove("hidden"),e.classList.add("short")}),e.addEventListener("keydown",function(e){13==e.keyCode&&updateName(t.value)}),n.addEventListener("click",function(){updateName(t.value)})}function updateName(e){e?firebase.auth().currentUser.updateProfile({displayName:e}).then(successDialog).catch(function(e){snacks("Please Try again later"),handleError({message:e+" at updateProfile in changeDisplayName"})}):snacks("Please Enter a Name")}function changeEmailAddress(){var e=document.getElementById("email-change-field"),t=new mdc.textField.MDCTextField(e),n=document.getElementById("edit--email");e.addEventListener("click",function(){document.getElementById("pre-filled-email").placeholder="",n.classList.remove("hidden"),e.classList.add("short")}),e.addEventListener("keydown",function(e){13==e.keyCode&&emailValidation(t)}),n.addEventListener("click",function(){emailValidation(t)})}function emailValidation(e){var t=firebase.auth().currentUser,n=e.value;n?n!==t.email?timeDiff(t.metadata.lastSignInTime)<=2?updateEmail(t,n):newSignIn(n,e):snacks("You have already set this as your email address"):snacks("Enter a valid Email Id")}function updateEmail(e,t){document.getElementById("growthfile").appendChild(loader("init-loader")),e.updateEmail(t).then(emailUpdateSuccess).catch(authUpdatedError)}function emailUpdateSuccess(){firebase.auth().currentUser.sendEmailVerification().then(emailVerificationSuccess).catch(emailVerificationError)}function emailVerificationSuccess(){successDialog(),snacks("Verification link has been send to your email address")}function emailVerificationError(e){snacks(e.message),document.querySelector(".init-loader")&&document.querySelector(".init-loader").remove(),handleError({message:e.message+" from emailVerificationError"})}function initUserSelectorSearch(n,a){var e=document.getElementById("search--bar-selector"),o=e.value="",r=document.createDocumentFragment(),c={};a.record.assignees.forEach(function(e){c[e]=""}),e.addEventListener("input",function(e){var t=e.target.value;if(isNumber(t))return o=n.transaction("users").objectStore("users"),void searchUsersDB(formatNumber(t),o,r,c,a);r=document.createDocumentFragment(),o=n.transaction("users").objectStore("users").index("displayName"),searchUsersDB(formatName(t),o,r,c,a)})}function isNumber(e){return!isNaN(e)}function formatNumber(e){var t=e;return"91"===t.substring(0,2)?t="+"+t:"+91"!==t.substring(0,3)&&(t="+91"+t),t}function formatName(e){var t=e.split(" "),n=t.length,a=[],o=0;for(o=0;o<n;o++){var r=t[o];if(r.charAt(0).toUpperCase()===e.charAt(0).toUpperCase)return e;a.push(r.charAt(0).toUpperCase()+r.slice(1))}return a.join(" ")}function checkNumber(e){return/^\+[1-9]\d{11,14}$/.test(e)}function searchUsersDB(e,t,o,r,c){console.log(e);var n=IDBKeyRange.bound(e,e+"￿"),i=document.getElementById("data-list--container");t.openCursor(n).onsuccess=function(e){var t=e.target.result;if(!t){if(i.innerHTML="",0!=o.children.length)return i.appendChild(o),void document.querySelectorAll('[data-selected="true"]').forEach(function(e){new mdc.checkbox.MDCCheckbox.attachTo(e).checked=!0,e.children[1].style.animation="none",e.children[1].children[0].children[0].style.animation="none"});var n=document.createElement("div");n.className="data-not-found";var a=document.createElement("p");return a.textContent="No Contact Found",a.className="mdc-typography--headline5",n.appendChild(a),void(document.querySelector(".data-not-found")||i.appendChild(n))}c.attachment.present?o.appendChild(createSimpleAssigneeLi(t.value,!0,!1)):r.hasOwnProperty(t.value.mobile)||o.appendChild(createSimpleAssigneeLi(t.value,!0,!0)),t.continue()}}var apiHandler=new Worker("apiHandler.js");function handleError(e){var t=JSON.parse(localStorage.getItem("error"));if(!t.hasOwnProperty(e.message))return t[e.message]=!0,localStorage.setItem("error",JSON.stringify(t)),e.device=native.getInfo(),e.stack&&(e.stack=e.stack),void requestCreator("instant",JSON.stringify(e))}function loader(e){var t=document.createElement("div");return t.className="loader "+e,t}function successDialog(){var e=document.createElement("aside");e.className="mdc-dialog mdc-dialog--open success--dialog",e.id="success--dialog";var t=document.createElement("div");t.className="mdc-dialog__surface round--surface";var n=document.createElement("section");n.className="mdc-dialog__body";var a=document.createElement("div");a.className="success--container";var o=document.createElement("div");o.className="success--check",a.appendChild(o),n.appendChild(a),t.appendChild(n),e.appendChild(t),document.body.appendChild(e),new mdc.dialog.MDCDialog(document.querySelector("#success--dialog")).show(),setTimeout(function(){document.getElementById("success--dialog").remove(),document.body.classList.remove("mdc-dialog-scroll-lock")},1200),scroll_namespace.count=0,scroll_namespace.size=20,localStorage.removeItem("clickedActivity"),listView({urgent:!1,nearBy:!1})}function appDialog(e,t){if(!document.getElementById("enable-gps")){var n=document.createElement("aside");n.className="mdc-dialog mdc-dialog--open",n.id="enable-gps";var a=document.createElement("div");a.className="mdc-dialog__surface",a.style.width="90%",a.style.height="auto";var o=document.createElement("section");o.className="mdc-dialog__body mock-main-body",o.textContent=e;var r=document.createElement("footer");r.className="mdc-dialog__footer mock-footer";var c=document.createElement("button");c.type="button",c.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--accept",c.textContent="Ok",t||c.classList.add("hidden"),c.style.backgroundColor="#3498db",r.appendChild(c),a.appendChild(o),a.appendChild(r),n.appendChild(a),document.body.appendChild(n)}var i=new mdc.dialog.MDCDialog(document.querySelector("#enable-gps"));i.listen("MDCDialog:accept",function(){listView({nearby:!1,urgent:!1})}),i.show()}function appUpdateDialog(e,t){if(!document.getElementById("app-update-dialog")){var n=document.createElement("aside");n.className="mdc-dialog mdc-dialog--open",n.id="app-update-dialog";var a=document.createElement("div");a.className="mdc-dialog__surface",a.style.width="90%",a.style.height="auto";var o=document.createElement("header");o.className="mdc-dialog__header";var r=document.createElement("h2");r.className="mdc-dialog__header__title",r.textContent=t,o.appendChild(r);var c=document.createElement("section");c.className="mdc-dialog__body",c.textContent=e;var i=document.createElement("footer");i.className="mdc-dialog__footer",a.appendChild(o),a.appendChild(c),a.appendChild(i),n.appendChild(a),document.body.appendChild(n)}new mdc.dialog.MDCDialog(document.querySelector("#app-update-dialog")).show()}function progressBar(){var e=document.createElement("div");e.className="mdc-linear-progress mdc-linear-progress--indeterminate progress--update",e.role="progressbar";var t=document.createElement("div");t.className="mdc-linear-progress__buffering-dots";var n=document.createElement("div");n.className="mdc-linear-progress__buffer";var a=document.createElement("div");a.className="mdc-linear-progress__bar mdc-linear-progress__primary-bar";var o=document.createElement("span");o.className="mdc-linear-progress__bar-inner",a.appendChild(o);var r=document.createElement("div");r.className="mdc-linear-progress__bar mdc-linear-progress__secondary-bar";var c=document.createElement("span");return c.className="mdc-linear-progress__bar-inner",r.appendChild(c),e.appendChild(t),e.appendChild(n),e.appendChild(a),e.appendChild(r),e}function snacks(e,t){var n=document.createElement("div");n.className="mdc-snackbar",n.setAttribute("aria-live","assertive"),n.setAttribute("aria-atomic","true"),n.setAttribute("aria-hidden","true");var a=document.createElement("div");a.className="mdc-snackbar__text mdc-typography--subtitle2";var o=document.createElement("div");o.className="mdc-snackbar__action-wrapper";var r=document.createElement("button");r.className="mdc-snackbar__action-button",o.appendChild(r),n.appendChild(a),n.appendChild(o),document.getElementById("snackbar-container").innerHTML=n.outerHTML;var c={message:e,actionText:t?t.btn:"OK",timeout:1e4,actionHandler:function(){}};mdc.snackbar.MDCSnackbar.attachTo(document.querySelector(".mdc-snackbar")).show(c)}function fetchCurrentTime(e){return Date.now()+e}function geolocationApi(o){return new Promise(function(t,n){var a=new XMLHttpRequest;a.open(o.method,o.url,!0),a.setRequestHeader("Content-Type","application/json"),a.onreadystatechange=function(){if(4===a.readyState){if(400<=a.status)return"notFound"===JSON.parse(a.response).error.errors[0].reason?1===o.retry?n({message:JSON.parse(a.response).error.errors[0].message,body:{cellular:o.body,tries:"Retried 3 times"}}):(o.retry--,void geolocationApi(o).then().catch(function(e){n(e)})):n({message:JSON.parse(a.response).error.errors[0].message,body:o.body});if(!a.responseText)return n({message:"No response text from google",body:o.body});var e=JSON.parse(a.responseText);if(!e)return n({message:"Response text is not parseable",body:o.body});t({latitude:e.location.lat,longitude:e.location.lng,accuracy:e.accuracy,provider:{cellular:JSON.parse(o.body)}})}},a.send(o.body)})}function getCellTowerInfo(){return new Promise(function(t,n){var e="";try{e=AndroidInterface.getCellularData()}catch(e){n({message:e.message+" from getCellularData"})}if(e){geolocationApi({method:"POST",url:"https://www.googleapis.com/geolocation/v1/geolocate?key=AIzaSyA4s7gp7SFid_by1vLVZDmcKbkEcsStBAo",body:e,retry:3}).then(function(e){t(e)}).catch(function(e){n(e)})}else n({message:"empty cell tower from android."})})}function manageLocation(){return new Promise(function(t,n){"Android"!==native.getName()?html5Geolocation().then(function(e){t(e)}).catch(function(e){n(e)}):getCellTowerInfo().then(function(e){t(e)}).catch(function(e){return handleError(e),html5Geolocation()}).then(function(e){t(e)}).catch(function(e){n({error:e,meta:"Both geolocation and html5 failed to get location"})})})}function html5Geolocation(){return new Promise(function(n,t){var a=[],o=0,r=0,c=setInterval(function(){navigator.geolocation.getCurrentPosition(function(e){if(1!==++o){if(a.push({latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy,provider:"HTML5"}),a[0].latitude.toFixed(3)===e.coords.latitude.toFixed(3)&&a[0].longitude.toFixed(3)===e.coords.longitude.toFixed(3)&&3==++r)return clearInterval(c),c=null,n(a[0]);if(5<=o){clearInterval(c),c=null;var t=sortedByAccuracy(a);return n(t)}}},function(e){clearInterval(c),c=null,t({message:e.message+" from html5Geolocation"})})},500)})}function locationUpdationSuccess(e){if(e.prev.latitude&&e.prev.longitude&&e.new.latitude&&e.new.longitude){var t=new CustomEvent("location",{detail:e.new});window.dispatchEvent(t);var n=calculateDistanceBetweenTwoPoints(e.prev,e.new),a=new CustomEvent("locationChanged",{detail:isLocationMoreThanThreshold(n)});window.dispatchEvent(a)}}function showSuggestCheckInDialog(){var e=document.querySelector("#suggest-checkIn-dialog");if(e){var t=new mdc.dialog.MDCDialog(e);t&&(document.getElementById("dialog--component")||(t.root_.classList.remove("hidden"),t.show(),t.listen("MDCDialog:accept",function(t){getRootRecord().then(function(e){suggestCheckIn(!1).then(function(){isLocationStatusWorking()&&(1===e.offices.length?createTempRecord(e.offices[0],"check-in",{suggestCheckIn:!0}):callSubscriptionSelectorUI(t,!0))})}).catch(console.log)}),t.listen("MDCDialog:cancel",function(e){suggestCheckIn(!1).then(console.log).catch(console.log)})))}}function isDialogOpened(e){var t=document.querySelector(e);return!!t&&t.classList.contains("mdc-dialog--open")}function updateLocationInRoot(i){return new Promise(function(t,a){var o={latitude:"",longitude:"",accuracy:"",provider:"",lastLocationTime:""},r=firebase.auth().currentUser.uid,c=indexedDB.open(r,3);c.onsuccess=function(){var e=c.result.transaction(["root"],"readwrite"),n=e.objectStore("root");n.get(r).onsuccess=function(e){var t=e.target.result;t.location&&(o=t.location),t.location=i,t.location.lastLocationTime=Date.now(),n.put(t)},e.oncomplete=function(){t({prev:o,new:i})},e.onerror=function(){a({message:e.error.message+" from updateLocationInRoot",body:e.error.name})}},c.onerror=function(){a({message:c.error.message+" from updateLocationInRoot",body:c.error.name})}})}function toRad(e){return e*Math.PI/180}function calculateDistanceBetweenTwoPoints(e,t){var n=toRad(t.latitude-e.latitude),a=toRad(t.longitude-e.longitude),o=toRad(t.latitude),r=toRad(e.latitude),c=Math.sin(n/2)*Math.sin(n/2)+Math.sin(a/2)*Math.sin(a/2)*Math.cos(o)*Math.cos(r);return 6371*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)))}function isLocationMoreThanThreshold(e){return 1<=e}function isLocationLessThanThreshold(e){return e<=1}function sortedByAccuracy(e){return e.sort(function(e,t){return e.accuracy-t.accuracy})[0]}function sendCurrentViewNameToAndroid(e){if("Android"===native.getName())try{AndroidInterface.startConversation(e)}catch(e){handleError({message:e.message+" from startConversation"})}}var locationPermission={checkGps:function(){try{return AndroidInterface.isGpsEnabled()}catch(e){return handleError({message:e.message+" from isGpsEnabled"}),!0}},checkLocationPermission:function(){try{return AndroidInterface.isLocationPermissionGranted()}catch(e){return handleError({message:e.message+" from isLocationPermissionGranted"}),!0}}};function createAndroidDialog(e,t){try{AndroidInterface.showDialog(e,t)}catch(e){handleError({message:e.message+" from showDialog"}),appDialog(t,!0)}}function isLocationStatusWorking(){if("Android"!==native.getName())return!0;if(locationPermission.checkLocationPermission()){if(AndroidInterface.isConnectionActive())return!0;createAndroidDialog("No Connectivity","Please Check your Internet Connectivity")}else createAndroidDialog("Location Permission","Please Allow Growthfile location access.")}function requestCreator(e,a){var o=firebase.auth().currentUser,r={type:e,body:"",user:{token:"",uid:o.uid,displayName:o.displayName,photoURL:o.photoURL,phoneNumber:o.phoneNumber}};"instant"===e||"now"===e||"Null"===e||"backblaze"===e?o.getIdToken(!1).then(function(e){r.body=a,r.user.token=e,apiHandler.postMessage(r)}).catch(function(e){handleError({message:e.code})}):getRootRecord().then(function(e){var n=e.location,t=isLastLocationOlderThanThreshold(n.lastLocationTime,5);a.timestamp=fetchCurrentTime(e.serverTime),t?handleWaitForLocation(a,r):o.getIdToken(!1).then(function(e){var t={latitude:n.latitude,longitude:n.longitude,accuracy:n.accuracy,provider:n.provider};a.geopoint=t,r.body=a,r.user.token=e,sendRequest(n,r)}).catch(function(e){handleError({message:e.code})})}),apiHandler.onmessage=messageReceiver,apiHandler.onerror=onErrorMessage}function handleWaitForLocation(o,r){window.addEventListener("location",function e(a){firebase.auth().currentUser.getIdToken(!1).then(function(e){var t=a.detail,n={latitude:t.latitude,longitude:t.longitude,accuracy:t.accuracy,provider:t.provider};o.geopoint=n,r.body=o,r.user.token=e,sendRequest(n,r)}).catch(function(e){handleError({message:e.code})}),window.removeEventListener("location",e,!0)},!0)}function sendRequest(e,t){e.latitude&&e.longitude&&e.accuracy?apiHandler.postMessage(t):(appDialog("Fetching Location Please wait.",!0),getRootRecord().then(function(e){var t=void 0;try{t=AndroidInterface.getCellularData()}catch(e){t=e.message}handleError({message:"No location found in indexedDB",body:{deviceInfo:native.getInfo(),storedLocation:e.location,cellTower:t}})}))}function isLastLocationOlderThanThreshold(e,t){var n=moment(moment().valueOf()),a=e;return t<moment.duration(n.diff(a)).asSeconds()}var receiverCaller={"update-app":updateApp,"revoke-session":revokeSession,notification:successDialog,"android-stop-refreshing":androidStopRefreshing,loadView:loadView,apiFail:apiFail,backblazeRequest:urlFromBase64Image};function messageReceiver(e){receiverCaller[e.data.type](e.data)}function updateApp(t){if("Android"!==native.getName())webkit.messageHandlers.updateApp.postMessage("Update App");else try{AndroidInterface.updateApp(t.msg)}catch(e){appUpdateDialog("Please Install the Latest version from google play store , to Use Growthfile. After Updating the App, close Growthfile and open again ",JSON.parse(t.msg).message)}}function revokeSession(){firebase.auth().signOut().then(function(){}).catch(function(e){handleError({message:"Sign out error",body:e})})}function apiFail(e){document.getElementById("send-activity")&&(document.getElementById("send-activity").style.display="block"),document.querySelector("header .mdc-linear-progress")&&document.querySelector("header .mdc-linear-progress").remove(),document.querySelector(".loader")&&document.querySelector(".loader").remove(),document.querySelector(".delete-activity")&&(document.querySelector(".delete-activity").style.display="block"),document.querySelector(".undo-delete-loader")&&(document.querySelector(".undo-delete-loader").style.display="block"),document.querySelector(".form-field-status")&&document.querySelector(".form-field-status").classList.contains("hidden")&&document.querySelector(".form-field-status").classList.remove("hidden"),snacks(e.msg.message)}function urlFromBase64Image(e){if(200===e.code&&"profileView"===history.state[0]){var t=document.querySelector("#profile--image-container .profile--loader ");return t&&t.remove(),void(document.getElementById("user-profile--image").src=firebase.auth().currentUser.photoURL)}}function loadView(t){if(localStorage.setItem("dbexist",firebase.auth().currentUser.uid),androidStopRefreshing(),!history.state)return localStorage.setItem("today",null),void openListWithChecks();if("updateCreateActivity"!==history.state[0]){if("profileView"!==history.state[0])if("listView"!==history.state[0])window[history.state[0]](history.state[1],!1);else{if(!t.msg.length)return;getRootRecord().then(function(e){updateEl(t.msg,e.location)})}}else toggleActionables(history.state[1].activityId)}function androidStopRefreshing(){if("Android"===native.getName())try{AndroidInterface.stopRefreshing(!0)}catch(e){handleError({message:e.message+" from androidStopRefreshing"})}}function onErrorMessage(e){var t={"line-number":e.lineno,file:e.filename};handleError({message:e.message+" from apiHandler.js at "+e.lineno,body:t})}function getInputText(e){return mdc.textField.MDCTextField.attachTo(document.querySelector(e))}function runRead(e){localStorage.getItem("dbexist")&&requestCreator("Null",e)}function removeChildNodes(e){for(;e.firstChild;)e.removeChild(e.firstChild)}