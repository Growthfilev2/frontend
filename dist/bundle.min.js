var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function conversation(e,t){window.removeEventListener("scroll",handleScroll,!1),checkIfRecordExists("activity",e).then(function(e){e?(t&&history.pushState(["conversation",e],null,null),fetchAddendumForComment(e)):listView()}).catch(handleError)}function checkIfRecordExists(o,c){return new Promise(function(a,e){var t=firebase.auth().currentUser,n=window.indexedDB.open(t.uid);n.onsuccess=function(){n.result.transaction(o).objectStore(o).get(c).onsuccess=function(e){var t=e.target.result;a(!!t&&c)}},n.onerror=function(){e({message:n.error.message+" from checkIfRecordExists"})}})}function fetchAddendumForComment(n){if(n){var o=firebase.auth().currentUser,c=window.indexedDB.open(o.uid);c.onsuccess=function(){var a=c.result,e=a.transaction(["addendum"],"readonly"),t=e.objectStore("addendum").index("activityId");createHeaderContent(a,n),commentPanel(n),statusChange(a,n),sendCurrentViewNameToAndroid("conversation"),reinitCount(a,n),t.openCursor(n).onsuccess=function(e){var t=e.target.result;t&&(document.getElementById(t.value.addendumId)||createComment(a,t.value,o).then(function(e){document.getElementById("chat-container")&&document.getElementById("chat-container").appendChild(e)}),t.continue())},e.oncomplete=function(){document.querySelector(".activity--chat-card-container")&&(document.querySelector(".activity--chat-card-container").scrollTop=document.querySelector(".activity--chat-card-container").scrollHeight)}}}}function commentPanel(e){if(!document.querySelector(".activity--chat-card-container")){var t=document.createElement("div");t.className="activity--chat-card-container  mdc-top-app-bar--fixed-adjust panel-card";var a=document.createElement("div");a.id="chat-container",a.className="mdc-card reverser-parent";var n=document.createElement("div");n.className="user-comment--container";var o=document.createElement("div");o.className="status--change-cont";var c=document.createElement("div");c.className="comment--container";var i=document.createElement("div");i.className="input--text-padding mdc-text-field mdc-text-field--dense",i.id="write--comment",i.style.width="100%";var r=document.createElement("input");r.className="mdc-text-field__input comment-field mdc-elevation--z4",r.type="text",i.appendChild(r),c.appendChild(i);var d=document.createElement("button");d.classList.add("mdc-fab","mdc-fab--mini","hidden"),d.id="send-chat--input";var l=document.createElement("span");l.classList.add("mdc-fac__icon","material-icons"),l.textContent="send",d.appendChild(l),c.appendChild(d),t.appendChild(a),n.appendChild(c),document.getElementById("app-current-panel").innerHTML=t.outerHTML+o.outerHTML+n.outerHTML,document.querySelector(".comment-field").oninput=function(e){e.target.value&&e.target.value.replace(/\s/g,"").length?showSendCommentButton():hideSendCommentButton()},document.getElementById("send-chat--input").onclick=function(){isLocationStatusWorking()&&sendComment(e)}}}function sendComment(e){requestCreator("comment",{activityId:e,comment:document.querySelector(".comment-field").value}),document.querySelector(".comment-field").value="",hideSendCommentButton()}function hideSendCommentButton(){document.getElementById("send-chat--input").classList.add("hidden"),document.getElementById("write--comment").style.width="100%",document.getElementById("write--comment").style.transition="0.3s ease",document.querySelector(".status--change-cont").style.transition="0.3s ease",document.querySelector(".status--change-cont").style.opacity="1"}function showSendCommentButton(){document.getElementById("send-chat--input").classList.remove("hidden"),document.getElementById("write--comment").style.width="80%",document.querySelector(".status--change-cont").style.opacity="0"}function statusChange(e,t){var l=document.createElement("label");l.setAttribute("for","toggle-status"),l.textContent="Done",e.transaction("activity").objectStore("activity").get(t).onsuccess=function(e){var t=document.querySelector(".status--change-cont"),a=e.target.result;if(!a.canEdit||"CANCELLED"===a.status){var n=document.createElement("span"),o=e.target.result;return n.textContent="Activity "+o.status.toLowerCase(),void(t&&(t.innerHTML=n.outerHTML,t.style.textAlign="center"))}if(0!=a.editable){if(!document.querySelector(".status-check")){var c=document.createElement("div");c.className="mdc-form-field form-field-status";var i=document.createElement("div");i.className="mdc-checkbox status-check";var r=document.createElement("input");r.className="mdc-checkbox__native-control",r.id="toggle-status",r.type="checkbox";var d=document.createElement("div");d.className="mdc-checkbox__background";document.createElement("div").className="mdc-checkbox__mixedmark",d.innerHTML='<svg class="mdc-checkbox__checkmark"\n      viewBox="0 0 24 24">\n      <path class="mdc-checkbox__checkmark-path"\n      fill="none"\n      d="M1.73,12.91 8.1,19.28 22.79,4.59"/>\n      </svg>\n      <div class="mdc-checkbox__mixedmark"></div>',i.appendChild(r),i.appendChild(d),c.appendChild(i),t&&(t.innerHTML=c.outerHTML+l.outerHTML)}document.querySelector(".mdc-checkbox")&&(switchControl=new mdc.checkbox.MDCCheckbox.attachTo(document.querySelector(".mdc-checkbox")),"CONFIRMED"===a.status&&(switchControl.checked=!0),document.querySelector(".mdc-checkbox").onclick=function(){isLocationStatusWorking()?changeStatusRequest(switchControl,a):resetStatusConfirmation(switchControl,a)})}else t&&(t.innerHTML=l.outerHTML+loader("status-loader").outerHTML)}}function resetStatusConfirmation(e,t){"CONFIRMED"===t.status?e.checked=!0:e.checked=!1}function changeStatusRequest(e,t){document.querySelector(".form-field-status").classList.add("hidden"),document.querySelector(".status--change-cont").appendChild(loader("status-loader")),e.checked?requestCreator("statusChange",{activityId:t.activityId,status:"CONFIRMED"}):requestCreator("statusChange",{activityId:t.activityId,status:"PENDING"})}function createComment(e,u,t){var m=!1;return new Promise(function(r){var d=document.createElement("div");d.classList.add("comment-box","talk-bubble","tri-right","round","btm-left"),t.phoneNumber===u.user?d.classList.add("current-user--comment","secondary-color-light"):d.classList.add("other-user--comment","mdc-theme--primary-bg"),d.id=u.addendumId;var l=document.createElement("div");l.classList.add("talktext");var s=document.createElement("p");s.classList.add("user-name--comment","mdc-typography--subtitle2"),getUserRecord(e,u.user).then(function(e){e.displayName?s.textContent=e.displayName:s.textContent=e.mobile;var t=document.createElement("p");t.classList.add("comment","mdc-typography--subtitle2"),t.textContent=u.comment;var a=document.createElement("span");a.className="comment--info";var n=document.createElement("span");n.textContent=moment(u.timestamp).format("DD-MM-YY H:mm"),n.classList.add("comment-date","mdc-typography--caption");var o=document.createElement("div"),c=document.createElement("i");c.classList.add("user-map--span","material-icons"),c.appendChild(document.createTextNode("location_on")),o.onclick=function(e){if(hasMapsApiLoaded()){m=!m;var t={lat:u.location._latitude,lng:u.location._longitude};maps(e,m,u.addendumId,t)}},c.dataset.latitude=u.location._latitude,c.dataset.longitude=u.location._longitude,o.appendChild(c);var i=document.createElement("div");i.className="map-convo",a.appendChild(n),a.appendChild(o),l.appendChild(s),l.appendChild(t),l.appendChild(a),d.appendChild(l),d.appendChild(i),r(d)})})}function getUserRecord(o,c){return new Promise(function(a,e){var t=o.transaction("users").objectStore("users"),n=void 0;n="string"==typeof c?c:c.phoneNumber,t.get(n).onsuccess=function(e){var t=e.target.result;return a(t||{displayName:"",mobile:n,photoURL:""})}})}function hasMapsApiLoaded(){return"object"===("undefined"==typeof google?"undefined":_typeof(google))&&"object"===_typeof(google.maps)}function maps(e,t,a,n){var o="";if(o=e?document.getElementById(a).querySelector(".map-convo"):document.querySelector(".map-detail."+a),!t)return o.style.height="0px",void(e&&(e.target.textContent="location_on"));if(0!==o.children.length)return o.style.height="200px",void(e&&(e.target.textContent="arrow_drop_down"));e&&(e.target.textContent="arrow_drop_down"),o.style.height="200px";var c=new google.maps.Map(o,{zoom:16,center:n,disableDefaultUI:!0});if(!e){var i=document.createElement("div");new MapsCustomControl(i,c,n.lat,n.lng);i.index=1,c.controls[google.maps.ControlPosition.TOP_LEFT].push(i)}new google.maps.Marker({position:n,map:c})}function MapsCustomControl(e,t,a,n){var o=document.createElement("div");o.style.backgroundColor="#fff",o.style.border="2px solid #fff",o.style.borderRadius="3px",o.style.boxShadow="0 2px 6px rgba(0,0,0,.3)",o.style.cursor="pointer",o.style.marginBottom="22px",o.style.textAlign="center",o.style.padding="0px 5px 0px 5px",e.appendChild(o);var c=document.createElement("a");c.href="https://www.google.com/maps?q="+a+","+n,c.className="material-icons",c.style.color="rgb(25,25,25)",c.style.fontSize="16px",c.style.lineHeight="38px",c.style.paddingLeft="5px",c.style.paddingRight="5px",c.style.textDecoration="none",c.innerHTML="open_in_new",o.appendChild(c)}function createHeaderContent(t,e){var a=t.transaction("activity").objectStore("activity"),i=document.createElement("div"),r=document.createElement("div");r.className="back-icon",r.id="back-conv",r.style.float="left";var n=document.createElement("i");n.style.marginRight="5px",n.className="material-icons back-icon--large",n.textContent="arrow_back",r.appendChild(n),a.get(e).onsuccess=function(e){var c=e.target.result;getUserRecord(t,c.creator).then(function(e){var t=document.createElement("object");t.data=e.photoURL||"./img/empty-user.jpg",t.className="header--icon-creator",t.type="image/jpeg";var a=document.createElement("img");a.src="./img/empty-user.jpg",a.className="header--icon-creator",t.appendChild(a),r.appendChild(t);var n=document.createElement("div");n.className="mdc-list-item__text comment-header-primary mdc-typography--subtitle2",n.textContent=c.activityName;var o=document.createElement("span");o.className="mdc-list-item__secondary-text",o.textContent="Click here to see details",n.appendChild(o),i.appendChild(r),i.appendChild(n),modifyHeader({id:"app-main-header",left:i.outerHTML}),document.getElementById("back-conv").addEventListener("click",function(){backNav()}),document.querySelector(".comment-header-primary").addEventListener("click",function(){checkIfRecordExists("activity",c.activityId).then(function(e){e?updateCreateActivity(c):listView()}).catch(handleError)})})}}function reinitCount(e,t){var a=e.transaction(["list"],"readwrite"),n=a.objectStore("list");n.get(t).onsuccess=function(e){var t=e.target.result;t&&(t.count=0,n.put(t))},a.oncomplete=function(){}}function fillUsersInSelector(c){var i=document.getElementById("data-list--container"),r=c.record.assignees,d=indexedDB.open(firebase.auth().currentUser.uid);d.onsuccess=function(){var e=d.result.transaction(["users"]),t=e.objectStore("users");document.querySelector(".selector-send").classList.remove("hidden");var a=document.getElementById("selector-submit-send");a.textContent="Add New Number",a.dataset.type="add-number";var n=0,o={};r.forEach(function(e){"string"==typeof e?o[e]=!0:o[e.phoneNumber]=!0}),o[firebase.auth().currentUser.phoneNumber]=!0,t.openCursor().onsuccess=function(e){var t=e.target.result;t&&(c.attachment.present?(n++,i.appendChild(createSimpleAssigneeLi(t.value,!0,!1))):o.hasOwnProperty(t.value.mobile)||(n++,i.appendChild(createSimpleAssigneeLi(t.value,!0,!0))),t.continue())},e.oncomplete=function(){n||(i.appendChild(noSelectorResult("No Contact Found")),document.getElementById("users-selector-search").style.display="none"),a.onclick=function(){if("add-number"===a.dataset.type)return document.getElementById("users-selector-search").style.display="none",removeChildNodes(i),a.remove(),void addNewNumber(c);if(c.attachment.present){var e=document.querySelector(".mdc-radio.radio-selected");if(!e)return void(document.getElementById("selector-warning").textContent="* Please Select A Contact");var t=new mdc.radio.MDCRadio(e);updateDomFromIDB(c.record,{hash:"",key:c.attachment.key},{primary:JSON.parse(t.value)}).then(function(e){updateCreateActivity(e,!0)}).catch(handleError)}else c.record.hasOwnProperty("create")?resetSelectedContacts().then(function(e){e.length?updateDomFromIDB(c.record,{hash:"addOnlyAssignees"},{primary:e}).then(function(e){document.body.classList.remove("mdc-dialog-scroll-lock"),updateCreateActivity(e,!0)}).catch(handleError):document.getElementById("selector-warning").textContent="* Please Select A Contact"}):isLocationStatusWorking()&&shareReq(c)},document.querySelectorAll('[data-selected="true"]').forEach(function(e){e&&(new mdc.checkbox.MDCCheckbox.attachTo(e).checked=!0,e.children[1].style.animation="none",e.children[1].children[0].children[0].style.animation="none")})}}}function noSelectorResult(e){var t=document.createElement("div");t.className="data-not-found";var a=document.createElement("p");return a.className="mdc-typography--headline5",a.textContent=e,t.appendChild(a),t}function shareReq(a){resetSelectedContacts().then(function(e){var t={activityId:a.record.activityId,share:e};document.querySelector("header").appendChild(progressBar()),requestCreator("share",t)})}function addNewNumber(a){var e=document.createElement("div");e.className="custom-number--container";var t=document.createElement("input");t.className="mdc-text-field__input",t.id="number-field",t.type="number",t.setAttribute("maxlength","10"),t.setAttribute("size","10"),t.required=!0,t.onkeypress=function(e){return 48<=e.charCode&&e.charCode<=57},t.oninput=function(){this.value.length>this.maxLength?this.value=this.value.slice(0,this.maxLength):this.value.length===this.maxLength?(document.querySelector(".message-field").classList.remove("error-message"),this.classList.add("valid-input"),document.querySelector(".message-field").textContent="",document.getElementById("new-contact").disabled=!1):(document.querySelector(".message-field").classList.add("error-message"),document.querySelector(".message-field").textContent="* Please Enter a valid Number",document.getElementById("new-contact").disabled=!0)};var n=document.createElement("button");n.className="mdc-button",n.textContent="Add Contact",n.id="new-contact",n.onclick=function(){var t=formatNumber(document.getElementById("number-field").value);checkNumber(t)?numberNotExist(t).then(function(e){if(e)return document.getElementById("new-contact").disabled=!0,document.querySelector(".message-field").classList.add("error-message"),void(document.querySelector(".message-field").textContent="* Contact already exist");a.attachment.present?updateDomFromIDB(a.record,{hash:"",key:a.attachment.key},{primary:t}).then(function(e){console.log(e),updateCreateActivity(e,!0)}).catch(handleError):a.record.hasOwnProperty("create")?updateDomFromIDB(a.record,{hash:"addOnlyAssignees"},{primary:[t]}).then(function(e){updateCreateActivity(e,!0)}).catch(handleError):isLocationStatusWorking()&&newNumberReq(a,t)}):(document.querySelector(".message-field").classList.add("error-message"),document.querySelector(".message-field").textContent="* Please Enter a valid Number",document.getElementById("new-contact").disabled=!0)};var o=document.createElement("p");o.className="mdc-typography--subtitle2 message-field",o.textContent="Enter new phone contact without country code",o.id="helper-message",e.appendChild(t),e.appendChild(o),e.appendChild(n),document.querySelector("#data-list--container").appendChild(e);new mdc.ripple.MDCRipple.attachTo(document.getElementById("new-contact"))}function newNumberReq(e,t){document.querySelector("header").appendChild(progressBar()),requestCreator("share",{activityId:e.record.activityId,share:[t]})}function numberNotExist(n){return new Promise(function(a){var e=firebase.auth().currentUser.uid,t=indexedDB.open(e);t.onsuccess=function(){t.result.transaction("users").objectStore("users").get(n).onsuccess=function(e){var t=e.target.result;a(!!t)}}})}function resetSelectedContacts(){return new Promise(function(n){var o=[],e=firebase.auth().currentUser.uid,t=indexedDB.open(e);t.onsuccess=function(){var a=t.result.transaction(["users"],"readwrite").objectStore("users");a.openCursor().onsuccess=function(e){var t=e.target.result;t?(t.value.isSelected&&(o.push(t.value.mobile),t.value.isSelected=!1,a.put(t.value)),t.continue()):n(o)}}})}function getLocationForMapSelector(r,d){return new Promise(function(e,t){var a=0,n=document.getElementById("data-list--container"),o=r.objectStore("map"),c=d.record.office,i=IDBKeyRange.bound([c,""],[c,"￿"]);o.index("byOffice").openCursor(i,"nextunique").onsuccess=function(e){var t=e.target.result;t&&(t.value.office===d.record.office&&t.value.location&&(a++,n.appendChild(createVenueLi(t.value,!1,d.record,!0))),t.continue())},r.oncomplete=function(){e(a)},r.onerror=function(){t(r.error)}})}function checkMapStoreForNearByLocation(r,d){return new Promise(function(o,c){var i=indexedDB.open(firebase.auth().currentUser.uid);i.onsuccess=function(){var n=[],e=i.result.transaction(["map"]),t=e.objectStore("map").index("byOffice"),a=IDBKeyRange.bound([r,""],[r,"￿"]);t.openCursor(a).onsuccess=function(e){var t=e.target.result;t&&(t.value.location&&t.value.latitude&&t.value.longitude&&isLocationLessThanThreshold(calculateDistanceBetweenTwoPoints(t.value,d))&&n.push(t.value),t.continue())},e.oncomplete=function(){var t={};n.forEach(function(e){t[e.location]=e});var a=[];Object.keys(t).forEach(function(e){a.push(t[e])}),o(a)},e.onerror=function(){c(e.error)}}})}function createSeachInput(e,t){var a=document.createElement("div");a.id=e,a.className="mdc-text-field mdc-text-field--with-leading-icon search-field";var n=document.createElement("i");n.className="material-icons mdc-text-field__icon",n.textContent="search";var o=document.createElement("input");o.className="mdc-text-field__input";var c=document.createElement("div");c.className="mdc-line-ripple";var i=document.createElement("label");return i.className="mdc-floating-label",i.textContent=t,a.appendChild(n),a.appendChild(o),a.appendChild(c),a.appendChild(i),a}function handleClickListnersForMap(n,o){document.querySelector("#selector-submit-send").onclick=function(){if(o){var e=document.querySelector(".mdc-radio.radio-selected");if(e){var t=new mdc.radio.MDCRadio(e),a=JSON.parse(t.value);updateDomFromIDB(n.record,{hash:"venue",key:n.key},{primary:a.location,secondary:{address:a.address,geopoint:a.geopoint}}).then(function(e){updateCreateActivity(e,!0)}).catch(function(e){console.log(e)})}else document.getElementById("selector-warning").textContent="* Please Choose A Location"}else updateCreateActivity(n.record,!0)}}function fillChildrenInSelector(e,n,t){var a=document.getElementById("data-list--container"),o=IDBKeyRange.bound([n.attachment.template,"CONFIRMED"],[n.attachment.template,"PENDING"]),c=0;e.openCursor(o).onsuccess=function(e){var t=e.target.result;t&&(n.attachment.office===t.value.office&&(t.value.attachment.Name&&(c++,a.appendChild(createSimpleLi("children",t.value.attachment.Name.value))),t.value.attachment.Number&&(c++,a.appendChild(createSimpleLi("children",t.value.attachment.Number.value)))),t.continue())},t.oncomplete=function(){var e=document.getElementById("selector-submit-send");if(!c)return a.appendChild(noSelectorResult("No Values Found")),e.textContent="CANCEL",void(e.onclick=function(){updateCreateActivity(n.record,!0)});document.getElementById("selector-submit-send").onclick=function(){var e=document.querySelector(".mdc-radio.radio-selected");if(e){var t=new mdc.radio.MDCRadio(e),a=JSON.parse(t.value);updateDomFromIDB(n.record,{hash:"children",key:n.attachment.key},{primary:a.name}).then(function(e){updateCreateActivity(e,!0)}).catch(function(e){console.log(e)})}else document.getElementById("selector-warning").textContent="* Please Select a Value"}}}function fillSubscriptionInSelector(e,o){var c=document.getElementById("data-list--container"),i=document.createElement("div");i.className="mdc-list-group";var r=[],t=e.transaction(["subscriptions"]);t.objectStore("subscriptions").index("office").openCursor(null,"nextunique").onsuccess=function(e){var t=e.target.result;if(t){var a=document.createElement("h3");a.className="mdc-list-group__subheader subheader--group-small",a.textContent=t.value.office,a.dataset.groupOffice=t.value.office;var n=document.createElement("ul");n.className="mdc-list",n.dataset.selection=t.value.office,n.setAttribute("aria-orientation","vertical"),r.push(t.value.office),i.appendChild(a),i.appendChild(n),t.continue()}},t.oncomplete=function(){if(o.suggestCheckIn){var e=document.getElementById("data-list--container"),t=document.createElement("div");t.className="suggest-checkin--view";var a=document.createElement("span");a.className="material-icons suggestion-icon",a.textContent="add_alert",t.appendChild(a);var n=document.createElement("span");n.textContent="Check-In ?",n.className="suggest-checkin--text",t.appendChild(a),t.appendChild(n),e.insertBefore(t,e.childNodes[0])}insertTemplateByOffice(r,o.suggestCheckIn),c.appendChild(i),document.getElementById("selector-submit-send").onclick=function(){if(isLocationStatusWorking())if(document.querySelector(".mdc-radio.radio-selected")){document.getElementById("selector-warning").textContent="";var e=new mdc.radio.MDCRadio(document.querySelector(".mdc-radio.radio-selected")),t=JSON.parse(e.value);document.getElementById("app-current-panel").dataset.view="create",createTempRecord(t.office,t.template,o)}else document.getElementById("selector-warning").textContent="Please Select a Template"}}}function insertTemplateByOffice(e,a){var t=indexedDB.open(firebase.auth().currentUser.uid),n=(document.createDocumentFragment(),[]);t.onsuccess=function(){var e=t.result.transaction(["subscriptions"],"readonly");e.objectStore("subscriptions").index("office").openCursor().onsuccess=function(e){var t=e.target.result;if(t)if("CANCELLED"!==t.value.status)if(document.querySelector('[data-selection="'+t.value.office+'"] [data-template="'+t.value.template+'"]'))t.continue();else{if(a&&"check-in"===t.value.template)return n.push(_defineProperty({},t.value.office,createGroupList(t.value.office,t.value.template))),void t.continue();document.querySelector('[data-selection="'+t.value.office+'"]').appendChild(createGroupList(t.value.office,t.value.template)),t.continue()}else t.continue()},e.oncomplete=function(){n.forEach(function(a){Object.keys(a).forEach(function(e){var t=document.querySelector('[data-selection="'+e+'"]');t.insertBefore(a[e],t.childNodes[0])})}),document.querySelector(".selector-send").classList.remove("hidden")}}}function createTempRecord(a,i,e){var t=firebase.auth().currentUser.uid,n=indexedDB.open(t);n.onsuccess=function(){var e=n.result.transaction(["subscriptions"]).objectStore("subscriptions").index("officeTemplate"),t=IDBKeyRange.only([a,i]);e.get(t).onsuccess=function(e){var o=e.target.result;if(o){var a=[];o.schedule.forEach(function(e){var t={};t.name=e,t.startTime="",t.endTime="",a.push(t)});var c={office:o.office,template:o.template,venue:"",schedule:a,attachment:o.attachment,timestamp:Date.now(),canEdit:!0,assignees:[],activityName:o.template.toUpperCase(),create:!0},n=[];"check-in"!==i?(o.venue.forEach(function(e){var t={};t.venueDescriptor=e,t.location="",t.address="",t.geopoint={_latitude:"",_longitude:""},n.push(t)}),c.venue=n,updateCreateActivity(c)):getRootRecord().then(function(e){var t={};t.venueDescriptor=o.venue[0],t.location="",t.address="",t.geopoint={_latitude:"",_longitude:""},c.venue=[t];var a=isLastLocationOlderThanThreshold(e.location.lastLocationTime,5);if(!e.location||a){var n="Fetching Location Please wait. ";return"Android"===native.getName()&&(n+=" Make Sure you have set Location Mode to High Accuracy"),appDialog(n,!1),void manageLocation().then(function(e){e.latitude&&e.longitude&&(updateLocationInRoot(e),document.querySelector("#enable-gps")&&document.querySelector("#enable-gps").remove(),updateCreateActivity(c))}).catch(function(e){document.querySelector("#enable-gps")&&document.querySelector("#enable-gps").remove();var t="There was a problem in detecting your location";"Android"===native.getName()&&(t+=". Make sure you have set Location Mode to high accuracy"),appDialog(t,!1),setTimeout(function(){document.querySelector("#enable-gps")&&document.querySelector("#enable-gps").remove()},5e3),listView(),handleError(e)})}updateCreateActivity(c)})}}}}function hasAnyValueInChildren(o,c,i){var e=firebase.auth().currentUser.uid,t=indexedDB.open(e);return new Promise(function(n){t.onsuccess=function(){var e=t.result.transaction("children").objectStore("children"),a=0;e.openCursor().onsuccess=function(e){var t=e.target.result;t?(t.value.template===c&&t.value.office===o&&"CANCELLED"!=i&&a++,t.continue()):n(0!==a)}}})}function updateDomFromIDB(c,i,r){return new Promise(function(a,n){var e=firebase.auth().currentUser.uid,o=indexedDB.open(e);o.onsuccess=function(){var e=o.result,t=c;if("venue"!==i.hash){if("addOnlyAssignees"===i.hash){if(!r.primary.length)return;return r.primary.forEach(function(e){-1<t.assignees.indexOf(e)||t.assignees.push(e)}),void a(t)}"weekday"!==i.hash&&i.hasOwnProperty("key")&&(t.attachment[i.key].value=r.primary,updateLocalRecord(t,e).then(function(e){a(t)}).catch(function(e){n(e)}))}else updateLocalRecord(t=updateVenue(t,i,r),e).then(function(e){a(t)}).catch(function(e){console.log(e),n(e)})}})}function updateLocalRecord(c,i){return new Promise(function(e,t){var a=i.transaction(["activity"],"readwrite"),n=a.objectStore("activity"),o=c;o.hasOwnProperty("create")||n.put(o),a.oncomplete=function(){e("activity object store updated with value")},a.onerror=function(){t({message:a.error.message+" from updateLocalRecord"})}})}function changeTextContentForNewSelectedVenue(e,t){var a=document.getElementById(convertKeyToId(e.key));if(a){var n=a.querySelector("[data-primary]"),o=a.querySelector("[data-secondary]"),c=document.getElementById("send-activity");t.primary&&n&&(n.textContent=t.primary),t.hasOwnProperty("secondary")&&o&&(o.textContent=t.secondary.address),c&&(c.dataset.progress||c.classList.remove("hidden"))}}function updateVenue(e,t,a){return e.venue.forEach(function(e){e.venueDescriptor===t.key&&(e.location=a.primary,e.address=a.secondary.address,e.geopoint._latitude=a.secondary.geopoint._latitude,e.geopoint._longitude=a.secondary.geopoint._longitude)}),e}function convertKeyToId(e){return e.replace(/-/g,"--").replace(/\s/g,"-")}function convertIdToKey(e){return e.replace(/-/g," ").replace("  ","-")}function updateCreateContainer(e,t,a){var n=JSON.parse(e);document.body.style.backgroundColor="#eeeeee";var o=document.createElement("div");o.style.display="inline-flex";var c=document.createElement("span");c.className="material-icons",c.textContent="arrow_back",c.id="backToConv";var i=document.createElement("span");i.textContent=n.activityName,i.style.fontSize="18px",i.style.paddingLeft="10px",i.style.marginTop="6px",i.className="mdc-list-item__text",i.style.width=document.documentElement.clientWidth-100+"px",o.appendChild(c),o.appendChild(i);var r=document.createElement("div");modifyHeader({id:"app-main-header",left:o.outerHTML,right:r.outerHTML}),document.getElementById("backToConv").addEventListener("click",function(){updateLocalRecord(n,t).then(function(){backNav()}).catch(handleError)});var d=document.createElement("div");d.className="mdc-top-app-bar--fixed-adjust update-create--activity";for(var l=["office","venue","schedule","attachment","assignees"],s=0;s<5;s++){var u=document.createElement("ul");u.className="mdc-list custom--list-margin";var m=document.createElement("div");switch(l[s]){case"office":u.classList.remove("custom--list-margin");break;case"schedule":m.className="mdc-list-group__subheader",m.id="schedule--group";break;case"venue":case"assignees":u.classList.add("mdc-list--two-line","mdc-list--avatar-list")}"schedule"===l[s]?d.appendChild(m):(u.id=l[s]+"--list",d.appendChild(u))}if(n.canEdit){var p=document.createElement("button");p.setAttribute("aria-label","Send"),n.create?p.className="":a||(p.className="hidden"),p.id="send-activity",p.textContent="SUBMIT",d.appendChild(p)}return d}function updateCreateActivity(i,r){"updateCreateActivity"===history.state[0]?history.replaceState(["updateCreateActivity",i],null,null):history.pushState(["updateCreateActivity",i],null,null);var e=firebase.auth().currentUser.uid,d=indexedDB.open(e);d.onsuccess=function(){var e=d.result,t=document.getElementById("app-current-panel"),a=JSON.stringify(i);t.innerHTML=updateCreateContainer(a,e,r).outerHTML,document.getElementById("office--list").appendChild(createSimpleLi("Office",{office:i.office,showLabel:!0})),createVenueSection(i),createScheduleTable(i),createAttachmentContainer(i),createAssigneeList(i,!0,e),createActivityCancellation(i),window.scrollTo(0,0),document.getElementById("send-activity")&&document.getElementById("send-activity").addEventListener("click",function(){isLocationStatusWorking()&&(this.dataset.progress=!0,sendActivity(i))});for(var n=document.querySelectorAll(".update-create--activity input"),o=0;o<n.length;o++)n[o].addEventListener("input",function(e){document.getElementById("send-activity").dataset.progress||document.getElementById("send-activity").classList.contains("hidden")&&document.getElementById("send-activity").classList.remove("hidden")});if(document.querySelector(".mdc-select")){var c=new mdc.select.MDCSelect(document.querySelector(".mdc-select"));c.listen("change",function(){updateDomFromIDB(i,{hash:"weekday",key:c.root_.dataset.value},{primary:c.value}).then(function(e){document.getElementById("send-activity").dataset.progress||document.getElementById("send-activity").classList.contains("hidden")&&document.getElementById("send-activity").classList.remove("hidden")}).catch(handleError)})}}}function createCheckInVenue(e,t){var a=document.createElement("div");a.className="mdc-radio checkin",a.value=JSON.stringify(e);var n=document.createElement("input");n.className="mdc-radio__native-control",n.type="radio",n.setAttribute("name","radios"),t&&n.setAttribute("checked","true");var o=document.createElement("div");o.className="mdc-radio__background";var c=document.createElement("div");c.className="mdc-radio__outer-circle";var i=document.createElement("div");i.className="mdc-radio__inner-circle",o.appendChild(c),o.appendChild(i),a.appendChild(n),a.appendChild(o);return a}function createSimpleLi(e,t){var a=document.createElement("li");a.className="mdc-list-item mdc-ripple-upgraded";var n=document.createElement("span");n.className="detail--static-text";document.createElement("span");var o=document.createElement("span");if("Office"===e&&(o.className="data--value-list",o.textContent=t.office,n.textContent=e,a.appendChild(n),a.appendChild(o)),"children"===e){var c=document.createElement("span");c.className="mdc-list-item__meta",c.appendChild(createRadioInput()),a.textContent=t,a.appendChild(c),a.onclick=function(){checkRadioInput(this,{name:t})}}if("delete"===e&&(o.className="mdc-list-item__graphic material-icons",o.textContent=e,n.classList.remove("detail--static-text"),n.classList.add("delete-activity"),n.textContent=t.text,a.appendChild(o),a.appendChild(n)),"empty"===e&&(a.dataset.prop="delete"),"undo-deleted"===e){o.className="mdc-list-item__graphic material-icons",o.textContent="delete",n.classList.remove("detail--static-text"),n.classList.add("delete-activity"),n.textContent=t.text,a.appendChild(o),a.appendChild(n),a.classList.add("undo-delete-activity");var i=document.createElement("button");i.className="mdc-button mdc-ripple-upgraded mdc-list-item__meta undo-deleted",i.textContent="Undo",i.onclick=function(){isLocationStatusWorking()&&(document.querySelector(".undo-deleted").style.display="none",a.appendChild(loader("undo-delete-loader")),reqForUndoDeleted(t.id))},a.appendChild(i)}return a}function reqForUndoDeleted(e){requestCreator("statusChange",{activityId:e,status:"PENDING"})}function createGroupList(e,t){var a=document.createElement("li");a.className="mdc-list-item transition-ease",a.dataset.template=t;var n=document.createElement("span");n.className="mdc-list-item__text",n.textContent=t.toUpperCase();var o=document.createElement("span");return o.className="mdc-list-item__meta",o.appendChild(createRadioInput()),a.onclick=function(){checkRadioInput(this,{office:e,template:t})},a.appendChild(n),a.appendChild(o),a}function createVenueSection(r){var d=document.getElementById("venue--list");"check-in"===r.template&&r.hasOwnProperty("create")?getRootRecord().then(function(e){checkMapStoreForNearByLocation(r.office,e.location).then(function(e){if(e.length){var o=!1,t=document.createElement("li");t.className="mdc-list-item label--text",t.textContent=r.venue[0].venueDescriptor,t.style.height="50px",t.style.paddingRight="11px";var a=document.createElement("span");a.className="mdc-list-item__meta";var n=document.createElement("label");n.id="uncheck-checkin",n.className="mdc-fab add--assignee-icon";var c=document.createElement("span");c.className="mdc-fab__icon material-icons",c.textContent="clear",n.appendChild(c),a.appendChild(n),t.appendChild(a),d.appendChild(t),1==e.length&&(o=!0),e.forEach(function(e){var t=document.createElement("div");t.className="mdc-form-field check-in-form";var a=document.createElement("label");a.setAttribute("for","check-in-radio"),a.textContent=e.location,t.appendChild(a),t.appendChild(createCheckInVenue(e,o)),d.appendChild(t);var n=document.createElement("div");n.id="map-detail-check-in-create"+convertKeyToId(e.venueDescriptor),d.appendChild(n)});var i=document.getElementById("uncheck-checkin");i&&i.addEventListener("click",function(){document.querySelectorAll(".mdc-radio.checkin").forEach(function(e){new mdc.radio.MDCRadio(e).checked=!1})})}})}):(r.venue.forEach(function(e){d.appendChild(createVenueLi(e,!0,r));var t=document.createElement("div");t.className="map-detail "+convertKeyToId(e.venueDescriptor),d.appendChild(t)}),"check-in"===r.template&&(r.venue[0].location&&r.venue[0].address||(document.getElementById("venue--list").style.display="none")),0===r.venue.length&&(document.getElementById("venue--list").style.display="none"))}function createVenueLi(a,e,t,n){var o=!1,c=document.createElement("li");c.className="mdc-list-item mdc-ripple-upgraded",c.id=convertKeyToId(a.venueDescriptor);var i=document.createElement("div");i.className="mdc-list-item__text link--span";var r=document.createElement("span");r.className="mdc-list-item__primary-text";var d=document.createElement("span");d.className="mdc-list-item__meta";var l=document.createElement("label");l.className="mdc-fab add--assignee-icon attachment-selector-label";var s=document.createElement("span");if(s.className="mdc-fab__icon material-icons",s.textContent="add_location",l.appendChild(s),e){var u=document.createElement("span");u.className="detail--static-text",u.textContent=a.venueDescriptor;var m=document.createElement("span");m.className="data--value-list",m.textContent=a.location,m.dataset.primary="",r.appendChild(u),r.appendChild(m),i.appendChild(r),i.onclick=function(e){if(hasMapsApiLoaded()&&a.geopoint._latitude&&a.geopoint._longitude){o=!o;var t={lat:a.geopoint._latitude,lng:a.geopoint._longitude};maps("",o,convertKeyToId(a.venueDescriptor),t)}},t.canEdit&&(d.setAttribute("aria-hidden","true"),d.appendChild(l),l.onclick=function(e){insertInputsIntoActivity(t),history.replaceState(["updateCreateActivity",t],null,null),selectorUI({record:t,store:"map",attachment:{present:!1},key:a.venueDescriptor})})}else r.textContent=a.location,i.appendChild(r);var p=document.createElement("span");p.className="mdc-list-item__meta material-icons",n&&(p.appendChild(createRadioInput()),c.onclick=function(){checkRadioInput(this,{location:a.location,address:a.address,geopoint:{_latitude:a.latitude,_longitude:a.longitude},venueDesc:a.venueDescriptor})});var h=document.createElement("span");return h.className="mdc-list-item__secondary-text",h.textContent=a.address,h.dataset.secondary="",i.appendChild(h),c.appendChild(i),n?c.appendChild(p):c.appendChild(d),c}function createScheduleTable(v){v.schedule.length||(document.getElementById("schedule--group").style.display="none");var g=0;v.schedule.forEach(function(e){g++;var t=document.createElement("h5");t.className="mdc-list-group__subheader label--text",t.textContent=e.name;var a=document.createElement("ul");a.className="mdc-list mdc-list--dense";var n=document.createElement("li");n.className="mdc-list-divider",n.setAttribute("role","separator");var o=document.createElement("li");o.className="mdc-list-item schedule-start-li";var c=document.createElement("div");c.className="mdc-text-field start--date"+g;var i=document.createElement("input");i.value=moment(e.startTime||new Date).format("YYYY-MM-DD"),i.type="date",i.disabled=!v.canEdit,i.className="mdc-text-field__input",c.appendChild(i);var r=document.createElement("span");r.className="mdc-list-item__meta";var d=document.createElement("div");d.className="mdc-text-field start--time"+g;var l=document.createElement("input");e.startTime?l.value=moment(e.startTime).format("HH:mm"):l.value=moment("24","HH:mm").format("HH:mm"),l.type="time",l.className="time--input",l.disabled=!v.canEdit,l.className="mdc-text-field__input",d.appendChild(l),r.appendChild(d);var s=document.createElement("li");s.className="mdc-list-item schedule-end-li";var u=document.createElement("div");u.className="mdc-text-field end--date"+g;var m=document.createElement("input");m.value=moment(e.endTime||moment().add(1,"days")).format("YYYY-MM-DD"),m.type="date",m.disabled=!v.canEdit,m.className="mdc-text-field__input",u.appendChild(m);var p=document.createElement("span");p.className="mdc-list-item__meta";var h=document.createElement("div");h.className="mdc-text-field end--time"+g;var f=document.createElement("input");e.endTime?f.value=moment(e.endTime||new Date).format("HH:mm"):f.value=moment("24","HH:mm").format("HH:mm"),f.type="time",f.disabled=!v.canEdit,f.className="mdc-text-field__input",h.appendChild(f),p.appendChild(h),o.appendChild(c),o.appendChild(r),s.appendChild(u),s.appendChild(p),a.appendChild(o),a.appendChild(n),a.appendChild(s),document.getElementById("schedule--group").appendChild(t),document.getElementById("schedule--group").appendChild(a)})}function createAttachmentContainer(p){["Name","Number","Template","email","phoneNumber","HHMM","weekday","number","base64","string"].forEach(function(e){var t=document.createElement("div");t.className=e+"--group",document.getElementById("attachment--list").appendChild(t)});var h={phoneNumber:"",weekday:"","HH:MM":"",string:"",base64:"",number:"",email:""};Object.keys(p.attachment).forEach(function(t){var a=document.createElement("div");"HH:MM"===p.attachment[t].type?a.className="attachment-field HHMM":a.className="attachment-field "+p.attachment[t].type,a.id=convertKeyToId(t),p.canEdit&&a.classList.add("editable--true");var e=document.createElement("span");if(e.className="label--text","Name"===(e.textContent=t)||"Number"===t){a.appendChild(e);a.appendChild(createSimpleInput(p.attachment[t].value,p.canEdit,"",t,!0))}else"string"===p.attachment[t].type&&(a.appendChild(e),a.appendChild(createSimpleInput(p.attachment[t].value,p.canEdit,"",t)));if("number"===p.attachment[t].type&&(a.appendChild(e),a.appendChild(createNumberInput(p.attachment[t].value,p.canEdit))),"email"===p.attachment[t].type&&(a.appendChild(e),a.appendChild(createEmailInput(p.attachment[t].value,p.canEdit))),"phoneNumber"===p.attachment[t].type){a.classList.add("selector--margin");var n=document.createElement("label");n.className="mdc-fab add--assignee-icon attachment-selector-label";var o=document.createElement("span");o.className="mdc-fab__icon material-icons",o.textContent="person_add",n.appendChild(o);var c=document.createElement("span");c.className="data--value-list",c.dataset.primary="",p.canEdit&&(a.appendChild(n),n.onclick=function(e){insertInputsIntoActivity(p),history.replaceState(["updateCreateActivity",p],null,null),selectorUI({record:p,store:"users",attachment:{present:!0,key:t}})}),a.appendChild(e),c.textContent=p.attachment[t].value,a.appendChild(c)}if("HH:MM"==p.attachment[t].type&&(a.appendChild(e),a.appendChild(createTimeInput(p.attachment[t].value,p.canEdit,{simple:!1,type:"time"}))),"weekday"===p.attachment[t].type&&(a.appendChild(e),a.appendChild(createSelectMenu(t,p.attachment[t].value,p.canEdit))),"base64"===p.attachment[t].type){var i=document.createElement("label");i.className="mdc-fab attachment-selector-label add--assignee-icon",i.id="start-camera";var r=document.createElement("span");r.className="mdc-fab__icon material-icons",r.textContent="add_a_photo",i.appendChild(r);var d=document.createElement("ul");d.className="image-preview--attachment mdc-image-list standard-image-list mdc-image-list--with-text-protection",d.appendChild(setFilePath(p.attachment[t].value,t,!0)),a.appendChild(d),p.canEdit&&(a.appendChild(i),a.appendChild(d),i.onclick=function(){readCameraFile()})}if(!h.hasOwnProperty(p.attachment[t].type)){var l=document.createElement("label");l.className="mdc-fab add--assignee-icon attachment-selector-label";var s=document.createElement("span");s.className="mdc-fab__icon material-icons",s.textContent="add",l.appendChild(s),a.appendChild(e);var u=document.createElement("span");u.textContent=p.attachment[t].value,u.className="data--value-list",a.appendChild(u),p.canEdit&&hasAnyValueInChildren(p.office,p.attachment[t].type,p.status).then(function(e){e&&(a.appendChild(l),a.classList.add("selector--margin"),l.onclick=function(e){u.dataset.primary="",insertInputsIntoActivity(p),history.replaceState(["updateCreateActivity",p],null,null),selectorUI({record:p,store:"children",attachment:{present:!0,key:t,office:p.office,template:p.attachment[t].type,status:p.status}})})})}var m=document.createElement("hr");m.className="attachment--divider","HH:MM"===p.attachment[t].type?(document.querySelector(".HHMM--group").appendChild(a),document.querySelector(".HHMM--group").appendChild(m)):"Name"===t?(document.querySelector(".Name--group").appendChild(a),document.querySelector(".Name--group").appendChild(m)):h.hasOwnProperty(p.attachment[t].type)?(document.querySelector("."+p.attachment[t].type+"--group").appendChild(a),document.querySelector("."+p.attachment[t].type+"--group").appendChild(m)):(document.querySelector(".Template--group").appendChild(a),document.querySelector(".Template--group").appendChild(m))})}function createAssigneeList(t,e,a){var n=document.getElementById("assignees--list");if(e){var o=document.createElement("li");o.className="mdc-list-item label--text add--assignee-loader",o.textContent="Assignees";var c=document.createElement("span");c.className="mdc-list-item__meta";var i=document.createElement("div");i.className="mdc-fab add--assignee-icon",i.onclick=function(e){insertInputsIntoActivity(t),history.replaceState(["updateCreateActivity",t],null,null),selectorUI({record:t,store:"users",attachment:{present:!1}})};var r=document.createElement("span");r.className="mdc-fab__icon material-icons",r.textContent="person_add",i.appendChild(r),c.appendChild(i),t.canEdit&&o.appendChild(c),n.appendChild(o)}t.assignees.forEach(function(e){getUserRecord(a,e).then(function(e){n.appendChild(createSimpleAssigneeLi(e))})})}function createSimpleAssigneeLi(e,t,a){var n=document.createElement("li");if(n.classList.add("mdc-list-item","assignee-li"),!e)return n;n.dataset.value=e.mobile;var o=document.createElement("object");o.data=e.photoURL||"./img/empty-user.jpg",o.type="image/jpeg",o.className="mdc-list-item__graphic";var c=document.createElement("img");c.src="./img/empty-user.jpg",c.className="empty-user-assignee",o.appendChild(c);var i=document.createElement("span");i.classList.add("mdc-list-item__text");var r=document.createElement("span");r.className="mdc-list-item__primary-text";var d=document.createElement("span");d.classList.add("mdc-list-item__secondary-text"),e.displayName?(r.textContent=e.displayName,d.textContent=e.mobile):r.textContent=e.mobile,i.appendChild(r),i.appendChild(d);var l=document.createElement("span");return l.className="mdc-list-item__meta material-icons",t&&(a?l.appendChild(createCheckBox(e)):(l.appendChild(createRadioInput()),n.onclick=function(){checkRadioInput(this,n.dataset.value)})),n.appendChild(o),n.appendChild(i),n.appendChild(l),n}function createRadioInput(){var e=document.createElement("div");e.className="mdc-radio radio-control-selector";var t=document.createElement("input");t.className="mdc-radio__native-control",t.type="radio",t.name="radio";var a=document.createElement("div");a.className="mdc-radio__background";var n=document.createElement("div");n.className="mdc-radio__outer-circle";var o=document.createElement("div");return o.className="mdc-radio__inner-circle",a.appendChild(n),a.appendChild(o),e.appendChild(t),e.appendChild(a),e}function createCheckBox(t){var e=document.createElement("div");e.className="mdc-checkbox status-check",e.dataset.selected=t.isSelected;var a=document.createElement("input");a.className="mdc-checkbox__native-control",a.type="checkbox",a.onclick=function(e){checkCheckboxInput(e,t)};var n=document.createElement("div");n.className="mdc-checkbox__background";return document.createElement("div").className="mdc-checkbox__mixedmark",n.innerHTML='<svg class="mdc-checkbox__checkmark"\n    viewBox="0 0 24 24">\n    <path class="mdc-checkbox__checkmark-path"\n    fill="none"\n    d="M1.73,12.91 8.1,19.28 22.79,4.59"/>\n    </svg>\n    <div class="mdc-checkbox__mixedmark"></div>',e.appendChild(a),e.appendChild(n),e}function checkCheckboxInput(t,a){var e=firebase.auth().currentUser.uid,n=indexedDB.open(e);n.onsuccess=function(){var e=n.result.transaction("users","readwrite").objectStore("users");a.hasOwnProperty("isSelected")&&a.isSelected?(t.target.parentNode.dataset.selected=!1,a.isSelected=!1):(t.target.parentNode.dataset.selected=!0,a.isSelected=!0),e.put(a),document.querySelectorAll('[data-selected="true"]').length&&(document.querySelector(".selector-send").dataset.type="",document.querySelector(".selector-send").textContent="SELECT")}}function checkRadioInput(e,t){document.getElementById("selector-submit-send").textContent="SELECT",[].concat(_toConsumableArray(document.querySelectorAll(".radio-selected"))).forEach(function(e){e.classList.remove("radio-selected")});var a=e;if(a){var n=new mdc.radio.MDCRadio(a.querySelector(".radio-control-selector"));n.root_.classList.add("radio-selected"),document.getElementById("selector-submit-send").dataset.type="",n.value=JSON.stringify(t)}}function setFilePath(e,t,a){if(document.querySelector(".image--list-li"))return document.getElementById("attachment-picture").data="data:image/jpg;base64,"+e,document.getElementById("attachment-picture").dataset.value="data:image/jpg;base64,"+e,void(document.getElementById("send-activity").dataset.progress||document.getElementById("send-activity").classList.remove("hidden"));var n=document.createElement("li");n.className="mdc-image-list__item image--list-li";var o=document.createElement("div"),c=document.createElement("object");c.data=e||"./img/placeholder.png",c.type="image/jpeg",c.id="attachment-picture",c.dataset.photoKey=t,c.className="profile-container--main mdc-image-list__image";var i=document.createElement("img");i.src="./img/placeholder.png",i.className="profile-container--main mdc-image-list__image",c.dataset.value=e?c.src=e:(c.data="./img/placeholder.png",""),c.appendChild(i),c.onclick=function(){openImage(this.data)},o.appendChild(c),n.appendChild(o);var r=document.createElement("div");r.className="mdc-image-list__supporting";var d=document.createElement("span");return d.textContent=t,d.className="mdc-image-list__label",d.id="label--image",r.appendChild(d),n.appendChild(r),a?n:void 0}function readCameraFile(){if("Android"===native.getName())try{AndroidInterface.startCamera()}catch(e){sendExceptionObject(e,"CATCH Type 11: AndroidInterface.startCamera at readCameraFile",[])}else webkit.messageHandlers.takeImageForAttachment.postMessage("convert image to base 64")}function openImage(e){e&&(document.getElementById("viewImage--dialog-component").querySelector("img").src=e,new mdc.dialog.MDCDialog.attachTo(document.querySelector("#viewImage--dialog-component")).show())}function createActivityCancellation(e){if(e.canEdit){var t=document.createElement("div");if(t.className="status--cancel-cont",!e.hasOwnProperty("create"))if("CANCELLED"!==e.status){if("CANCELLED"!==e.status){if(t.appendChild(createSimpleLi("delete",{text:"CANCEL"})),document.querySelector(".update-create--activity").appendChild(t),!e.canEdit)return;document.getElementById("cancel-alert")||cancelAlertDialog();var a=new mdc.dialog.MDCDialog(document.querySelector("#cancel-alert"));document.getElementById("delete-allow").onclick=function(){isLocationStatusWorking()&&deleteActivityReq(e.activityId)},a.listen("MDCDialog:cancel",function(){}),document.querySelector(".delete-activity").addEventListener("click",function(e){a.lastFocusedTarget=e.target,a.show()})}}else{t.appendChild(createSimpleLi("undo-deleted",{text:"Cancelled",id:e.activityId})),document.querySelector(".update-create--activity").appendChild(t);new mdc.ripple.MDCRipple.attachTo(document.querySelector(".undo-deleted"))}}}function deleteActivityReq(e){document.querySelector(".delete-activity").style.display="none",document.querySelector(".status--cancel-cont li").appendChild(loader("cancel-loader")),requestCreator("statusChange",{activityId:e,status:"CANCELLED"})}function cancelAlertDialog(){var e=document.createElement("aside");e.className="mdc-dialog",e.id="cancel-alert";var t=document.createElement("div");t.className="mdc-dialog__surface";var a=document.createElement("section");a.className="mdc-dialog__body",a.textContent="Are you sure you want to delete this activity ? ";var n=document.createElement("footer");n.className="mdc-dialog__footer";var o=document.createElement("button");o.type="button",o.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--accept delete-btn",o.textContent="Delete",o.id="delete-allow";var c=document.createElement("button");c.type="button",c.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--cancel cancel-delete-btn",c.textContent="Cancel",n.appendChild(c),n.appendChild(o),t.appendChild(a),t.appendChild(n),e.appendChild(t);var i=document.createElement("div");i.className="mdc-dialog__backdrop",e.appendChild(i),document.body.appendChild(e)}function sendActivity(t){if(t.hasOwnProperty("create"))insertInputsIntoActivity(t,!0);else{var e=firebase.auth().currentUser.uid,a=indexedDB.open(e);a.onsuccess=function(e){a.result.transaction("activity","readwrite").objectStore("activity").get(t.activityId).onsuccess=function(e){insertInputsIntoActivity(e.target.result,!0)}}}}function concatDateWithTime(e,t){var a=moment(e+" "+t);return moment(a).valueOf()}function insertInputsIntoActivity(a,e){for(var t=document.querySelectorAll(".string"),n=0;n<t.length;n++){var o=t[n].querySelector(".mdc-text-field__input").value;if(t[n].querySelector(".mdc-text-field__input").required&&checkSpacesInString(o))return void(e&&snacks("Please provide an input for the field “Name” "));a.attachment[convertIdToKey(t[n].id)].value=o}var c=document.querySelectorAll(".number");for(n=0;n<c.length;n++){var i=Number(c[n].querySelector(".mdc-text-field__input").value);a.attachment[convertIdToKey(c[n].id)].value=i}var r=document.querySelectorAll(".email");for(n=0;n<r.length;n++){var d=r[n].querySelector(".mdc-text-field__input").value;a.attachment[convertIdToKey(r[n].id)].value=d}var l=document.querySelectorAll(".HHMM");for(n=0;n<l.length;n++){var s=l[n].querySelector(".mdc-text-field__input").value;a.attachment[convertIdToKey(l[n].id)].value=s}for(var u=document.querySelectorAll(".image-preview--attachment  object"),m=0;m<u.length;m++)a.attachment[convertKeyToId(u[m].dataset.photoKey)].value=u[m].dataset.value;var p=void 0,h=void 0,f=void 0,v=void 0;for(n=1;n<a.schedule.length+1;n++)if(p=getInputText(".start--date"+n).value,h=getInputText(".start--time"+n).value,f=getInputText(".end--date"+n).value,v=getInputText(".end--time"+n).value,concatDateWithTime(p,h)||concatDateWithTime(f,v)){if(p&&!h)return void snacks("Please Select a Start Time");if(h&&!p)return void snacks("Please Select a Start Date");if(concatDateWithTime(p,h)&&!f)return void snacks("Please Select a End Date");if(concatDateWithTime(p,h)&&!v)return void snacks("Please Select a End Time");if(concatDateWithTime(f,v)<concatDateWithTime(p,h))return void snacks("The End Date and Time should be greater or equal to the start time");a.schedule[n-1].startTime=concatDateWithTime(p,h)||"",a.schedule[n-1].endTime=concatDateWithTime(f,v)||""}else a.schedule[n-1].startTime=concatDateWithTime(p,h)||"",a.schedule[n-1].endTime=concatDateWithTime(f,v)||"";if("check-in"===a.template)document.querySelectorAll(".mdc-radio.checkin").forEach(function(e){if(new mdc.radio.MDCRadio(e).checked){var t=JSON.parse(e.value);a.venue[0].geopoint={latitude:t.latitude,longitude:t.longitude},a.venue[0].location=t.location,a.venue[0].address=t.address}}),a.venue[0].location&&a.venue[0].address||(a.venue[0].geopoint={latitude:"",longitude:""});else for(n=0;n<a.venue.length;n++)a.venue[n].geopoint={latitude:a.venue[n].geopoint._latitude||"",longitude:a.venue[n].geopoint._longitude||""},a.venue[n].hasOwnProperty("showIcon")&&delete a.venue[n].showIcon;var g={venue:a.venue,schedule:a.schedule,attachment:a.attachment};e&&sendUpdateReq(g,a)}function sendUpdateReq(e,t){if(!t.hasOwnProperty("create"))return e.activityId=t.activityId,document.querySelector("header").appendChild(progressBar()),document.querySelector("#send-activity").classList.add("hidden"),void requestCreator("update",e);e.office=t.office,e.template=t.template,e.share=t.assignees,document.querySelector("header").appendChild(progressBar()),document.querySelector("#send-activity").classList.add("hidden"),requestCreator("create",e)}function checkSpacesInString(e){return!e.replace(/\s/g,"").length}function initializeAutocompleteGoogle(n,o){n.addListener("place_changed",function(){var e=n.getPlace();if(e.geometry){var t="";e.address_components&&(t=[e.address_components[0]&&e.address_components[0].short_name||"",e.address_components[1]&&e.address_components[1].short_name||"",e.address_components[2]&&e.address_components[2].short_name||""].join(" "));var a={primary:e.name,secondary:{address:t,geopoint:{_latitude:e.geometry.location.lat(),_longitude:e.geometry.location.lng()}}};updateDomFromIDB(o.record,{hash:"venue",key:o.key},a).then(function(e){updateCreateActivity(e,!0)}).catch(handleError)}else snacks("Please select a valid location")})}function createSimpleInput(e,t,a,n,o){if(!t){var c=document.createElement("span");return c.className="data--value-list",c.textContent=e,c}var i=document.createElement("div");n&&n.length<15?i.className="mdc-text-field data--value-list":i.className="mdc-text-field data--value-list-small";var r=document.createElement("input");r.className="mdc-text-field__input input--value--update",r.style.paddingTop="0px",r.value=e,r.required=o;var d=document.createElement("div");if(d.className="mdc-line-ripple",a&&(i.id="search--bar--field",r.id="search--bar-selector",i.classList.add("field-input")),i.appendChild(r),i.appendChild(d),i)new mdc.textField.MDCTextField.attachTo(i);return i}function createNumberInput(e,t){if(!t){var a=document.createElement("span");return a.className="data--value-list",a.textContent=e,a}var n=document.createElement("div");n.className="mdc-text-field data--value-list";var o=document.createElement("input");o.className="mdc-text-field__input input--type-number",o.type="number",o.style.paddingTop="0px",o.value=e,o.setAttribute("onkeypress","return event.charCode >= 48 && event.charCode <= 57");var c=document.createElement("div");return c.className="mdc-line-ripple",n.appendChild(o),n.appendChild(c),n}function createEmailInput(e,t){if(!t){var a=document.createElement("span");return a.className="data--value-list",a.textContent=e,a}var n=document.createElement("div");n.className="mdc-text-field data--value-list";var o=document.createElement("input");o.className="mdc-text-field__input input--type-email",o.type="email",o.placeholder="johndoe@example.com",o.style.paddingTop="0px",o.value=e;var c=document.createElement("div");return c.className="mdc-line-ripple",n.appendChild(o),n.appendChild(c),n}function createTimeInput(e,t,a){if(!t){var n=document.createElement("span");return n.className="data--value-list","date"===a.type&&(n.textContent=e?moment(e).calendar():""),n}var o=document.createElement("div");o.className="mdc-text-field";var c=document.createElement("input");c.className="mdc-text-field__input input--type-time",c.type=a.type,c.style.borderBottom="none","date"===a.type?c.value=moment(e).format("DD-MM-YYYY"):c.value=e,"time"===a.type&&(o.classList.add("data--value-list"),c.style.width="100%",c.value=e||moment("24","HH:mm").format("HH:mm"));var i=document.createElement("div");return i.className="mdc-line-ripple",o.appendChild(c),o.appendChild(i),a.simple?(c.classList.remove("mdc-text-field__input"),c):o}function createSelectMenu(e,t,a){if(!a){var n=document.createElement("span");return n.className="data--value-list",n.textContent=t,n}var o=document.createElement("div");o.className="mdc-select data--value-list",o.style.height="32%;",o.id=convertKeyToId(e),o.dataset.value=e,o.dataset.primary="";var c=document.createElement("select");c.className="mdc-select__native-control",c.style.paddingRight="0px";for(var i=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],r=0;r<i.length;r++){var d=document.createElement("option");d.value=i[r],d.textContent=i[r],t===i[r]&&d.setAttribute("selected","true"),c.appendChild(d)}var l=document.createElement("label");l.className="mdc-floating-label",l.textContent="";var s=document.createElement("div");return s.className="mdc-line-ripple",o.appendChild(l),o.appendChild(c),o.appendChild(s),o}function toggleActionables(e){if(e&&"create"!==document.getElementById("app-current-panel").dataset.view){var t=indexedDB.open(firebase.auth().currentUser.uid);t.onsuccess=function(){t.result.transaction("activity").objectStore("activity").get(e).onsuccess=function(e){var t=e.target.result;if(t){document.querySelectorAll(".mdc-fab");t.editable&&(document.querySelector(".loader")&&(document.querySelector(".loader").remove(),document.querySelector(".add--assignee-loader .add--assignee-icon")&&(document.querySelector(".add--assignee-loader .add--assignee-icon").style.display="block")),document.querySelector(".progress--update")&&document.querySelector(".progress--update").remove())}else listView()}}}}var ui=void 0,native={setFCMToken:function(e){localStorage.setItem("token",e)},getFCMToken:function(){return localStorage.getItem("token")},setName:function(e){localStorage.setItem("deviceType",e)},getName:function(){return localStorage.getItem("deviceType")},setIosInfo:function(e){var t=e.split("&"),a={baseOs:t[0],deviceBrand:t[1],deviceModel:t[2],appVersion:Number(t[3]),osVersion:t[4],id:t[5],initConnection:t[6]};localStorage.setItem("iosUUID",JSON.stringify(a))},getIosInfo:function(){return localStorage.getItem("iosUUID")},getInfo:function(){if(!this.getName())return!1;if("Android"===this.getName())try{return AndroidInterface.getDeviceId()}catch(e){return sendExceptionObject(e,"Catch Type 3: AndroidInterface.getDeviceId in native.getInfo()",[]),JSON.stringify({baseOs:this.getName(),deviceBrand:"",deviceModel:"",appVersion:7,osVersion:"",id:""})}return this.getIosInfo()}},app={today:function(e){return e?moment().format(e):moment()},tomorrow:function(){return moment(this.today()).add(1,"day")},isNewDay:function(e){var t=localStorage.getItem("today");return t?!moment(moment().format("YYYY-MM-DD")).isSame(moment(t))&&(localStorage.setItem("today",moment().format("YYYY-MM-DD")),!0):(localStorage.setItem("today",moment().format("YYYY-MM-DD")),!0)}};function backNav(){history.back()}function firebaseUiConfig(t){return{callbacks:{signInSuccessWithAuthResult:function(e){if(t)return document.querySelector("#updateEmailDialog").remove(),updateEmail(e.user,t),!1},signInFailure:function(e){return handleUIError(e)},uiShown:function(){}},signInFlow:"popup",signInOptions:[{provider:firebase.auth.PhoneAuthProvider.PROVIDER_ID,recaptchaParameters:{type:"image",size:"normal",badge:"bottomleft"},defaultCountry:"IN",defaultNationalNumber:t?firebase.auth().currentUser.phoneNumber:""}]}}function userSignedOut(){var e=document.createElement("div");e.id="login-container",document.body.appendChild(e),ui||(ui=new firebaseui.auth.AuthUI(firebase.auth())),ui.start("#login-container",firebaseUiConfig())}function layoutGrid(){var e=document.createElement("div");e.classList.add("mdc-layout-grid","mdc-typography","app"),e.id="main-layout-app";var t=document.createElement("div");t.className="mdc-layout-grid__inner cell-space";var a=document.createElement("div");a.id="header";var n=document.createElement("div");n.id="app-current-panel",n.className="mdc-layout-grid__cell--span-12";var o=document.createElement("div");o.id="snackbar-container";var c=document.createElement("div");c.id="alert--box",a.appendChild(createHeader("app-main-header")),t.appendChild(a),t.appendChild(n),t.appendChild(o),e.appendChild(t),e.appendChild(c),document.body.innerHTML=e.outerHTML,imageViewDialog()}function createCheckInDialog(){var e=document.createElement("aside");e.className="mdc-dialog mdc-dialog--open hidden",e.id="suggest-checkIn-dialog",e.style.backgroundColor="rgba(0,0,0,0.47)";var t=document.createElement("div");t.className="mdc-dialog__surface",t.style.width="90%",t.style.height="auto";var a=document.createElement("header");a.className="mdc-dialog__header";var n=document.createElement("h2");n.className="mdc-dialog__header__title",n.textContent="Reminder",a.appendChild(n);var o=document.createElement("section");o.className="mdc-dialog__body",o.textContent="Check-in ?";var c=document.createElement("footer");c.className="mdc-dialog__footer";var i=document.createElement("button");i.type="button",i.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--accept",i.textContent="Okay",i.style.backgroundColor="#3498db";var r=document.createElement("button");return r.type="button",r.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--cancel",r.textContent="Cancel",r.style.backgroundColor="#3498db",c.appendChild(r),c.appendChild(i),t.appendChild(a),t.appendChild(o),t.appendChild(c),e.appendChild(t),e}function createHeader(e){var t=document.createElement("header");t.className="mdc-top-app-bar mdc-top-app-bar--fixed mdc-elevation--z1",t.id=e;var a=document.createElement("div");a.className="mdc-top-app-bar__row";var n=document.createElement("section");n.className="mdc-top-app-bar__section mdc-top-app-bar__section--align-start";var o=document.createElement("div");o.id=e+"view-type",o.className="view-type",n.appendChild(o);var c=document.createElement("div");c.className="mdc-top-app-bar__section mdc-top-app-bar__section--align-end";var i=document.createElement("div");return i.id=e+"action-data",i.className="action-data",c.appendChild(i),a.appendChild(n),a.appendChild(c),t.appendChild(a),t}function imageViewDialog(){var e=document.createElement("aside");e.id="viewImage--dialog-component",e.className="mdc-dialog",e.role="alertdialog";var t=document.createElement("div");t.className="mdc-dialog__surface";var a=document.createElement("section");a.className="mdc-dialog__content";var n=document.createElement("img");n.src="",n.style.width="100%",a.appendChild(n),t.appendChild(a);var o=document.createElement("footer");o.className="mdc-dialog__footer";var c=document.createElement("button");c.type="button",c.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--cancel",c.textContent="cancel",c.style.backgroundColor="#3498db",o.appendChild(c),t.appendChild(o),e.appendChild(t);var i=document.createElement("div");i.className="mdc-dialog__backdrop",e.appendChild(i),document.body.appendChild(e)}function startApp(e){firebase.auth().onAuthStateChanged(function(a){if(!a)return document.getElementById("main-layout-app").style.display="none",void userSignedOut();if(native.getInfo()){if(localStorage.getItem("error")||localStorage.setItem("error",JSON.stringify({})),e){var t=indexedDB.open(a.uid,3),n=void 0;t.onupgradeneeded=function(e){(n=t.result).onerror=function(){handleError({message:n.error.message+" from startApp on upgradeneeded"})},createObjectStores(n,a.uid)},t.onsuccess=function(){document.getElementById("main-layout-app").style.display="block",localStorage.setItem("dbexist",a.uid);var t=!1;if("Android"!==native.getName())try{webkit.messageHandlers.startLocationService.postMessage("start fetchin location")}catch(e){sendExceptionObject(e,"Catch Type 2: webkit.messageHandlers.startLocationService",["start fetchin location"]),t=!0}else t=!0;listView(),requestCreator("now",{device:native.getInfo(),from:"",registerToken:native.getFCMToken()}),runAppChecks(),t&&manageLocation().then(function(e){e.latitude&&e.longitude&&updateLocationInRoot(e)}).catch(function(e){handleError(e)})},t.onerror=function(){handleError({message:t.error.message+" from startApp"})}}}else redirect()})}function getEmployeeDetails(){return new Promise(function(o,c){var i=firebase.auth().currentUser,r=indexedDB.open(i.uid);r.onsuccess=function(){var e=r.result.transaction(["children"]),t=e.objectStore("children"),a=void 0,n=IDBKeyRange.bound(["employee","CONFIRMED"],["employee","PENDING"]);t.index("templateStatus").openCursor(n).onsuccess=function(e){var t=e.target.result;t&&(t.value.attachment["Employee Contact"].value===i.phoneNumber&&(a=t.value),t.continue())},e.oncomplete=function(){o(a)},e.onerror=function(){c({message:e.error.message+" from getEmployeeDetails"})}},r.onerror=function(){c({message:r.error.message+" from getEmployeeDetails"})}})}function isEmployeeOnLeave(){return new Promise(function(i,r){getEmployeeDetails().then(function(o){if(!o)return i(!1);o.onLeave=!1;var c=indexedDB.open(firebase.auth().currentUser.uid);c.onsuccess=function(){var e=c.result.transaction(["calendar"]),t=e.objectStore("calendar"),a=IDBKeyRange.bound(["leave","CONFIRMED",o.office],["leave","PENDING",o.office]),n=!1;t.index("onLeave").openCursor(a).onsuccess=function(e){var t=e.target.result;t&&(moment(moment().format("YYYY-MM-DD")).isBetween(t.value.start,t.value.end,null,"[]")?n=!0:t.continue())},e.oncomplete=function(){i(n)},e.onerror=function(){r({message:e.error.message+" from isEmployeeOnLeave"})}},c.onerror=function(){r({message:c.error.message+" from isEmployeeOnLeave"})}}).catch(function(e){r(e)})})}function createObjectStores(e,t){var a=e.createObjectStore("activity",{keyPath:"activityId"});a.createIndex("timestamp","timestamp"),a.createIndex("office","office"),a.createIndex("hidden","hidden");var n=e.createObjectStore("list",{keyPath:"activityId"});n.createIndex("timestamp","timestamp"),n.createIndex("status","status");var o=e.createObjectStore("users",{keyPath:"mobile"});o.createIndex("displayName","displayName"),o.createIndex("isUpdated","isUpdated"),o.createIndex("count","count"),e.createObjectStore("addendum",{autoIncrement:!0}).createIndex("activityId","activityId");var c=e.createObjectStore("subscriptions",{autoIncrement:!0});c.createIndex("office","office"),c.createIndex("template","template"),c.createIndex("officeTemplate",["office","template"]);var i=e.createObjectStore("calendar",{autoIncrement:!0});i.createIndex("activityId","activityId"),i.createIndex("timestamp","timestamp"),i.createIndex("start","start"),i.createIndex("end","end"),i.createIndex("urgent",["status","hidden"]),i.createIndex("onLeave",["template","status","office"]);var r=e.createObjectStore("map",{autoIncrement:!0});r.createIndex("activityId","activityId"),r.createIndex("location","location"),r.createIndex("latitude","latitude"),r.createIndex("longitude","longitude"),r.createIndex("nearby",["status","hidden"]),r.createIndex("byOffice",["office","location"]);var d=e.createObjectStore("children",{keyPath:"activityId"});d.createIndex("template","template"),d.createIndex("office","office"),d.createIndex("templateStatus",["template","status"]),e.createObjectStore("root",{keyPath:"uid"}).put({uid:t,fromTime:0,location:""})}function redirect(){firebase.auth().signOut().then(function(){window.location="https://www.growthfile.com"}).catch(function(e){window.location="https://www.growthfile.com",handleError({message:e+" from redirect"})})}function initLocation(){manageLocation().then(function(e){e.latitude&&e.longitude&&updateLocationInRoot(e)}).catch(function(e){handleError(e)})}function runAppChecks(){window.addEventListener("suggestCheckIn",function(t){isEmployeeOnLeave().then(function(e){if(!e&&t.detail&&"listView"===history.state[0])try{document.getElementById("alert--box").innerHTML=createCheckInDialog().outerHTML,getRootRecord().then(function(e){e&&e.offices&&(showSuggestCheckInDialog(e.offices),listView())})}catch(e){console.log(e)}}).catch(handleError)},!0)}window.addEventListener("load",function(){var t="Device Incompatibility",a="Your Device is Incompatible with Growthfile. Please Upgrade your Android Version";if(window.Worker||window.indexedDB)firebase.initializeApp({apiKey:"AIzaSyA4s7gp7SFid_by1vLVZDmcKbkEcsStBAo",authDomain:"growthfile-207204.firebaseapp.com",databaseURL:"https://growthfile-207204.firebaseio.com",projectId:"growthfile-207204",storageBucket:"growthfile-207204.appspot.com",messagingSenderId:"701025551237"}),moment.updateLocale("en",{calendar:{lastDay:"[yesterday]",sameDay:"hh:mm",nextDay:"[Tomorrow at] LT",lastWeek:"dddd",nextWeek:"dddd [at] LT",sameElse:"L"},longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YY"},months:["January","February","March","April","May","June","July","August","September","October","November","December"]}),window.onpopstate=function(e){if(e.state){if("listView"===e.state[0]){var t=scroll_namespace.count;return t&&(scroll_namespace.size=t),scroll_namespace.count=0,void window[e.state[0]]()}window[e.state[0]](e.state[1],!1)}},layoutGrid(),startApp(!0);else try{AndroidInterface.showDialog(t,a)}catch(e){sendExceptionObject(e,"Catch Type 1: AndroidInterface.showDialog at window.onload",[t,a]),appDialog(a)}});var scroll_namespace={count:0,size:20,skip:!1};function initDomLoad(){document.querySelector(".init-loader")&&document.querySelector(".init-loader").remove(),document.querySelector(".mdc-linear-progress")&&document.querySelector(".mdc-linear-progress").remove(),listPanel(),creatListHeader("Activities"),createActivityIcon()}function listView(){history.pushState(["listView"],null,null),initDomLoad(),getSizeOfListStore().then(function(t){t?(20<t&&window.addEventListener("scroll",handleScroll,!1),getRootRecord().then(function(e){t&&t<=20?loadActivitiesFromListStore(e.location):startCursor(e.location)})):appendTextContentInListView("No activities Found")})}function appendTextContentInListView(e){var t=document.createElement("p");t.textContent=e,t.className="no-activity",document.getElementById("activity-list-main").appendChild(t),document.getElementById("activity-list-main").style.boxShadow="none"}function getSizeOfListStore(){return new Promise(function(t,a){var n=indexedDB.open(firebase.auth().currentUser.uid);n.onsuccess=function(){var e=n.result.transaction(["list"]).objectStore("list").count();e.onsuccess=function(){t(e.result)},e.onerror=function(){a(e.error)}},n.onerror=function(){a(n.error)}})}function updateEl(a,i){var n=indexedDB.open(firebase.auth().currentUser.uid);n.onsuccess=function(){var e=n.result.transaction(["list","activity"]),o=e.objectStore("activity"),t=e.objectStore("list"),c=document.getElementById("activity--list");a.forEach(function(n){document.querySelector(".no-activity")&&document.querySelector(".no-activity").remove(),t.get(n.activityId).onsuccess=function(e){var t=e.target.result,a=document.querySelector('[data-id="'+n.activityId+'"]');a&&a.remove(),t&&(i.location?getActivityDataForList(o,t,i.location).then(function(e){c&&c.insertBefore(e,c.childNodes[0])}):getActivityDataForList(o,t).then(function(e){c&&c.insertBefore(e,c.childNodes[0])}))}})}}function handleScroll(e){getRootRecord().then(function(e){if(window.innerHeight+window.scrollY===document.body.scrollHeight){if(!document.getElementById("activity--list"))return;startCursor(e.location)}})}function loadActivitiesFromListStore(o){var c=indexedDB.open(firebase.auth().currentUser.uid);c.onsuccess=function(){var e=c.result.transaction(["list","activity","root"]),a=e.objectStore("activity"),t=e.objectStore("list").index("timestamp"),n=document.createDocumentFragment();t.openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;t&&(getActivityDataForList(a,t.value,o).then(function(e){n.appendChild(e)}),t.continue())},e.oncomplete=function(){var e=document.getElementById("activity--list");e&&(e.innerHTML="",e.appendChild(n),scrollToActivity())}}}function startCursor(i){console.log(i);var r=indexedDB.open(firebase.auth().currentUser.uid);r.onsuccess=function(){var e=r.result.transaction(["list","activity","root"]),a=e.objectStore("activity"),t=e.objectStore("list").index("timestamp"),n=0,o=scroll_namespace.count,c=document.createDocumentFragment();t.openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;t&&(o?scroll_namespace.skip?(getActivityDataForList(a,t.value,i).then(function(e){c.appendChild(e),n++}),runCursor(t,n)):(scroll_namespace.skip=!0,t.advance(o)):(getActivityDataForList(a,t.value,i).then(function(e){c.appendChild(e),n++}),runCursor(t,n)))},e.oncomplete=function(){var e=document.getElementById("activity--list");e&&(e.appendChild(c),scroll_namespace.count=scroll_namespace.count+scroll_namespace.size,scroll_namespace.skip=!1,scroll_namespace.size=20,scrollToActivity())}}}function runCursor(e,t){t<scroll_namespace.size&&e.continue()}function getActivityDataForList(t,s,u){return new Promise(function(i,e){var r=document.createElement("div");r.style.marginTop="10px";var d=document.createElement("span");d.className="mdc-list-item__secondary-text venue-secondline";var l=document.createElement("span");l.className="mdc-list-item__secondary-text",t.get(s.activityId).onsuccess=function(e){var t=e.target.result;if(t){var a=t.schedule,n=t.venue,o=void 0,c=generateLastestSchedule(a,s.createdTime);u&&(o=generateLatestVenue(n,u)),o&&!c?(d.textContent=o,d.style.maxWidth="70%"):c&&!o?l.textContent=c:c&&o&&(d.textContent=o,l.textContent=" | "+c),r.appendChild(d),r.appendChild(l),i(activityListUI(s,r))}}})}function setMarginForSecondLine(e){var t=e.childNodes;return 1<t.length&&t[0].innerHTML&&t[1].innerHTML?e.style.marginTop="-42px":e.style.marginTop="-35px",e}function generateTextIfActivityIsNotPending(e){return{CONFIRMED:"Done",CANCELLED:"Cancelled"}[e]}function generateLastestSchedule(e,t){var a=removeEmptyObjects(e,"startTime","endTime");if(!a.length)return formatCreatedTime(t);var n=Date.now();return getTimeTypeForMultipleSchedule(n,sortDatesInAscendingOrderWithPivot(n,a))}function removeEmptyObjects(e,t,a){return e.length?e.filter(function(e){if(e[t]&&e[a])return e}):e}function sortDatesInAscendingOrderWithPivot(e,t){var a=t.slice();return a.push(e),a.sort(function(e,t){return e-t})}function getTimeTypeForMultipleSchedule(e,t){var a=t.slice().indexOf(e);return a==t.length-1?moment(t[t.length-2]).format("D, MMM").replace(",",""):moment(t[a+1]).format("D, MMM").replace(",","")}function formatCreatedTime(e){return e?isToday(e)?moment(e).format("hh:mm"):moment(e).format("D, MMM").replace(",",""):""}function isToday(e){return(new Date).setHours(0,0,0,0)==new Date(e).setHours(0,0,0,0)}function generateLatestVenue(e,a){var t=removeEmptyObjects(e,"location","address"),n=t.length;if(!n)return"";if(1==n)return t[0].location;var o=[];return e.forEach(function(e){var t={latitude:e.geopoint._latitude,longitude:e.geopoint._longitude};o.push({distance:calculateDistanceBetweenTwoPoints(t,a),location:e.location})}),sortNearestLocation(o)[0].location}function sortNearestLocation(e){return e.slice().sort(function(e,t){return e.distance-t.distance})}function activityListUI(e,t){var a=document.createElement("li");a.dataset.id=e.activityId,a.onclick=function(){localStorage.setItem("clickedActivity",this.dataset.id),conversation(this.dataset.id,!0)},a.classList.add("mdc-list-item","activity--list-item","mdc-elevation--z1");var n=document.createElement("object");n.data=e.creator.photo||"./img/empty-user.jpg",n.type="image/jpeg",n.className="mdc-list-item__graphic material-icons";var o=document.createElement("img");o.src="./img/empty-user.jpg",o.className="empty-user-list",n.appendChild(o);var c=document.createElement("span");c.classList.add("mdc-list-item__text");var i=document.createElement("span");i.className="mdc-list-item__primary-text bigBlackBold",i.textContent=e.activityName,c.appendChild(i),c.appendChild(t);var r=document.createElement("div");r.className="mdc-meta__custom-text",r.style.width="76px",isToday(e.timestamp)&&(r.style.marginTop="4px"),r.textContent=moment(e.timestamp).calendar();var d=document.createElement("span");return d.classList.add("mdc-list-item__meta"),d.appendChild(r),d.appendChild(generateIconByCondition(e,a)),a.appendChild(n),a.appendChild(c),a.appendChild(d),a}function generateIconByCondition(e,t){if(e.count){var a=document.createElement("span");return a.textContent=e.count,a.className="count mdc-meta__custom-text",t.classList.add("count-active"),a}var n=document.createElement("i");n.classList.add("status-cancel","material-icons",""+e.status),n.textContent="clear";var o=document.createElement("i");o.classList.add("status-confirmed","material-icons",""+e.status),o.textContent="check";var c=document.createElement("i");return c.classList.add("status-pending","material-icons",""+e.status),c.textContent="","CONFIRMED"===e.status?o:"CANCELLED"===e.status?n:c}function appendActivityListToDom(e){var t=document.getElementById("activity--list");t&&t.appendChild(e)}function getRootRecord(){return new Promise(function(t,a){var n=void 0,o=firebase.auth().currentUser.uid,c=indexedDB.open(o);c.onsuccess=function(){var e=c.result.transaction(["root"],"readwrite");e.objectStore("root").get(o).onsuccess=function(e){var t=e.target.result;n=t||null},e.oncomplete=function(){n?t(n):a({message:"No root record found from getRootRecord"})},e.onerror=function(){a({message:e.error.message+" from getRootRecord"})}},c.onerror=function(){a({message:c.error+" from getRootRecord"})}})}function createActivityIcon(){document.getElementById("create-activity")||getCountOfTemplates().then(function(e){e&&createActivityIconDom()}).catch(handleError)}function getCountOfTemplates(){return new Promise(function(t,a){var n=0,o=indexedDB.open(firebase.auth().currentUser.uid);o.onsuccess=function(){var e=o.result.transaction(["subscriptions"],"readonly");e.objectStore("subscriptions").index("office").openCursor(null,"nextunique").onsuccess=function(e){var t=e.target.result;t&&(n++,t.continue())},e.oncomplete=function(){t(n)},e.onerror=function(){a({message:e.error.message+" from getCountOfTemplates"})}},o.onerror=function(){a({message:o.error.message+" from getCountOfTemplates"})}})}function createActivityIconDom(){var e=document.getElementById("create-activity--parent"),t=document.createElement("button");t.className="mdc-fab create-activity",t.id="create-activity",t.setAttribute("aria-label","Add");var a=document.createElement("span");a.className="mdc-fab_icon material-icons",a.id="activity-create--icon",a.textContent="add",t.appendChild(a),e.innerHTML=t.outerHTML,document.querySelector(".create-activity").addEventListener("click",function(e){callSubscriptionSelectorUI()})}function callSubscriptionSelectorUI(e){selectorUI({record:"",store:"subscriptions",suggestCheckIn:e})}function listPanel(){if(!document.getElementById("activity-list-main")){var e=document.createElement("div");e.className="mdc-card panel-card mdc-top-app-bar--fixed-adjust",e.id="activity-list-main";var t=document.createElement("ul");t.className="mdc-list mdc-list--two-line mdc-list--avatar-list",t.id="activity--list",e.appendChild(t);var a=document.createElement("div");a.id="create-activity--parent",e.appendChild(a),document.getElementById("app-current-panel").innerHTML=e.outerHTML}}function creatListHeader(i){var e=indexedDB.open(firebase.auth().currentUser.uid);e.onsuccess=function(){getUserRecord(e.result,firebase.auth().currentUser.phoneNumber).then(function(e){var t=document.createElement("div");t.className="profile--icon-header";var a=document.createElement("div");a.id="menu--panel";var n=document.createElement("object");n.className="list-photo-header",n.type="image/jpeg",n.data=e.photoURL||"./img/empty-user.jpg";var o=document.createElement("img");o.src="./img/empty-user.jpg",o.className="list-photo-header",n.appendChild(o),a.appendChild(n);var c=document.createElement("p");c.textContent=i,a.appendChild(c),t.appendChild(a),modifyHeader({id:"app-main-header",left:t.outerHTML,right:""}),document.querySelector(".list-photo-header").addEventListener("click",function(){profileView(!0)})})}}function scrollToActivity(){var e=localStorage.getItem("clickedActivity");if(document.querySelector('[data-id="'+e+'"]'))return document.querySelector('[data-id="'+e+'"]').scrollIntoView({behavior:"instant",block:"center",inline:"center"}),void localStorage.removeItem("clickedActivity")}function notificationWorker(e,n){return new Promise(function(t,a){notification.postMessage({dbName:firebase.auth().currentUser.uid,type:e,updateTimestamp:n}),notification.onmessage=function(e){t(e.data)},notification.onerror=function(e){a({message:e.message+" from notificationWorker at "+e.lineno})}})}function modifyHeader(e){e.left&&(document.getElementById(e.id+"view-type").innerHTML=e.left);e.right&&(document.getElementById(e.id+"action-data").innerHTML=e.right)}function profileView(e){e&&history.pushState(["profileView"],null,null),window.addEventListener&&window.removeEventListener("scroll",handleScroll,!1),document.body.style.backgroundColor="#eeeeee";var c=firebase.auth().currentUser,t=c.uid,i=indexedDB.open(t);i.onsuccess=function(){var a=i.result,n=a.transaction(["root"],"readwrite"),o=n.objectStore("root");o.get(t).onsuccess=function(e){var t=e.target.result;o.put(t),n.oncomplete=function(){createProfileHeader(),createProfilePanel(a).then(function(e){document.getElementById("app-current-panel")&&(document.getElementById("app-current-panel").innerHTML=e.outerHTML,document.getElementById("close-profile--panel").addEventListener("click",function(){backNav()}),"Android"===native.getName()?document.getElementById("uploadProfileImage").addEventListener("click",function(){try{AndroidInterface.openImagePicker()}catch(e){sendExceptionObject(e,"CATCH Type 10:AndroidInterface.openImagePicker at profileview",[])}}):inputFile("uploadProfileImage").addEventListener("change",function(){readUploadedFile()}),changeDisplayName(c),changeEmailAddress(c))})}}}}function inputFile(e){return document.getElementById(e)}function createProfileHeader(){var e=document.createElement("span");e.id="close-profile--panel";var t=document.createElement("i");t.className="material-icons",t.textContent="arrow_back",e.appendChild(t),modifyHeader({id:"app-main-header",left:e.outerHTML})}function createProfilePanel(e){return new Promise(function(v){getUserRecord(e,firebase.auth().currentUser.phoneNumber).then(function(e){var t=document.createElement("div");t.id="profile-view--container",t.className="mdc-top-app-bar--fixed-adjust mdc-theme--background";var a=document.createElement("button");a.className="mdc-fab","Android"===native.getName()&&(a.id="uploadProfileImage");var n=document.createElement("label");n.setAttribute("for","uploadProfileImage");var o=document.createElement("span");o.className="mdc-fab__icon material-icons",o.textContent="add_a_photo",n.appendChild(o),a.appendChild(n);var c=void 0;"Android"!==native.getName()&&((c=document.createElement("input")).type="file",c.style.display="none",c.id="uploadProfileImage",c.accept="image/jpeg;");var i=document.createElement("div");i.id="profile--image-container",i.className="profile-container--main";var r=document.createElement("object");r.type="image/jpeg",r.data=e.photoURL||"./img/empty-user-big.jpg",r.id="user-profile--image";var d=document.createElement("img");d.src="./img/empty-user-big.jpg",d.className="empty-user-profile",r.appendChild(d);var l=document.createElement("div");l.className="insert-overlay",i.appendChild(r),i.appendChild(l),i.appendChild(a),"Android"!==native.getName()&&n.appendChild(c);var s=document.createElement("div");s.id="name--change-container",s.className="profile-psuedo-card";var u=document.createElement("button");u.className="mdc-icon-button material-icons hidden",u.id="edit--name",u.setAttribute("aria-hidden","true"),u.setAttribute("aria-pressed","false"),u.textContent="check";var m=firebase.auth().currentUser.displayName;s.innerHTML='<div class="mdc-text-field" id=\'name-change-field\'>\n        <input autocomplete="off" type="text"  placeholder="'+(m?"":"Enter Your Name")+'"  id="pre-filled-name" class="mdc-text-field__input" value="'+(m||"")+'">\n        <label class="mdc-floating-label mdc-floating-label--float-above" for="pre-filled-name">\n         Your Name\n        </label>\n        <div class="mdc-line-ripple"></div>\n      </div>\n      ',s.appendChild(u);var p=document.createElement("div");p.id="email--change-container",p.className="profile-psuedo-card";var h=document.createElement("button");h.className="mdc-icon-button material-icons hidden",h.id="edit--email",h.setAttribute("aria-hidden","true"),h.setAttribute("aria-pressed","false"),h.textContent="check";var f=firebase.auth().currentUser.email;p.innerHTML='<div class="mdc-text-field" id=\'email-change-field\'>\n        <input  autocomplete="off" type="text" id="pre-filled-email" class="mdc-text-field__input" value="'+(f||"")+'" placeholder="'+(f?"":"Enter your Email")+'">\n        <label class="mdc-floating-label mdc-floating-label--float-above" for="pre-filled-email">\n         Your Email\n        </label>\n        <div class="mdc-line-ripple"></div>\n      </div>\n      ',p.appendChild(h),t.appendChild(i),t.appendChild(s),t.appendChild(p),v(t)})})}function updateEmailDialog(){if(!document.getElementById("updateEmailDialog")){var e=document.createElement("aside");e.className="mdc-dialog mdc-dialog--open",e.id="updateEmailDialog";var t=document.createElement("div");t.className="mdc-dialog__surface",t.style.width="90%",t.style.height="auto";var a=document.createElement("section");a.className="mdc-dialog__body",a.id="refresh-login";var n=document.createElement("footer");n.className="mdc-dialog__footer";var o=document.createElement("button");o.type="button",o.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--cancel update-email-cancel",o.textContent="Cancel",o.style.backgroundColor="#3498db",n.appendChild(o),t.appendChild(a),t.appendChild(n),e.appendChild(t),document.body.appendChild(e)}}function timeDiff(e){var t=moment().format("YYY-MM-DD HH:mm"),a=moment(e).format("YYY-MM-DD HH:mm");return moment(t).diff(moment(a),"minutes")}function newSignIn(e,t){updateEmailDialog();var a=document.querySelector("#updateEmailDialog"),n=new mdc.dialog.MDCDialog(a);n.show();try{ui||(ui=new firebaseui.auth.AuthUI(firebase.auth())),ui.start("#refresh-login",firebaseUiConfig(e)),setTimeout(function(){document.querySelector(".firebaseui-id-phone-number").disabled=!0,document.querySelector(".firebaseui-label").remove(),document.querySelector(".firebaseui-title").textContent="Verify your phone Number to Update your Email address"},500),n.listen("MDCDialog:cancel",function(){t.value=firebase.auth().currentUser.email,a.remove()})}catch(e){a.remove(),console.log(e),handleError({message:e.message+" from newSignIn function during email updation"}),snacks("Please try again later")}}function readUploadedFile(e){if("Android"!==native.getName()){var t=inputFile("uploadProfileImage").files[0],a=new FileReader;a.addEventListener("load",function(){sendBase64ImageToBackblaze(a.result)},!1),t&&a.readAsDataURL(t)}else sendBase64ImageToBackblaze(e)}function sendBase64ImageToBackblaze(e){var t=document.getElementById("user-profile--image"),a=document.getElementById("profile--image-container"),n="data:image/jpeg;base64,";t&&(t.data=n+e),a&&document.getElementById("profile--image-container").appendChild(loader("profile--loader")),requestCreator("backblaze",{imageBase64:n+e})}function authUpdatedError(e){"auth/invalid-email"!==e.message&&handleError({message:e.message+" from authUpdatedError"}),document.querySelector(".init-loader")&&document.querySelector(".init-loader").remove(),snacks(e.message)}function changeDisplayName(){var e=document.getElementById("name-change-field"),t=new mdc.textField.MDCTextField(e),a=document.getElementById("edit--name");firebase.auth().currentUser.displayName;e.addEventListener("click",function(){document.getElementById("pre-filled-name").placeholder="",a.classList.remove("hidden"),e.classList.add("short")}),e.addEventListener("keydown",function(e){13==e.keyCode&&updateName(t.value)}),a.addEventListener("click",function(){updateName(t.value)})}function updateName(e){e?firebase.auth().currentUser.updateProfile({displayName:e}).then(successDialog).catch(function(e){snacks("Please Try again later"),handleError({message:e+" at updateProfile in changeDisplayName"})}):snacks("Please Enter a Name")}function changeEmailAddress(){var e=document.getElementById("email-change-field"),t=new mdc.textField.MDCTextField(e),a=document.getElementById("edit--email");e.addEventListener("click",function(){document.getElementById("pre-filled-email").placeholder="",a.classList.remove("hidden"),e.classList.add("short")}),e.addEventListener("keydown",function(e){13==e.keyCode&&emailValidation(t)}),a.addEventListener("click",function(){emailValidation(t)})}function emailValidation(e){var t=firebase.auth().currentUser,a=e.value;a?a===t.email&&t.emailVerified?snacks("You have already set this as your email address"):timeDiff(t.metadata.lastSignInTime)<=2?updateEmail(t,a):newSignIn(a,e):snacks("Enter a valid Email Id")}function updateEmail(e,t){document.getElementById("growthfile").appendChild(loader("init-loader")),e.updateEmail(t).then(function(){emailUpdateSuccess(!0)}).catch(authUpdatedError)}function emailUpdateSuccess(e){firebase.auth().currentUser.sendEmailVerification().then(function(){emailVerificationSuccess(e)}).catch(emailVerificationError)}function emailVerificationSuccess(e){e&&successDialog(),snacks("Verification link has been send to your email address")}function emailVerificationError(e){snacks(e.message),document.querySelector(".init-loader")&&document.querySelector(".init-loader").remove(),handleError({message:e.message+" from emailVerificationError"})}function initUserSelectorSearch(c,t){var i=indexedDB.open(firebase.auth().currentUser.uid);i.onsuccess=function(){var a=i.result,e=t.input_,n=e.value="",o=document.createDocumentFragment();e.addEventListener("input",function(e){var t=e.target.value;if(isNumber(t))return n=a.transaction("users").objectStore("users"),void searchUsersDB(formatNumber(t),n,o,c);o=document.createDocumentFragment(),n=a.transaction("users").objectStore("users").index("displayName"),searchUsersDB(formatName(t),n,o,c)})}}function isNumber(e){return!isNaN(e)}function formatNumber(e){var t=e;return"91"===t.substring(0,2)?t="+"+t:"+91"!==t.substring(0,3)&&(t="+91"+t),t}function formatName(e){var t=e.split(" "),a=t.length,n=[],o=0;for(o=0;o<a;o++){var c=t[o];if(c.charAt(0).toUpperCase()===e.charAt(0).toUpperCase)return e;n.push(c.charAt(0).toUpperCase()+c.slice(1))}return n.join(" ")}function checkNumber(e){return/^\+[1-9]\d{11,14}$/.test(e)}function searchUsersDB(e,t,o,c){console.log(e);var a=IDBKeyRange.bound(e,e+"￿"),i=document.getElementById("data-list--container"),n=c.record.assignees,r={};n.forEach(function(e){"string"==typeof e?r[e]=!0:r[e.phoneNumber]=!0}),r[firebase.auth().currentUser.phoneNumber]=!0,t.openCursor(a).onsuccess=function(e){var t=e.target.result;if(!t){if(i.innerHTML="",0!=o.children.length)return i.appendChild(o),void document.querySelectorAll('[data-selected="true"]').forEach(function(e){new mdc.checkbox.MDCCheckbox.attachTo(e).checked=!0,e.children[1].style.animation="none",e.children[1].children[0].children[0].style.animation="none"});var a=document.createElement("div");a.className="data-not-found";var n=document.createElement("p");return n.textContent="No Contact Found",n.className="mdc-typography--headline5",a.appendChild(n),void(document.querySelector(".data-not-found")||i.appendChild(a))}c.attachment.present?o.appendChild(createSimpleAssigneeLi(t.value,!0,!1)):r.hasOwnProperty(t.value.mobile)||o.appendChild(createSimpleAssigneeLi(t.value,!0,!0)),t.continue()}}function selectorUI(i){var e=document.getElementById("app-current-panel");createSelectorHeader(i);var t=document.createElement("div");t.className="selector-container mdc-top-app-bar--fixed-adjust","map"===i.store&&t.appendChild(createSeachInput("map-selector-search","Search For Location")),"users"===i.store&&t.appendChild(createSeachInput("users-selector-search","Search Users"));var a=document.createElement("ul");a.id="data-list--container",a.className="mdc-list",t.appendChild(a);var n=document.createElement("span");n.className="selector-warning-text",n.id="selector-warning",t.appendChild(n);var o=document.createElement("button");o.textContent="SELECT",o.id="selector-submit-send",o.className="mdc-button selector-submit--button selector-send",t.appendChild(o),e.innerHTML=t.outerHTML,window.scrollTo(0,0);i.record;var c=firebase.auth().currentUser.uid,r=indexedDB.open(c);r.onsuccess=function(){var e=r.result;if("map"===i.store){var t=new mdc.textField.MDCTextField.attachTo(document.querySelector("#map-selector-search")),a=e.transaction([i.store]),n=t.input_;autocomplete=new google.maps.places.Autocomplete(n,{componentRestrictions:{country:"in"}}),n.placeholder="",initializeAutocompleteGoogle(autocomplete,i),getLocationForMapSelector(a,i).then(function(e){e||(document.getElementById("map-selector-search").style.display="none",document.getElementById("selector-submit-send").textContent="CANCEL",document.getElementById("data-list--container").appendChild(noSelectorResult("No Location Found"))),handleClickListnersForMap(i,e)}).catch(console.log)}if("subscriptions"===i.store&&fillSubscriptionInSelector(e,i),"users"===i.store){e.transaction(i.store).objectStore(i.store);var o=new mdc.textField.MDCTextField.attachTo(document.getElementById("users-selector-search"));initUserSelectorSearch(i,o),resetSelectedContacts().then(function(){fillUsersInSelector(i)})}if("children"===i.store){var c=e.transaction([i.store]);fillChildrenInSelector(c.objectStore(i.store).index("templateStatus"),i,c)}}}function createSelectorHeader(t){var e=document.createElement("div");e.className="back-icon",e.id="back-selector",e.style.float="left";var a=document.createElement("i");a.style.marginRight="5px",a.className="material-icons back-icon--large",a.textContent="arrow_back",e.appendChild(a),modifyHeader({id:"app-main-header",left:e.outerHTML}),document.querySelector("#back-selector").addEventListener("click",function(e){"subscriptions"===t.store?listView():(document.querySelector(".mdc-top-app-bar__section--align-end").classList.remove("search-field-transform"),updateCreateActivity(history.state[1],!0))})}var apiHandler=new Worker("apiHandler.js");function handleError(e){var t=JSON.parse(localStorage.getItem("error"));if(!t.hasOwnProperty(e.message))return t[e.message]=!0,localStorage.setItem("error",JSON.stringify(t)),e.device=native.getInfo(),void requestCreator("instant",JSON.stringify(e))}function loader(e){var t=document.createElement("div");return t.className="loader "+e,t}function successDialog(){var e=document.createElement("aside");e.className="mdc-dialog mdc-dialog--open success--dialog",e.id="success--dialog";var t=document.createElement("div");t.className="mdc-dialog__surface round--surface";var a=document.createElement("section");a.className="mdc-dialog__body";var n=document.createElement("div");n.className="success--container";var o=document.createElement("div");o.className="success--check",n.appendChild(o),a.appendChild(n),t.appendChild(a),e.appendChild(t),document.body.appendChild(e),new mdc.dialog.MDCDialog(document.querySelector("#success--dialog")).show(),setTimeout(function(){document.getElementById("success--dialog").remove(),document.body.classList.remove("mdc-dialog-scroll-lock")},1200),scroll_namespace.count=0,scroll_namespace.size=20,localStorage.removeItem("clickedActivity"),listView()}function appDialog(e,t){if(!document.getElementById("enable-gps")){var a=document.createElement("aside");a.className="mdc-dialog mdc-dialog--open",a.id="enable-gps";var n=document.createElement("div");n.className="mdc-dialog__surface",n.style.width="90%",n.style.height="auto";var o=document.createElement("section");o.className="mdc-dialog__body mock-main-body",o.textContent=e;var c=document.createElement("footer");c.className="mdc-dialog__footer mock-footer";var i=document.createElement("button");i.type="button",i.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--accept",i.textContent="Ok",t||i.classList.add("hidden"),i.style.backgroundColor="#3498db",c.appendChild(i),n.appendChild(o),n.appendChild(c),a.appendChild(n),document.body.appendChild(a)}var r=new mdc.dialog.MDCDialog(document.querySelector("#enable-gps"));r.listen("MDCDialog:accept",function(){listView()}),r.show()}function officeRemovalDialog(e){if(!document.getElementById("office-removal-dialog")){var t=document.createElement("aside");t.className="mdc-dialog mdc-dialog--open",t.id="office-removal-dialog",t.style.backgroundColor="rgba(0,0,0,0.47)";var a=document.createElement("div");a.className="mdc-dialog__surface",a.style.width="90%",a.style.height="auto";var n=document.createElement("section");n.className="mdc-dialog__body mock-main-body",n.textContent=e;var o=document.createElement("footer");o.className="mdc-dialog__footer mock-footer";var c=document.createElement("button");c.type="button",c.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--accept",c.textContent="Ok",c.style.width="100%",c.style.backgroundColor="#3498db",o.appendChild(c),a.appendChild(n),a.appendChild(o),t.appendChild(a),document.body.appendChild(t)}}function appUpdateDialog(e,t){if(!document.getElementById("app-update-dialog")){var a=document.createElement("aside");a.className="mdc-dialog mdc-dialog--open",a.id="app-update-dialog";var n=document.createElement("div");n.className="mdc-dialog__surface",n.style.width="90%",n.style.height="auto";var o=document.createElement("header");o.className="mdc-dialog__header";var c=document.createElement("h2");c.className="mdc-dialog__header__title",c.textContent=t,o.appendChild(c);var i=document.createElement("section");i.className="mdc-dialog__body",i.textContent=e;var r=document.createElement("footer");r.className="mdc-dialog__footer",n.appendChild(o),n.appendChild(i),n.appendChild(r),a.appendChild(n),document.body.appendChild(a)}new mdc.dialog.MDCDialog(document.querySelector("#app-update-dialog")).show()}function progressBar(){var e=document.createElement("div");e.className="mdc-linear-progress mdc-linear-progress--indeterminate progress--update",e.role="progressbar";var t=document.createElement("div");t.className="mdc-linear-progress__buffering-dots";var a=document.createElement("div");a.className="mdc-linear-progress__buffer";var n=document.createElement("div");n.className="mdc-linear-progress__bar mdc-linear-progress__primary-bar";var o=document.createElement("span");o.className="mdc-linear-progress__bar-inner",n.appendChild(o);var c=document.createElement("div");c.className="mdc-linear-progress__bar mdc-linear-progress__secondary-bar";var i=document.createElement("span");return i.className="mdc-linear-progress__bar-inner",c.appendChild(i),e.appendChild(t),e.appendChild(a),e.appendChild(n),e.appendChild(c),e}function snacks(e,t){var a=document.createElement("div");a.className="mdc-snackbar",a.setAttribute("aria-live","assertive"),a.setAttribute("aria-atomic","true"),a.setAttribute("aria-hidden","true"),a.style.zIndex=99999;var n=document.createElement("div");n.className="mdc-snackbar__text mdc-typography--subtitle2";var o=document.createElement("div");o.className="mdc-snackbar__action-wrapper";var c=document.createElement("button");c.className="mdc-snackbar__action-button",o.appendChild(c),a.appendChild(n),a.appendChild(o),document.getElementById("snackbar-container").innerHTML=a.outerHTML;var i={message:e,actionText:"OK",timeout:5e3,actionHandler:function(){}};mdc.snackbar.MDCSnackbar.attachTo(document.querySelector(".mdc-snackbar")).show(i)}function fetchCurrentTime(e){return Date.now()+e}function geolocationApi(o){return new Promise(function(t,a){var n=new XMLHttpRequest;n.open("POST","https://www.googleapis.com/geolocation/v1/geolocate?key=AIzaSyA4s7gp7SFid_by1vLVZDmcKbkEcsStBAo",!0),n.setRequestHeader("Content-Type","application/json"),n.onreadystatechange=function(){if(4===n.readyState){if(400<=n.status)return a({message:n.response,body:o});var e=JSON.parse(n.response);if(!e)return a({message:"Response From geolocation Api "+e,body:o});t({latitude:e.location.lat,longitude:e.location.lng,accuracy:e.accuracy,provider:{body:o}})}},n.onerror=function(){a({message:n})},n.send(o)})}function handleRequestBody(e){var t=JSON.parse(e);return t.wifiAccessPoints&&t.wifiAccessPoints.length?(t.cellTowers&&delete t.cellTowers,JSON.stringify(t)):null}function manageLocation(){return new Promise(function(a,n){var o={};"Android"!==native.getName()?html5Geolocation().then(function(e){a(e)}).catch(function(e){n(e)}):html5Geolocation().then(function(e){if(e.accuracy<=350)return a(e);o.html5={body:"",result:e},handleGeoLocationApi(o,e).then(function(e){a(e)})}).catch(function(t){handleGeoLocationApi(o).then(function(e){a(e)}).catch(function(e){n({message:"Both HTML and Geolocation failed to fetch location.",body:JSON.stringify({html5:t,geolocation:JSON.stringify(e)}),locationError:!0})})})})}function handleGeoLocationApi(c,i){return new Promise(function(n,t){var e=void 0,o=[];try{e=AndroidInterface.getCellularData()}catch(e){return i?void n(i):(sendExceptionObject(e,"CATCH Type 4 : AndroidInterface.getCellularData at handleGeolocationApi",[]),void t("CATCH Type 4 : AndroidInterface.getCellularData at handleGeolocationApi"))}if(!Object.keys(JSON.parse(e)).length)return i?n(i):t("Empty Object returned from getCellularData method");geolocationApi(e).then(function(t){if(t.accuracy<=350)return n(t);c.orignialGeolocationResponse={body:e,result:t};var a=handleRequestBody(e);if(!a)return 1200<=t.accuracy&&handleError({message:"Oringinal CellTower has accuracy more than 1200 and WAP doesnt exist",body:JSON.stringify(c),locationError:!0}),i?t.accuracy<i.accuracy?void n(t):n(i):void n(t);geolocationApi(a).then(function(e){return e.accuracy<=350?n(e):(c.withoutCellTower={body:a,result:e},1200<=e.accuracy&&handleError({message:"html5,originalCellTower,WithoutCellTower",body:JSON.stringify(c),locationError:!0}),Object.keys(c).forEach(function(e){o.push(c[e].result)}),n(sortedByAccuracy(o)))}).catch(function(e){if(1200<=t.accuracy&&(c.withoutCellTower={body:a},handleError({message:"Orinigal CellTower has accuracy more than 1200 and api failure when sending cellTowerObject without cellularTowers",body:JSON.stringify(c),locationError:!0})),i){if(!(t.accuracy<i.accuracy))return n(i);n(t)}else n(t)})}).catch(function(e){i?n(i):t(e)})})}function iosLocationError(e){manageLocation().then(function(e){e.latitude&&e.longitude&&updateLocationInRoot(e)})}function html5Geolocation(){return new Promise(function(a,t){for(var e=[],n=0;n<2;n++){var o=new Promise(function(t,a){navigator.geolocation.getCurrentPosition(function(e){return t({latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy,provider:"HTML5"})},function(e){a({message:e})},{timeout:5e3,maximumAge:0,enableHighAccuracy:!0})});e.push(o)}Promise.all(e).then(function(e){var t=e.sort(function(e,t){return e.accuracy-t.accuracy});a(t[0])}).catch(function(e){t({message:e.message.message})})})}function showSuggestCheckInDialog(t){var e=document.querySelector("#suggest-checkIn-dialog");if(e){var a=new mdc.dialog.MDCDialog(e);a&&(document.getElementById("dialog--component")||(a.root_.classList.remove("hidden"),a.show(),a.listen("MDCDialog:accept",function(e){isLocationStatusWorking()&&(1===t.length?createTempRecord(t[0],"check-in",{suggestCheckIn:!0}):callSubscriptionSelectorUI(!0))}),a.listen("MDCDialog:cancel",function(e){app.isNewDay()})))}}function isDialogOpened(e){var t=document.querySelector(e);return!!t&&t.classList.contains("mdc-dialog--open")}function updateLocationInRoot(n){var o={latitude:"",longitude:"",accuracy:"",provider:"",lastLocationTime:""},t=firebase.auth().currentUser.uid,c=indexedDB.open(t);c.onsuccess=function(){var e=c.result.transaction(["root"],"readwrite"),a=e.objectStore("root");a.get(t).onsuccess=function(e){var t=e.target.result;t.location&&(o=t.location),t.location=n,t.location.lastLocationTime=Date.now(),a.put(t)},e.oncomplete=function(){if(o.latitude&&o.longitude&&n.latitude&&n.longitude){var e=calculateDistanceBetweenTwoPoints(o,n),t=new CustomEvent("suggestCheckIn",{detail:isLocationMoreThanThreshold(e)||app.isNewDay()});window.dispatchEvent(t)}},e.onerror=function(){handleError({message:e.error.message+" from updateLocationInRoot",body:e.error.name})},c.onerror=function(){handleError({message:c.error.message+" from updateLocationInRoot",body:c.error.name}),window.dispatchEvent(suggestCheckIn)}}}function toRad(e){return e*Math.PI/180}function calculateDistanceBetweenTwoPoints(e,t){var a=toRad(t.latitude-e.latitude),n=toRad(t.longitude-e.longitude),o=toRad(t.latitude),c=toRad(e.latitude),i=Math.sin(a/2)*Math.sin(a/2)+Math.sin(n/2)*Math.sin(n/2)*Math.cos(o)*Math.cos(c);return 6371*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))}function isLocationMoreThanThreshold(e){return 1<=e}function isLocationLessThanThreshold(e){return e<=1}function sortedByAccuracy(e){return e.sort(function(e,t){return e.accuracy-t.accuracy})[0]}function sendCurrentViewNameToAndroid(t){if("Android"===native.getName())try{AndroidInterface.startConversation(t)}catch(e){sendExceptionObject(e,"CATCH Type 5: AndroidInterface.startConversation at sendCurrentViewNameToAndroid",[t])}}var locationPermission={checkLocationPermission:function(){try{return AndroidInterface.isLocationPermissionGranted()}catch(e){return sendExceptionObject(e,"CATCH Type 6: AndroidInterface.isLocationPermissionGranted at locationPermission",[]),!0}}};function createAndroidDialog(t,a){try{AndroidInterface.showDialog(t,a)}catch(e){sendExceptionObject(e,"CATCH Type 1:AndroidInterface.showDialog at createAndroidDialog ",[t,a]),appDialog(a,!0)}}function isLocationStatusWorking(){if("Android"!==native.getName())return!0;if(locationPermission.checkLocationPermission()){try{if(!AndroidInterface.isConnectionActive())return void createAndroidDialog("No Connectivity","Please Check your Internet Connectivity")}catch(e){return sendExceptionObject(e,"CATCH Type 7: AndroidInterface.isConnectionActive  at isLocationStatusWorking",[]),!0}return!0}createAndroidDialog("Location Permission","Please Allow Growthfile location access.")}function requestCreator(e,c){var a=firebase.auth().currentUser,i={type:e,body:"",user:{token:"",uid:a.uid,displayName:a.displayName,photoURL:a.photoURL,phoneNumber:a.phoneNumber}};"instant"===e||"now"===e||"Null"===e||"backblaze"===e?a.getIdToken(!1).then(function(e){i.body=c,i.user.token=e,apiHandler.postMessage(i)}).catch(function(e){handleError({message:e.code})}):getRootRecord().then(function(n){var o=n.location,e=isLastLocationOlderThanThreshold(o.lastLocationTime,5),t=[a.getIdToken(!1)];e&&t.push(manageLocation()),Promise.all(t).then(function(e){var t=e[0];2==e.length&&(o=e[1],console.log(o),updateLocationInRoot(o));var a={latitude:o.latitude,longitude:o.longitude,accuracy:o.accuracy,provider:o.provider};c.timestamp=fetchCurrentTime(n.serverTime),c.geopoint=a,i.body=c,i.user.token=t,sendRequest(o,i)}).catch(function(e){handleError(e)})}),apiHandler.onmessage=messageReceiver,apiHandler.onerror=onErrorMessage}function sendRequest(e,t){e.latitude&&e.longitude&&e.accuracy?apiHandler.postMessage(t):(appDialog("Fetching Location Please wait.",!0),getRootRecord().then(function(e){var t=void 0;try{t=AndroidInterface.getCellularData()}catch(e){t=e.message,sendExceptionObject(e,"CATCH Type 4: AndroidInterface.getCullarData at sendRequest",[])}var a={deviceInfo:native.getInfo(),storedLocation:e.location,cellTower:t};handleError({message:"No Locations Found in indexedDB",body:JSON.stringify(a)})}))}function isLastLocationOlderThanThreshold(e,t){var a=moment(moment().valueOf()),n=e;return t<moment.duration(a.diff(n)).asSeconds()}var receiverCaller={initFirstLoad:initFirstLoad,"update-app":updateApp,"removed-from-office":officeRemovalSuccess,"revoke-session":revokeSession,notification:successDialog,"android-stop-refreshing":androidStopRefreshing,apiFail:apiFail,backblazeRequest:urlFromBase64Image};function messageReceiver(e){receiverCaller[e.data.type](e.data)}function emailVerify(){if(firebase.auth().currentUser.email)emailUpdateSuccess();else{showEMailUpdateDailog();var e=new mdc.dialog.MDCDialog(document.getElementById("email-update-dialog"));e.show(),e.listen("MDCDialog:accept",function(){document.getElementById("email-update-dialog").remove(),profileView(!0)}),e.listen("MDCDialog:cancel",function(){document.getElementById("email-update-dialog").remove()})}}function showEMailUpdateDailog(){var e=document.createElement("aside");e.className="mdc-dialog mdc-dialog--open",e.id="email-update-dialog",e.style.backgroundColor="rgba(0,0,0,0.47)";var t=document.createElement("div");t.className="mdc-dialog__surface",t.style.width="90%",t.style.height="auto";var a=document.createElement("header");a.className="mdc-dialog__header";var n=document.createElement("h2");n.className="mdc-dialog__header__title",n.textContent="Reminder",a.appendChild(n);var o=document.createElement("section");o.className="mdc-dialog__body",o.textContent="Please Set your Email-id";var c=document.createElement("footer");c.className="mdc-dialog__footer";var i=document.createElement("button");i.type="button",i.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--accept",i.textContent="Okay",i.style.backgroundColor="#3498db";var r=document.createElement("button");r.type="button",r.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--cancel",r.textContent="Cancel",r.style.backgroundColor="#3498db",c.appendChild(r),c.appendChild(i),t.appendChild(a),t.appendChild(o),t.appendChild(c),e.appendChild(t),document.body.appendChild(e)}function initFirstLoad(t){"listView"===history.state[0]&&(t.msg.hasOwnProperty("activity")&&t.msg.activity.length&&getRootRecord().then(function(e){updateEl(t.msg.activity,e)}),t.msg.hasOwnProperty("template")&&createActivityIcon())}function updateApp(t){if("Android"!==native.getName())webkit.messageHandlers.updateApp.postMessage("Update App");else try{AndroidInterface.updateApp(t.msg)}catch(e){appUpdateDialog("Please Install the Latest version from google play store , to Use Growthfile. After Updating the App, close Growthfile and open again ",JSON.parse(t.msg).message),sendExceptionObject(e,"CATCH Type 8: AndroidInterface.updateApp at updateApp",[JSON.stringify(t.msg)])}}function revokeSession(){firebase.auth().signOut().then(function(){}).catch(function(e){handleError({message:"Sign out error",body:e})})}function apiFail(e){document.getElementById("send-activity")&&(document.getElementById("send-activity").style.display="block"),document.querySelector("header .mdc-linear-progress")&&document.querySelector("header .mdc-linear-progress").remove(),document.querySelector(".loader")&&document.querySelector(".loader").remove(),document.querySelector(".delete-activity")&&(document.querySelector(".delete-activity").style.display="block"),document.querySelector(".undo-delete-loader")&&(document.querySelector(".undo-delete-loader").style.display="block"),document.querySelector(".form-field-status")&&document.querySelector(".form-field-status").classList.contains("hidden")&&document.querySelector(".form-field-status").classList.remove("hidden"),snacks(e.msg.message)}function urlFromBase64Image(e){if(200===e.code&&"profileView"===history.state[0]){var t=document.querySelector("#profile--image-container .profile--loader ");return t&&t.remove(),void(document.getElementById("user-profile--image").src=firebase.auth().currentUser.photoURL)}}function officeRemovalSuccess(e){officeRemovalDialog("You have been removed from "+e.msg.join(" & "));var t=new mdc.dialog.MDCDialog(document.getElementById("office-removal-dialog"));t.show(),t.listen("MDCDialog:accept",function(){document.getElementById("office-removal-dialog").remove(),document.getElementById("app-current-panel").innerHTML="",listView()})}function androidStopRefreshing(){if("Android"===native.getName())try{AndroidInterface.stopRefreshing(!0)}catch(e){sendExceptionObject(e,"CATCH Type 9:AndroidInterface.stopRefreshing at androidStopRefreshing",[!0])}}function onErrorMessage(e){var t={"line-number":e.lineno,file:e.filename,"col-number":e.colno};handleError({message:e.message+" from apiHandler.js at line-number "+e.lineno+" and columne-number "+e.colno,body:t})}function getInputText(e){return mdc.textField.MDCTextField.attachTo(document.querySelector(e))}function runRead(e){if(localStorage.getItem("dbexist"))if(e)switch(Object.keys(e)[0]){case"verifyEmail":emailVerify();break;case"read":requestCreator("Null",e);break;default:requestCreator("Null",e)}else requestCreator("Null",e)}function removeChildNodes(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function sendExceptionObject(e,t,a){handleError({message:""+t,body:JSON.stringify({message:e.message,name:e.name,stack:JSON.stringify(e.stack),paramSent:a})})}