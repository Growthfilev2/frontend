var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){window.removeEventListener("scroll",at,!1),d("activity",e).then(function(e){e?(t&&history.pushState(["conversation",e],null,null),n(e)):tt()}).catch(rn)}function d(o,c){return new Promise(function(n,e){var t=firebase.auth().currentUser,a=window.indexedDB.open(t.uid);a.onsuccess=function(){a.result.transaction(o).objectStore(o).get(c).onsuccess=function(e){var t=e.target.result;n(!!t&&c)}},a.onerror=function(){e({message:a.error.message+" from checkIfRecordExists"})}})}function n(a){if(a){var o=firebase.auth().currentUser,c=window.indexedDB.open(o.uid);c.onsuccess=function(){var n=c.result,e=n.transaction(["addendum"],"readonly"),t=e.objectStore("addendum").index("activityId");C(n,a),r(a),i(n,a),kn("conversation"),E(n,a),t.openCursor(a).onsuccess=function(e){var t=e.target.result;t&&(document.getElementById(t.value.addendumId)||s(n,t.value,o).then(function(e){document.getElementById("chat-container")&&document.getElementById("chat-container").appendChild(e)}),t.continue())},e.oncomplete=function(){document.querySelector(".activity--chat-card-container")&&(document.querySelector(".activity--chat-card-container").scrollTop=document.querySelector(".activity--chat-card-container").scrollHeight)}}}}function r(e){if(!document.querySelector(".activity--chat-card-container")){var t=document.createElement("div");t.className="activity--chat-card-container  mdc-top-app-bar--fixed-adjust panel-card";var n=document.createElement("div");n.id="chat-container",n.className="mdc-card reverser-parent";var a=document.createElement("div");a.className="user-comment--container";var o=document.createElement("div");o.className="status--change-cont";var c=document.createElement("div");c.className="comment--container";var r=document.createElement("div");r.className="input--text-padding mdc-text-field mdc-text-field--dense",r.id="write--comment",r.style.width="100%";var i=document.createElement("input");i.className="mdc-text-field__input comment-field mdc-elevation--z4",i.type="text",r.appendChild(i),c.appendChild(r);var d=document.createElement("button");d.classList.add("mdc-fab","mdc-fab--mini","hidden"),d.id="send-chat--input";var s=document.createElement("span");s.classList.add("mdc-fac__icon","material-icons"),s.textContent="send",d.appendChild(s),c.appendChild(d),t.appendChild(n),a.appendChild(c),document.getElementById("app-current-panel").innerHTML=t.outerHTML+o.outerHTML+a.outerHTML,document.querySelector(".comment-field").oninput=function(e){e.target.value&&e.target.value.replace(/\s/g,"").length?p():m()},document.getElementById("send-chat--input").onclick=function(){Bn()&&l(e)}}}function l(e){qn("comment",{activityId:e,comment:document.querySelector(".comment-field").value}),document.querySelector(".comment-field").value="",m()}function m(){document.getElementById("send-chat--input").classList.add("hidden"),document.getElementById("write--comment").style.width="100%",document.getElementById("write--comment").style.transition="0.3s ease",document.querySelector(".status--change-cont").style.transition="0.3s ease",document.querySelector(".status--change-cont").style.opacity="1"}function p(){document.getElementById("send-chat--input").classList.remove("hidden"),document.getElementById("write--comment").style.width="80%",document.querySelector(".status--change-cont").style.opacity="0"}function i(e,t){var s=document.createElement("label");s.setAttribute("for","toggle-status"),s.textContent="Done",e.transaction("activity").objectStore("activity").get(t).onsuccess=function(e){var t=document.querySelector(".status--change-cont"),n=e.target.result;if(!n.canEdit||"CANCELLED"===n.status){var a=document.createElement("span"),o=e.target.result;return a.textContent="Activity "+o.status.toLowerCase(),void(t&&(t.innerHTML=a.outerHTML,t.style.textAlign="center"))}if(0!=n.editable){if(!document.querySelector(".status-check")){var c=document.createElement("div");c.className="mdc-form-field form-field-status";var r=document.createElement("div");r.className="mdc-checkbox status-check";var i=document.createElement("input");i.className="mdc-checkbox__native-control",i.id="toggle-status",i.type="checkbox";var d=document.createElement("div");d.className="mdc-checkbox__background";document.createElement("div").className="mdc-checkbox__mixedmark",d.innerHTML='<svg class="mdc-checkbox__checkmark"\n      viewBox="0 0 24 24">\n      <path class="mdc-checkbox__checkmark-path"\n      fill="none"\n      d="M1.73,12.91 8.1,19.28 22.79,4.59"/>\n      </svg>\n      <div class="mdc-checkbox__mixedmark"></div>',r.appendChild(i),r.appendChild(d),c.appendChild(r),t&&(t.innerHTML=c.outerHTML+s.outerHTML)}document.querySelector(".mdc-checkbox")&&(switchControl=new mdc.checkbox.MDCCheckbox.attachTo(document.querySelector(".mdc-checkbox")),"CONFIRMED"===n.status&&(switchControl.checked=!0),document.querySelector(".mdc-checkbox").onclick=function(){Bn()?h(switchControl,n):f(switchControl,n)})}else t&&(t.innerHTML=s.outerHTML+dn("status-loader").outerHTML)}}function f(e,t){"CONFIRMED"===t.status?e.checked=!0:e.checked=!1}function h(e,t){document.querySelector(".form-field-status").classList.add("hidden"),document.querySelector(".status--change-cont").appendChild(dn("status-loader")),e.checked?qn("statusChange",{activityId:t.activityId,status:"CONFIRMED"}):qn("statusChange",{activityId:t.activityId,status:"PENDING"})}function s(e,u,t){var m=!1;return new Promise(function(i){var d=document.createElement("div");d.classList.add("comment-box","talk-bubble","tri-right","round","btm-left"),t.phoneNumber===u.user?d.classList.add("current-user--comment","secondary-color-light"):d.classList.add("other-user--comment","mdc-theme--primary-bg"),d.id=u.addendumId;var s=document.createElement("div");s.classList.add("talktext");var l=document.createElement("p");l.classList.add("user-name--comment","mdc-typography--subtitle2"),v(e,u.user).then(function(e){e.displayName?l.textContent=e.displayName:l.textContent=e.mobile;var t=document.createElement("p");t.classList.add("comment","mdc-typography--subtitle2"),t.textContent=u.comment;var n=document.createElement("span");n.className="comment--info";var a=document.createElement("span");a.textContent=moment(u.timestamp).format("DD-MM-YY H:mm"),a.classList.add("comment-date","mdc-typography--caption");var o=document.createElement("div"),c=document.createElement("i");c.classList.add("user-map--span","material-icons"),c.appendChild(document.createTextNode("location_on")),o.onclick=function(e){if(g()){m=!m;var t={lat:u.location._latitude,lng:u.location._longitude};y(e,m,u.addendumId,t)}},c.dataset.latitude=u.location._latitude,c.dataset.longitude=u.location._longitude,o.appendChild(c);var r=document.createElement("div");r.className="map-convo",n.appendChild(a),n.appendChild(o),s.appendChild(l),s.appendChild(t),s.appendChild(n),d.appendChild(s),d.appendChild(r),i(d)})})}function v(t,a){return new Promise(function(n,e){t.transaction("users").objectStore("users").get(a).onsuccess=function(e){var t=e.target.result;return n(t||{displayName:"",mobile:a,photoURL:""})}})}function g(){return"object"===("undefined"==typeof google?"undefined":a(google))&&"object"===a(google.maps)}function y(e,t,n,a){var o="";if(o=e?document.getElementById(n).querySelector(".map-convo"):document.querySelector(".map-detail."+n),!t)return o.style.height="0px",void(e&&(e.target.textContent="location_on"));if(0!==o.children.length)return o.style.height="200px",void(e&&(e.target.textContent="arrow_drop_down"));e&&(e.target.textContent="arrow_drop_down"),o.style.height="200px";var c=new google.maps.Map(o,{zoom:16,center:a,disableDefaultUI:!0});if(!e){var r=document.createElement("div");new b(r,c,a.lat,a.lng);r.index=1,c.controls[google.maps.ControlPosition.TOP_LEFT].push(r)}new google.maps.Marker({position:a,map:c})}function b(e,t,n,a){var o=document.createElement("div");o.style.backgroundColor="#fff",o.style.border="2px solid #fff",o.style.borderRadius="3px",o.style.boxShadow="0 2px 6px rgba(0,0,0,.3)",o.style.cursor="pointer",o.style.marginBottom="22px",o.style.textAlign="center",o.style.padding="0px 5px 0px 5px",e.appendChild(o);var c=document.createElement("a");c.href="https://www.google.com/maps?q="+n+","+a,c.className="material-icons",c.style.color="rgb(25,25,25)",c.style.fontSize="16px",c.style.lineHeight="38px",c.style.paddingLeft="5px",c.style.paddingRight="5px",c.style.textDecoration="none",c.innerHTML="open_in_new",o.appendChild(c)}function C(t,e){var n=t.transaction("activity").objectStore("activity"),r=document.createElement("div"),i=document.createElement("div");i.className="back-icon",i.id="back-conv",i.style.float="left";var a=document.createElement("i");a.style.marginRight="5px",a.className="material-icons back-icon--large",a.textContent="arrow_back",i.appendChild(a),n.get(e).onsuccess=function(e){var c=e.target.result;_(t,c.creator).then(function(e){var t=document.createElement("object");t.data=e||"./img/empty-user.jpg",t.className="header--icon-creator",t.type="image/jpeg";var n=document.createElement("img");n.src="./img/empty-user.jpg",n.className="header--icon-creator",t.appendChild(n),i.appendChild(t);var a=document.createElement("div");a.className="mdc-list-item__text comment-header-primary mdc-typography--subtitle2",a.textContent=c.activityName;var o=document.createElement("span");o.className="mdc-list-item__secondary-text",o.textContent="Click here to see details",a.appendChild(o),r.appendChild(i),r.appendChild(a),Dt({id:"app-main-header",left:r.outerHTML}),document.getElementById("back-conv").addEventListener("click",function(){qe()}),document.querySelector(".comment-header-primary").addEventListener("click",function(){d("activity",c.activityId).then(function(e){e?X(c):tt()}).catch(rn)})})}}function E(e,t){var n=e.transaction(["list"],"readwrite"),a=n.objectStore("list");a.get(t).onsuccess=function(e){var t=e.target.result;t&&(t.count=0,a.put(t))},n.oncomplete=function(){}}function _(e,t){return new Promise(function(n){e.transaction("users").objectStore("users").get(t).onsuccess=function(e){var t=e.target.result;n(t?t.photoURL:"./img/empty-user.jpg")}})}function N(e,n){kn("selector");var t=document.createElement("aside");t.id="dialog--component",t.className="mdc-dialog",t.role="alertdialog";var a=document.createElement("div");a.className="mdc-dialog__surface",a.appendChild(je("dialog--surface-header"));var o=document.createElement("span");o.className="material-icons",o.textContent="search",o.id="selector--search";var c=document.createElement("span");c.className="material-icons dialog--header-back selector--type-"+n.store,c.textContent="arrow_back";var r=document.createElement("section");r.className="mdc-dialog__body--scrollable mdc-top-app-bar--fixed-adjust";var i=document.createElement("ul");i.id="data-list--container",i.className="mdc-list ",r.appendChild(i);var d=document.createElement("footer");d.className="mdc-dialog__footer";var s=document.createElement("button");s.className="mdc-fab mdc-dialog__footer__button mdc-dialog__footer__button--accept selector-send hidden",s.type="button";var l=document.createElement("span");l.className="mdc-fab__icon material-icons","users"===n.store?(l.textContent="add",s.dataset.clicktype="numpad"):l.textContent="send",s.appendChild(l),d.appendChild(s),a.appendChild(r),a.appendChild(d),t.appendChild(a);var u=document.createElement("div");u.className="mdc-dialog__backdrop",t.appendChild(u),document.body.appendChild(t),"subscriptions"===n.store||"children"===n.store?Dt({id:"dialog--surface-header",left:c.outerHTML}):Dt({id:"dialog--surface-header",left:c.outerHTML,right:o.outerHTML}),document.querySelector(".dialog--header-back").addEventListener("click",function(t){t.target.classList.contains("selector--type-users")&&"users-list-back"===t.target.dataset.state?q().then(function(e){S(t,n)}):x()}),w(e,n)}function x(){document.getElementById("dialog--component")&&(document.getElementById("dialog--component").remove(),document.getElementById("growthfile").classList.remove("mdc-dialog-scroll-lock"))}function S(e,t){e&&"back-list"===e.target.dataset.type&&(Ne(t),x())}function w(e,t){var n=new mdc.dialog.MDCDialog(document.querySelector("#dialog--component")),a=t.record,o=firebase.auth().currentUser.uid,c=indexedDB.open(o);c.onsuccess=function(){var e=c.result;"map"===t.store&&M(e,e.transaction([t.store]),n,t);"subscriptions"===t.store&&H(e,n,t),"users"===t.store&&(e.transaction(t.store).objectStore(t.store),q().then(function(){I(t,n)})),"children"===t.store&&j(e.transaction(t.store).objectStore(t.store),a,n,t)},n.lastFocusedTarget=e.target,n.show()}function I(a,o){var c=document.getElementById("data-list--container"),r={};a.record.assignees.forEach(function(e){r[e]=""});var i=indexedDB.open(firebase.auth().currentUser.uid);i.onsuccess=function(){var e=i.result,t=e.transaction(["users"]),n=t.objectStore("users");document.querySelector(".selector-send").classList.remove("hidden"),n.openCursor().onsuccess=function(e){var t=e.target.result;if(t){var n=t.value;a.attachment.present?c.appendChild(ce(n,!0,!1)):r.hasOwnProperty(t.value.mobile)||c.appendChild(ce(n,!0,!0)),t.continue()}},t.oncomplete=function(){document.querySelectorAll('[data-selected="true"]').forEach(function(e){e&&(new mdc.checkbox.MDCCheckbox.attachTo(e).checked=!0,e.children[1].style.animation="none",e.children[1].children[0].children[0].style.animation="none")}),document.getElementById("selector--search").addEventListener("click",function(){Ee(e,"users",a)}),o.acceptButton_.onclick=function(){if("numpad"===o.acceptButton_.dataset.clicktype)return document.getElementById("selector--search").style.display="none",Gn(document.getElementById("data-list--container")),document.querySelector(".mdc-dialog__footer").style.display="none",void L(a,o);if(a.attachment.present){var e=new mdc.radio.MDCRadio(document.querySelector(".mdc-radio.radio-selected"));F(a.record,{hash:"",key:a.attachment.key},{primary:JSON.parse(e.value)}).then(x).catch(rn)}else a.record.hasOwnProperty("create")?q().then(function(e){F(a.record,{hash:"addOnlyAssignees"},{primary:e}).then(x).catch(rn)}):Bn()&&k(a)}}}}function k(t){document.querySelector(".add--assignee-loader").appendChild(dn("user-loader")),document.querySelector(".add--assignee-loader .add--assignee-icon").style.display="none",q().then(function(e){qn("share",{activityId:t.record.activityId,share:e}),x()})}function L(n){var e=document.createElement("div");e.className="custom-number--container";var t=document.createElement("input");t.className="mdc-text-field__input",t.id="number-field",t.type="number",t.setAttribute("maxlength","10"),t.setAttribute("size","10"),t.required=!0,t.onkeypress=function(e){return 48<=e.charCode&&e.charCode<=57},t.oninput=function(){this.value.length>this.maxLength?this.value=this.value.slice(0,this.maxLength):this.value.length===this.maxLength?(document.querySelector(".message-field").classList.remove("error-message"),this.classList.add("valid-input"),document.querySelector(".message-field").textContent="",document.getElementById("new-contact").disabled=!1):(document.querySelector(".message-field").classList.add("error-message"),document.querySelector(".message-field").textContent="* Please Enter a valid Number",document.getElementById("new-contact").disabled=!0)};var a=document.createElement("button");a.className="mdc-button",a.textContent="Add Contact",a.id="new-contact",a.onclick=function(){var t=tn(document.getElementById("number-field").value);an(t)?B(t).then(function(e){if(e)return document.getElementById("new-contact").disabled=!0,document.querySelector(".message-field").classList.add("error-message"),void(document.querySelector(".message-field").textContent="* Contact already exist");n.attachment.present?F(n.record,{hash:"",key:n.attachment.key},{primary:[t]}).then(x).catch(rn):n.record.hasOwnProperty("create")?F(n.record,{hash:"addOnlyAssignees"},{primary:[t]}).then(x).catch(rn):isLocationVerified()&&D(n,t)}):(document.querySelector(".message-field").classList.add("error-message"),document.querySelector(".message-field").textContent="* Please Enter a valid Number",document.getElementById("new-contact").disabled=!0)};var o=document.createElement("p");o.className="mdc-typography--subtitle2 message-field",o.textContent="Enter new phone contact without country code",o.id="helper-message",e.appendChild(t),e.appendChild(o),e.appendChild(a),document.querySelector("#dialog--component section.mdc-dialog__body--scrollable").appendChild(e);new mdc.ripple.MDCRipple.attachTo(document.getElementById("new-contact"))}function D(e,t){qn("share",{activityId:e.record.activityId,share:[t]}),x()}function B(a){return new Promise(function(n){var e=firebase.auth().currentUser.uid,t=indexedDB.open(e);t.onsuccess=function(){t.result.transaction("users").objectStore("users").get(a).onsuccess=function(e){var t=e.target.result;n(!!t)}}})}function q(){return new Promise(function(a){var o=[],e=firebase.auth().currentUser.uid,t=indexedDB.open(e);t.onsuccess=function(){var n=t.result.transaction(["users"],"readwrite").objectStore("users");n.openCursor().onsuccess=function(e){var t=e.target.result;t?(t.value.isSelected&&(o.push(t.value.mobile),t.value.isSelected=!1,n.put(t.value)),t.continue()):a(o)}}})}function M(t,e,n,a){if("check-in"===a.record.template){document.getElementById("selector--search").classList.add("hidden");var o=document.getElementById("data-list--container");Et().then(function(e){A(a.record.office,e.location).then(function(e){e.forEach(function(e){o.appendChild(te(e,!1,a.record,!0))}),P(t,n,a)})})}else T(e,a).then(function(){P(t,n,a)}).catch(console.log)}function T(r,i){return new Promise(function(e,t){var n=document.getElementById("data-list--container"),a=r.objectStore("map"),o=i.record.office,c=IDBKeyRange.bound([o,""],[o,"￿"]);a.index("byOffice").openCursor(c,"nextunique").onsuccess=function(e){var t=e.target.result;t&&(t.value.office===i.record.office&&t.value.location&&n.appendChild(te(t.value,!1,i.record,!0)),t.continue())},r.oncomplete=function(){e(!0)},r.onerror=function(){t(r.error)}})}function A(i,d){return new Promise(function(o,c){var r=indexedDB.open(firebase.auth().currentUser.uid);r.onsuccess=function(){var n=[],e=r.result.transaction(["map"]),t=e.objectStore("map").index("byOffice"),a=IDBKeyRange.bound([i,""],[i,"￿"]);t.openCursor(a,"nextunique").onsuccess=function(e){var t=e.target.result;t&&(t.value.location&&wn(xn(t.value,d))&&n.push(t.value),t.continue())},e.oncomplete=function(){o(n)},e.onerror=function(){c(e.error)}}})}function P(e,t,a){document.getElementById("selector--search")&&document.getElementById("selector--search").addEventListener("click",function(){Ee(e,"map",a)}),document.querySelector(".selector-send").classList.remove("hidden"),t.acceptButton_.onclick=function(){var e=document.querySelector(".mdc-radio.radio-selected");if(e){var t=new mdc.radio.MDCRadio(e),n=JSON.parse(t.value);F(a.record,{hash:"venue",key:a.key},{primary:n.location,secondary:{address:n.address,geopoint:n.geopoint}}).then(x).catch(rn)}}}function j(e,n,t,a){var o=document.getElementById("data-list--container");e.openCursor().onsuccess=function(e){var t=e.target.result;t&&(t.value.template===a.attachment.template&&t.value.office===a.attachment.office&&"CANCELLED"!=t.value.status&&(t.value.attachment.Name&&o.appendChild($("children",t.value.attachment.Name.value)),t.value.attachment.Number&&o.appendChild($("children",t.value.attachment.Number.value))),t.continue())},document.querySelector(".selector-send").classList.remove("hidden"),t.acceptButton_.onclick=function(){var e=new mdc.radio.MDCRadio(document.querySelector(".mdc-radio.radio-selected")),t=JSON.parse(e.value);F(n,{hash:"children",key:a.attachment.key},{primary:t.name}).then(x).catch(rn)}}function H(e,o,c){var r=document.getElementById("data-list--container"),i=document.createElement("div");i.className="mdc-list-group";var d=[],t=e.transaction(["subscriptions"]);t.objectStore("subscriptions").index("office").openCursor(null,"nextunique").onsuccess=function(e){var t=e.target.result;if(t){var n=document.createElement("h3");n.className="mdc-list-group__subheader subheader--group-small",n.textContent=t.value.office,n.dataset.groupOffice=t.value.office;var a=document.createElement("ul");a.className="mdc-list",a.dataset.selection=t.value.office,a.setAttribute("aria-orientation","vertical"),d.push(t.value.office),i.appendChild(n),i.appendChild(a),t.continue()}},t.oncomplete=function(){if(c.suggestCheckIn){var e=document.getElementById("data-list--container"),t=document.createElement("div");t.className="suggest-checkin--view";var n=document.createElement("span");n.className="material-icons suggestion-icon",n.textContent="add_alert",t.appendChild(n);var a=document.createElement("span");a.textContent="Check-In ?",a.className="suggest-checkin--text",t.appendChild(n),t.appendChild(a),e.insertBefore(t,e.childNodes[0])}O(d,c.suggestCheckIn),r.appendChild(i),o.acceptButton_.onclick=function(){if(Bn()&&document.querySelector(".mdc-radio.radio-selected")){var e=new mdc.radio.MDCRadio(document.querySelector(".mdc-radio.radio-selected")),t=JSON.parse(e.value);document.getElementById("app-current-panel").dataset.view="create",U(t.office,t.template,c)}}}}function O(e,n){var t=indexedDB.open(firebase.auth().currentUser.uid),a=(document.createDocumentFragment(),[]);t.onsuccess=function(){var e=t.result.transaction(["subscriptions"],"readonly");e.objectStore("subscriptions").index("office").openCursor().onsuccess=function(e){var t=e.target.result;if(t)if("CANCELLED"!==t.value.status)if(document.querySelector('[data-selection="'+t.value.office+'"] [data-template="'+t.value.template+'"]'))t.continue();else{if(n&&"check-in"===t.value.template)return a.push(c({},t.value.office,Z(t.value.office,t.value.template))),void t.continue();document.querySelector('[data-selection="'+t.value.office+'"]').appendChild(Z(t.value.office,t.value.template)),t.continue()}else t.continue()},e.oncomplete=function(){a.forEach(function(n){Object.keys(n).forEach(function(e){var t=document.querySelector('[data-selection="'+e+'"]');t.insertBefore(n[e],t.childNodes[0])})}),document.querySelector(".selector-send").classList.remove("hidden")}}}function U(n,r,e){var t=firebase.auth().currentUser.uid,a=indexedDB.open(t);a.onsuccess=function(){var e=a.result.transaction(["subscriptions"]).objectStore("subscriptions").index("officeTemplate"),t=IDBKeyRange.only([n,r]);e.get(t).onsuccess=function(e){var a=e.target.result;if(a){var n=[];a.schedule.forEach(function(e){var t={};t.name=e,t.startTime="",t.endTime="",n.push(t)});var o={office:a.office,template:a.template,venue:"",schedule:n,attachment:a.attachment,timestamp:Date.now(),canEdit:!0,assignees:[],activityName:a.template.toUpperCase(),create:!0},c=[];"check-in"!==r?(a.venue.forEach(function(e){var t={};t.venueDescriptor=e,t.location="",t.address="",t.geopoint={_latitude:"",_longitude:""},c.push(t)}),o.venue=c,X(o),x()):Et().then(function(e){if(An(e.location.lastLocationTime,5))return ln("Fetching Location Please wait",!1),void window.addEventListener("location",function e(t){var n=t.detail;document.querySelector("#enable-gps")&&document.querySelector("#enable-gps").remove(),R(o,a.venue[0],n),window.removeEventListener("location",e,!0)},!0);R(o,a.venue[0],e.location)})}}}}function R(o,c,e){A(o.office,e).then(function(e){var t=[],n={};if(n.venueDescriptor=c,n.location="",n.address="",n.geopoint={_latitude:"",_longitude:""},e.length?n.showIcon=!0:n.showIcon=!1,1===e.length){var a=e[0];n.location=a.location,n.address=a.address,n.geopoint={_latitude:a.latitude,_longitude:a.longitude}}t.push(n),o.venue=t,X(o),x()})}function Y(o,c,r){var e=firebase.auth().currentUser.uid,t=indexedDB.open(e);return new Promise(function(a){t.onsuccess=function(){var e=t.result.transaction("children").objectStore("children"),n=0;e.openCursor().onsuccess=function(e){var t=e.target.result;t?(t.value.template===c&&t.value.office===o&&"CANCELLED"!=r&&n++,t.continue()):a(0!==n)}}})}function F(i,d,s){return new Promise(function(o,c){var e=firebase.auth().currentUser.uid,r=indexedDB.open(e);r.onsuccess=function(){var t=r.result,n=i;if("venue"===d.hash)return n=z(n,d,s),V(d,s),void J(n,t).then(function(e){o(e)}).catch(function(e){c(e)});if("addOnlyAssignees"===d.hash){if(!s.primary.length)return;var a=document.getElementById("assignees--list");return s.primary.forEach(function(e){-1<n.assignees.indexOf(e)||(n.assignees.push(e),v(t,e).then(function(e){a&&a.appendChild(ce(e))}))}),void o(!0)}"weekday"!==d.hash&&d.hasOwnProperty("key")&&(n.attachment[d.key].value=s.primary,J(n,t).then(function(e){V(d,s),o(e)}).catch(function(e){c(e)}))}})}function J(c,r){return new Promise(function(e,t){var n=r.transaction(["activity"],"readwrite"),a=n.objectStore("activity"),o=c;o.hasOwnProperty("create")||a.put(o),n.oncomplete=function(){e("activity object store updated with value")},n.onerror=function(){t({message:n.error.message+" from updateLocalRecord"})}})}function V(e,t){var n=document.getElementById(G(e.key));if(n){var a=n.querySelector("[data-primary]"),o=n.querySelector("[data-secondary]"),c=document.getElementById("send-activity");t.primary&&a&&(a.textContent=t.primary),t.hasOwnProperty("secondary")&&o&&(o.textContent=t.secondary.address),c&&(c.dataset.progress||c.classList.remove("hidden"))}}function z(e,t,n){return e.venue.forEach(function(e){e.venueDescriptor===t.key&&(e.location=n.primary,e.address=n.secondary.address,e.geopoint._latitude=n.secondary.geopoint._latitude,e.geopoint._longitude=n.secondary.geopoint._longitude)}),e}function G(e){return e.replace(/-/g,"--").replace(/\s/g,"-")}function K(e){return e.replace(/-/g," ").replace("  ","-")}function W(e,t){var n=JSON.parse(e);document.body.style.backgroundColor="#eeeeee";var a=document.createElement("div");a.style.display="inline-flex";var o=document.createElement("span");o.className="material-icons",o.textContent="arrow_back",o.id="backToConv";var c=document.createElement("span");c.textContent=n.activityName,c.style.fontSize="18px",c.style.paddingLeft="10px",c.style.marginTop="6px",a.appendChild(o),a.appendChild(c),Dt({id:"app-main-header",left:a.outerHTML}),document.getElementById("backToConv").addEventListener("click",function(){J(n,t).then(function(){qe()}).catch(rn)});var r=document.createElement("div");r.className="mdc-top-app-bar--fixed-adjust update-create--activity";for(var i=["office","venue","schedule","attachment","assignees"],d=0;d<5;d++){var s=document.createElement("ul");s.className="mdc-list custom--list-margin";var l=document.createElement("div");switch(i[d]){case"office":s.classList.remove("custom--list-margin");break;case"schedule":l.className="mdc-list-group__subheader",l.id="schedule--group";break;case"venue":case"assignees":s.classList.add("mdc-list--two-line","mdc-list--avatar-list")}"schedule"===i[d]?r.appendChild(l):(s.id=i[d]+"--list",r.appendChild(s))}if(n.canEdit){var u=document.createElement("button");u.className="mdc-fab send--activity-fab",u.setAttribute("aria-label","Send"),u.id="send-activity",n.hasOwnProperty("create")||u.classList.add("hidden");var m=document.createElement("span");m.className="mdc-fab__icon material-icons",m.textContent="send",u.appendChild(m),r.appendChild(u)}return r}function X(r){history.pushState(["updateCreateActivity",r],null,null);var e=firebase.auth().currentUser.uid,i=indexedDB.open(e);i.onsuccess=function(){var e=i.result,t=document.getElementById("app-current-panel"),n=JSON.stringify(r);t.innerHTML=W(n,e).outerHTML,document.getElementById("office--list").appendChild($("Office",{office:r.office,showLabel:!0})),ee(r),ne(r),ae(r),oe(r,!0,e),pe(r),document.getElementById("send-activity")&&document.getElementById("send-activity").addEventListener("click",function(){Bn()&&(this.dataset.progress=!0,ve(r))});for(var a=document.querySelectorAll(".update-create--activity input"),o=0;o<a.length;o++)a[o].addEventListener("input",function(e){document.getElementById("send-activity").dataset.progress||document.getElementById("send-activity").classList.contains("hidden")&&document.getElementById("send-activity").classList.remove("hidden")});if(document.querySelector(".mdc-select")){var c=new mdc.select.MDCSelect(document.querySelector(".mdc-select"));c.listen("change",function(){F(r,{hash:"weekday",key:c.root_.dataset.value},{primary:c.value}).then(function(e){document.getElementById("send-activity").dataset.progress||document.getElementById("send-activity").classList.contains("hidden")&&document.getElementById("send-activity").classList.remove("hidden")}).catch(rn)})}}}function $(e,t){var n=document.createElement("li");n.className="mdc-list-item mdc-ripple-upgraded";var a=document.createElement("span");a.className="detail--static-text";document.createElement("span");var o=document.createElement("span");if("Office"===e&&(o.className="data--value-list",o.textContent=t.office,a.textContent=e,n.appendChild(a),n.appendChild(o)),"children"===e){var c=document.createElement("span");c.className="mdc-list-item__meta",c.appendChild(re()),n.textContent=t,n.appendChild(c),n.onclick=function(){se(this,{name:t})}}if("delete"===e&&(o.className="mdc-list-item__graphic material-icons",o.textContent=e,a.classList.remove("detail--static-text"),a.classList.add("delete-activity"),a.textContent=t.text,n.appendChild(o),n.appendChild(a)),"empty"===e&&(n.dataset.prop="delete"),"undo-deleted"===e){o.className="mdc-list-item__graphic material-icons",o.textContent="delete",a.classList.remove("detail--static-text"),a.classList.add("delete-activity"),a.textContent=t.text,n.appendChild(o),n.appendChild(a),n.classList.add("undo-delete-activity");var r=document.createElement("button");r.className="mdc-button mdc-ripple-upgraded mdc-list-item__meta undo-deleted",r.textContent="Undo",r.onclick=function(){Bn()&&(document.querySelector(".undo-deleted").style.display="none",n.appendChild(dn("undo-delete-loader")),Q(t.id))},n.appendChild(r)}return n}function Q(e){qn("statusChange",{activityId:e,status:"PENDING"})}function Z(e,t){var n=document.createElement("li");n.className="mdc-list-item transition-ease",n.dataset.template=t;var a=document.createElement("span");a.className="mdc-list-item__text",a.textContent=t.toUpperCase();var o=document.createElement("span");return o.className="mdc-list-item__meta",o.appendChild(re()),n.onclick=function(){se(this,{office:e,template:t})},n.appendChild(a),n.appendChild(o),n}function ee(n){var a=document.getElementById("venue--list");n.venue.forEach(function(e){a.appendChild(te(e,!0,n));var t=document.createElement("div");t.className="map-detail "+G(e.venueDescriptor),a.appendChild(t)}),0===n.venue.length&&(document.getElementById("venue--list").style.display="none")}function te(n,e,t,a){var o=!1,c=document.createElement("li");c.className="mdc-list-item mdc-ripple-upgraded",c.id=G(n.venueDescriptor);var r=document.createElement("div");r.className="mdc-list-item__text link--span";var i=document.createElement("span");i.className="mdc-list-item__primary-text";var d=document.createElement("span");d.className="mdc-list-item__meta";var s=document.createElement("label");s.className="mdc-fab add--assignee-icon attachment-selector-label";var l=document.createElement("span");if(l.className="mdc-fab__icon material-icons",l.textContent="add_location",s.appendChild(l),e){var u=document.createElement("span");u.className="detail--static-text",u.textContent=n.venueDescriptor;var m=document.createElement("span");m.className="data--value-list",m.textContent=n.location,m.dataset.primary="",i.appendChild(u),i.appendChild(m),r.appendChild(i),r.onclick=function(e){if(g()&&n.geopoint._latitude&&n.geopoint._longitude){o=!o;var t={lat:n.geopoint._latitude,lng:n.geopoint._longitude};y("",o,G(n.venueDescriptor),t)}},t.canEdit&&(d.setAttribute("aria-hidden","true"),d.appendChild(s),s.onclick=function(e){N(e,{record:t,store:"map",attachment:{present:!1},key:n.venueDescriptor})})}else i.textContent=n.location,r.appendChild(i);var p=document.createElement("span");p.className="mdc-list-item__meta material-icons",a&&(p.appendChild(re()),c.onclick=function(){se(this,{location:n.location,address:n.address,geopoint:{_latitude:n.latitude,_longitude:n.longitude},venueDesc:n.venueDescriptor})});var f=document.createElement("span");return f.className="mdc-list-item__secondary-text",t.hasOwnProperty("create")?"check-in"!==t.template||a||(n.showIcon?f.textContent=n.address:(f.style.paddingTop="3px",f.textContent="Not A Known Location")):f.textContent=n.address,f.dataset.secondary="",r.appendChild(f),c.appendChild(r),a?c.appendChild(p):"check-in"===t.template?n.showIcon&&c.appendChild(d):c.appendChild(d),c}function ne(v){v.schedule.length||(document.getElementById("schedule--group").style.display="none");var g=0;v.schedule.forEach(function(e){g++;var t=document.createElement("h5");t.className="mdc-list-group__subheader label--text",t.textContent=e.name;var n=document.createElement("ul");n.className="mdc-list mdc-list--dense";var a=document.createElement("li");a.className="mdc-list-divider",a.setAttribute("role","separator");var o=document.createElement("li");o.className="mdc-list-item schedule-start-li";var c=document.createElement("div");c.className="mdc-text-field start--date"+g;var r=document.createElement("input");r.value=moment(e.startTime||new Date).format("YYYY-MM-DD"),r.type="date",r.disabled=!v.canEdit,r.className="mdc-text-field__input",c.appendChild(r);var i=document.createElement("span");i.className="mdc-list-item__meta";var d=document.createElement("div");d.className="mdc-text-field start--time"+g;var s=document.createElement("input");s.value=moment(e.startTime||new Date).format("HH:mm"),s.type="time",s.className="time--input",s.disabled=!v.canEdit,s.className="mdc-text-field__input",d.appendChild(s),i.appendChild(d);var l=document.createElement("li");l.className="mdc-list-item schedule-end-li";var u=document.createElement("div");u.className="mdc-text-field end--date"+g;var m=document.createElement("input");m.value=moment(e.endTime||new Date).format("YYYY-MM-DD"),m.type="date",m.disabled=!v.canEdit,m.className="mdc-text-field__input",u.appendChild(m);var p=document.createElement("span");p.className="mdc-list-item__meta";var f=document.createElement("div");f.className="mdc-text-field end--time"+g;var h=document.createElement("input");h.value=moment(e.endTime||new Date).format("HH:mm"),h.type="time",h.disabled=!v.canEdit,h.className="mdc-text-field__input",f.appendChild(h),p.appendChild(f),o.appendChild(c),o.appendChild(i),l.appendChild(u),l.appendChild(p),n.appendChild(o),n.appendChild(a),n.appendChild(l),document.getElementById("schedule--group").appendChild(t),document.getElementById("schedule--group").appendChild(n)})}function ae(p){["Name","Number","Template","email","phoneNumber","HHMM","weekday","number","base64","string"].forEach(function(e){var t=document.createElement("div");t.className=e+"--group",document.getElementById("attachment--list").appendChild(t)});var f={phoneNumber:"",weekday:"","HH:MM":"",string:"",base64:"",number:"",email:""};Object.keys(p.attachment).forEach(function(t){var n=document.createElement("div");"HH:MM"===p.attachment[t].type?n.className="attachment-field HHMM":n.className="attachment-field "+p.attachment[t].type,n.id=G(t),p.canEdit&&n.classList.add("editable--true");var e=document.createElement("span");if(e.className="label--text","Name"===(e.textContent=t)||"Number"===t){n.appendChild(e);n.appendChild(Se(p.attachment[t].value,p.canEdit,"",t,!0))}else"string"===p.attachment[t].type&&(n.appendChild(e),n.appendChild(Se(p.attachment[t].value,p.canEdit,"",t)));if("number"===p.attachment[t].type&&(n.appendChild(e),n.appendChild(we(p.attachment[t].value,p.canEdit))),"email"===p.attachment[t].type&&(n.appendChild(e),n.appendChild(Ie(p.attachment[t].value,p.canEdit))),"phoneNumber"===p.attachment[t].type){n.classList.add("selector--margin");var a=document.createElement("label");a.className="mdc-fab add--assignee-icon attachment-selector-label";var o=document.createElement("span");o.className="mdc-fab__icon material-icons",o.textContent="person_add",a.appendChild(o);var c=document.createElement("span");c.className="data--value-list",c.dataset.primary="",p.canEdit&&(n.appendChild(a),a.onclick=function(e){N(e,{record:p,store:"users",attachment:{present:!0,key:t}})}),n.appendChild(e),c.textContent=p.attachment[t].value,n.appendChild(c)}if("HH:MM"==p.attachment[t].type&&(n.appendChild(e),n.appendChild(ke(p.attachment[t].value,p.canEdit,{simple:!1,type:"time"}))),"weekday"===p.attachment[t].type&&(n.appendChild(e),n.appendChild(Le(t,p.attachment[t].value,p.canEdit))),"base64"===p.attachment[t].type){var r=document.createElement("label");r.className="mdc-fab attachment-selector-label add--assignee-icon",r.id="start-camera";var i=document.createElement("span");i.className="mdc-fab__icon material-icons",i.textContent="add_a_photo",r.appendChild(i);var d=document.createElement("ul");d.className="image-preview--attachment mdc-image-list standard-image-list mdc-image-list--with-text-protection",d.appendChild(le(p.attachment[t].value,t,!0)),n.appendChild(d),p.canEdit&&(n.appendChild(r),n.appendChild(d),r.onclick=function(){ue()})}if(!f.hasOwnProperty(p.attachment[t].type)){var s=document.createElement("label");s.className="mdc-fab add--assignee-icon attachment-selector-label";var l=document.createElement("span");l.className="mdc-fab__icon material-icons",l.textContent="add",s.appendChild(l),n.appendChild(e);var u=document.createElement("span");u.textContent=p.attachment[t].value,u.className="data--value-list",n.appendChild(u),p.canEdit&&Y(p.office,p.attachment[t].type,p.status).then(function(e){e&&(n.appendChild(s),n.classList.add("selector--margin"),s.onclick=function(e){u.dataset.primary="",N(e,{record:p,store:"children",attachment:{present:!0,key:t,office:p.office,template:p.attachment[t].type,status:p.status}})})})}var m=document.createElement("hr");m.className="attachment--divider","HH:MM"===p.attachment[t].type?(document.querySelector(".HHMM--group").appendChild(n),document.querySelector(".HHMM--group").appendChild(m)):"Name"===t?(document.querySelector(".Name--group").appendChild(n),document.querySelector(".Name--group").appendChild(m)):f.hasOwnProperty(p.attachment[t].type)?(document.querySelector("."+p.attachment[t].type+"--group").appendChild(n),document.querySelector("."+p.attachment[t].type+"--group").appendChild(m)):(document.querySelector(".Template--group").appendChild(n),document.querySelector(".Template--group").appendChild(m))})}function oe(t,e,n){var a=document.getElementById("assignees--list");if(e){var o=document.createElement("li");o.className="mdc-list-item label--text add--assignee-loader",o.textContent="Assignees";var c=document.createElement("span");c.className="mdc-list-item__meta";var r=document.createElement("div");r.className="mdc-fab add--assignee-icon",r.onclick=function(e){N(e,{record:t,store:"users",attachment:{present:!1}})};var i=document.createElement("span");i.className="mdc-fab__icon material-icons",i.textContent="person_add",r.appendChild(i),c.appendChild(r),t.canEdit&&o.appendChild(c),a.appendChild(o)}t.assignees.forEach(function(e){v(n,e).then(function(e){a.appendChild(ce(e))})})}function ce(e,t,n){var a=document.createElement("li");if(a.classList.add("mdc-list-item","assignee-li"),!e)return a;a.dataset.value=e.mobile;var o=document.createElement("object");o.data=e.photoURL||"./img/empty-user.jpg",o.type="image/jpeg",o.className="mdc-list-item__graphic";var c=document.createElement("img");c.src="./img/empty-user.jpg",c.className="empty-user-assignee",o.appendChild(c);var r=document.createElement("span");r.classList.add("mdc-list-item__text");var i=document.createElement("span");i.className="mdc-list-item__primary-text";var d=document.createElement("span");d.classList.add("mdc-list-item__secondary-text"),e.displayName?(i.textContent=e.displayName,d.textContent=e.mobile):i.textContent=e.mobile,r.appendChild(i),r.appendChild(d);var s=document.createElement("span");return s.className="mdc-list-item__meta material-icons",t&&(n?s.appendChild(ie(e)):(s.appendChild(re()),a.onclick=function(){se(this,a.dataset.value)})),a.appendChild(o),a.appendChild(r),a.appendChild(s),a}function re(){var e=document.createElement("div");e.className="mdc-radio radio-control-selector";var t=document.createElement("input");t.className="mdc-radio__native-control",t.type="radio",t.name="radio";var n=document.createElement("div");n.className="mdc-radio__background";var a=document.createElement("div");a.className="mdc-radio__outer-circle";var o=document.createElement("div");return o.className="mdc-radio__inner-circle",n.appendChild(a),n.appendChild(o),e.appendChild(t),e.appendChild(n),e}function ie(t){var e=document.createElement("div");e.className="mdc-checkbox status-check",e.dataset.selected=t.isSelected;var n=document.createElement("input");n.className="mdc-checkbox__native-control",n.type="checkbox",n.onclick=function(e){de(e,t)};var a=document.createElement("div");a.className="mdc-checkbox__background";return document.createElement("div").className="mdc-checkbox__mixedmark",a.innerHTML='<svg class="mdc-checkbox__checkmark"\n    viewBox="0 0 24 24">\n    <path class="mdc-checkbox__checkmark-path"\n    fill="none"\n    d="M1.73,12.91 8.1,19.28 22.79,4.59"/>\n    </svg>\n    <div class="mdc-checkbox__mixedmark"></div>',e.appendChild(n),e.appendChild(a),e}function de(t,n){var e=firebase.auth().currentUser.uid,a=indexedDB.open(e);a.onsuccess=function(){var e=a.result.transaction("users","readwrite").objectStore("users");n.hasOwnProperty("isSelected")&&n.isSelected?(t.target.parentNode.dataset.selected=!1,n.isSelected=!1):(t.target.parentNode.dataset.selected=!0,n.isSelected=!0,document.querySelector(".selector-send span").textContent="send"),e.put(n),0==document.querySelectorAll('[data-selected="true"]').length?(document.querySelector(".selector-send span").textContent="add",document.querySelector(".selector-send").dataset.clicktype="numpad"):document.querySelector(".selector-send").dataset.clicktype=""}}function se(e,t){[].concat(o(document.querySelectorAll(".radio-selected"))).forEach(function(e){e.classList.remove("radio-selected")});var n=e;if(n){var a=new mdc.radio.MDCRadio(n.querySelector(".radio-control-selector"));a.root_.classList.add("radio-selected"),document.querySelector(".selector-send span").textContent="send",document.querySelector(".selector-send").dataset.clicktype="",a.value=JSON.stringify(t)}}function le(e,t,n){if(document.querySelector(".image--list-li"))return document.getElementById("attachment-picture").data="data:image/jpg;base64,"+e,document.getElementById("attachment-picture").dataset.value="data:image/jpg;base64,"+e,void(document.getElementById("send-activity").dataset.progress||document.getElementById("send-activity").classList.remove("hidden"));var a=document.createElement("li");a.className="mdc-image-list__item image--list-li";var o=document.createElement("div"),c=document.createElement("object");c.data=e||"./img/placeholder.png",c.type="image/jpeg",c.id="attachment-picture",c.dataset.photoKey=t,c.className="profile-container--main mdc-image-list__image";var r=document.createElement("img");r.src="./img/placeholder.png",r.className="profile-container--main mdc-image-list__image",c.dataset.value=e?c.src=e:(c.data="./img/placeholder.png",""),c.appendChild(r),c.onclick=function(){me(this.data)},o.appendChild(c),a.appendChild(o);var i=document.createElement("div");i.className="mdc-image-list__supporting";var d=document.createElement("span");return d.textContent=t,d.className="mdc-image-list__label",d.id="label--image",i.appendChild(d),a.appendChild(i),n?a:void 0}function ue(){if("Android"===De.getName())try{AndroidInterface.startCamera()}catch(e){rn({message:e.message+" from startCamera"})}else webkit.messageHandlers.takeImageForAttachment.postMessage("convert image to base 64")}function me(e){e&&(document.getElementById("viewImage--dialog-component").querySelector("img").src=e,new mdc.dialog.MDCDialog.attachTo(document.querySelector("#viewImage--dialog-component")).show())}function pe(e){if(e.canEdit){var t=document.createElement("div");if(t.className="status--cancel-cont",!e.hasOwnProperty("create"))if("CANCELLED"!==e.status){if("CANCELLED"!==e.status){if(t.appendChild($("delete",{text:"CANCEL"})),document.querySelector(".update-create--activity").appendChild(t),!e.canEdit)return;document.getElementById("cancel-alert")||he();var n=new mdc.dialog.MDCDialog(document.querySelector("#cancel-alert"));document.getElementById("delete-allow").onclick=function(){Bn()&&fe(e.activityId)},n.listen("MDCDialog:cancel",function(){}),document.querySelector(".delete-activity").addEventListener("click",function(e){n.lastFocusedTarget=e.target,n.show()})}}else{t.appendChild($("undo-deleted",{text:"Cancelled",id:e.activityId})),document.querySelector(".update-create--activity").appendChild(t);new mdc.ripple.MDCRipple.attachTo(document.querySelector(".undo-deleted"))}}}function fe(e){document.querySelector(".delete-activity").style.display="none",document.querySelector(".status--cancel-cont li").appendChild(dn("cancel-loader")),qn("statusChange",{activityId:e,status:"CANCELLED"})}function he(){var e=document.createElement("aside");e.className="mdc-dialog",e.id="cancel-alert";var t=document.createElement("div");t.className="mdc-dialog__surface";var n=document.createElement("section");n.className="mdc-dialog__body",n.textContent="Are you sure you want to delete this activity ? ";var a=document.createElement("footer");a.className="mdc-dialog__footer";var o=document.createElement("button");o.type="button",o.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--accept delete-btn",o.textContent="Delete",o.id="delete-allow";var c=document.createElement("button");c.type="button",c.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--cancel cancel-delete-btn",c.textContent="Cancel",a.appendChild(c),a.appendChild(o),t.appendChild(n),t.appendChild(a),e.appendChild(t);var r=document.createElement("div");r.className="mdc-dialog__backdrop",e.appendChild(r),document.body.appendChild(e)}function ve(n){if(n.hasOwnProperty("create"))ye(n);else{var e=firebase.auth().currentUser.uid,a=indexedDB.open(e);a.onsuccess=function(e){var t=a.result.transaction("activity","readwrite").objectStore("activity");t.get(n.activityId).onsuccess=function(e){ye(e.target.result,t)}}}}function ge(e,t){var n=moment(e+" "+t);return moment(n).valueOf()}function ye(e,t){for(var n=document.querySelectorAll(".string"),a=0;a<n.length;a++){var o=n[a].querySelector(".mdc-text-field__input").value;if(n[a].querySelector(".mdc-text-field__input").required&&Ce(o))return void pn("Please provide an input for the field “Name” ");e.attachment[K(n[a].id)].value=o}var c=document.querySelectorAll(".number");for(a=0;a<c.length;a++){var r=Number(c[a].querySelector(".mdc-text-field__input").value);e.attachment[K(c[a].id)].value=r}var i=document.querySelectorAll(".email");for(a=0;a<i.length;a++){var d=i[a].querySelector(".mdc-text-field__input").value;e.attachment[K(i[a].id)].value=d}var s=document.querySelectorAll(".HHMM");for(a=0;a<s.length;a++){var l=s[a].querySelector(".mdc-text-field__input").value;e.attachment[K(s[a].id)].value=l}for(var u=document.querySelectorAll(".image-preview--attachment  img"),m=0;m<u.length;m++)e.attachment[G(u[m].dataset.photoKey)].value=u[m].dataset.value;var p=void 0,f=void 0,h=void 0,v=void 0;for(a=1;a<e.schedule.length+1;a++){if(p=Vn(".start--date"+a).value,f=Vn(".start--time"+a).value,h=Vn(".end--date"+a).value,v=Vn(".end--time"+a).value,!ge(p,f)&&!ge(h,v))return void pn("Please Select A Start Date and End Date");if(""===p)return void pn("Please Select a Start Date");if(""===h)return void pn("Please Select an End Date");if(ge(h,v)<ge(p,f))return void pn("The End Date and Time should be greater or equal to the start time");e.schedule[a-1].startTime=ge(p,f)||"",e.schedule[a-1].endTime=ge(h,v)||""}for(a=0;a<e.venue.length;a++)e.venue[a].geopoint={latitude:e.venue[a].geopoint._latitude||"",longitude:e.venue[a].geopoint._longitude||""},e.venue[a].hasOwnProperty("showIcon")&&delete e.venue[a].showIcon;be({venue:e.venue,schedule:e.schedule,attachment:e.attachment},e)}function be(e,t){if(!t.hasOwnProperty("create"))return e.activityId=t.activityId,document.querySelector("header").appendChild(mn()),document.querySelector("#send-activity").classList.add("hidden"),void qn("update",e);e.office=t.office,e.template=t.template,e.share=t.assignees,document.querySelector("header").appendChild(mn()),document.querySelector("#send-activity").classList.add("hidden"),qn("create",e)}function Ce(e){return!e.replace(/\s/g,"").length}function Ee(e,t,n){if(_e(t),"map"===t){var a=document.getElementById("search--bar-selector");return autocomplete=new google.maps.places.Autocomplete(a,{componentRestrictions:{country:"in"}}),void xe(autocomplete,n.record,n)}"users"===t&&Zt(e,n)}function _e(e){var t=document.getElementById("dialog--component"),n=t.querySelector("#dialog--surface-headeraction-data");n.className="search--cont",t.querySelector(".mdc-top-app-bar__section--align-end").classList.add("search-field-transform"),t.querySelector(".mdc-top-app-bar__section--align-start").style.backgroundColor="white",document.getElementById("search--bar--field")?document.getElementById("search--bar--field").style.display="block":n.appendChild(Se("",!0,!0)),document.getElementById("selector--search").style.display="none",document.querySelector(".selector-send").dataset.clicktype="",document.querySelector(".selector-send span").textContent="send",t.querySelector("#dialog--surface-headerview-type span").dataset.type="back-list","users"===e&&(t.querySelector("#dialog--surface-headerview-type span").dataset.state="user-list-back"),t.querySelector("#dialog--surface-headerview-type span").style.color="#0399f4"}function Ne(e){var t=document.getElementById("dialog--component"),n=t.querySelector("#dialog--surface-headeraction-data");t.querySelector("#dialog--surface-headerview-type span").dataset.type="",t.querySelector(".mdc-top-app-bar__section--align-end").classList.remove("search-field-transform"),n.querySelector("#search--bar--field").classList.remove("field-input"),n.classList.remove("search--cont"),document.getElementById("selector--search").style.display="block",document.querySelector(".selector-send").style.display="block",document.querySelector("#search--bar--field").style.display="none",t.querySelector(".mdc-top-app-bar__section--align-start").style.backgroundColor="#eeeeee",document.getElementById("data-list--container").style.display="block";var a=new mdc.dialog.MDCDialog(t);"users"===e.store&&(document.getElementById("data-list--container").innerHTML="",I(e,a)),"subscriptions"===e.store&&document.getElementById("data-list--container").querySelectorAll("li").forEach(function(e){e.style.display="flex"})}function xe(a,o,c){document.querySelector("#dialog--component .mdc-dialog__surface").style.width="100vw",document.querySelector("#dialog--component .mdc-dialog__surface").style.height="100vh",a.addListener("place_changed",function(){var e=a.getPlace();if(e.geometry){var t="";e.address_components&&(t=[e.address_components[0]&&e.address_components[0].short_name||"",e.address_components[1]&&e.address_components[1].short_name||"",e.address_components[2]&&e.address_components[2].short_name||""].join(" "));var n={primary:e.name,secondary:{address:t,geopoint:{_latitude:e.geometry.location.lat(),_longitude:e.geometry.location.lng()}}};F(o,{hash:"venue",key:c.key},n).then(x).catch(rn)}else pn("Please select a valid location")})}function Se(e,t,n,a,o){if(!t){var c=document.createElement("span");return c.className="data--value-list",c.textContent=e,c}var r=document.createElement("div");a&&a.length<15?r.className="mdc-text-field data--value-list":r.className="mdc-text-field data--value-list-small";var i=document.createElement("input");i.className="mdc-text-field__input input--value--update",i.style.paddingTop="0px",i.value=e,i.required=o;var d=document.createElement("div");if(d.className="mdc-line-ripple",n&&(r.id="search--bar--field",i.id="search--bar-selector",r.classList.add("field-input")),r.appendChild(i),r.appendChild(d),r)new mdc.textField.MDCTextField.attachTo(r);return r}function we(e,t){if(!t){var n=document.createElement("span");return n.className="data--value-list",n.textContent=e,n}var a=document.createElement("div");a.className="mdc-text-field data--value-list";var o=document.createElement("input");o.className="mdc-text-field__input input--type-number",o.type="number",o.style.paddingTop="0px",o.value=e,o.setAttribute("onkeypress","return event.charCode >= 48 && event.charCode <= 57");var c=document.createElement("div");return c.className="mdc-line-ripple",a.appendChild(o),a.appendChild(c),a}function Ie(e,t){if(!t){var n=document.createElement("span");return n.className="data--value-list",n.textContent=e,n}var a=document.createElement("div");a.className="mdc-text-field data--value-list";var o=document.createElement("input");o.className="mdc-text-field__input input--type-email",o.type="email",o.placeholder="johndoe@example.com",o.style.paddingTop="0px",o.value=e;var c=document.createElement("div");return c.className="mdc-line-ripple",a.appendChild(o),a.appendChild(c),a}function ke(e,t,n){if(!t){var a=document.createElement("span");return a.className="data--value-list","date"===n.type?a.textContent=moment(e).calendar():a.textContent=e,a}var o=document.createElement("div");o.className="mdc-text-field";var c=document.createElement("input");c.className="mdc-text-field__input input--type-time",c.type=n.type,c.style.borderBottom="none","date"===n.type?c.value=moment(e).format("YYYY-MM-DD"):c.value=e,"time"===n.type&&(o.classList.add("data--value-list"),c.style.width="100%",c.value=e||moment(new Date).format("HH:mm"));var r=document.createElement("div");return r.className="mdc-line-ripple",o.appendChild(c),o.appendChild(r),n.simple?(c.classList.remove("mdc-text-field__input"),c):o}function Le(e,t,n){if(!n){var a=document.createElement("span");return a.className="data--value-list",a.textContent=t,a}var o=document.createElement("div");o.className="mdc-select data--value-list",o.style.height="32%;",o.id=G(e),o.dataset.value=e,o.dataset.primary="";var c=document.createElement("select");c.className="mdc-select__native-control",c.style.paddingRight="0px";for(var r=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],i=0;i<r.length;i++){var d=document.createElement("option");d.value=r[i],d.textContent=r[i],t===r[i]&&d.setAttribute("selected","true"),c.appendChild(d)}var s=document.createElement("label");s.className="mdc-floating-label",s.textContent="";var l=document.createElement("div");return l.className="mdc-line-ripple",o.appendChild(s),o.appendChild(c),o.appendChild(l),o}function e(e){if(e&&"create"!==document.getElementById("app-current-panel").dataset.view){var t=indexedDB.open(firebase.auth().currentUser.uid);t.onsuccess=function(){t.result.transaction("activity").objectStore("activity").get(e).onsuccess=function(e){var t=e.target.result;if(t){document.querySelectorAll(".mdc-fab");t.editable&&(document.querySelector(".loader")&&(document.querySelector(".loader").remove(),document.querySelector(".add--assignee-loader .add--assignee-icon")&&(document.querySelector(".add--assignee-loader .add--assignee-icon").style.display="block")),document.querySelector(".progress--update")&&document.querySelector(".progress--update").remove())}else tt()}}}}var t={},De={setFCMToken:function(e){localStorage.setItem("token",e)},getFCMToken:function(){return localStorage.getItem("token")},setName:function(e){localStorage.setItem("deviceType",e)},getName:function(){return localStorage.getItem("deviceType")},setIosInfo:function(e){var t=e.split("&"),n={baseOs:t[0],deviceBrand:t[1],deviceModel:t[2],appVersion:Number(t[3]),osVersion:t[4],id:t[5],initConnection:t[6]};localStorage.setItem("iosUUID",JSON.stringify(n))},getIosInfo:function(){return localStorage.getItem("iosUUID")},getInfo:function(){if(!this.getName())return JSON.stringify({baseOs:"asd",deviceBrand:"",deviceModel:"",appVersion:6,osVersion:"",id:"123"});if("Android"===this.getName())try{return AndroidInterface.getDeviceId()}catch(e){return rn(e.message),JSON.stringify({baseOs:this.getName(),deviceBrand:"",deviceModel:"",appVersion:5,osVersion:"",id:""})}return this.getIosInfo()}},Be={today:function(e){return e?moment().format(e):moment()},tomorrow:function(){return moment(this.today()).add(1,"day")},isNewDay:function(e){var t=localStorage.getItem("today");return"null"===t||null==t?(localStorage.setItem("today",moment().format("YYYY-MM-DD")),!0):!moment(moment().format("YYYY-MM-DD")).isSame(moment(t))&&(localStorage.setItem("today",moment().format("YYYY-MM-DD")),!0)},isCurrentTimeNearStart:function(e){var t=e.attachment["Daily Start Time"].value,n=moment(t,"hh:mm").subtract(15,"minutes"),a=moment(t,"hh:mm").add(15,"minutes");return moment().isBetween(n,a,null,"[]")},isCurrentTimeNearEnd:function(e){var t=e.attachment["Daily End Time"].value,n=moment(t,"hh:mm").subtract(15,"minutes"),a=moment(t,"hh:mm").add(15,"minutes");return moment().isBetween(n,a,null,"[]")}};function qe(){history.back()}function Me(t){return{callbacks:{signInSuccessWithAuthResult:function(e){return t?Gt(e.user,t):ze(e.user),!1},signInFailure:function(e){return handleUIError(e)},uiShown:function(){}},signInFlow:"popup",signInOptions:[{provider:firebase.auth.PhoneAuthProvider.PROVIDER_ID,recaptchaParameters:{type:"image",size:"normal",badge:"bottomleft"},defaultCountry:"IN"}]}}function Te(){var e=document.createElement("div");e.id="login-container",document.body.appendChild(e),new firebaseui.auth.AuthUI(firebase.auth()||"").start("#login-container",Me())}function Ae(){var e=document.createElement("div");e.classList.add("mdc-layout-grid","mdc-typography","app"),e.id="main-layout-app";var t=document.createElement("div");t.className="mdc-layout-grid__inner cell-space";var n=document.createElement("div");n.id="header";var a=document.createElement("div");a.id="app-current-panel",a.className="mdc-layout-grid__cell--span-12";var o=document.createElement("div");o.id="snackbar-container";var c=document.createElement("div");c.id="alert--box",n.appendChild(je("app-main-header")),t.appendChild(n),t.appendChild(a),t.appendChild(o),e.appendChild(t),e.appendChild(c),document.body.innerHTML=e.outerHTML,He()}function Pe(){var e=document.createElement("aside");e.className="mdc-dialog mdc-dialog--open hidden",e.id="suggest-checkIn-dialog";var t=document.createElement("div");t.className="mdc-dialog__surface",t.style.width="90%",t.style.height="auto";var n=document.createElement("header");n.className="mdc-dialog__header";var a=document.createElement("h2");a.className="mdc-dialog__header__title",a.textContent="Reminder",n.appendChild(a);var o=document.createElement("section");o.className="mdc-dialog__body",o.textContent="Check-in ?";var c=document.createElement("footer");c.className="mdc-dialog__footer";var r=document.createElement("button");r.type="button",r.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--accept",r.textContent="Okay",r.style.backgroundColor="#3498db";var i=document.createElement("button");i.type="button",i.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--cancel",i.textContent="Cancel",i.style.backgroundColor="#3498db",c.appendChild(i),c.appendChild(r),t.appendChild(n),t.appendChild(o),t.appendChild(c),e.appendChild(t);var d=document.createElement("div");return d.className="mdc-dialog__backdrop",e.appendChild(d),e}function je(e){var t=document.createElement("header");t.className="mdc-top-app-bar mdc-top-app-bar--fixed mdc-elevation--z1",t.id=e;var n=document.createElement("div");n.className="mdc-top-app-bar__row";var a=document.createElement("section");a.className="mdc-top-app-bar__section mdc-top-app-bar__section--align-start";var o=document.createElement("div");o.id=e+"view-type",o.className="view-type",a.appendChild(o);var c=document.createElement("div");c.className="mdc-top-app-bar__section mdc-top-app-bar__section--align-end";var r=document.createElement("div");return r.id=e+"action-data",r.className="action-data",c.appendChild(r),n.appendChild(a),n.appendChild(c),t.appendChild(n),t}function He(){var e=document.createElement("aside");e.id="viewImage--dialog-component",e.className="mdc-dialog",e.role="alertdialog";var t=document.createElement("div");t.className="mdc-dialog__surface";var n=document.createElement("section");n.className="mdc-dialog__content";var a=document.createElement("img");a.src="",a.style.width="100%",n.appendChild(a),t.appendChild(n);var o=document.createElement("footer");o.className="mdc-dialog__footer";var c=document.createElement("button");c.type="button",c.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--cancel",c.textContent="cancel",c.style.backgroundColor="#3498db",o.appendChild(c),t.appendChild(o),e.appendChild(t);var r=document.createElement("div");r.className="mdc-dialog__backdrop",e.appendChild(r),document.body.appendChild(e)}function Oe(){firebase.auth().onAuthStateChanged(function(e){if(!e)return document.getElementById("main-layout-app").style.display="none",void Te();localStorage.getItem("dbexist")&&ze(e)})}function Ue(){return new Promise(function(o,c){var r=firebase.auth().currentUser,i=indexedDB.open(r.uid);i.onsuccess=function(){var e=i.result.transaction(["children"]),t=e.objectStore("children"),n=void 0,a=IDBKeyRange.bound(["employee","CONFIRMED"],["employee","PENDING"]);t.index("templateStatus").openCursor(a).onsuccess=function(e){var t=e.target.result;t&&(t.value.attachment["Employee Contact"].value===r.phoneNumber&&(n=t.value),t.continue())},e.oncomplete=function(){o(n)},e.onerror=function(){c({message:e.error.message+" from getEmployeeDetails"})}},i.onerror=function(){c({message:i.error.message+" from getEmployeeDetails"})}})}function Re(){return new Promise(function(c,r){Ue().then(function(a){if(!a)return c(!1);a.onLeave=!1;var o=indexedDB.open(firebase.auth().currentUser.uid);o.onsuccess=function(){var e=o.result.transaction(["calendar"]),t=e.objectStore("calendar"),n=IDBKeyRange.bound(["leave","CONFIRMED",a.office],["leave","PENDING",a.office]);t.index("onLeave").openCursor(n).onsuccess=function(e){var t=e.target.result;t&&(moment(moment().format("YYYY-MM-DD")).isBetween(t.value.start,t.value.end,null,"[]")?a.onLeave=!0:t.continue())},e.oncomplete=function(){c(a)},e.onerror=function(){r({message:e.error.message+" from isEmployeeOnLeave"})}},o.onerror=function(){r({message:o.error.message+" from isEmployeeOnLeave"})}}).catch(function(e){r(e)})})}function Ye(o){return new Promise(function(e,t){var n=indexedDB.open(o.uid,3),a={value:!1,version:""};n.onupgradeneeded=function(e){switch(e.oldVersion){case 1:a.value=!0,a.version=1;break;case 2:value=!1,a.version=2,n.transaction.objectStore("calendar").createIndex("onLeave",["template","status","office"]),n.transaction.objectStore("children").createIndex("templateStatus",["template","status"]),n.transaction.objectStore("map").createIndex("byOffice",["office","location"]);break;case 3:value=!1,a.version=3;break;default:a.value=!0,a.version=""}},n.onsuccess=function(){n.result.close(),e(a)},n.onerror=function(){t({message:n.error.message+" from idbVersionLessThan3"})}})}function Fe(){}function Je(o){return new Promise(function(e,t){var n={userMessage:"Please Restart The App",message:""},a=indexedDB.deleteDatabase(o.uid);a.onsuccess=function(){e(!0)},a.onblocked=function(){n.message="Couldnt delete DB because it is busy.App was openend when new code transition took place",t(n)},a.onerror=function(){n.message=a.error.message+" from removeIDBInstance",t(n)}})}function Ve(){firebase.auth().signOut().then(function(){window.location="https://www.growthfile.com"}).catch(function(e){window.location="https://www.growthfile.com",rn(e)})}function ze(t){document.getElementById("main-layout-app").style.display="block",Ye(t).then(function(e){if(localStorage.getItem("dbexist"))return from=1,e.value?void Ge(t,from):(qn("now",{device:De.getInfo(),from:"",registerToken:De.getFCMToken()}),void $e());Ge(t,0)}).catch(rn)}function Ge(e,t){Je(e).then(function(){localStorage.removeItem("dbexist"),history.pushState(null,null,null),document.getElementById("growthfile").appendChild(dn("init-loader")),setTimeout(function(){pn("Growthfile is Loading. Please Wait")},1e3),qn("now",{device:De.getInfo(),from:t,registerToken:De.getFCMToken()})}).catch(function(e){pn(e.userMessage),rn(e)})}function Ke(){window.addEventListener("locationChanged",function(t){Re().then(function(e){We(t.detail,e)}).catch(function(e){rn(e),We(t.detail)})},!0)}function We(e,t){var n={urgent:!1,nearby:!1};n.checkin=!!t&&!t.onLeave;var a=Be.isNewDay();if(e&&a)return n.nearby=!0,n.urgent=!0,void Xe(n);if(e)return n.nearby=!0,void Xe(n);if(a)return n.urgent=!0,localStorage.removeItem("dailyStartTimeCheckIn"),localStorage.removeItem("dailyEndTimeCheckIn"),void Xe(n);t&&(Be.isCurrentTimeNearStart(t)?null==localStorage.getItem("dailyStartTimeCheckIn")&&(localStorage.setItem("dailyStartTimeCheckIn",!0),t.onLeave||(n.checkin=!0),Xe(n)):Be.isCurrentTimeNearEnd(t)&&null==localStorage.getItem("dailyEndTimeCheckIn")&&(localStorage.setItem("dailyEndTimeCheckIn",!0),t.onLeave||(n.checkin=!0),Xe(n)))}function Xe(e){qt(e.checkin).then(function(){localStorage.removeItem("clickedActivity"),"listView"!==history.state[0]&&history.state||tt({urgent:e.urgent,nearby:e.nearby})}).catch(function(e){rn(e),tt({urgent:!1,nearby:!1})})}function $e(){tt({urgent:!1,nearby:!1}),Ke(),setInterval(function(){gn().then(function(e){_n(e).then(bn).catch(rn)}).catch(rn)},5e3)}window.addEventListener("load",function(){this.localStorage.getItem("error")||this.localStorage.setItem("error",JSON.stringify({}));var t="Your Device is Incompatible with Growthfile. Please Upgrade your Android Version";if(window.Worker||window.indexedDB)firebase.initializeApp({apiKey:"AIzaSyCoGolm0z6XOtI_EYvDmxaRJV_uIVekL_w",authDomain:"growthfilev2-0.firebaseapp.com",databaseURL:"https://growthfilev2-0.firebaseio.com",projectId:"growthfilev2-0",storageBucket:"growthfilev2-0.appspot.com",messagingSenderId:"1011478688238"}),moment.updateLocale("en",{calendar:{lastDay:"[yesterday]",sameDay:"LT",nextDay:"[Tomorrow at] LT",lastWeek:"dddd",nextWeek:"dddd [at] LT",sameElse:"L"},longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YY"},months:["January","February","March","April","May","June","July","August","September","October","November","December"]}),window.onpopstate=function(e){if(e.state){if("listView"===e.state[0]){document.getElementById("growthfile").appendChild(dn("init-loader"));var t=Ze.count;return Ze.size=t,Ze.count=0,void window[e.state[0]]()}window[e.state[0]](e.state[1],!1)}},Ae(),Oe();else{var e={title:"Device Incompatibility",message:t,cancelable:!1,button:{text:"",show:!1,clickAction:{redirection:{value:!1,text:""}}}};try{Android.notification(JSON.stringify(e))}catch(e){rn(e.message),ln(t)}}}),window.addEventListener("onMessage",function(e){qn("Null",!1)});var Qe=new Worker("notification.js"),Ze={count:0,size:20,skip:!1};function et(){document.querySelector(".init-loader")&&document.querySelector(".init-loader").remove(),document.querySelector(".mdc-linear-progress")&&document.querySelector(".mdc-linear-progress").remove(),wt(),It("Activities"),_t()}function tt(t,e){history.pushState(["listView"],null,null),et(),Et().then(function(e){e.suggestCheckIn&&(document.getElementById("alert--box").innerHTML=Pe().outerHTML,Cn()),window.addEventListener("scroll",at,!1),t?Lt("urgent",t.urgent).then(function(){Lt("nearBy",t.nearby).then(function(){ot(e.location)}).catch(rn)}).catch(rn):ot(e.location)})}function nt(n,r){var a=indexedDB.open(firebase.auth().currentUser.uid);a.onsuccess=function(){var e=a.result.transaction(["list","activity"]),o=e.objectStore("activity"),t=e.objectStore("list"),c=document.getElementById("activity--list");n.forEach(function(a){t.get(a.activityId).onsuccess=function(e){var t=e.target.result,n=document.querySelector('[data-id="'+a.activityId+'"]');n&&n.remove(),t&&rt(o,t,r).then(function(e){c.insertBefore(e,c.childNodes[0])})}})}}function at(e){Et().then(function(e){if(window.innerHeight+window.scrollY===document.body.scrollHeight){if(!document.getElementById("activity--list"))return;ot(e.location)}})}function ot(r){var i=indexedDB.open(firebase.auth().currentUser.uid);i.onsuccess=function(){var e=i.result.transaction(["list","activity","root"]),n=e.objectStore("activity"),t=e.objectStore("list").index("timestamp"),a=0,o=Ze.count,c=document.createDocumentFragment();t.openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;t&&(o?Ze.skip?(rt(n,t.value,r).then(function(e){console.log(e),c.appendChild(e),a++}),ct(t,a)):(Ze.skip=!0,t.advance(o)):(rt(n,t.value,r).then(function(e){c.appendChild(e),a++}),ct(t,a)))},e.oncomplete=function(){var e=document.getElementById("activity--list");e&&(console.log(c),e.appendChild(c),Ze.count=Ze.count+Ze.size,Ze.skip=!1,Ze.size=20,kt())}}}function ct(e,t){t<Ze.size&&e.continue()}function rt(t,s,l){return new Promise(function(i,e){var d=document.createElement("span");d.className="mdc-list-item__secondary-text",t.get(s.activityId).onsuccess=function(e){var t=e.target.result;if(t){var n=t.schedule,a=t.venue,o=t.status;if("PENDING"===o)d.appendChild(lt(n));else if(n.length){var c=document.createElement("div");c.textContent=dt(o),d.appendChild(c)}d.appendChild(vt(a,l));var r=it(d);i(yt(s,r))}}})}function it(e){var t=e.childNodes;return 1<t.length&&t[0].innerHTML&&t[1].innerHTML?e.style.marginTop="-42px":e.style.marginTop="-35px",e}function dt(e){return{CONFIRMED:"Done",CANCELLED:"Cancelled"}[e]}function st(e,t){var n=document.createElement("div");return n.textContent=e&&t?e+" : "+t:"",n}function lt(e){var t=void 0;switch(e.length){case 0:t=st("","");break;case 1:var n=ut(e[0]);t=st(n.name,n.value);break;default:var a=mt(e),o=ft(pt({time:moment().valueOf(),pivot:!0},a));t=st(o.name,o.time)}return t}function ut(e){var t=moment().format("DD-MM-YYYY"),n=moment(e.startTime).format("DD-MM-YYYY"),a={name:e.name,value:""};return n&&e.endTime&&(moment(n).isAfter(moment(t))?a.value=moment(n).calendar():a.value=moment(e.endTime).calendar()),a}function mt(e){var t=[];return e.forEach(function(e){t.push({time:e.startTime,name:e.name}),t.push({time:e.endTime,name:e.name})}),t}function pt(e,t){var n=t.slice();return n.push(e),n.sort(function(e,t){return e.time-t.time})}function ft(e){var t=e.slice(),n=ht(t);return n===e.length-1?(t[n-1].time=moment(t[n-1].time).calendar(),t[n-1]):(t[n+1].time=moment(t[n+1].time).calendar(),t[n+1])}function ht(e){return e.findIndex(function(e){if(e.pivot)return e})}function vt(e,o){var t="";switch(e.length){case 0:t=st("","");break;case 1:t=st(e[0].venueDescriptor,e[0].location);break;default:var c=[];if(e.forEach(function(e){var t=e.geopoint._latitude,n=e.geopoint._longitude;if(t&&n){var a={latitude:t,longitude:n};c.push({distance:xn(a,o),desc:e.venueDescriptor,location:e.location})}}),c.length){var n=gt(c);t=st(n[0].desc,n[0].location)}else t=st("","")}return t}function gt(e){return e.slice().sort(function(e,t){return e.distance-t.distance})}function yt(e,t){var n=document.createElement("li");n.dataset.id=e.activityId,n.onclick=function(){localStorage.setItem("clickedActivity",this.dataset.id),u(this.dataset.id,!0)},n.classList.add("mdc-list-item","activity--list-item","mdc-elevation--z1");var a=document.createElement("object");a.data=e.creator.photo||"./img/empty-user.jpg",a.type="image/jpeg",a.className="mdc-list-item__graphic material-icons";var o=document.createElement("img");o.src="./img/empty-user.jpg",o.className="empty-user-list",a.appendChild(o);var c=document.createElement("span");c.classList.add("mdc-list-item__text");var r=document.createElement("span");r.className="mdc-list-item__primary-text bigBlackBold",r.textContent=e.activityName,c.appendChild(r),c.appendChild(t);var i=document.createElement("span");i.classList.add("mdc-list-item__meta"),i.appendChild(bt(e,n));var d=document.createElement("span");d.classList.add("mdc-list-item__secondary-text","status-in-activity",""+e.status),document.createElement("i").className="material-icons";var s=document.createElement("i");s.classList.add("status-cancel","material-icons"),s.appendChild(document.createTextNode("clear"));var l=document.createElement("i");return l.classList.add("status-confirmed","material-icons"),l.appendChild(document.createTextNode("check")),"CONFIRMED"===e.status&&d.appendChild(l),"CANCELLED"===e.status&&d.appendChild(s),i.appendChild(d),n.appendChild(a),n.appendChild(c),n.appendChild(i),n}function bt(e,t){var n=document.createElement("i");if(n.className="material-icons notification",e.urgent)return n.textContent="alarm",n;if(e.nearby)return n.textContent="location_on",n;if(e.count){var a=document.createElement("div"),o=document.createElement("span");return o.textContent=e.count,o.className="count mdc-meta__custom-text",a.appendChild(o),t.classList.add("count-active"),a}var c=document.createElement("div");return c.className="mdc-meta__custom-text",c.style.width="76px",c.style.fontSize="16px",c.textContent=moment(e.timestamp).calendar(),c}function Ct(e){var t=document.getElementById("activity--list");t&&t.appendChild(e)}function Et(){return new Promise(function(t,n){var a=void 0,o=localStorage.getItem("dbexist"),c=indexedDB.open(o);c.onsuccess=function(){var e=c.result.transaction(["root"],"readwrite");e.objectStore("root").get(o).onsuccess=function(e){var t=e.target.result;a=t||null},e.oncomplete=function(){a?t(a):n({message:"No root record found from getRootRecord"})},e.onerror=function(){n({message:e.error.message+" from getRootRecord"})}},c.onerror=function(){n({message:c.error+" from getRootRecord"})}})}function _t(){document.getElementById("create-activity")||Nt().then(function(e){Object.keys(e).length&&xt()}).catch(rn)}function Nt(){return new Promise(function(t,n){var a=0,o={},c=indexedDB.open(firebase.auth().currentUser.uid);c.onsuccess=function(){var e=c.result.transaction(["subscriptions"],"readonly");e.objectStore("subscriptions").index("office").openCursor(null,"nextunique").onsuccess=function(e){var t=e.target.result;t&&(a++,o[t.value.office]=a,t.continue())},e.oncomplete=function(){t(o)},e.onerror=function(){n({message:e.error.message+" from getCountOfTemplates"})}},c.onerror=function(){n({message:c.error.message+" from getCountOfTemplates"})}})}function xt(){var e=document.getElementById("create-activity--parent"),t=document.createElement("button");t.className="mdc-fab create-activity",t.id="create-activity",t.setAttribute("aria-label","Add");var n=document.createElement("span");n.className="mdc-fab_icon material-icons",n.id="activity-create--icon",n.textContent="add",t.appendChild(n),e.innerHTML=t.outerHTML,document.querySelector(".create-activity").addEventListener("click",function(e){St(e)})}function St(e,t){N(e,{record:"",store:"subscriptions",suggestCheckIn:t})}function wt(){if(!document.getElementById("activity-list-main")){var e=document.createElement("div");e.className="mdc-card panel-card mdc-top-app-bar--fixed-adjust",e.id="activity-list-main";var t=document.createElement("ul");t.className="mdc-list mdc-list--two-line mdc-list--avatar-list",t.id="activity--list",e.appendChild(t);var n=document.createElement("div");n.id="create-activity--parent",e.appendChild(n),document.getElementById("app-current-panel").innerHTML=e.outerHTML}}function It(r){var e=indexedDB.open(firebase.auth().currentUser.uid);e.onsuccess=function(){_(e.result,firebase.auth().currentUser.phoneNumber).then(function(e){var t=document.createElement("div");t.className="profile--icon-header";var n=document.createElement("div");n.id="menu--panel";var a=document.createElement("object");a.className="list-photo-header",a.type="image/jpeg",a.data=e||"./img/empty-user.jpg";var o=document.createElement("img");o.src="./img/empty-user.jpg",o.className="list-photo-header",a.appendChild(o),n.appendChild(a);var c=document.createElement("p");c.textContent=r,n.appendChild(c),t.appendChild(n),Dt({id:"app-main-header",left:t.outerHTML,right:""}),document.querySelector(".list-photo-header").addEventListener("click",function(){Tt(!0)})})}}function kt(){var e=localStorage.getItem("clickedActivity");if(document.querySelector('[data-id="'+e+'"]'))return document.querySelector('[data-id="'+e+'"]').scrollIntoView({behavior:"instant",block:"center",inline:"center"}),void localStorage.removeItem("clickedActivity")}function Lt(e,a){return new Promise(function(t,n){Qe.postMessage({dbName:firebase.auth().currentUser.uid,type:e,updateTimestamp:a}),Qe.onmessage=function(e){t(e.data)},Qe.onerror=function(e){n({message:e.message+" from notificationWorker at "+e.lineno})}})}function Dt(e){e.left&&(document.getElementById(e.id+"view-type").innerHTML=e.left);e.right&&(document.getElementById(e.id+"action-data").innerHTML=e.right)}function Bt(e,t,n){var a=document.createElement("div");a.className="mdc-text-field mdc-text-field--dense "+n+" attachment--text-field",a.dataset.key=e,a.dataset.type=t,a.id=e.replace(/\s/g,"");var o=document.createElement("input");o.className="mdc-text-field__input",t&&"displayName"===e&&(o.placeholder="Your Name"),t&&"email"===e&&(o.placeholder="Your Email");var c=document.createElement("div");return c.className="mdc-line-ripple",a.appendChild(o),a.appendChild(c),a}function qt(r){return new Promise(function(o,c){Et().then(function(n){var a=indexedDB.open(firebase.auth().currentUser.uid);a.onsuccess=function(){var e=a.result.transaction(["root"],"readwrite"),t=e.objectStore("root");n.suggestCheckIn!==r&&(n.suggestCheckIn=r,t.put(n)),e.oncomplete=function(){o(!0)},e.onerror=function(){c({message:e.error.message+" from suggestCheckIn"})}},a.onerror=function(){c({message:a.error+" from suggestCheckIn"})}}).catch(function(e){c(e)})})}var Mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};a="function"==typeof Symbol&&"symbol"===Mt(Symbol.iterator)?function(e){return void 0===e?"undefined":Mt(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":Mt(e)};function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Tt(e){e&&history.pushState(["profileView"],null,null),window.addEventListener&&window.removeEventListener("scroll",at,!1),document.body.style.backgroundColor="#eeeeee";var c=firebase.auth().currentUser,t=c.uid,r=indexedDB.open(t);r.onsuccess=function(){var n=r.result,a=n.transaction(["root"],"readwrite"),o=a.objectStore("root");o.get(t).onsuccess=function(e){var t=e.target.result;t.view="profile",o.put(t),a.oncomplete=function(){Pt(),jt(n).then(function(e){document.getElementById("app-current-panel")&&(document.getElementById("app-current-panel").innerHTML=e.outerHTML,Qt(),document.getElementById("close-profile--panel").addEventListener("click",function(){qe()}),"Android"===De.getName()?document.getElementById("uploadProfileImage").addEventListener("click",function(){AndroidInterface.openImagePicker()}):At("uploadProfileImage").addEventListener("change",function(){Yt()}),Vt(c),zt(c))})}}},kn("profile")}function At(e){return document.getElementById(e)}function Pt(){var e=document.createElement("span");e.id="close-profile--panel";var t=document.createElement("i");t.className="material-icons",t.textContent="arrow_back",e.appendChild(t),Dt({id:"app-main-header",left:e.outerHTML})}function jt(e){return new Promise(function(g){_(e,firebase.auth().currentUser.phoneNumber).then(function(e){var t=document.createElement("div");t.id="profile-view--container",t.className="mdc-top-app-bar--fixed-adjust mdc-theme--background";var n=document.createElement("button");n.className="mdc-fab","Android"===De.getName()&&(n.id="uploadProfileImage");var a=document.createElement("label");a.setAttribute("for","uploadProfileImage");var o=document.createElement("span");o.className="mdc-fab__icon material-icons",o.textContent="add_a_photo",a.appendChild(o),n.appendChild(a);var c=void 0;"Android"!==De.getName()&&((c=document.createElement("input")).type="file",c.style.display="none",c.id="uploadProfileImage",c.accept="image/jpeg;");var r=document.createElement("div");r.id="profile--image-container",r.className="profile-container--main";var i=document.createElement("object");i.type="image/jpeg",i.data=e||"./img/empty-user-big.jpg",i.id="user-profile--image";var d=document.createElement("img");d.src="./img/empty-user-big.jpg",d.className="empty-user-profile",i.appendChild(d);var s=document.createElement("div");s.className="insert-overlay",r.appendChild(i),r.appendChild(s),r.appendChild(n),"Android"!==De.getName()&&a.appendChild(c);var l=document.createElement("div");l.id="name--change-container",l.className="profile-psuedo-card";var u=document.createElement("button");u.className="mdc-icon-button material-icons",u.id="edit--name",u.setAttribute("aria-hidden","true"),u.setAttribute("aria-pressed","false"),u.setAttribute("data-toggle-on-content","check"),u.setAttribute("data-toggle-on-label","check"),u.setAttribute("data-toggle-off-content","edit"),u.setAttribute("data-toggle-off-label","displayName"),u.textContent="edit",l.appendChild(Bt("displayName","Name")),l.appendChild(u);var m=document.createElement("div");m.id="email--change-container",m.className="profile-psuedo-card";var p=document.createElement("button");p.className="mdc-icon-button material-icons",p.id="edit--email",p.setAttribute("aria-hidden","true"),p.setAttribute("aria-pressed","false"),p.setAttribute("data-toggle-on-content","check"),p.setAttribute("data-toggle-on-label","check"),p.setAttribute("data-toggle-off-content","edit"),p.setAttribute("data-toggle-off-label","updateEmail"),p.textContent="email",m.appendChild(Bt("email","Email")),m.appendChild(p);var f=document.createElement("div");f.id="ui-auth",f.className="";var h=document.createElement("div");h.id="change--number-container";var v=document.createElement("div");v.id="phone-number--change-container",v.className="mdc-layout-grid__inner",h.appendChild(v),t.appendChild(r),t.appendChild(l),t.appendChild(m),t.appendChild(f),t.appendChild(h),g(t)})})}function Ht(e,t){var n=document.getElementById(e);new mdc.iconButton.MDCIconButtonToggle(n).root_.addEventListener("MDCIconButtonToggle:change",function(e){e.detail.isOn?(console.log(t),t.input_.style.borderBottom="1px solid rgba(0,0,0,.42)",t.input_.disabled=!1,t.lineRipple_.activate(),"Android"===localStorage.getItem("deviceType")&&AndroidInterface.startKeyboard(),t.input_.focus()):(t.input_.disabled=!0,t.input_.style.borderBottom="none",Ot(this.dataset.toggleOffLabel,t.value),t.lineRipple_.deactivate())})}function Ot(e,t){var n=firebase.auth().currentUser;if(console.log(void 0===t?"undefined":a(t)),"displayName"===e&&n.updateProfile(c({},e,t)).then(function(){sn()}).catch(Jt),"updateEmail"===e){if(t===firebase.auth().currentUser.email)return void pn("This email address already exists");Ut(firebase.auth().currentUser.metadata.lastSignInTime)<=5?(console.log("less than 5"),Gt(firebase.auth().currentUser,t)):Rt(t)}}function Ut(e){var t=moment().format("YYY-MM-DD HH:mm"),n=moment(e).format("YYY-MM-DD HH:mm");return moment(t).diff(moment(n),"minutes")}function Rt(e){var t=document.createElement("div");t.id="refresh-login",t.className="mdc-elevation--z3",document.getElementById("ui-auth").innerHTML=t.outerHTML,new firebaseui.auth.AuthUI(firebase.auth()).start("#refresh-login",Me(e)),setTimeout(function(){document.querySelector(".firebaseui-id-phone-number").value=firebase.auth().currentUser.phoneNumber,document.querySelector(".firebaseui-id-phone-number").disabled=!0,document.querySelector(".firebaseui-label").remove()},300)}function Yt(e){if("Android"!==De.getName()){var t=At("uploadProfileImage").files[0],n=new FileReader;n.addEventListener("load",function(){Ft(n.result)},!1),t&&n.readAsDataURL(t)}else Ft(e)}function Ft(e){var t=document.getElementById("user-profile--image"),n=document.getElementById("profile--image-container"),a="data:image/jpeg;base64,";t&&(t.data=a+e),n&&document.getElementById("profile--image-container").appendChild(dn("profile--loader")),qn("backblaze",{imageBase64:a+e})}function Jt(e){pn(e.message)}function Vt(e){var t=Vn("#displayName");e.displayName&&(t.value=e.displayName),Ht("edit--name",t)}function zt(e){var t=Vn("#email");e.email&&(t.value=e.email),Ht("edit--email",t)}function Gt(e,t){console.log(t),e.updateEmail(t).then(Kt).catch(Jt)}function Kt(){var e=firebase.auth().currentUser;console.log(e),e.sendEmailVerification().then(Wt).catch(Xt)}function Wt(){sn(),pn("Verification link has been send to your email address")}function Xt(e){pn(e.message)}function $t(e){console.log(e)}function Qt(){Vn("#displayName").input_.disabled=!0,Vn("#email").input_.disabled=!0}function Zt(n,a){var e=document.getElementById("search--bar-selector"),o=e.value="",c=document.createDocumentFragment(),r={};a.record.assignees.forEach(function(e){r[e]=""}),e.addEventListener("input",function(e){var t=e.target.value;if(en(t))return o=n.transaction("users").objectStore("users"),void on(tn(t),o,c,r,a);c=document.createDocumentFragment(),o=n.transaction("users").objectStore("users").index("displayName"),on(nn(t),o,c,r,a)})}function en(e){return!isNaN(e)}function tn(e){var t=e;return"91"===t.substring(0,2)?t="+"+t:"+91"!==t.substring(0,3)&&(t="+91"+t),t}function nn(e){var t=e.split(" "),n=t.length,a=[],o=0;for(o=0;o<n;o++){var c=t[o];if(c.charAt(0).toUpperCase()===e.charAt(0).toUpperCase)return e;a.push(c.charAt(0).toUpperCase()+c.slice(1))}return a.join(" ")}function an(e){return/^\+[1-9]\d{11,14}$/.test(e)}function on(e,t,o,c,r){console.log(e);var n=IDBKeyRange.bound(e,e+"￿"),i=document.getElementById("data-list--container");t.openCursor(n).onsuccess=function(e){var t=e.target.result;if(!t){if(i.innerHTML="",0!=o.children.length)return i.appendChild(o),void document.querySelectorAll('[data-selected="true"]').forEach(function(e){new mdc.checkbox.MDCCheckbox.attachTo(e).checked=!0,e.children[1].style.animation="none",e.children[1].children[0].children[0].style.animation="none"});var n=document.createElement("div");n.className="data-not-found";var a=document.createElement("p");return a.textContent="No Contact Found",a.className="mdc-typography--headline5",n.appendChild(a),void(document.querySelector(".data-not-found")||i.appendChild(n))}r.attachment.present?o.appendChild(ce(t.value,!0,!1)):c.hasOwnProperty(t.value.mobile)||o.appendChild(ce(t.value,!0,!0)),t.continue()}}var cn=new Worker("apiHandler.js");function rn(e){var t=JSON.parse(localStorage.getItem("error"));if(!t.hasOwnProperty(e.message))return t[e.message]=!0,localStorage.setItem("error",JSON.stringify(t)),e.device=De.getInfo(),e.stack&&(e.stack=e.stack),void qn("instant",JSON.stringify(e))}function dn(e){var t=document.createElement("div");return t.className="loader "+e,t}function sn(){var e=document.createElement("aside");e.className="mdc-dialog mdc-dialog--open success--dialog",e.id="success--dialog";var t=document.createElement("div");t.className="mdc-dialog__surface round--surface";var n=document.createElement("section");n.className="mdc-dialog__body";var a=document.createElement("div");a.className="success--container";var o=document.createElement("div");o.className="success--check",a.appendChild(o),n.appendChild(a),t.appendChild(n),e.appendChild(t),document.body.appendChild(e),new mdc.dialog.MDCDialog(document.querySelector("#success--dialog")).show(),setTimeout(function(){document.getElementById("success--dialog").remove(),document.body.classList.remove("mdc-dialog-scroll-lock")},1200),Ze.count=0,Ze.size=20,localStorage.removeItem("clickedActivity"),tt({urgent:!1,nearBy:!1})}function ln(e,t){if(!document.getElementById("enable-gps")){var n=document.createElement("aside");n.className="mdc-dialog mdc-dialog--open",n.id="enable-gps";var a=document.createElement("div");a.className="mdc-dialog__surface",a.style.width="90%",a.style.height="auto";var o=document.createElement("section");o.className="mdc-dialog__body mock-main-body",o.textContent=e;var c=document.createElement("footer");c.className="mdc-dialog__footer mock-footer";var r=document.createElement("button");r.type="button",r.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--accept",r.textContent="Ok",t||r.classList.add("hidden"),r.style.backgroundColor="#3498db",c.appendChild(r),a.appendChild(o),a.appendChild(c),n.appendChild(a),document.body.appendChild(n)}var i=new mdc.dialog.MDCDialog(document.querySelector("#enable-gps"));i.listen("MDCDialog:accept",function(){tt({nearby:!1,urgent:!1})}),i.show()}function un(e,t){if(!document.getElementById("app-update-dialog")){var n=document.createElement("aside");n.className="mdc-dialog mdc-dialog--open",n.id="app-update-dialog";var a=document.createElement("div");a.className="mdc-dialog__surface",a.style.width="90%",a.style.height="auto";var o=document.createElement("header");o.className="mdc-dialog__header";var c=document.createElement("h2");c.className="mdc-dialog__header__title",c.textContent=t,o.appendChild(c);var r=document.createElement("section");r.className="mdc-dialog__body",r.textContent=e;var i=document.createElement("footer");i.className="mdc-dialog__footer",a.appendChild(o),a.appendChild(r),a.appendChild(i),n.appendChild(a),document.body.appendChild(n)}new mdc.dialog.MDCDialog(document.querySelector("#app-update-dialog")).show()}function mn(){var e=document.createElement("div");e.className="mdc-linear-progress mdc-linear-progress--indeterminate progress--update",e.role="progressbar";var t=document.createElement("div");t.className="mdc-linear-progress__buffering-dots";var n=document.createElement("div");n.className="mdc-linear-progress__buffer";var a=document.createElement("div");a.className="mdc-linear-progress__bar mdc-linear-progress__primary-bar";var o=document.createElement("span");o.className="mdc-linear-progress__bar-inner",a.appendChild(o);var c=document.createElement("div");c.className="mdc-linear-progress__bar mdc-linear-progress__secondary-bar";var r=document.createElement("span");return r.className="mdc-linear-progress__bar-inner",c.appendChild(r),e.appendChild(t),e.appendChild(n),e.appendChild(a),e.appendChild(c),e}function pn(e,t){var n=document.createElement("div");n.className="mdc-snackbar",n.setAttribute("aria-live","assertive"),n.setAttribute("aria-atomic","true"),n.setAttribute("aria-hidden","true");var a=document.createElement("div");a.className="mdc-snackbar__text mdc-typography--subtitle2";var o=document.createElement("div");o.className="mdc-snackbar__action-wrapper";var c=document.createElement("button");c.className="mdc-snackbar__action-button",o.appendChild(c),n.appendChild(a),n.appendChild(o),document.getElementById("snackbar-container").innerHTML=n.outerHTML;var r={message:e,actionText:t?t.btn:"OK",timeout:1e4,actionHandler:function(){}};mdc.snackbar.MDCSnackbar.attachTo(document.querySelector(".mdc-snackbar")).show(r)}function fn(e){return Date.now()+e}function hn(o){return new Promise(function(t,n){var a=new XMLHttpRequest;a.open(o.method,o.url,!0),a.setRequestHeader("Content-Type","application/json"),a.onreadystatechange=function(){if(4===a.readyState){if(400<=a.status)return"notFound"===JSON.parse(a.response).error.errors[0].reason?1===o.retry?n({message:JSON.parse(a.response).error.errors[0].message,body:{cellular:o.body,tries:"Retried 3 times"}}):(o.retry--,void hn(o).then().catch(function(e){n(e)})):n({message:JSON.parse(a.response).error.errors[0].message,body:o.body});if(!a.responseText)return n({message:"No response text from google",body:o.body});var e=JSON.parse(a.responseText);if(!e)return n({message:"Response text is not parseable",body:o.body});t({latitude:e.location.lat,longitude:e.location.lng,accuracy:e.accuracy,provider:{cellular:JSON.parse(o.body)}})}},a.send(o.body)})}function vn(){return new Promise(function(t,n){var e="";try{e=AndroidInterface.getCellularData()}catch(e){n({message:e.message+" from getCellularData"})}if(e){hn({method:"POST",url:"https://www.googleapis.com/geolocation/v1/geolocate?key=AIzaSyCoGolm0z6XOtI_EYvDmxaRJV_uIVekL_w",body:e,retry:3}).then(function(e){t(e)}).catch(function(e){n(e)})}else n({message:"empty cell tower from android."})})}function gn(){return new Promise(function(t,n){"Android"!==De.getName()?yn().then(function(e){t(e)}).catch(function(e){n(e)}):vn().then(function(e){t(e)}).catch(function(e){return rn(e),yn()}).then(function(e){t(e)}).catch(function(e){n({error:e,meta:"Both geolocation and html5 failed to get location"})})})}function yn(){return new Promise(function(n,t){var a=[],o=0,c=0,r=setInterval(function(){navigator.geolocation.getCurrentPosition(function(e){if(1!==++o){if(a.push({latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy,provider:"HTML5"}),a[0].latitude.toFixed(3)===e.coords.latitude.toFixed(3)&&a[0].longitude.toFixed(3)===e.coords.longitude.toFixed(3)&&3==++c)return clearInterval(r),r=null,n(a[0]);if(5<=o){clearInterval(r),r=null;var t=In(a);return n(t)}}},function(e){clearInterval(r),r=null,t({message:e.message+" from html5Geolocation"})})},500)})}function bn(e){if(console.log(e),e.prev.latitude&&e.prev.longitude&&e.new.latitude&&e.new.longitude){var t=new CustomEvent("location",{detail:e.new});window.dispatchEvent(t);var n=xn(e.prev,e.new),a=new CustomEvent("locationChanged",{detail:Sn(n)});window.dispatchEvent(a)}}function Cn(){var e=document.querySelector("#suggest-checkIn-dialog");if(e){var t=new mdc.dialog.MDCDialog(e);t&&(document.getElementById("dialog--component")||(t.root_.classList.remove("hidden"),t.show(),t.listen("MDCDialog:accept",function(t){Et().then(function(e){qt(!1).then(function(){Bn()&&(1===e.offices.length?U(e.offices[0],"check-in",{suggestCheckIn:!0}):St(t,!0))})}).catch(console.log)}),t.listen("MDCDialog:cancel",function(e){qt(!1).then(console.log).catch(console.log)})))}}function En(e){var t=document.querySelector(e);return!!t&&t.classList.contains("mdc-dialog--open")}function _n(i){return new Promise(function(t,a){var o={latitude:"",longitude:"",accuracy:"",provider:"",lastLocationTime:""},c=firebase.auth().currentUser.uid,r=indexedDB.open(c,3);r.onsuccess=function(){var e=r.result.transaction(["root"],"readwrite"),n=e.objectStore("root");n.get(c).onsuccess=function(e){var t=e.target.result;t.location&&(o=t.location),t.location=i,t.location.lastLocationTime=Date.now(),n.put(t)},e.oncomplete=function(){t({prev:o,new:i})},e.onerror=function(){a({message:e.error.message+" from updateLocationInRoot",body:e.error.name})}},r.onerror=function(){a({message:r.error.message+" from updateLocationInRoot",body:r.error.name})}})}function Nn(e){return e*Math.PI/180}function xn(e,t){var n=Nn(t.latitude-e.latitude),a=Nn(t.longitude-e.longitude),o=Nn(t.latitude),c=Nn(e.latitude),r=Math.sin(n/2)*Math.sin(n/2)+Math.sin(a/2)*Math.sin(a/2)*Math.cos(o)*Math.cos(c);return 6371*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))}function Sn(e){return 1<=e}function wn(e){return e<=1}function In(e){return e.sort(function(e,t){return e.accuracy-t.accuracy})[0]}function kn(e){if("Android"===De.getName())try{AndroidInterface.startConversation(e)}catch(e){rn({message:e.message+" from startConversation"})}}var Ln={checkGps:function(){try{return AndroidInterface.isGpsEnabled()}catch(e){return rn({message:e.message+" from isGpsEnabled"}),!0}},checkLocationPermission:function(){try{return AndroidInterface.isLocationPermissionGranted()}catch(e){return rn({message:e.message+" from isLocationPermissionGranted"}),!0}}};function Dn(e,t){try{AndroidInterface.showDialog(e,t)}catch(e){rn({message:e.message+" from showDialog"}),ln(t,!0)}}function Bn(){if("Android"!==De.getName())return!0;if(Ln.checkGps())if(Ln.checkLocationPermission()){if(AndroidInterface.isConnectionActive())return!0;Dn("No Connectivity","Please Check your Internet Connectivity")}else Dn("Location Permission","Please Allow Growthfile location access.");else Dn("GPS Unavailable","Please Turn on Gps.")}function qn(e,a){var o=firebase.auth().currentUser,c={type:e,body:"",user:{token:"",uid:o.uid,displayName:o.displayName,photoURL:o.photoURL,phoneNumber:o.phoneNumber}};"instant"===e||"now"===e||"Null"===e||"backblaze"===e?o.getIdToken(!1).then(function(e){c.body=a,c.user.token=e,cn.postMessage(c)}).catch(function(e){rn({message:e.code})}):Et().then(function(e){var n=e.location,t=An(n.lastLocationTime,5);a.timestamp=fn(e.serverTime),t?Mn(a,c):o.getIdToken(!1).then(function(e){var t={latitude:n.latitude,longitude:n.longitude,accuracy:n.accuracy,provider:n.provider};a.geopoint=t,c.body=a,c.user.token=e,Tn(n,c)}).catch(function(e){rn({message:e.code})})}),cn.onmessage=jn,cn.onerror=Jn}function Mn(o,c){window.addEventListener("location",function e(a){firebase.auth().currentUser.getIdToken(!1).then(function(e){var t=a.detail,n={latitude:t.latitude,longitude:t.longitude,accuracy:t.accuracy,provider:t.provider};o.geopoint=n,c.body=o,c.user.token=e,Tn(n,c)}).catch(function(e){rn({message:e.code})}),window.removeEventListener("location",e,!0)},!0)}function Tn(e,t){e.latitude&&e.longitude&&e.accuracy?cn.postMessage(t):(ln("Fetching Location Please wait.",!0),Et().then(function(e){var t=void 0;try{t=AndroidInterface.getCellularData()}catch(e){t=e.message}rn({message:"No location found in indexedDB",body:{deviceInfo:De.getInfo(),storedLocation:e.location,cellTower:t}})}))}function An(e,t){var n=moment(moment().valueOf()),a=e;return t<moment.duration(n.diff(a)).asSeconds()}var Pn={"update-app":Hn,"revoke-session":On,notification:sn,"android-stop-refreshing":Fn,loadView:Yn,apiFail:Un,backblazeRequest:Rn};function jn(e){Pn[e.data.type](e.data)}function Hn(t){if("Android"!==De.getName())webkit.messageHandlers.updateApp.postMessage();else try{AndroidInterface.updateApp(t.msg)}catch(e){un("Please Install the Latest version from google play store , to Use Growthfile. After Updating the App, close Growthfile and open again ",JSON.parse(t.msg).message)}}function On(){firebase.auth().signOut().then(function(){}).catch(function(e){rn({message:"Sign out error",body:e})})}function Un(e){document.getElementById("send-activity")&&(document.getElementById("send-activity").style.display="block"),document.querySelector("header .mdc-linear-progress")&&document.querySelector("header .mdc-linear-progress").remove(),document.querySelector(".loader")&&document.querySelector(".loader").remove(),document.querySelector(".delete-activity")&&(document.querySelector(".delete-activity").style.display="block"),document.querySelector(".undo-delete-loader")&&(document.querySelector(".undo-delete-loader").style.display="block"),document.querySelector(".form-field-status")&&document.querySelector(".form-field-status").classList.contains("hidden")&&document.querySelector(".form-field-status").classList.remove("hidden"),rn({message:e.msg.message,body:e.msg}),pn(e.msg.message)}function Rn(e){if(200===e.code&&"profileView"===history.state[0]){var t=document.querySelector("#profile--image-container .profile--loader ");return t&&t.remove(),void(document.getElementById("user-profile--image").src=firebase.auth().currentUser.photoURL)}}function Yn(t){if(localStorage.setItem("dbexist",firebase.auth().currentUser.uid),Fn(),!history.state)return localStorage.setItem("today",null),void $e();if("updateCreateActivity"!==history.state[0]){if("profileView"!==history.state[0])if("listView"!==history.state[0])window[history.state[0]](history.state[1],!1);else{if(!t.msg.length)return;Et().then(function(e){nt(t.msg,e.location)})}}else e(history.state[1].activityId)}function Fn(){if("Android"===De.getName())try{AndroidInterface.stopRefreshing(!0)}catch(e){rn({message:e.message+" from androidStopRefreshing"})}}function Jn(e){var t={"line-number":e.lineno,file:e.filename};rn({message:e.message+" from apiHandler.js at "+e.lineno,body:t})}function Vn(e){return mdc.textField.MDCTextField.attachTo(document.querySelector(e))}function zn(e){localStorage.getItem("dbexist")&&qn("Null",e)}function Gn(e){for(;e.firstChild;)e.removeChild(e.firstChild)}