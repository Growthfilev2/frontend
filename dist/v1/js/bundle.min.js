function getCellularInformation(){var e=void 0,t=AndroidInterface.getMobileCountryCode(),n=AndroidInterface.getMobileNetworkCode(),a=AndroidInterface.getRadioType(),o=AndroidInterface.getCarrier(),i=AndroidInterface.getWifiAccessPoints();try{e=AndroidInterface.getCellTowerInformation()}catch(e){console.log(e)}var r=[],c=[];i&&(r=parseQuery(i)),e&&(c=removeFalseCellIds(parseQuery(e)));var l={};return t&&(l.homeMobileCountryCode=Number(t)),n&&(l.homeMobileNetworkCode=Number(n)),o&&(l.carrier=o),a&&(l.radioType=a),r.length&&(l.wifiAccessPoints=r),c.length&&(l.cellTowers=c),r.length&&c.length?l.considerIp=!1:l.considerIp=!0,l}function removeFalseCellIds(e){var t=2147483647;return e.filter(function(e){return 0<e.cellId&&e.cellId<t&&0<e.locationAreaCode&&e.locationAreaCode<t})}function parseQuery(e){var n=[];return e.split(",").forEach(function(e){var t=new URLSearchParams(e);n.push(queryPatramsToObject(t))}),n}function queryPatramsToObject(e){var n={};return e.forEach(function(e,t){n[t]="macAddress"===t?e:Number(e)}),n}function createElement(e,t){var n=document.createElement(e);return t&&Object.keys(t).forEach(function(e){n[e]=t[e]}),n}function createHeader(e,t,n){var a=createElement("header",{className:"mdc-top-app-bar",id:n}),o=createElement("div",{className:"mdc-top-app-bar__row"}),i=createElement("section",{className:"mdc-top-app-bar__section mdc-top-app-bar__section--align-start"});if(e.forEach(function(e){var t=createElement("a",{className:"material-icons mdc-top-app-bar__navigation-icon",textContent:e});i.appendChild(t)}),o.appendChild(i),t.length){var r=createElement("section",{className:"mdc-top-app-bar__section mdc-top-app-bar__section--align-end"});r.setAttribute("role","toolbar"),t.forEach(function(e){var t=createElement("a",{className:"material-icons mdc-top-app-bar__action-item",textContent:e});r.appendChild(t)}),o.appendChild(r)}return a.appendChild(o),new mdc.topAppBar.MDCTopAppBar(a)}function Dialog(e,t){this.title=e,this.content=t}function tabBarBase(){var e=createElement("div",{className:"mdc-tab-bar"});e.setAttribute("role","tablist");var t=createElement("div",{className:"mdc-tab-scroller"}),n=createElement("div",{className:"mdc-tab-scroller__scroll-area"}),a=createElement("div",{className:"mdc-tab-scroller__scroll-content"});return n.appendChild(a),t.appendChild(n),e.appendChild(t),e}function addTabs(e){var t=createElement("button",{className:"mdc-tab"});t.setAttribute("role","tab");var n=createElement("span",{className:"mdc-tab-indicator"});n.appendChild(createElement("span",{className:"mdc-tab-indicator__content mdc-tab-indicator__content--underline"})),e.index||(t.setAttribute("aria-selected","true"),t.setAttribute("tabindex","0"),t.classList.add("mdc-tab--active"),n.classList.add("mdc-tab-indicator--active"));var a=createElement("div",{className:"mdc-tab__content"}),o=createElement("span",{className:"mdc-tab__text-label",textContent:e.name});a.appendChild(o);var i=createElement("span",{className:"mdc-tab__ripple"});return t.appendChild(a),t.appendChild(n),t.appendChild(i),t}function InputField(){}function textAreaField(e){var t=createElement("div",{className:"mdc-text-field  mdc-text-field--no-label mdc-text-field--textarea"}),n=createElement("textarea",{className:"mdc-text-field__input"});e.rows&&(n.rows=e.rows),e.cols&&(n.cols=e.cols);var a=createElement("div",{className:"mdc-notched-outline"}),o=createElement("div",{className:"mdc-notched-outline__leading"}),i=createElement("div",{className:"mdc-notched-outline__trailing"});a.appendChild(o);var r=createElement("div",{className:"mdc-notched-outline__notch"}),c=createElement("label",{className:"mdc-floating-label",textContent:e.label});return r.appendChild(c),a.appendChild(r),a.appendChild(i),t.appendChild(n),new mdc.textField.MDCTextField(t)}function selectMenu(e){for(var t=createElement("div",{className:"mdc-select"}),n=createElement("i",{className:"mdc-select__dropdown-icon"}),a=createElement("select",{className:"mdc-select__native-control"}),o=0;o<e.data.length;o++)a.appendChild(createElement("option",{textContent:e.data[o],value:e.data[o],selected:e.data[o]===e.selected}));var i=createElement("label",{className:"mdc-floating-label",textContent:e.labelText});t.appendChild(n),t.appendChild(a),t.appendChild(i);var r=new InputField;return t.appendChild(r.ripple()),new mdc.select.MDCSelect(t)}function notchedOultine(){var e=createElement("div",{className:"mdc-notched-outline"}),t=createElement("div",{className:"mdc-notched-outline__leading"}),n=createElement("div",{className:"mdc-notched-outline__trailing"});return e.appendChild(t),e.appendChild(n),e}function Button(e){this.name=e;var t=createElement("button",{className:"mdc-button"});t.appendChild(createElement("span",{className:"mdc-button__label",textContent:this.name})),this.base=t}function iconButton(e){return this.base=createElement("button",{className:"mdc-icon-button "+e.className,id:e.id}),this.base.setAttribute("aria-label",e.label),this.base.setAttribute("aria-hidden","true"),this.base.setAttribute("aria-pressed","false"),this.base.appendChild(createElement("i",{className:"material-icons mdc-icon-button__icon mdc-icon-button__icon--on",textContent:e.initialState})),this.base.appendChild(createElement("i",{className:"material-icons mdc-icon-button__icon",textContent:e.finalState})),new mdc.iconButton.MDCIconButtonToggle(this.base)}function Fab(e){this.fabName=e;var t=createElement("button",{className:"mdc-fab"});this.i=createElement("i",{className:"mdc-fab__icon material-icons",textContent:this.fabName}),t.appendChild(this.i),this.base=t}function AppendMap(e){this.el=e,this.options={zoom:16,disableDefaultUI:!0},this.location=""}function radioList(e){var t=document.createElement("li");t.className="mdc-list-item",t.setAttribute("role","radio"),e.index&&t.setAttribute("tabindex","0"),e.selected&&t.setAttribute("aria-checked","true");var n=createElement("span",{className:"mdc-list-item__graphic"});n.appendChild(createRadioInput(e)),t.appendChild(n);var a=createElement("label",{className:"mdc-list-item__text",textContent:e.labelText.charAt(0).toUpperCase()+e.labelText.slice(1)});return t.appendChild(a),a.setAttribute("for","list-radio-item-"+e.index),t}function userList(e,t){var n=document.createElement("li");n.className="mdc-list-item",n.dataset.phoneNumber=e.value.mobile,e.index&&n.setAttribute("tabindex","0"),e.selected&&n.setAttribute("aria-checked","true");var a=createElement("object",{className:"mdc-list-item__graphic",data:e.value.photoURL||"./img/empty-user.jpg",type:"image/jpeg"}),o=createElement("img",{className:"empty-user-assignee",src:"./img/empty-user.jpg"});a.appendChild(o),n.appendChild(a);var i=createElement("span",{className:"mdc-list-item__text"});if(i.appendChild(createElement("span",{className:"mdc-list-item__primary-text",textContent:e.value.displayName||e.value.mobile})),i.appendChild(createElement("span",{className:"mdc-list-item__secondary-text",textContent:e.value.mobile})),n.appendChild(i),t){var r=createElement("span",{className:"mdc-list-item__meta"});e.singleSelection?(n.setAttribute("role","radio"),r.appendChild(createRadioInput(e))):(n.setAttribute("role","checkbox"),e.disabled=!0,r.appendChild(createCheckBox(e))),n.appendChild(r)}return n}function createRadioInput(e){var t=createElement("div",{className:"mdc-radio"}),n=createElement("input",{className:"mdc-radio__native-control"});n.setAttribute("name","listDemoRadioGroup"),n.type="radio",n.value=JSON.stringify(e.value),n.id="list-radio-item-"+e.index;var a=createElement("div",{className:"mdc-radio__background"}),o=createElement("div",{className:"mdc-radio__outer-circle"}),i=createElement("div",{className:"mdc-radio__inner-circle"});return a.appendChild(o),a.appendChild(i),t.appendChild(n),t.appendChild(a),t}function createCheckBox(e){var t=createElement("div",{className:"mdc-checkbox mdc-list-item__meta"});e.disabled&&t.classList.add("mdc-checkbox--disabled");var n=createElement("input",{className:"mdc-checkbox__native-control",type:"checkbox",value:JSON.stringify(e.value)});n.setAttribute("tabindex","-1");var a=createElement("div",{className:"mdc-checkbox__background"});return a.innerHTML='<svg class="mdc-checkbox__checkmark"\n      viewBox="0 0 24 24">\n      <path class="mdc-checkbox__checkmark-path"\n      fill="none"\n      d="M1.73,12.91 8.1,19.28 22.79,4.59"/>\n      </svg>\n      <div class="mdc-checkbox__mixedmark"></div>',t.appendChild(n),t.appendChild(a),t}function chipSet(e,t){var n=createElement("div",{className:"mdc-chip-set"}),a=createElement("div",{className:"mdc-chip mdc-chip--selected"}),o=createElement("div",{className:"mdc-chip__text chip-text",textContent:e});if(a.appendChild(o),t){var i=createElement("i",{className:"material-icons mdc-chip__icon mdc-chip__icon--trailing",textContent:"cancel"});i.setAttribute("tabindex","0"),i.setAttribute("role","button"),a.appendChild(i)}return n.appendChild(a),n}function AppKeys(){this.mode="dev"}Dialog.prototype.create=function(e){var t=createElement("div",{className:"mdc-dialog",role:"alertDialog"});t.setAttribute("aria-modal","true"),t.setAttribute("aria-labelledby","Title"),t.setAttribute("aria-describedby","content");var n=createElement("div",{className:"mdc-dialog__container"}),a=createElement("div",{className:"mdc-dialog__surface"}),o=createElement("h2",{className:"mdc-dialog__title "+(this.title?"":"hidden"),textContent:this.title}),i=createElement("div",{className:"mdc-dialog__content"});if(this.content instanceof HTMLElement?i.appendChild(this.content):i.textContent=this.content,a.appendChild(o),a.appendChild(i),"simple"!==e){var r=createElement("footer",{className:"mdc-dialog__actions"}),c=createElement("button",{className:"mdc-button mdc-dialog__button",type:"button",textContent:"cancel"});c.setAttribute("data-mdc-dialog-action","close");var l=createElement("button",{className:"mdc-button mdc-dialog__button",type:"button",textContent:"Create"});l.setAttribute("data-mdc-dialog-action","accept"),r.appendChild(c),r.appendChild(l),a.appendChild(r)}n.appendChild(a),t.appendChild(n),t.appendChild(createElement("div",{className:"mdc-dialog__scrim"}));var s=document.getElementById("dialog-container");return s.innerHTML="",s.appendChild(t),new mdc.dialog.MDCDialog(t)},InputField.prototype.base=function(){return createElement("div",{className:"mdc-text-field filled-background  mdc-text-field--fullwidth"})},InputField.prototype.input=function(){return createElement("input",{className:"mdc-text-field__input"})},InputField.prototype.ripple=function(){return createElement("div",{className:"mdc-line-ripple"})},InputField.prototype.label=function(e){return createElement("label",{className:"mdc-floating-label",textContent:e})},InputField.prototype.withoutLabel=function(){var e=this.base(),t=this.input();return e.appendChild(t),e.appendChild(this.ripple()),new mdc.textField.MDCTextField(e)},InputField.prototype.withLabel=function(e){var t=this.base(),n=this.input();return t.appendChild(n),t.appendChild(this.label(e)),t.appendChild(this.ripple()),new mdc.textField.MDCTextField(t)},InputField.prototype.withLeadingIcon=function(e,t){var n=this.base();n.classList.remove("data--value-list","mdc-text-field--fullwidth"),n.classList.add("mdc-text-field--with-leading-icon");var a=createElement("i",{className:"material-icons mdc-text-field__icon",textContent:e});return n.appendChild(a),n.appendChild(this.input()),n.appendChild(this.label(t)),n.appendChild(this.ripple()),new mdc.textField.MDCTextField(n)},Button.prototype.getButton=function(){return new mdc.ripple.MDCRipple(this.base)},Button.prototype.disabled=function(e){this.base.disabled=e},Button.prototype.raised=function(){this.base.classList.add("mdc-button--raised")},Button.prototype.shaped=function(){this.base.classList.add("shaped")},Button.prototype.selectorButton=function(){this.base.classList.add("selector-send","selector-submit--button")},Fab.prototype=Object.create(new Button),Fab.prototype.extended=function(e){this.base.classList.add("mdc-fab--extended");var t=createElement("label",{className:"mdc-fab__label",textContent:e});return this.base.appendChild(t),this.getButton()},AppendMap.prototype.setLocation=function(e){this.options.center=e,this.location=e},AppendMap.prototype.setZoom=function(e){this.options.zoom=e},AppendMap.prototype.map=function(){return new google.maps.Map(this.el,this.options)},AppendMap.prototype.withCustomControl=function(){var e=document.createElement("div");new MapsCustomControl(e,map,this.location.lat,this.location.lng);e.index=1,map.controls[google.maps.ControlPosition.TOP_LEFT].push(e)},AppendMap.prototype.getMarker=function(t){var n={position:this.location,map:this.map()};return t&&Object.keys(t).forEach(function(e){n[e]=t[e]}),this.el.style.height="400px",new google.maps.Marker(n)},AppendMap.prototype.geocodeCustomerMarker=function(n){return new Promise(function(e,t){google.maps.event.addListener(n,"dragend",function(){geocodePosition(n.getPosition(),data).then(function(e){e.customerRecord?addressField.value=e.customerRecord.venue[0].address:addressField.value=e.venue[0].address}).catch(function(e){handleError({message:"geocode Error in autocomplete listener for"+data.template,body:JSON.stringify(e)}),locationErrorText.textContent="Failed to detect your current Location. Search For A new Location or choose existing"})})})},AppKeys.prototype.getMode=function(){return this.mode},AppKeys.prototype.getMapKey=function(){return"production"===this.mode?"AIzaSyA4s7gp7SFid_by1vLVZDmcKbkEcsStBAo":"AIzaSyCadBqkHUJwdcgKT11rp_XWkbQLFAy80JQ"},AppKeys.prototype.getKeys=function(){return"production"===this.mode?{apiKey:this.getMapKey(),authDomain:"growthfile-207204.firebaseapp.com",databaseURL:"https://growthfile-207204.firebaseio.com",projectId:"growthfile-207204",storageBucket:"growthfile-207204.appspot.com",messagingSenderId:"701025551237"}:{apiKey:this.getMapKey(),authDomain:"growthfilev2-0.firebaseapp.com",projectId:"growthfilev2-0",messagingSenderId:"1011478688238"}},AppKeys.prototype.getBaseUrl=function(){return"production"===this.mode?"https://api2.growthfile.com/api/":"https://us-central1-growthfilev2-0.cloudfunctions.net/api/"};var appKey=new AppKeys,progressBar=void 0,snackBar=void 0,ui=void 0,drawer=void 0,topAppBar=void 0,native={setFCMToken:function(e){localStorage.setItem("token",e)},getFCMToken:function(){return localStorage.getItem("token")},setName:function(e){localStorage.setItem("deviceType",e)},getName:function(){return localStorage.getItem("deviceType")},setIosInfo:function(e){var t=new URLSearchParams(e),n={};t.forEach(function(e,t){n[t]="appVersion"===t?Number(e):e}),localStorage.setItem("deviceInfo",JSON.stringify(n))},getIosInfo:function(){return localStorage.getItem("deviceInfo")},getInfo:function(){if(!this.getName())return!1;if("Android"!==this.getName())return this.getIosInfo();var t=void 0;try{t=getDeviceInfomation(),localStorage.setItem("deviceInfo",t)}catch(e){sendExceptionObject(e,"Catch Type 3: AndroidInterface.getDeviceId in native.getInfo()",[]),t=JSON.stringify({baseOs:this.getName(),deviceBrand:"",deviceModel:"",appVersion:10,osVersion:"",id:""}),localStorage.setItem("deviceInfo",t)}return t}};function isNewDay(e){var t=localStorage.getItem("today");return t?!moment(moment().format("YYYY-MM-DD")).isSame(moment(t))&&(e&&localStorage.setItem("today",moment().format("YYYY-MM-DD")),!0):(e&&localStorage.setItem("today",moment().format("YYYY-MM-DD")),!0)}function getDeviceInfomation(){return JSON.stringify({id:AndroidInterface.getId(),deviceBrand:AndroidInterface.getDeviceBrand(),deviceModel:AndroidInterface.getDeviceModel(),osVersion:AndroidInterface.getOsVersion(),baseOs:AndroidInterface.getBaseOs(),radioVersion:AndroidInterface.getRadioVersion(),appVersion:Number(AndroidInterface.getAppVersion())})}function backNav(){history.back()}function resetScroll(){scroll_namespace.count=0,scroll_namespace.size=20,scroll_namespace.skip=!1}function firebaseUiConfig(t){return{callbacks:{signInSuccessWithAuthResult:function(e){if(t)return updateEmail(e.user,t),!1},signInFailure:function(e){return handleUIError(e)},uiShown:function(){}},signInFlow:"popup",signInOptions:[{provider:firebase.auth.PhoneAuthProvider.PROVIDER_ID,recaptchaParameters:{type:"image",size:"normal",badge:"bottomleft"},defaultCountry:"IN",defaultNationalNumber:t?firebase.auth().currentUser.phoneNumber:""}]}}function userSignedOut(){ui||(ui=new firebaseui.auth.AuthUI(firebase.auth())),ui.start(document.getElementById("login-container"),firebaseUiConfig())}function startApp(e){firebase.auth().onAuthStateChanged(function(t){if(!t)return document.getElementById("start-loader").classList.add("hidden"),document.getElementById("main-layout-app").style.display="none",void userSignedOut();if("production"!==appKey.getMode()||native.getInfo()){if(localStorage.getItem("error")&&!isNewDay()||localStorage.setItem("error",JSON.stringify({})),e){var n=window.indexedDB.open(t.uid,5),a=void 0;n.onupgradeneeded=function(e){if((a=n.result).onerror=function(){handleError({message:a.error.message+" from startApp on upgradeneeded"})},e.oldVersion){if(e.oldVersion<4)n.transaction.objectStore("subscriptions").createIndex("status","status");if(e.oldVersion<5)n.transaction.objectStore("map").createIndex("bounds",["latitude","longitude"])}else createObjectStores(a,t.uid)},n.onsuccess=function(){a=n.result,document.getElementById("main-layout-app").style.display="block",localStorage.setItem("dbexist",t.uid),ga("set","userId",JSON.parse(native.getInfo()).id),console.log(document.cookie),mapView(),requestCreator("now",{device:native.getInfo(),from:"",registerToken:native.getFCMToken()})},n.onerror=function(){handleError({message:n.error.message+" from startApp"})}}}else redirect()})}function getEmployeeDetails(){return new Promise(function(o,i){var r=firebase.auth().currentUser,c=indexedDB.open(r.uid);c.onsuccess=function(){var e=c.result.transaction(["children"]),t=e.objectStore("children"),n=void 0,a=IDBKeyRange.bound(["employee","CONFIRMED"],["employee","PENDING"]);t.index("templateStatus").openCursor(a).onsuccess=function(e){var t=e.target.result;t&&(t.value.attachment["Employee Contact"].value===r.phoneNumber&&(n=t.value),t.continue())},e.oncomplete=function(){o(n)},e.onerror=function(){i({message:e.error.message+" from getEmployeeDetails"})}},c.onerror=function(){i({message:c.error.message+" from getEmployeeDetails"})}})}function isEmployeeOnLeave(){return new Promise(function(r,c){getEmployeeDetails().then(function(o){if(!o)return r(!1);o.onLeave=!1;var i=indexedDB.open(firebase.auth().currentUser.uid);i.onsuccess=function(){var e=i.result.transaction(["calendar"]),t=e.objectStore("calendar"),n=IDBKeyRange.bound(["leave","CONFIRMED",o.office],["leave","PENDING",o.office]),a=!1;t.index("onLeave").openCursor(n).onsuccess=function(e){var t=e.target.result;t&&(moment(moment().format("YYYY-MM-DD")).isBetween(t.value.start,t.value.end,null,"[]")?a=!0:t.continue())},e.oncomplete=function(){r(a)},e.onerror=function(){c({message:e.error.message+" from isEmployeeOnLeave"})}},i.onerror=function(){c({message:i.error.message+" from isEmployeeOnLeave"})}}).catch(function(e){c(e)})})}function createObjectStores(e,t){var n=e.createObjectStore("activity",{keyPath:"activityId"});n.createIndex("timestamp","timestamp"),n.createIndex("office","office"),n.createIndex("hidden","hidden");var a=e.createObjectStore("list",{keyPath:"activityId"});a.createIndex("timestamp","timestamp"),a.createIndex("status","status");var o=e.createObjectStore("users",{keyPath:"mobile"});o.createIndex("displayName","displayName"),o.createIndex("isUpdated","isUpdated"),o.createIndex("count","count"),e.createObjectStore("addendum",{autoIncrement:!0}).createIndex("activityId","activityId");var i=e.createObjectStore("subscriptions",{autoIncrement:!0});i.createIndex("office","office"),i.createIndex("template","template"),i.createIndex("officeTemplate",["office","template"]),i.createIndex("status","status");var r=e.createObjectStore("calendar",{autoIncrement:!0});r.createIndex("activityId","activityId"),r.createIndex("timestamp","timestamp"),r.createIndex("start","start"),r.createIndex("end","end"),r.createIndex("urgent",["status","hidden"]),r.createIndex("onLeave",["template","status","office"]);var c=e.createObjectStore("map",{autoIncrement:!0});c.createIndex("activityId","activityId"),c.createIndex("location","location"),c.createIndex("latitude","latitude"),c.createIndex("longitude","longitude"),c.createIndex("nearby",["status","hidden"]),c.createIndex("byOffice",["office","location"]),c.createIndex("bounds",["latitude","longitude"]);var l=e.createObjectStore("children",{keyPath:"activityId"});l.createIndex("template","template"),l.createIndex("office","office"),l.createIndex("templateStatus",["template","status"]),e.createObjectStore("root",{keyPath:"uid"}).put({uid:t,fromTime:0,location:""})}function redirect(){firebase.auth().signOut().then(function(){window.location="https://www.growthfile.com"}).catch(function(e){console.log(e),window.location="https://www.growthfile.com",handleError({message:e+" from redirect"})})}function createCheckInData(){return new Promise(function(a,o){getUniqueOfficeCount().then(function(n){console.log(n);var t=[];n.length&&(n.forEach(function(e){t.push(getSubscription(e,"check-in"))}),Promise.all(t).then(function(e){if(e.length){var t=e.filter(function(e){return null!=e});return a({data:t,offices:n})}}).catch(function(e){o(e)}))})})}function checkInDialog(e,a){var t=void 0,o=void 0,n=e.offices,i=e.data;if(1!=n.length){var r=createElement("ul",{className:"mdc-list"});r.setAttribute("role","radiogroup"),i.forEach(function(e,t){r.appendChild(radioList({labelText:e.office,index:t,value:e}))}),(o=new mdc.list.MDCList(r)).singleSelection=!0,(t=new Dialog("Check-In Reminder",r).create()).listen("MDCDialog:opened",function(e){o.layout(),o.listElements.map(function(e){return new mdc.ripple.MDCRipple.attachTo(e)})}),t.listen("MDCDialog:closed",function(e){if("accept"===e.detail.action){var t=document.getElementById("list-radio-item-"+o.selectedIndex).value;if(t){var n=JSON.parse(t);checkMapStoreForNearByLocation(n.office,a).then(function(e){requestCreator("create",setVenueForCheckIn(e,n))})}}}),t.open()}else checkMapStoreForNearByLocation(n[0],a).then(function(e){requestCreator("create",setVenueForCheckIn(e,i[0]))})}function setVenueForCheckIn(e,t){var n={geopoint:{latitude:"",longitude:""},address:"",location:"",venueDescriptor:t.venue[0]};return e.length?(n.location=e[0].location,n.address=e[0].address,n.geopoint.latitude=e[0].latitude,n.geopoint.longitude=e[0].longitude,t.venue=[n],t.share=[],console.log(t)):(t.venue=[n],t.share=[]),[t]}function getUniqueOfficeCount(){return new Promise(function(t,n){var a=indexedDB.open(firebase.auth().currentUser.uid),o=[];a.onsuccess=function(){var e=a.result.transaction(["children"]);e.objectStore("children").index("template").openCursor("office").onsuccess=function(e){var t=e.target.result;t&&(o.push(t.value.office),t.continue())},e.oncomplete=function(){return t(o)},e.onerror=function(){return n({message:e.error.message,body:JSON.stringify(e.error)})}},a.onerror=function(){return n({message:a.error.message})}})}function checkMapStoreForNearByLocation(c,l){return new Promise(function(o,i){var r=indexedDB.open(firebase.auth().currentUser.uid);r.onsuccess=function(){var a=[],e=r.result.transaction(["map"]),t=e.objectStore("map").index("byOffice"),n=IDBKeyRange.bound([c,""],[c,"￿"]);t.openCursor(n).onsuccess=function(e){var t=e.target.result;t&&(t.value.location&&t.value.latitude&&t.value.longitude&&isLocationLessThanThreshold(calculateDistanceBetweenTwoPoints(t.value,l))&&a.push(t.value),t.continue())},e.oncomplete=function(){var t={};a.forEach(function(e){t[e.location]=e});var n=[];Object.keys(t).forEach(function(e){n.push(t[e])});var e=n.sort(function(e,t){return e.accuracy-t.accuracy});o(e)},e.onerror=function(){i(e.error)}}})}window.onpopstate=function(e){if(e.state){if("listView"!==e.state[0])return window[e.state[0]](e.state[1],!1);var t=scroll_namespace.count;t&&(scroll_namespace.size=t),scroll_namespace.count=0,window[e.state[0]]()}},window.addEventListener("load",function(){(firebase.initializeApp(appKey.getKeys()),progressBar=new mdc.linearProgress.MDCLinearProgress(document.querySelector(".mdc-linear-progress")),snackBar=new mdc.snackbar.MDCSnackbar(document.querySelector(".mdc-snackbar")),drawer=new mdc.drawer.MDCDrawer(document.querySelector(".mdc-drawer")),navigator,moment.updateLocale("en",{calendar:{lastDay:"[yesterday]",sameDay:"hh:mm",nextDay:"[Tomorrow at] LT",lastWeek:"dddd",nextWeek:"dddd [at] LT",sameElse:"L"},longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YY"},months:["January","February","March","April","May","June","July","August","September","October","November","December"]}),window.Worker||window.indexedDB)?startApp(!0):new Dialog("App Incompatiblity","Growthfile is incompatible with this device").create().open()});var map,globMark,gray=[{featureType:"administrative",elementType:"geometry.fill",stylers:[{color:"#D6E2E6"}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#CFD4D5"}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#7492A8"}]},{featureType:"landscape.man_made",elementType:"geometry.fill",stylers:[{color:"#DDE2E3"}]},{featureType:"landscape.man_made",elementType:"geometry.stroke",stylers:[{color:"#CFD4D5"}]},{featureType:"landscape.natural",elementType:"geometry.fill",stylers:[{color:"#dde2e3"}]},{featureType:"landscape.natural",elementType:"labels.text.fill",stylers:[{color:"#7492A8"}]},{featureType:"landscape.natural.terrain",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"geometry.fill",stylers:[{color:"#DDE2E3"}]},{featureType:"poi",elementType:"labels.icon",stylers:[{saturation:-100}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#588CA4"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{color:"#B9F6CA"}]},{featureType:"poi.park",elementType:"geometry.stroke",stylers:[{color:"#BAE6A1"}]},{featureType:"poi.sports_complex",elementType:"geometry.fill",stylers:[{color:"#C6E8B3"}]},{featureType:"poi.sports_complex",elementType:"geometry.stroke",stylers:[{color:"#BAE6A1"}]},{featureType:"road",elementType:"labels.icon",stylers:[{saturation:-45},{lightness:10},{visibility:"on"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#41626B"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#FFFFFF"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#C1D1D6"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#A6B5BB"}]},{featureType:"road.highway",elementType:"labels.icon",stylers:[{visibility:"on"}]},{featureType:"road.highway.controlled_access",elementType:"geometry.fill",stylers:[{color:"#9FB6BD"}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{color:"#FFFFFF"}]},{featureType:"transit",elementType:"labels.icon",stylers:[{saturation:-70}]},{featureType:"transit.line",elementType:"geometry.fill",stylers:[{color:"#CFD4D5"}]},{featureType:"transit.line",elementType:"labels.text.fill",stylers:[{color:"#CFD4D5"}]},{featureType:"transit.station",elementType:"labels.text.fill",stylers:[{color:"#90CAF9"}]},{featureType:"transit.station.airport",elementType:"geometry.fill",stylers:[{saturation:-100},{lightness:-5}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#A6CBE3"}]}];function mapView(){history.pushState(["mapView"],null,null),document.getElementById("section-start").innerHTML=' <a href="#" class="demo-menu material-icons mdc-top-app-bar__navigation-icon">menu</a>',(topAppBar=new mdc.topAppBar.MDCTopAppBar(document.querySelector(".mdc-top-app-bar"))).setScrollTarget(document.getElementById("main-content")),topAppBar.root_.classList.add("transparent"),document.getElementById("growthfile").classList.remove("mdc-top-app-bar--fixed-adjust");manageLocation().then(function(e){document.getElementById("start-loader").classList.add("hidden");var n={lat:e.latitude,lng:e.longitude};map=new google.maps.Map(document.getElementById("map"),{center:n,zoom:18,disableDefaultUI:!0,styles:gray}),new google.maps.Marker({position:n,icon:"https://www.robotwoods.com/dev/misc/bluecircle.png"}).setMap(map);new google.maps.Circle({strokeColor:"#0399f4",strokeOpacity:.8,strokeWeight:2,fillColor:"#0399f4",fillOpacity:.35,map:map,center:n,radius:e.accuracy});google.maps.event.addListenerOnce(map,"idle",function(){console.log("idle_once");var e=document.createElement("div");new CenterControl(e,map,n);e.index=1;var t=document.createElement("div");new TakeSnap(t);t.index=2,map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(e),map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(t),topAppBar.listen("MDCTopAppBar:nav",function(){drawer.open=!drawer.open,[].map.call(document.querySelectorAll(".mdc-drawer .mdc-list-item"),function(e){new mdc.ripple.MDCRipple(e)}),document.getElementById("drawer-icon").src=firebase.auth().currentUser.photoURL,document.getElementById("drawer-title").textContent=firebase.auth().currentUser.displayName||irebase.auth().currentUser.phoneNumber,document.getElementById("drawer-icon").onclick=function(){profileView()}})}),google.maps.event.addListener(map,"idle",function(){document.querySelector("#recenter-action i")&&(document.querySelector("#recenter-action i").style.color="black"),Promise.all([loadNearByLocations(getMapBounds(map),map),getUniqueOfficeCount()]).then(function(e){var t=void 0,n=void 0,a=e[0],o=e[1],i=a.length,r=o.length,c=document.getElementById("selection-box"),l=c.querySelector(".content-body");if(c.querySelector("#card-header").textContent="Hello, "+(firebase.auth().currentUser.displayName||firebase.auth().currentUser.phoneNumber),c.classList.remove("hidden"),!i)return 1<r?(l.innerHTML=mdcSelectOffice(o,"Select Office"),t=new mdc.select.MDCSelect(c.querySelector(".mdc-select")),void document.getElementById("submit-check-in").addEventListener("click",function(){var n=new mdc.linearProgress.MDCLinearProgress(document.querySelector("#check-in-prog"));n.open(),t.value&&getSubscription(t.value,"check-in").then(function(e){var t=setVenueForCheckIn([],e);requestCreator("create",t),setTimeout(function(){n.close()},500),console.log(t)})})):void document.getElementById("submit-check-in").addEventListener("click",function(){var n=new mdc.linearProgress.MDCLinearProgress(document.querySelector("#check-in-prog"));n.open(),getSubscription(o[0],"check-in").then(function(e){var t=setVenueForCheckIn([],e);requestCreator("create",t),console.log(t),setTimeout(function(){n.close()},500)})});var s="<div>\n          "+mdcSelectVenue(a,"Choose Venue","select-venue")+"\n          <div class='mt-10 hidden' id='choose-office-container'>\n             "+mdcSelectOffice(o,"Select Office","select-office")+"\n          </div>\n          </div>";l.innerHTML=s,(n=new mdc.select.MDCSelect(document.getElementById("select-venue"))).listen("MDCSelect:change",function(e){console.log(e.detail.value),e.detail.value?document.getElementById("choose-office-container").classList.add("hidden"):1<r&&(c.scrollTop=c.scrollHeight,document.getElementById("choose-office-container").classList.remove("hidden"),t=new mdc.select.MDCSelect(document.getElementById("select-office")))}),document.getElementById("submit-check-in").addEventListener("click",function(){var e=void 0,a=n.value?JSON.parse(n.value):"";(e=1==r?o[0]:a?a.office:t.value)&&getSubscription(e,"check-in").then(function(e){var t=new mdc.linearProgress.MDCLinearProgress(document.querySelector("#check-in-prog"));t.open();var n=setVenueForCheckIn(a?[a]:[],e);requestCreator("create",n),setTimeout(function(){t.close()},500),console.log(n)})})})})}).catch(function(e){console.log(e),document.getElementById("growthfile").classList.add("mdc-top-app-bar--fixed-adjust"),document.getElementById("start-loader").classList.add("hidden"),document.getElementById("map").innerHTML='<div><p>Failed To Detect You Location</p><button class="mdc-button" onclick=mapView()>Try Again</button></div>'})}function CenterControl(e,t,n){var a=new Fab("my_location").getButton();a.root_.id="recenter-action",a.root_.classList.add("custom-control","right","mdc-theme--background","mdc-theme--on-primary"),console.log(a),e.appendChild(a.root_),a.root_.addEventListener("click",function(){a.root_.querySelector("i").style.color="#0399f4",focusMarker(t,n,18)})}function TakeSnap(e){var t=new Fab("photo_camera").getButton();t.root_.id="take-snap",t.root_.classList.add("custom-control","right","mdc-theme--on-secondary"),e.appendChild(t.root_),t.root_.addEventListener("click",function(){console.log("clicked"),AndroidInterface.startCamera()})}function mdcSelectOffice(e,t,n){return'<div class="mdc-select" id='+n+'>\n  <i class="mdc-select__dropdown-icon"></i>\n  <select class="mdc-select__native-control">\n \n  '+e.map(function(e){return" <option value='"+e+"'>\n    "+e+"\n    </option>"}).join("")+"\n  </select>\n  <label class='mdc-floating-label'>"+t+'</label>\n  <div class="mdc-line-ripple"></div>\n</div>'}function mdcSelectVenue(t,e,n){return'<div class="mdc-select" id='+n+'>\n  <i class="mdc-select__dropdown-icon"></i>\n  <select class="mdc-select__native-control">\n  <option value=\'\'></option>\n  '+t.map(function(e){return" <option value='"+JSON.stringify(e)+"' selected='"+(1==t.length?"true":"false")+"'>\n    "+e.location+"\n    </option>"}).join("")+"\n  </select>\n  <label class='mdc-floating-label mdc-floating-label--float-above'>"+e+'</label>\n  <div class="mdc-line-ripple"></div>\n</div>'}function setFilePath(e){var o="data:image/jpg;base64,"+e,t=createElement("div",{className:"form-meta"});t.classList.add("snap-form");var i=textAreaField({rows:"1",cols:"100",label:"Comment"});i.input_.classList.add("mdc-theme--primary","snap-text");var r=new Fab("send").getButton();r.root_.classList.add("app-fab--absolute"),r.root_.style.zIndex="9",r.root_.setAttribute("autofocus","true"),t.appendChild(i.root_),t.appendChild(r.root_);var c=new Dialog("",t).create("simple");c.listen("MDCDialog:opened",function(e){var t=c.content_,n=createHeader(["keyboard_backspace"],[],"snap-header");n.foundation_.adapter_.addClass("transparent"),n.listen("MDCTopAppBar:nav",function(){c.close()}),t.appendChild(n.root_),i.input_.addEventListener("keyup",function(){this.style.paddingTop="25px",this.style.height="5px",this.style.height=this.scrollHeight+"px",this.scrollHeight<=300&&(r.root_.style.bottom=this.scrollHeight-20+"px")}),r.root_.addEventListener("click",function(){var n=i.value,a=o;createCheckInData().then(function(t){console.log(t),manageLocation().then(function(e){t.data[0].attachment.Comment.value=n,t.data[0].attachment.Photo.value=a,checkInDialog(t,e),c.close()})}).catch(console.log)});var a=new Image;a.onload=function(){var e=getOrientation(a);t.style.backgroundImage="url("+o+")",t.style.padding="0px",t.style.overflow="hidden",t.classList.add("snap-bckg"),"potrait"==e&&(t.style.backgroundSize="cover"),"landscape"!=e&&"sqaure"!=e||(t.style.backgroundSize="contain")},a.src=o}),c.container_.style.minWidth="100%",c.root_.querySelector(".mdc-dialog__surface").style.minWidth="100%",c.root_.querySelector(".mdc-dialog__surface").style.minHeight="100vh",c.open()}function getOrientation(e){return e.width>e.height?"landscape":e.height>e.width?"potrait":e.width==e.height?"square":void 0}function focusMarker(e,t,n){e.setZoom(n),e.panTo(t)}function getMapBounds(e){var t=e.getBounds().getNorthEast(),n=e.getBounds().getSouthWest();return{ne:[t.lat(),t.lng()],sw:[n.lat(),n.lng()]}}function loadNearByLocations(i,u){return new Promise(function(a,e){new google.maps.MarkerImage("./img/marker.png",new google.maps.Size(30,30),null,null,new google.maps.Size(30,30));var c=new google.maps.InfoWindow({disableAutoPan:!0}),l=[],o=indexedDB.open(firebase.auth().currentUser.uid),s=void 0,d=void 0;console.log(i),o.onsuccess=function(){var e=o.result.transaction(["map"]),t=e.objectStore("map").index("bounds"),n=IDBKeyRange.bound(i.sw,i.ne);t.openCursor(n).onsuccess=function(e){var t=e.target.result;if(t)if(t.value.location&&t.value.latitude&&t.value.longitude)if(d&&d.lat===t.value.latitude&&d.lng===t.value.longitude)t.continue();else{var n,a,o,i=new google.maps.Marker({position:{lat:t.value.latitude,lng:t.value.longitude},icon:{url:"./img/marker.png",size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)},id:t.value.activityId,value:JSON.stringify(t.value)});if(u.getBounds().contains(i.getPosition())){var r="<span>"+t.value.location+"</span>";google.maps.event.addListener(i,"click",(n=i,a=r,o=c,function(){s&&s.close(),o.setContent(a),o.open(u,n),s=o})),i.setMap(u),l.push(t.value)}d={lat:t.value.latitude,lng:t.value.longitude},t.continue()}else t.continue()},e.oncomplete=function(){return a(l)}}})}function profileView(e){drawer.open=!1,history.pushState(["profileView"],null,null),topAppBar.root_.classList.remove("transparent"),document.body.style.backgroundColor="#eeeeee";var t=document.getElementById("section-start");t.innerHTML="",t.appendChild(headerBackIcon());var n=indexedDB.open(firebase.auth().currentUser.uid);n.onsuccess=function(){getUserRecord(n.result,firebase.auth().currentUser.phoneNumber).then(function(e){document.getElementById("app-current-panel")&&(document.getElementById("app-current-panel").innerHTML=createProfilePanel(e).outerHTML,"Android"===native.getName()?document.getElementById("uploadProfileImage").addEventListener("click",function(){try{AndroidInterface.openImagePicker()}catch(e){sendExceptionObject(e,"CATCH Type 10:AndroidInterface.openImagePicker at profileview",[])}}):document.getElementById("uploadProfileImage").addEventListener("change",function(){readUploadedFile()}),changeDisplayName(),changeEmailAddress())})}}function createProfilePanel(e){var t=document.createElement("div");t.id="profile-view--container",t.className="mdc-top-app-bar--fixed-adjust mdc-theme--background";var n=document.createElement("button");n.className="mdc-fab","Android"===native.getName()&&(n.id="uploadProfileImage");var a=document.createElement("label");a.setAttribute("for","uploadProfileImage");var o=document.createElement("span");o.className="mdc-fab__icon material-icons",o.textContent="add_a_photo",a.appendChild(o),n.appendChild(a);var i=void 0;"Android"!==native.getName()&&((i=document.createElement("input")).type="file",i.style.display="none",i.id="uploadProfileImage",i.accept="image/jpeg;");var r=document.createElement("div");r.id="profile--image-container",r.className="profile-container--main";var c=document.createElement("object");c.type="image/jpeg",c.data=e.photoURL||"./img/empty-user-big.jpg",c.id="user-profile--image";var l=document.createElement("img");l.src="./img/empty-user-big.jpg",l.className="empty-user-profile",c.appendChild(l);var s=document.createElement("div");s.className="insert-overlay",r.appendChild(c),r.appendChild(s),r.appendChild(n),"Android"!==native.getName()&&a.appendChild(i);var d=document.createElement("div");d.id="name--change-container",d.className="profile-psuedo-card";var u=document.createElement("button");u.className="mdc-icon-button material-icons hidden",u.id="edit--name",u.setAttribute("aria-hidden","true"),u.setAttribute("aria-pressed","false"),u.textContent="check";var m=firebase.auth().currentUser.displayName;d.innerHTML='<div class="mdc-text-field" id=\'name-change-field\'>\n        <input autocomplete="off" type="text"  placeholder="'+(m?"":"Enter Your Name")+'"  id="pre-filled-name" class="mdc-text-field__input" value="'+(m||"")+'">\n        <label class="mdc-floating-label mdc-floating-label--float-above" for="pre-filled-name">\n         Your Name\n        </label>\n        <div class="mdc-line-ripple"></div>\n      </div>\n      ',d.appendChild(u);var p=document.createElement("div");p.id="email--change-container",p.className="profile-psuedo-card";var f=document.createElement("button");f.className="mdc-icon-button material-icons hidden",f.id="edit--email",f.setAttribute("aria-hidden","true"),f.setAttribute("aria-pressed","false"),f.textContent="check";var g=firebase.auth().currentUser.email;return p.innerHTML='<div class="mdc-text-field" id=\'email-change-field\'>\n        <input  autocomplete="off" type="text" id="pre-filled-email" class="mdc-text-field__input" value="'+(g||"")+'" placeholder="'+(g?"":"Enter your Email")+'">\n        <label class="mdc-floating-label mdc-floating-label--float-above" for="pre-filled-email">\n         Your Email\n        </label>\n        <div class="mdc-line-ripple"></div>\n      </div>\n      ',p.appendChild(f),t.appendChild(r),t.appendChild(d),t.appendChild(p),t}function timeDiff(e){var t=moment().format("YYY-MM-DD HH:mm"),n=moment(e).format("YYY-MM-DD HH:mm");return moment(t).diff(moment(n),"minutes")}function newSignIn(t,e){var n=new Dialog("",createElement("div",{id:"refresh-login"})).create();n.open(),n.listen("MDCDialog:opened",function(e){try{ui||(ui=new firebaseui.auth.AuthUI(firebase.auth())),ui.start("#refresh-login",firebaseUiConfig(t)),setTimeout(function(){document.querySelector(".firebaseui-id-phone-number").disabled=!0,document.querySelector(".firebaseui-label").remove(),document.querySelector(".firebaseui-title").textContent="Verify your phone Number to Update your Email address"},500)}catch(e){console.log(e),handleError({message:e.message+" from newSignIn function during email updation"}),snacks("Please try again later")}})}function readUploadedFile(e){if("Android"!==native.getName()){var t=document.getElementById("uploadProfileImage").files[0],n=new FileReader;n.addEventListener("load",function(){sendBase64ImageToBackblaze(n.result)},!1),t&&n.readAsDataURL(t)}else sendBase64ImageToBackblaze(e)}function sendBase64ImageToBackblaze(e){var t=document.getElementById("user-profile--image"),n=document.getElementById("profile--image-container"),a="data:image/jpeg;base64,";t&&(t.data=a+e),n&&document.getElementById("profile--image-container").appendChild(loader("profile--loader")),requestCreator("backblaze",{imageBase64:a+e})}function authUpdatedError(e){progressBar.foundation_.close(),snacks(e.message)}function changeDisplayName(){var e=document.getElementById("name-change-field"),t=new mdc.textField.MDCTextField(e),n=document.getElementById("edit--name");firebase.auth().currentUser.displayName;e.addEventListener("click",function(){document.getElementById("pre-filled-name").placeholder="",n.classList.remove("hidden"),e.classList.add("short")}),e.addEventListener("keydown",function(e){13==e.keyCode&&updateName(t.value)}),n.addEventListener("click",function(){updateName(t.value)})}function updateName(e){e?(progressBar.foundation_.open(),firebase.auth().currentUser.updateProfile({displayName:e}).then(successDialog).catch(function(e){progressBar.foundation_.close(),snacks("Please Try again later"),handleError({message:e+" at updateProfile in changeDisplayName"})})):snacks("Please Enter a Name")}function changeEmailAddress(){var e=document.getElementById("email-change-field"),t=new mdc.textField.MDCTextField(e),n=document.getElementById("edit--email");e.addEventListener("click",function(){document.getElementById("pre-filled-email").placeholder="",n.classList.remove("hidden"),e.classList.add("short")}),e.addEventListener("keydown",function(e){13==e.keyCode&&emailValidation(t)}),n.addEventListener("click",function(){emailValidation(t)})}function emailValidation(e){var t=firebase.auth().currentUser,n=e.value;n?n===t.email&&t.emailVerified?snacks("You have already set this as your email address"):timeDiff(t.metadata.lastSignInTime)<=2?updateEmail(t,n):newSignIn(n,e):snacks("Enter a valid Email Id")}function updateEmail(e,t){progressBar.foundation_.open(),e.updateEmail(t).then(function(){emailUpdateSuccess(!0)}).catch(authUpdatedError)}function emailUpdateSuccess(e){firebase.auth().currentUser.sendEmailVerification().then(function(){emailVerificationSuccess(e)}).catch(emailVerificationError)}function emailVerificationSuccess(e){e&&(successDialog(),document.getElementById("dialog-container").innerHTML=""),snacks("Verification link has been send to your email address")}function emailVerificationError(e){snacks(e.message),progressBar.foundation_.close()}var apiHandler=new Worker("js/apiHandler.js");function handleError(e){var t=JSON.parse(localStorage.getItem("error"));t.hasOwnProperty(e.message)||(t[e.message]=!0,localStorage.setItem("error",JSON.stringify(t)),requestCreator("instant",JSON.stringify(e)))}function loader(e){var t=document.createElement("div");return t.className="loader "+e,t}function successDialog(){if("mapView"!==history.state[0]){progressBar.foundation_.close();var e=document.getElementById("success-animation"),t=document.getElementById("growthfile");return e.classList.remove("hidden"),t.style.opacity="0.37",setTimeout(function(){e.classList.add("hidden"),t.style.opacity="1"},1500),void mapView()}snackBar.labelText="Check-In Created",snackBar.open()}function snacks(e,t){snackBar.labelText=e,snackBar.open(),snackBar.timeoutMs=1e4,snackBar.actionButtonText="okay"}function fetchCurrentTime(e){return Date.now()+e}function geolocationApi(o){return new Promise(function(t,n){var a=new XMLHttpRequest;a.open("POST","https://www.googleapis.com/geolocation/v1/geolocate?key="+appKey.getMapKey(),!0),a.setRequestHeader("Content-Type","application/json"),a.onreadystatechange=function(){if(4===a.readyState){if(400<=a.status)return n({message:a.response,body:JSON.parse(o)});var e=JSON.parse(a.response);if(!e)return n({message:"Response From geolocation Api "+e,body:JSON.parse(o)});t({latitude:e.location.lat,longitude:e.location.lng,accuracy:e.accuracy,provider:o})}},a.onerror=function(){n({message:a})},a.send(o)})}function manageLocation(){return new Promise(function(t,n){getLocation().then(function(e){updateLocationInRoot(e),t(e)}).catch(function(e){n(e)})})}function getLocation(){return new Promise(function(n,a){if("Android"!==native.getName())try{webkit.messageHandlers.locationService.postMessage("start"),window.addEventListener("iosLocation",function e(t){n(t.detail),window.removeEventListener("iosLocation",e,!0)},!0)}catch(e){n({latitude:28.549173600000003,longitude:77.25055569999999,accuracy:24})}else html5Geolocation().then(function(t){if(t.accuracy<=350)return n(t);handleGeoLocationApi().then(function(e){return t.accuracy<e.accuracy?n(t):n(e)}).catch(function(e){return n(t)})}).catch(function(t){handleGeoLocationApi().then(function(e){return n(e)}).catch(function(e){return a({message:"Both HTML and Geolocation failed to fetch location",body:{html5:t,geolocation:e},locationError:!0})})})})}function handleGeoLocationApi(){return new Promise(function(t,n){var e=void 0;try{e=getCellularInformation()}catch(e){n(e.message)}Object.keys(e).length||n("empty object from getCellularInformation"),geolocationApi(JSON.stringify(e)).then(function(e){return t(e)}).catch(function(e){n(e)})})}function logWifi(e){for(var a={message:"Wi-fi Change Log",body:{main:e}},t=function(e){var n;n=e,setTimeout(function(){if(3!=n){var t=void 0,e=void 0;1==n&&(e="first wifi at "+moment().format("hh:mm:ss")),2==n&&(e="second wifi at "+moment().format("hh:mm:ss"));try{t=getCellularInformation()}catch(e){t=e.message}a.body[e]=t}else handleError(a)},2e3*e)},n=1;n<=3;n++)t(n)}function iosLocationError(e){html5Geolocation().then(function(e){updateLocationInRoot(e)}).catch(function(e){reject(e)}),handleError(e)}function html5Geolocation(){return new Promise(function(t,n){navigator.geolocation.getCurrentPosition(function(e){return t({latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy,provider:"HTML5"})},function(e){n({message:e.message})},{maximumAge:0,timeout:1e4,enableHighAccuracy:!1})})}function updateLocationInRoot(a){var o={latitude:"",longitude:"",accuracy:"",provider:"",lastLocationTime:""},t=firebase.auth().currentUser.uid,i=indexedDB.open(t);i.onsuccess=function(){var e=i.result.transaction(["root"],"readwrite"),n=e.objectStore("root");n.get(t).onsuccess=function(e){var t=e.target.result;t.location&&(o=t.location),t.location=a,t.location.lastLocationTime=Date.now(),n.put(t)},e.oncomplete=function(){if(o.latitude&&o.longitude&&a.latitude&&a.longitude){var e=calculateDistanceBetweenTwoPoints(o,a),t=new CustomEvent("suggestCheckIn",{detail:{newDay:isNewDay(!0),locationChanged:isLocationMoreThanThreshold(e)}});if(window.dispatchEvent(t),"Ios"===native.getName()){var n=new CustomEvent("iosLocation",{detail:a});window.dispatchEvent(n)}}},e.onerror=function(){handleError({message:e.error.message+" from updateLocationInRoot",body:e.error.name})},i.onerror=function(){handleError({message:i.error.message+" from updateLocationInRoot",body:i.error.name}),window.dispatchEvent(suggestCheckIn)}}}function toRad(e){return e*Math.PI/180}function calculateDistanceBetweenTwoPoints(e,t){var n=toRad(t.latitude-e.latitude),a=toRad(t.longitude-e.longitude),o=toRad(t.latitude),i=toRad(e.latitude),r=Math.sin(n/2)*Math.sin(n/2)+Math.sin(a/2)*Math.sin(a/2)*Math.cos(o)*Math.cos(i);return 6371*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))}function isLocationMoreThanThreshold(e){return 1<=e}function isLocationLessThanThreshold(e){return e<=1}function sortedByAccuracy(e){return e.sort(function(e,t){return e.accuracy-t.accuracy})[0]}function isLocationStatusWorking(){return"Android"!==native.getName()||(AndroidInterface.isLocationPermissionGranted()?!{samsung:!0,OnePlus:!0}[JSON.parse(localStorage.getItem("deviceInfo")).deviceBrand]||(!!AndroidInterface.isWifiOn()||void new Dialog("TURN ON YOUR WIFI","Growthfile requires wi-fi access for improving your location accuracy.").create().open()):void new Dialog("LOCATION PERMISSION","Please Allow Growthfile location access.").create().open())}function requestCreator(o,i,e){var t=firebase.auth().currentUser;if(t){var r={type:o,body:"",meta:{user:{token:"",uid:t.uid,displayName:t.displayName,photoURL:t.photoURL,phoneNumber:t.phoneNumber},apiUrl:appKey.getBaseUrl()}};t.getIdToken(!1).then(function(a){"instant"===o||"now"===o||"Null"===o||"backblaze"===o?(r.body=i,r.meta.user.token=a,apiHandler.postMessage(r)):getRootRecord().then(function(e){var t=e.location,n=!0;t&&(n=isLastLocationOlderThanThreshold(t.lastLocationTime,5)),r.meta.user.token=a,createRequestBody(o,i,r,e.serverTime,n?t:e.location)})}).catch(console.log),apiHandler.onmessage=messageReceiver,apiHandler.onerror=onErrorMessage}}function createRequestBody(e,t,n,a,o){"create"===e?t.forEach(function(e){e.timestamp=fetchCurrentTime(a),e.geopoint=o}):(t.timestamp=fetchCurrentTime(a),t.geopoint=o),n.body=t,apiHandler.postMessage(n)}function locationErrorDialog(t){var e=new Dialog("Location Error","There was a problem in detecting your location. Please try again later").create();e.open(),e.listen("MDCDialog:closed",function(e){resetScroll(),listView(),handleError(t)})}function isLastLocationOlderThanThreshold(e,t){if(!e)return!0;var n=moment(moment().valueOf());return t<moment.duration(n.diff(e)).asSeconds()}var receiverCaller={initFirstLoad:initFirstLoad,"update-app":updateApp,"removed-from-office":officeRemovalSuccess,"revoke-session":revokeSession,notification:successDialog,apiFail:apiFail};function messageReceiver(e){receiverCaller[e.data.type](e.data)}function emailVerify(e){if(!firebase.auth().currentUser.email||!firebase.auth().currentUser.emailVerified){if(firebase.auth().currentUser.email)return emailUpdateSuccess();var t=new Dialog(e.title,e.body).create();t.open(),t.listen("MDCDialog:closed",function(e){"accept"===e.detail.action&&profileView(!0)})}}function templateDialog(e,o,i){var t=createElement("div",{className:"notification-message",textContent:e.body}),n=createElement("ul",{className:"mdc-list",id:"payroll-notification-list"});n.setAttribute("role","radiogroup"),e.data.forEach(function(e,t){n.appendChild(radioList({labelText:e.template,index:t,value:e}))}),t.appendChild(n);var a=new Dialog(e.title,t).create();a.open();var r=new mdc.list.MDCList(n);r.singleSelection=!0,a.listen("MDCDialog:opened",function(e){r.layout(),r.listElements.map(function(e){return new mdc.ripple.MDCRipple.attachTo(e)})}),a.listen("MDCDialog:closed",function(e){if("accept"===e.detail.action&&isLocationStatusWorking()){var t=document.getElementById("list-radio-item-"+r.selectedIndex).value;if(t){var n=JSON.parse(t),a={schedule:"",attachment:""};if(o||(a.schedule=n.schedule,a.attachment=n.attachment),!i)return ga("send",{hitType:"event",eventCategory:"suggestion",eventAction:"click",eventLabel:n.template+" suggestion selected"}),void createTempRecord(n.office,n.template,a);selectorUI({store:"subscriptions"})}}})}function initFirstLoad(e){}function updateApp(){if("Android"!==native.getName())return webkit.messageHandlers.updateApp.postMessage("Update App");var e=new Dialog("New Update Avaialble","Please Install the Latest version from google play store , to Use Growthfile. Click Okay to Install Lastest Version from Google Play Store.").create();e.open(),e.scrimClickAction="",e.listen("MDCDialog:opened",function(){e.buttons_[0].setAttribute("disabled","true")}),e.listen("MDCDialog:closed",function(e){"accept"===e.detail.action&&AndroidInterface.openGooglePlayStore("com.growthfile.growthfileNew")})}function revokeSession(){firebase.auth().signOut().then(function(){}).catch(function(e){handleError({message:"Sign out error",body:e})})}function apiFail(e){document.getElementById("send-activity")&&(document.getElementById("send-activity").style.display="block"),document.querySelector(".loader")&&document.querySelector(".loader").remove(),document.querySelector(".delete-activity")&&(document.querySelector(".delete-activity").style.display="block"),document.querySelector(".undo-delete-loader")&&(document.querySelector(".undo-delete-loader").style.display="block"),document.querySelector(".form-field-status")&&document.querySelector(".form-field-status").classList.contains("hidden")&&document.querySelector(".form-field-status").classList.remove("hidden"),snacks(e.msg.message)}function officeRemovalSuccess(e){var t=new Dialog("Reminder","You have been removed from "+e.msg.join(" & ")).create();t.open(),t.listen("MDCDialog:closed",function(){document.getElementById("app-current-panel").innerHTML="",resetScroll(),listView()})}function onErrorMessage(e){var t={"line-number":e.lineno,file:e.filename,"col-number":e.colno};handleError({message:e.message+" from apiHandler.js at line-number "+e.lineno+" and columne-number "+e.colno,body:t})}function getInputText(e){return mdc.textField.MDCTextField.attachTo(document.querySelector(e))}function runRead(e){if(localStorage.getItem("dbexist"))return e?void(e.read?requestCreator("Null",e):setTimeout(function(){e.verifyEmail?emailVerify(JSON.parse(e.verifyEmail)):e.payroll&&templateDialog(JSON.parse(e.payroll))},500)):requestCreator("Null",e)}function removeChildNodes(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function getRootRecord(){return new Promise(function(t,n){var a=void 0,o=firebase.auth().currentUser.uid,i=indexedDB.open(o);i.onsuccess=function(){var e=i.result.transaction(["root"],"readwrite");e.objectStore("root").get(o).onsuccess=function(e){var t=e.target.result;a=t},e.oncomplete=function(){t(a)},e.onerror=function(){n({message:e.error.message+" from getRootRecord"})}},i.onerror=function(){n({message:i.error+" from getRootRecord"})}})}function headerBackIcon(e){var t=document.createElement("i");return t.className="material-icons mdc-top-app-bar__navigation-icon",t.textContent="arrow_back",t.onclick=function(){if(!e)return backNav()},t}function getUserRecord(o,i){return new Promise(function(n,e){var t=o.transaction("users").objectStore("users"),a=void 0;a="string"==typeof i?i:i.phoneNumber,t.get(a).onsuccess=function(e){var t=e.target.result;return n(t||{displayName:"",mobile:a,photoURL:""})}})}function getSubscription(r,c){return new Promise(function(o){var e=firebase.auth().currentUser.uid,i=indexedDB.open(e);i.onsuccess=function(){var e=i.result.transaction(["subscriptions"]),t=e.objectStore("subscriptions").index("officeTemplate"),n=IDBKeyRange.only([r,c]),a=void 0;t.get(n).onsuccess=function(e){e.target.result&&"CANCELLED"!==e.target.result.status&&(a=e.target.result)},e.oncomplete=function(){return o(a)}}})}