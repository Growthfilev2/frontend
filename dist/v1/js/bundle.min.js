function getCellularInformation(){var e=void 0,t=AndroidInterface.getMobileCountryCode(),n=AndroidInterface.getMobileNetworkCode(),a=AndroidInterface.getRadioType(),o=AndroidInterface.getCarrier(),i=AndroidInterface.getWifiAccessPoints();try{e=AndroidInterface.getCellTowerInformation()}catch(e){console.log(e)}var r=[],c=[];i&&(r=parseQuery(i)),e&&(c=removeNegativeCellIds(parseQuery(e)));var s={};return t&&(s.homeMobileCountryCode=Number(t)),n&&(s.homeMobileNetworkCode=Number(n)),o&&(s.carrier=o),a&&(s.radioType=a),r.length&&(s.wifiAccessPoints=r),c.length&&(s.cellTowers=c),r.length&&c.length?s.considerIp=!1:s.considerIp=!0,JSON.stringify(s)}function removeNegativeCellIds(e){return e.filter(function(e){return 0<=e.cellId})}function parseQuery(e){var n=[];return e.split(",").forEach(function(e){var t=new URLSearchParams(e);n.push(queryPatramsToObject(t))}),n}function queryPatramsToObject(e){var n={};return e.forEach(function(e,t){n[t]="macAddress"===t?e:Number(e)}),n}function createElement(e,t){var n=document.createElement(e);return Object.keys(t).forEach(function(e){n[e]=t[e]}),n}function Dialog(e,t){this.title=e,this.content=t}function tabBar(e){var t=createElement("div",{className:"mdc-tab-bar"});t.setAttribute("role","tablist");var n=createElement("div",{className:"mdc-tab-scroller"}),a=createElement("div",{className:"mdc-tab-scroller__scroll-area"}),c=createElement("div",{className:"mdc-tab-scroller__scroll-content"});return e.forEach(function(e,t){var n=createElement("button",{className:"mdc-tab mdc-tab--active"});n.setAttribute("role","tab");var a=createElement("span",{className:"mdc-tab-indicator"});a.appendChild(createElement("span",{className:"mdc-tab-indicator__content mdc-tab-indicator__content--underline"})),t||(n.setAttribute("aria-selected","true"),n.setAttribute("tabindex","0"),a.classList.add("mdc-tab-indicator--active"));var o=createElement("div",{className:"mdc-tab__content"}),i=createElement("span",{className:"mdc-tab__text-label",textContent:e});o.appendChild(i);var r=createElement("span",{className:"mdc-tab__ripple"});n.appendChild(o),n.appendChild(a),n.appendChild(r),c.appendChild(n)}),a.appendChild(c),n.appendChild(a),t.appendChild(n),new mdc.tabBar.MDCTabBar(t)}function InputField(){}function textAreaField(e){var t=createElement("textarea",{className:"text-area-basic mdc-text-field__input",rows:e.rows});return t.value=e.value,e.readonly||t.setAttribute("readonly","true"),t}function selectMenu(e){for(var t=createElement("div",{className:"mdc-select"}),n=createElement("i",{className:"mdc-select__dropdown-icon"}),a=createElement("select",{className:"mdc-select__native-control"}),o=0;o<e.data.length;o++)a.appendChild(createElement("option",{textContent:e.data[o],value:e.data[o],selected:e.data[o]===e.selected}));var i=createElement("label",{className:"mdc-floating-label",textContent:e.labelText});t.appendChild(n),t.appendChild(a),t.appendChild(i);var r=new InputField;return t.appendChild(r.ripple()),new mdc.select.MDCSelect(t)}function notchedOultine(){var e=createElement("div",{className:"mdc-notched-outline"}),t=createElement("div",{className:"mdc-notched-outline__leading"}),n=createElement("div",{className:"mdc-notched-outline__trailing"});return e.appendChild(t),e.appendChild(n),e}function Button(e){this.name=e;var t=createElement("button",{className:"mdc-button"});t.appendChild(createElement("span",{className:"mdc-button__label",textContent:this.name})),this.base=t}function iconButton(e){return this.base=createElement("button",{className:"mdc-icon-button "+e.className,id:e.id}),this.base.setAttribute("aria-label",e.label),this.base.setAttribute("aria-hidden","true"),this.base.setAttribute("aria-pressed","false"),this.base.appendChild(createElement("i",{className:"material-icons mdc-icon-button__icon mdc-icon-button__icon--on",textContent:e.initialState})),this.base.appendChild(createElement("i",{className:"material-icons mdc-icon-button__icon",textContent:e.finalState})),new mdc.iconButton.MDCIconButtonToggle(this.base)}function Fab(e){this.fabName=e;var t=createElement("button",{className:"mdc-fab"});this.span=createElement("span",{className:"mdc-fab__icon material-icons",textContent:this.fabName}),t.appendChild(this.span),this.base=t}function AppendMap(e){this.el=e,this.options={zoom:16,disableDefaultUI:!0},this.location=""}function radioList(e){var t=document.createElement("li");t.className="mdc-list-item",t.setAttribute("role","radio"),e.index||(t.setAttribute("tabindex","0"),t.setAttribute("aria-checked","true"));var n=createElement("span",{className:"mdc-list-item__graphic"});n.appendChild(createRadioInput(e));var a=createElement("label",{className:"mdc-list-item__text",textContent:e.labelText.charAt(0).toUpperCase()+e.labelText.slice(1)});return a.setAttribute("for","list-radio-item-"+e.index),t.appendChild(n),t.appendChild(a),t}function createRadioInput(e){var t=createElement("div",{className:"mdc-radio"}),n=createElement("input",{className:"mdc-radio__native-control"});n.setAttribute("name","listDemoRadioGroup"),n.type="radio",n.value=JSON.stringify(e.value),n.id="list-radio-item-"+e.index;var a=createElement("div",{className:"mdc-radio__background"}),o=createElement("div",{className:"mdc-radio__outer-circle"}),i=createElement("div",{className:"mdc-radio__inner-circle"});return a.appendChild(o),a.appendChild(i),t.appendChild(n),t.appendChild(a),t}function createCheckBox(e){console.log(e);var t=createElement("div",{className:"mdc-checkbox mdc-list-item__meta"}),n=createElement("input",{className:"mdc-checkbox__native-control",type:"checkbox",value:JSON.stringify(e.value)});n.setAttribute("tabindex","-1");var a=createElement("div",{className:"mdc-checkbox__background"});return a.innerHTML='<svg class="mdc-checkbox__checkmark"\n      viewBox="0 0 24 24">\n      <path class="mdc-checkbox__checkmark-path"\n      fill="none"\n      d="M1.73,12.91 8.1,19.28 22.79,4.59"/>\n      </svg>\n      <div class="mdc-checkbox__mixedmark"></div>',t.appendChild(n),t.appendChild(a),new mdc.checkbox.MDCCheckbox(t)}function chipSet(e,t){var n=createElement("div",{className:"mdc-chip-set"}),a=createElement("div",{className:"mdc-chip mdc-chip--selected"}),o=createElement("div",{className:"mdc-chip__text chip-text",textContent:e});if(a.appendChild(o),t){var i=createElement("i",{className:"material-icons mdc-chip__icon mdc-chip__icon--trailing",textContent:"cancel"});i.setAttribute("tabindex","0"),i.setAttribute("role","button"),a.appendChild(i)}return n.appendChild(a),n}function AppKeys(){this.mode="dev"}Dialog.prototype.create=function(){var e=createElement("div",{className:"mdc-dialog",role:"alertDialog"});e.setAttribute("aria-modal","true"),e.setAttribute("aria-labelledby","Title"),e.setAttribute("aria-describedby","content");var t=createElement("div",{className:"mdc-dialog__container"}),n=createElement("div",{className:"mdc-dialog__surface"}),a=createElement("h2",{className:"mdc-dialog__title",textContent:this.title}),o=createElement("div",{className:"mdc-dialog__content"});this.content instanceof HTMLElement?o.appendChild(this.content):o.textContent=this.content;var i=createElement("footer",{className:"mdc-dialog__actions"}),r=createElement("button",{className:"mdc-button mdc-dialog__button",type:"button",textContent:"cancel"});r.setAttribute("data-mdc-dialog-action","close");var c=createElement("button",{className:"mdc-button mdc-dialog__button",type:"button",textContent:"okay"});c.setAttribute("data-mdc-dialog-action","accept"),i.appendChild(r),i.appendChild(c),n.appendChild(a),n.appendChild(o),n.appendChild(i),t.appendChild(n),e.appendChild(t),e.appendChild(createElement("div",{className:"mdc-dialog__scrim"}));var s=document.getElementById("dialog-container");return s.innerHTML="",s.appendChild(e),new mdc.dialog.MDCDialog(e)},InputField.prototype.base=function(){return createElement("div",{className:"mdc-text-field filled-background  mdc-text-field--fullwidth"})},InputField.prototype.input=function(){return createElement("input",{className:"mdc-text-field__input"})},InputField.prototype.ripple=function(){return createElement("div",{className:"mdc-line-ripple"})},InputField.prototype.label=function(e){return createElement("label",{className:"mdc-floating-label",textContent:e})},InputField.prototype.withoutLabel=function(){var e=this.base(),t=this.input();return e.appendChild(t),e.appendChild(this.ripple()),new mdc.textField.MDCTextField(e)},InputField.prototype.withLabel=function(e){var t=this.base(),n=this.input();return t.appendChild(n),t.appendChild(this.label(e)),t.appendChild(this.ripple()),new mdc.textField.MDCTextField(t)},InputField.prototype.withLeadingIcon=function(e,t){var n=this.base();n.classList.remove("data--value-list","mdc-text-field--fullwidth"),n.classList.add("mdc-text-field--with-leading-icon");var a=createElement("i",{className:"material-icons mdc-text-field__icon",textContent:e});return n.appendChild(a),n.appendChild(this.input()),n.appendChild(this.label(t)),n.appendChild(this.ripple()),new mdc.textField.MDCTextField(n)},Button.prototype.getButton=function(){return console.log(this),new mdc.ripple.MDCRipple(this.base)},Button.prototype.disabled=function(e){this.base.disabled=e},Button.prototype.raised=function(){this.base.classList.add("mdc-button--raised")},Button.prototype.shaped=function(){this.base.classList.add("shaped")},Button.prototype.selectorButton=function(){this.base.classList.add("selector-send","selector-submit--button")},Fab.prototype=Object.create(new Button),Fab.prototype.extended=function(e){this.base.classList.add("mdc-fab--extended");var t=createElement("label",{className:"mdc-fab__label",textContent:e});return this.base.appendChild(t),this.getButton()},AppendMap.prototype.setLocation=function(e){this.options.center=e,this.location=e},AppendMap.prototype.setZoom=function(e){this.options.zoom=e},AppendMap.prototype.map=function(){return new google.maps.Map(this.el,this.options)},AppendMap.prototype.withCustomControl=function(){var e=document.createElement("div");new MapsCustomControl(e,map,this.location.lat,this.location.lng);e.index=1,map.controls[google.maps.ControlPosition.TOP_LEFT].push(e)},AppendMap.prototype.getMarker=function(t){var n={position:this.location,map:this.map()};return t&&Object.keys(t).forEach(function(e){n[e]=t[e]}),this.el.style.height="400px",new google.maps.Marker(n)},AppendMap.prototype.geocodeCustomerMarker=function(n){return new Promise(function(e,t){google.maps.event.addListener(n,"dragend",function(){geocodePosition(n.getPosition(),data).then(function(e){e.customerRecord?addressField.value=e.customerRecord.venue[0].address:addressField.value=e.venue[0].address}).catch(function(e){handleError({message:"geocode Error in autocomplete listener for"+data.template,body:JSON.stringify(e)}),locationErrorText.textContent="Failed to detect your current Location. Search For A new Location or choose existing"})})})},AppKeys.prototype.getMode=function(){return this.mode},AppKeys.prototype.getMapKey=function(){return"production"===this.mode?"AIzaSyA4s7gp7SFid_by1vLVZDmcKbkEcsStBAo":"AIzaSyCadBqkHUJwdcgKT11rp_XWkbQLFAy80JQ"},AppKeys.prototype.getKeys=function(){return"production"===this.mode?{apiKey:this.getMapKey(),authDomain:"growthfile-207204.firebaseapp.com",databaseURL:"https://growthfile-207204.firebaseio.com",projectId:"growthfile-207204",storageBucket:"growthfile-207204.appspot.com",messagingSenderId:"701025551237"}:{apiKey:this.getMapKey(),authDomain:"growthfilev2-0.firebaseapp.com",projectId:"growthfilev2-0",messagingSenderId:"1011478688238"}},AppKeys.prototype.getBaseUrl=function(){return"production"===this.mode?"https://api2.growthfile.com/api/":"https://us-central1-growthfilev2-0.cloudfunctions.net/api/"};var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function conversation(e,t){document.body.classList.remove("mdc-dialog-scroll-lock"),window.removeEventListener("scroll",handleScroll,!1),checkIfRecordExists("activity",e).then(function(e){e?(t&&history.pushState(["conversation",e],null,null),fetchAddendumForComment(e)):(resetScroll(),listView())}).catch(handleError)}function checkIfRecordExists(o,i){return new Promise(function(n,e){var t=firebase.auth().currentUser,a=window.indexedDB.open(t.uid);a.onsuccess=function(){a.result.transaction(o).objectStore(o).get(i).onsuccess=function(e){var t=e.target.result;n(!!t&&i)}},a.onerror=function(){e({message:a.error.message+" from checkIfRecordExists"})}})}function fetchAddendumForComment(a){if(a){var o=firebase.auth().currentUser,i=window.indexedDB.open(o.uid);i.onsuccess=function(){var n=i.result,e=n.transaction(["addendum"],"readonly"),t=e.objectStore("addendum").index("activityId");createHeaderContent(n,a),commentPanel(a),statusChange(n,a),reinitCount(n,a),t.openCursor(a).onsuccess=function(e){var t=e.target.result;t&&(document.getElementById(t.value.addendumId)||createComment(n,t.value,o).then(function(e){document.getElementById("chat-container")&&document.getElementById("chat-container").appendChild(e)}),t.continue())},e.oncomplete=function(){document.querySelector(".activity--chat-card-container")&&(document.querySelector(".activity--chat-card-container").scrollTop=document.querySelector(".activity--chat-card-container").scrollHeight)}}}}function commentPanel(t){if(!document.querySelector(".activity--chat-card-container")){var e=document.createElement("div");e.className="activity--chat-card-container panel-card";var n=document.createElement("div");n.id="chat-container",n.className="mdc-card reverser-parent";var a=document.createElement("div");a.className="user-comment--container";var o=document.createElement("div");o.className="status--change-cont";var i=document.createElement("div");i.className="comment--container";var r=document.createElement("div");r.className="input--text-padding mdc-text-field mdc-text-field--dense",r.id="write--comment",r.style.width="100%",r.style.backgroundColor="white";var c=document.createElement("input");c.className="comment-field mdc-elevation--z4",c.type="text",r.appendChild(c),i.appendChild(r);var s=document.createElement("button");s.classList.add("mdc-fab","mdc-fab--mini","hidden"),s.id="send-chat--input";var d=document.createElement("span");d.classList.add("mdc-fac__icon","material-icons"),d.textContent="send",s.appendChild(d),i.appendChild(s),e.appendChild(n),a.appendChild(i),document.getElementById("app-current-panel").innerHTML=e.outerHTML+o.outerHTML+a.outerHTML,document.querySelector(".comment-field").oninput=function(e){toggleCommentButton(e.target.value&&e.target.value.replace(/\s/g,"").length)},document.getElementById("send-chat--input").onclick=function(){if(isLocationStatusWorking()){var e=document.querySelector(".comment-field").value;requestCreator("comment",{activityId:t,comment:e}),document.querySelector(".comment-field").value="",toggleCommentButton(!1)}}}}function toggleCommentButton(e){var t=document.getElementById("send-chat--input"),n=document.getElementById("write--comment"),a=document.querySelector(".status--change-cont");a.style.opacity=e?(t.classList.remove("hidden"),n.style.width="80%","0"):(t.classList.add("hidden"),n.style.width="100%",n.style.transition="0.3s ease",a.style.transition="0.3s ease","1")}function statusChange(e,t){var d=document.createElement("label");d.setAttribute("for","toggle-status"),d.textContent="Done",e.transaction("activity").objectStore("activity").get(t).onsuccess=function(e){var t=document.querySelector(".status--change-cont"),n=e.target.result;if(!n.canEdit||"CANCELLED"===n.status){var a=document.createElement("span"),o=e.target.result;return a.textContent="Activity "+o.status.toLowerCase(),void(t&&(t.innerHTML=a.outerHTML,t.style.textAlign="center"))}if(0!=n.editable){if(!document.querySelector(".status-check")){var i=document.createElement("div");i.className="mdc-form-field form-field-status";var r=document.createElement("div");r.className="mdc-checkbox status-check";var c=document.createElement("input");c.className="mdc-checkbox__native-control",c.id="toggle-status",c.type="checkbox";var s=document.createElement("div");s.className="mdc-checkbox__background";document.createElement("div").className="mdc-checkbox__mixedmark",s.innerHTML='<svg class="mdc-checkbox__checkmark"\n      viewBox="0 0 24 24">\n      <path class="mdc-checkbox__checkmark-path"\n      fill="none"\n      d="M1.73,12.91 8.1,19.28 22.79,4.59"/>\n      </svg>\n      <div class="mdc-checkbox__mixedmark"></div>',r.appendChild(c),r.appendChild(s),i.appendChild(r),t&&(t.innerHTML=i.outerHTML+d.outerHTML)}document.querySelector(".mdc-checkbox")&&(switchControl=new mdc.checkbox.MDCCheckbox.attachTo(document.querySelector(".mdc-checkbox")),"CONFIRMED"===n.status&&(switchControl.checked=!0),document.querySelector(".mdc-checkbox").onclick=function(){isLocationStatusWorking()?changeStatusRequest(switchControl,n):"CONFIRMED"===n.status?switchControl.checked=!0:switchControl.checked=!1})}else t&&(t.innerHTML=d.outerHTML+loader("status-loader").outerHTML)}}function changeStatusRequest(e,t){document.querySelector(".form-field-status").classList.add("hidden"),document.querySelector(".status--change-cont").appendChild(loader("status-loader")),e.checked?requestCreator("statusChange",{activityId:t.activityId,status:"CONFIRMED"}):requestCreator("statusChange",{activityId:t.activityId,status:"PENDING"})}function createComment(e,u,t){var m=!1;return new Promise(function(c){var s=document.createElement("div");s.classList.add("comment-box","talk-bubble","tri-right","round","btm-left"),t.phoneNumber===u.user?s.classList.add("current-user--comment","secondary-color-light"):s.classList.add("other-user--comment","mdc-theme--primary-bg"),s.id=u.addendumId;var d=document.createElement("div");d.classList.add("talktext");var l=document.createElement("p");l.classList.add("user-name--comment","mdc-typography--subtitle2"),getUserRecord(e,u.user).then(function(e){e.displayName?l.textContent=e.displayName:l.textContent=e.mobile;var t=document.createElement("p");t.classList.add("comment","mdc-typography--subtitle2"),t.textContent=u.comment;var n=document.createElement("span");n.className="comment--info";var a=document.createElement("span");a.textContent=moment(u.timestamp).format("DD-MM-YY H:mm"),a.classList.add("comment-date","mdc-typography--caption");var o=document.createElement("div"),i=document.createElement("i");i.classList.add("user-map--span","material-icons"),i.appendChild(document.createTextNode("location_on")),i.dataset.latitude=u.location._latitude,i.dataset.longitude=u.location._longitude,o.appendChild(i);var r=document.createElement("div");r.className="map-convo",o.onclick=function(e){if(hasMapsApiLoaded()){m=!m;var t={lat:u.location._latitude,lng:u.location._longitude},n=new AppendMap(r);n.setLocation(t),n.setZoom(18),n.getMarker(),i.textContent=m?(r.style.height="200px","arrow_drop_down"):(r.style.height="0px","location_on")}},n.appendChild(a),n.appendChild(o),d.appendChild(l),d.appendChild(t),d.appendChild(n),s.appendChild(d),s.appendChild(r),c(s)})})}function getUserRecord(o,i){return new Promise(function(n,e){var t=o.transaction("users").objectStore("users"),a=void 0;a="string"==typeof i?i:i.phoneNumber,t.get(a).onsuccess=function(e){var t=e.target.result;return n(t||{displayName:"",mobile:a,photoURL:""})}})}function hasMapsApiLoaded(){try{return"object"===("undefined"==typeof google?"undefined":_typeof(google))&&"object"===_typeof(google.maps)}catch(e){return!1}}function MapsCustomControl(e,t,n){var a=document.createElement("div");a.style.backgroundColor="#fff",a.style.border="2px solid #fff",a.style.borderRadius="3px",a.style.boxShadow="0 2px 6px rgba(0,0,0,.3)",a.style.cursor="pointer",a.style.marginBottom="22px",a.style.textAlign="center",a.style.padding="0px 5px 0px 5px",e.appendChild(a);var o=document.createElement("a");o.href="https://www.google.com/maps?q="+t+","+n,o.className="material-icons",o.style.color="rgb(25,25,25)",o.style.fontSize="16px",o.style.lineHeight="38px",o.style.paddingLeft="5px",o.style.paddingRight="5px",o.style.textDecoration="none",o.innerHTML="open_in_new",a.appendChild(o)}function createHeaderContent(t,e){var c=document.getElementById("section-start");c.innerHTML="";var n=t.transaction("activity").objectStore("activity"),s=headerBackIcon();n.get(e).onsuccess=function(e){var r=e.target.result;getUserRecord(t,r.creator).then(function(e){var t=document.createElement("object");t.data=e.photoURL||"./img/empty-user.jpg",t.className="header--icon-creator",t.type="image/jpeg";var n=document.createElement("img");n.src="./img/empty-user.jpg",n.className="header--icon-creator",t.appendChild(n);var a=document.createElement("div");a.className="mdc-top-app-bar__title mdc-typography--subtitle2";var o=document.createElement("span");o.textContent=r.activityName,o.className="",a.onclick=function(){checkIfRecordExists("activity",r.activityId).then(function(e){e?updateCreateActivity(r):(resetScroll(),listView())}).catch(handleError)};var i=document.createElement("span");i.textContent="Click here to see details",c.appendChild(s),c.appendChild(t),a.appendChild(o),a.appendChild(document.createElement("br")),a.appendChild(i),c.appendChild(a)})}}function reinitCount(e,t){var n=e.transaction(["list"],"readwrite"),a=n.objectStore("list");a.get(t).onsuccess=function(e){var t=e.target.result;t&&(t.count=0,a.put(t))},n.oncomplete=function(){}}function noSelectorResult(e){var t=document.createElement("div");t.className="data-not-found";var n=document.createElement("p");return n.className="mdc-typography--headline5",n.textContent=e,t.appendChild(n),t}function checkMapStoreForNearByLocation(c,s){return new Promise(function(o,i){var r=indexedDB.open(firebase.auth().currentUser.uid);r.onsuccess=function(){var a=[],e=r.result.transaction(["map"]),t=e.objectStore("map").index("byOffice"),n=IDBKeyRange.bound([c,""],[c,"￿"]);t.openCursor(n).onsuccess=function(e){var t=e.target.result;t&&(t.value.location&&t.value.latitude&&t.value.longitude&&isLocationLessThanThreshold(calculateDistanceBetweenTwoPoints(t.value,s))&&a.push(t.value),t.continue())},e.oncomplete=function(){var t={};a.forEach(function(e){t[e.location]=e});var n=[];Object.keys(t).forEach(function(e){n.push(t[e])});var e=n.sort(function(e,t){return e.accuracy-t.accuracy});o(e)},e.onerror=function(){i(e.error)}}})}function createTempRecord(n,r,c){var e=firebase.auth().currentUser.uid,a=indexedDB.open(e);a.onsuccess=function(){var e=a.result.transaction(["subscriptions"]).objectStore("subscriptions").index("officeTemplate"),t=IDBKeyRange.only([n,r]);e.get(t).onsuccess=function(e){var a=e.target.result;if(a){var n=void 0;c.schedule?n=c.schedule:(n=[],a.schedule.forEach(function(e){var t={};t.name=e,t.startTime="",t.endTime="",n.push(t)})),c.attachment&&Object.keys(c.attachment).forEach(function(e){a.attachment[e]=c.attachment[e]});var o={office:a.office,template:a.template,venue:"",schedule:n,attachment:a.attachment,timestamp:Date.now(),canEdit:!0,assignees:[],activityName:a.template.toUpperCase(),create:!0},i=[];"check-in"!==r?(a.venue.forEach(function(e){var t={};t.venueDescriptor=e,t.location="",t.address="",t.geopoint={_latitude:"",_longitude:""},i.push(t)}),o.venue=i,"tour plan"!==r&&"dsr"!==r&&"duty roster"!==r&&"customer"!==r?updateCreateActivity(o):"Android"===native.getName()?getLocation().then(function(e){geocodePosition({lat:e.latitude,lng:e.longitude}).then(function(e){return createBlendedCustomerRecord(o,e)})}).catch(function(e){return console.log(e),createBlendedCustomerRecord(o)}):window.addEventListener("iosLocation",function e(t){geocodePosition({lat:t.detail.latitude,lng:t.detail.longitude}).then(function(e){return createBlendedCustomerRecord(o,e)}),window.removeEventListener("iosLocation",e,!0)},!0)):getRootRecord().then(function(e){var t={};t.venueDescriptor=a.venue[0],t.location="",t.address="",t.geopoint={_latitude:"",_longitude:""},o.venue=[t];var n=isLastLocationOlderThanThreshold(e.location.lastLocationTime,5);if(e.location&&!n)return updateCreateActivity(o);document.getElementById("start-loader").classList.remove("hidden"),"Ios"!==native.getName()?manageLocation().then(function(e){document.getElementById("start-loader").classList.add("hidden"),updateCreateActivity(o)}).catch(function(t){document.getElementById("start-loader").classList.add("hidden");var e=new Dialog("Location Error","There was a problem in detecting your location. Please try again later").create();e.open(),e.listen("MDCDialog:closed",function(e){resetScroll(),listView(),handleError(t)})}):window.addEventListener("iosLocation",function e(t){document.getElementById("start-loader").classList.add("hidden"),updateCreateActivity(o),window.removeEventListener("iosLocation",e,!0)},!0)})}}}}function createBlendedCustomerRecord(t,n){if("customer"===t.template){var e=[createVenueObjectWithGeoCode(t.venue[0].venueDescriptor,n)];return t.venue=e,updateCreateActivity(t)}getSubscription(t.office,"customer").then(function(e){if(!e)return t.customerRecord=!1,updateCreateActivity(t);e.venue=[createVenueObjectWithGeoCode(e.venue[0],n)],t.customerRecord=e,updateCreateActivity(t)})}function hasAnyValueInChildren(o,i,r){var e=firebase.auth().currentUser.uid,c=indexedDB.open(e),s=[];return new Promise(function(a){c.onsuccess=function(){var e=c.result.transaction(["children"]),t=e.objectStore("children").index("templateStatus"),n=IDBKeyRange.bound([i,"CONFIRMED"],[i,"PENDING"]);t.openCursor(n).onsuccess=function(e){var t=e.target.result;t&&(t.value.office===o&&(r&&"customer"===i?t.value.attachment.Name.value===r&&s.push(t.value):s.push(t.value)),t.continue())},e.oncomplete=function(){a(s)}}})}function convertKeyToId(e){return e.replace(/-/g,"--").replace(/\s/g,"-")}function convertIdToKey(e){return e.replace(/-/g," ").replace("  ","-")}function updateCreateContainer(e,t){document.body.style.backgroundColor="#eeeeee",document.body.classList.remove("mdc-dialog-scroll-lock");var n=document.createElement("span");n.textContent=e.activityName,n.className="mdc-top-app-bar__title";var a=headerBackIcon(),o=document.getElementById("section-start");o.innerHTML="",o.appendChild(a),o.appendChild(n);var i=document.createElement("div");i.className="update-create--activity";for(var r=["office","venue","schedule","attachment","assignees"],c=0;c<5;c++){var s=document.createElement("ul");s.className="mdc-list custom--list-margin";var d=document.createElement("div");switch(r[c]){case"office":s.classList.remove("custom--list-margin");break;case"schedule":d.className="mdc-list-group__subheader",d.id="schedule--group";break;case"venue":case"assignees":s.classList.add("mdc-list--two-line","mdc-list--avatar-list")}"schedule"===r[c]?i.appendChild(d):(s.id=r[c]+"--list",i.appendChild(s))}if(e.canEdit){var l=document.createElement("button");l.setAttribute("aria-label","Send"),e.create?l.className="":t||(l.className="hidden"),l.id="send-activity",l.textContent="SUBMIT",i.appendChild(l)}return i}function updateCreateActivity(a,o){document.querySelector(".mdc-linear-progress")&&document.querySelector(".mdc-linear-progress").remove(),"updateCreateActivity"===history.state[0]?history.replaceState(["updateCreateActivity",a],null,null):history.pushState(["updateCreateActivity",a],null,null),console.log(a);var e=firebase.auth().currentUser.uid,i=indexedDB.open(e);i.onsuccess=function(){var e=i.result;document.getElementById("app-current-panel").innerHTML=updateCreateContainer(a,o).outerHTML,document.getElementById("office--list").appendChild(createSimpleLi("Office",{office:a.office,showLabel:!0})),createVenueSection(a),createScheduleTable(a),createAttachmentContainer(a),createAssigneeList(a,e),createActivityCancellation(a),window.scrollTo(0,0),document.getElementById("send-activity")&&document.getElementById("send-activity").addEventListener("click",function(){isLocationStatusWorking()&&(this.dataset.progress=!0,insertInputsIntoActivity(a,!0))});for(var t=document.querySelectorAll(".update-create--activity input"),n=0;n<t.length;n++)t[n].addEventListener("input",function(e){document.getElementById("send-activity").dataset.progress||document.getElementById("send-activity").classList.contains("hidden")&&document.getElementById("send-activity").classList.remove("hidden")})}}function createSimpleLi(e,t){var n=document.createElement("li");n.className="mdc-list-item mdc-ripple-upgraded";var a=document.createElement("span");a.className="detail--static-text";document.createElement("span");var o=document.createElement("span");if("Office"===e&&(o.className="data--value-list",o.textContent=t.office,a.textContent=e,n.appendChild(a),n.appendChild(o)),"delete"===e&&(o.className="mdc-list-item__graphic material-icons",o.textContent=e,a.classList.remove("detail--static-text"),a.classList.add("delete-activity"),a.textContent=t.text,n.appendChild(o),n.appendChild(a)),"empty"===e&&(n.dataset.prop="delete"),"undo-deleted"===e){o.className="mdc-list-item__graphic material-icons",o.textContent="delete",a.classList.remove("detail--static-text"),a.classList.add("delete-activity"),a.textContent=t.text,n.appendChild(o),n.appendChild(a),n.classList.add("undo-delete-activity");var i=document.createElement("button");i.style.color="white",i.className="mdc-button mdc-ripple-upgraded mdc-list-item__meta undo-deleted",i.textContent="Undo",i.onclick=function(){isLocationStatusWorking()&&(document.querySelector(".undo-deleted").style.display="none",n.appendChild(loader("undo-delete-loader")),requestCreator("statusChange",{activityId:t.id,status:"PENDING"}))},n.appendChild(i)}return n}function createVenueSection(i){if("customer"!==i.template&&0!==i.venue.length){var r=document.getElementById("venue--list");"check-in"!==i.template?i.venue.forEach(function(e){r.appendChild(createVenueLi(e,!0,i));var t=document.createElement("div");t.className="map-detail "+convertKeyToId(e.venueDescriptor),r.appendChild(t)}):i.hasOwnProperty("create")?getRootRecord().then(function(e){checkMapStoreForNearByLocation(i.office,e.location).then(function(e){if(e.length){r.className="mdc-list",r.setAttribute("role","radiogroup");var t=document.createElement("div");t.textContent=i.venue[0].venueDescriptor,t.style.paddingRight="11px";var n=document.createElement("span");uncheck.id="uncheck-checkin",uncheck.className="mdc-fab add--assignee-icon";var a=document.createElement("span");a.className="mdc-fab__icon material-icons",a.textContent="clear",uncheck.appendChild(a),t.appendChild(n),e.forEach(function(e,t){var n=radioList({value:e,index:t,labelText:e.location});new mdc.ripple.MDCRipple.attachTo(n),r.appendChild(n)}),new mdc.list.MDCList(r).singleSelection=!0;var o=document.getElementById("uncheck-checkin");o&&o.addEventListener("click",function(){})}})}):i.venue.forEach(function(e){if(e.location&&e.address){r.appendChild(createVenueLi(e,!0,i));var t=document.createElement("div");t.className="map-detail "+convertKeyToId(e.venueDescriptor),r.appendChild(t)}})}}function createVenueLi(o,e,t,n){var i=!1,a=document.createElement("li");a.className="mdc-list-item mdc-ripple-upgraded",a.id=convertKeyToId(o.venueDescriptor);var r=document.createElement("div");r.className="mdc-list-item__text link--span";var c=document.createElement("span");c.className="mdc-list-item__primary-text";var s=document.createElement("span");s.className="mdc-list-item__meta";var d=new Fab("add_location").getButton();if(d.root_.classList.add("add--assignee-icon","attachment-selector-label"),e){var l=document.createElement("span");l.className="detail--static-text",l.textContent=o.venueDescriptor;var u=document.createElement("span");u.className="data--value-list",u.textContent=o.location,u.dataset.primary="",c.appendChild(l),c.appendChild(u),r.appendChild(c),r.onclick=function(e){if(hasMapsApiLoaded()&&o.geopoint._latitude&&o.geopoint._longitude){i=!i;var t={lat:o.geopoint._latitude,lng:o.geopoint._longitude},n=document.querySelector(".map-detail."+convertKeyToId(o.venueDescriptor)),a=new AppendMap(n);a.setZoom(18),a.setLocation(t),a.getMarker(),n.style.height=i?"200px":"0px"}},t.canEdit&&(s.setAttribute("aria-hidden","true"),s.appendChild(d.root_),d.root_.onclick=function(e){insertInputsIntoActivity(t),history.replaceState(["updateCreateActivity",t],null,null),selectorUI({record:t,store:"map",key:o.venueDescriptor})})}else c.textContent=o.location,r.appendChild(c);var m=document.createElement("span");m.className="mdc-list-item__meta material-icons",n&&(m.appendChild(createRadioInput()),a.onclick=function(){checkRadioInput(this,{location:o.location,address:o.address,geopoint:{_latitude:o.latitude,_longitude:o.longitude},venueDesc:o.venueDescriptor})});var p=document.createElement("span");return p.className="mdc-list-item__secondary-text",p.textContent=o.address,p.dataset.secondary="",r.appendChild(p),a.appendChild(r),n?a.appendChild(m):a.appendChild(s),a}function createScheduleTable(v){v.schedule.length||(document.getElementById("schedule--group").style.display="none");var g=0;v.schedule.forEach(function(e){g++;var t=document.createElement("h5");t.className="mdc-list-group__subheader label--text",t.textContent=e.name;var n=document.createElement("ul");n.className="mdc-list mdc-list--dense";var a=document.createElement("li");a.className="mdc-list-divider",a.setAttribute("role","separator");var o=document.createElement("li");o.className="mdc-list-item schedule-start-li";var i=document.createElement("div");i.className="mdc-text-field start--date"+g;var r=document.createElement("input");r.value=moment(e.startTime||new Date).format("YYYY-MM-DD"),r.type="date",r.disabled=!v.canEdit,r.className="mdc-text-field__input",i.appendChild(r);var c=document.createElement("span");c.className="mdc-list-item__meta";var s=document.createElement("div");s.className="mdc-text-field start--time"+g;var d=document.createElement("input");e.startTime?d.value=moment(e.startTime).format("HH:mm"):d.value=moment("24","HH:mm").format("HH:mm"),d.type="time",d.className="time--input",d.disabled=!v.canEdit,d.className="mdc-text-field__input",s.appendChild(d),c.appendChild(s);var l=document.createElement("li");l.className="mdc-list-item schedule-end-li";var u=document.createElement("div");u.className="mdc-text-field end--date"+g;var m=document.createElement("input");m.value=moment(e.endTime||moment().add(1,"days")).format("YYYY-MM-DD"),m.type="date",m.disabled=!v.canEdit,m.className="mdc-text-field__input",u.appendChild(m),"leave"===v.template&&(r.onchange=function(e){var t=document.getElementById("Number-Of-Days");if(t){var n=moment(m.value).diff(moment(r.value),"days")+1;0<=n&&(t.querySelector("input").value=n)}},m.onchange=function(e){var t=document.getElementById("Number-Of-Days");if(t){var n=moment(m.value).diff(moment(r.value),"days")+1;0<=n&&(t.querySelector("input").value=n)}});var p=document.createElement("span");p.className="mdc-list-item__meta";var h=document.createElement("div");h.className="mdc-text-field end--time"+g;var f=document.createElement("input");e.endTime?f.value=moment(e.endTime||new Date).format("HH:mm"):f.value=moment("24","HH:mm").format("HH:mm"),f.type="time",f.disabled=!v.canEdit,f.className="mdc-text-field__input",h.appendChild(f),p.appendChild(h),o.appendChild(i),o.appendChild(c),l.appendChild(u),l.appendChild(p),n.appendChild(o),n.appendChild(a),n.appendChild(l),document.getElementById("schedule--group").appendChild(t),document.getElementById("schedule--group").appendChild(n)})}function createAttachmentContainer(y){["Name","Number","Template","email","phoneNumber","HHMM","weekday","number","base64","string"].forEach(function(e){var t=document.createElement("div");t.className=e+"--group",document.getElementById("attachment--list").appendChild(t)});var b={phoneNumber:"",weekday:"","HH:MM":"",string:"",base64:"",number:"",email:""};Object.keys(y.attachment).forEach(function(n){var a=document.createElement("div");"HH:MM"===y.attachment[n].type?a.className="attachment-field HHMM":a.className="attachment-field  "+y.attachment[n].type,a.id=convertKeyToId(n),y.canEdit&&a.classList.add("editable--true");var e=createElement("label",{className:"label--text",textContent:n});if("string"===y.attachment[n].type)if("Name"===n||"Number"===n)if("customer"!==y.template){a.appendChild(e);var t=(new InputField).withoutLabel();t.root_.id=n,t.disabled=!y.canEdit,t.value=y.attachment[n].value,t.input_.required=!0,t.input_.placeholder="Enter Value",t.input_.oninput=function(e){y.attachment[n].value=e.target.value},a.appendChild(t.root_)}else{a.appendChild(e);var o=addNewCustomer(y);o.style.marginTop="0px",a.appendChild(o)}else{a.appendChild(e);var i=textAreaField({value:y.attachment[n].value,readonly:y.canEdit,rows:2});i.oninput=function(e){y.attachment[n].value=e.target.value,document.getElementById("send-activity").dataset.progress||document.getElementById("send-activity").classList.remove("hidden")},a.appendChild(i)}if("number"===y.attachment[n].type){if(a.appendChild(e),console.log(y),"Number Of Days"===n){var r=document.querySelector("#schedule--group .start--date1 input"),c=document.querySelector("#schedule--group .end--date1 input");y.attachment[n].value=moment(c.value).diff(r.value,"days")+1,console.log(moment(c.value).diff(r.value,"days")+1)}var s=(new InputField).withoutLabel();s.input_.type="number",s.value=y.attachment[n].value,y.canEdit?s.input_.oninput=function(e){y.attachment[n].value=Number(e.target.value)}:s.disabled=!0,a.appendChild(s.root_)}if("email"===y.attachment[n].type){a.appendChild(e);var d=(new InputField).withoutLabel();d.value=y.attachment[n].value,canEdit?d.input_.oninput=function(e){y.attachment[n].value=e.target.value}:d.disabled=!0,d.input_.type="email",a.appendChild(d.root_)}if("phoneNumber"===y.attachment[n].type){if(a.appendChild(e),a.classList.add("selector--margin","mdc-form-field"),y.attachment[n].value){a.style.padding="5px 15px 5px 15px";var l=new mdc.chips.MDCChip(chipSet(y.attachment[n].value,y.canEdit));l.listen("MDCChip:removal",function(e){y.attachment[n].value="",document.querySelector("#send-activity")&&document.querySelector("#send-activity").classList.remove("hidden")}),l.root_.classList.add("label--text"),l.root_.dataset.primary="",a.appendChild(l.root_)}if(y.canEdit){var u=new Fab("person_add").getButton();u.root_.classList.add("add--assignee-icon","attachment-selector-label"),a.appendChild(u.root_),u.root_.onclick=function(e){insertInputsIntoActivity(y),history.replaceState(["updateCreateActivity",y],null,null),selectorUI({record:y,store:"users",attachment:!0,key:n})}}}if("HH:MM"==y.attachment[n].type){a.appendChild(e);var m=(new InputField).withoutLabel();m.value=y.attachment[n].value||moment("24","HH:mm").format("HH:mm"),y.canEdit?m.input_.oninput=function(e){y.attachment[n].value=e.target.value}:m.disabled=!0,m.input_.type="time",a.appendChild(m.root_)}if("weekday"===y.attachment[n].type){var p=selectMenu({data:["sunday","tuesday","wednesday","thursday","friday","saturday","monday"],selected:y.attachment[n].value,labelText:n});console.log(p),y.canEdit?p.listen("change",function(e){document.getElementById("send-activity").dataset.progress||document.getElementById("send-activity").classList.remove("hidden"),y.attachment[n].value=e.target.value}):(p.root_.classList.add("mdc-select--disabled"),p.nativeControl_.setAttribute("disabled","true")),a.appendChild(p.root_)}if("base64"===y.attachment[n].type){var h=createElement("ul",{className:"image-preview--attachment mdc-image-list standard-image-list mdc-image-list--with-text-protection"});if(h.appendChild(setFilePath(y.attachment[n].value,n,!0)),y.canEdit){var f=new Fab("add_a_photo").getButton();f.root_.classList.add("attachment-selector-label","add--assignee-icon"),a.appendChild(f.root_),f.root_.onclick=function(){readCameraFile()}}a.appendChild(h)}if(!b.hasOwnProperty(y.attachment[n].type)){a.classList.add("mdc-form-field");a.appendChild(e);var v=document.createElement("span");if(y.attachment[n].value){var g=new mdc.chips.MDCChip(chipSet(y.attachment[n].value,y.canEdit));a.appendChild(g.root_),g.listen("MDCChip:removal",function(e){y.attachment[n].value="",document.querySelector("#send-activity")&&document.querySelector("#send-activity").classList.remove("hidden"),"Customer"===n&&y.hasOwnProperty("create")&&(y.customerRecord&&(getLocation().then(function(e){geocodePosition({lat:e.latitude,lng:e.longitude}).then(function(e){y.customerRecord.venue=[createVenueObjectWithGeoCode(y.customerRecord.venue[0].venueDescriptor,e)]})}).catch(function(e){y.customerRecord.venue=[createVenueObjectWithGeoCode(y.customerRecord.venue[0].venueDescriptor)]}),y.customerRecord.attachment.Name.value=""),g.root_.parentNode.replaceChild(addNewCustomerButton(y,a).root_,g.root_))})}else"Customer"===n&&y.hasOwnProperty("create")&&y.customerRecord&&a.appendChild(addNewCustomerButton(y,a).root_);hasAnyValueInChildren(y.office,y.attachment[n].type).then(function(t){if(t.length&&y.canEdit){var e=new Fab("add").getButton();e.root_.classList.add("mdc-typography--subtitle2","mdc-button--dense","add--assignee-icon","attachment-selector-label"),e.root_.id="customer-selection-btn",a.appendChild(e.root_),a.classList.add("selector--margin"),e.root_.onclick=function(e){v.dataset.primary="",insertInputsIntoActivity(y),history.replaceState(["updateCreateActivity",y],null,null),selectorUI({record:y,store:"children",key:n,results:t})}}})}"HH:MM"===y.attachment[n].type?document.querySelector(".HHMM--group").appendChild(a):"Name"===n?document.querySelector(".Name--group").appendChild(a):b.hasOwnProperty(y.attachment[n].type)?document.querySelector("."+y.attachment[n].type+"--group").appendChild(a):document.querySelector(".Template--group").appendChild(a)})}function addNewCustomerButton(e,t){var n=new Button("Create New");n.shaped(),n.raised();var a=n.getButton();a.root_.classList.add("create-new-customer-btn");var o=!1;return a.root_.onclick=function(){o=!o,this.style.marginRight=o?(showCustomerContainer(e,t),this.textContent="Cancel",this.style.float="right","0px"):(hideCustomerContainer(e,t,this),this.textContent="Create New","15px")},a}function showCustomerContainer(e,t){t.classList.remove("mdc-form-field"),e.customerRecord?t.appendChild(addNewCustomer(e.customerRecord,e)):t.appendChild(addNewCustomer(e)),t.querySelector("#customer-selection-btn")&&t.querySelector("#customer-selection-btn").classList.add("hidden")}function hideCustomerContainer(t,e){e.classList.add("mdc-form-field"),document.querySelector(".customer-form")&&document.querySelector(".customer-form").remove(),t.customerRecord&&(getLocation().then(function(e){geocodePosition({lat:e.latitude,lng:e.longitude}).then(function(e){t.customerRecord.venue=[createVenueObjectWithGeoCode(t.customerRecord.venue[0].venueDescriptor,e)]})}).catch(function(e){t.customerRecord.venue=[createVenueObjectWithGeoCode(t.customerRecord.venue[0].venueDescriptor)]}),t.customerRecord.attachment.Name.value=""),e.querySelector("#customer-selection-btn")&&e.querySelector("#customer-selection-btn").classList.remove("hidden")}function createAssigneeList(t,n){var a=document.getElementById("assignees--list"),e=createElement("li",{className:"mdc-list-item label--text add--assignee-loader",textContent:"Assignees"});if(t.canEdit){var o=createElement("span",{className:"mdc-list-item__meta"}),i=new Fab("person_add").getButton();i.root_.classList.add("add--assignee-icon"),i.root_.onclick=function(e){insertInputsIntoActivity(t),history.replaceState(["updateCreateActivity",t],null,null),selectorUI({record:t,store:"users"})},o.appendChild(i.root_),e.appendChild(o)}a.appendChild(e),t.assignees.forEach(function(e){getUserRecord(n,e).then(function(e){a.appendChild(createSimpleAssigneeLi(e))})})}function createSimpleAssigneeLi(e,t){var n=createElement("li",{className:"mdc-list-item"});if(!e)return n;var a=createElement("object",{className:"mdc-list-item__graphic",data:e.photoURL||"./img/empty-user.jpg",type:"image/jpeg"}),o=createElement("img",{className:"empty-user-assignee",src:"./img/empty-user.jpg"});a.appendChild(o);var i=createElement("span",{className:"mdc-list-item_text"}),r=createElement("span",{className:"mdc-list-item__primary-text"}),c=createElement("span",{className:"mdc-list-item__secondary-text"});return e.displayName?(r.textContent=e.displayName,c.textContent=e.mobile):r.textContent=e.mobile,i.appendChild(r),i.appendChild(c),n.appendChild(a),n.appendChild(i),t&&(n.setAttribute("role","checkbox"),n.appendChild(t.root_)),n}function checkRadioInput(e,t){document.getElementById("selector-submit-send").textContent="SELECT",[].concat(_toConsumableArray(document.querySelectorAll(".radio-selected"))).forEach(function(e){e.classList.remove("radio-selected")});var n=e;if(n){var a=new mdc.radio.MDCRadio(n.querySelector(".radio-control-selector"));a.root_.classList.add("radio-selected"),document.getElementById("selector-submit-send").dataset.type="",a.value=JSON.stringify(t)}}function setFilePath(e,t,n){if(document.querySelector(".image--list-li"))return document.getElementById("attachment-picture").data="data:image/jpg;base64,"+e,document.getElementById("attachment-picture").dataset.value="data:image/jpg;base64,"+e,void(document.getElementById("send-activity").dataset.progress||document.getElementById("send-activity").classList.remove("hidden"));var a=document.createElement("li");a.className="mdc-image-list__item image--list-li";var o=document.createElement("div"),i=document.createElement("object");i.data=e||"./img/placeholder.png",i.type="image/jpeg",i.id="attachment-picture",i.dataset.photoKey=t,i.className="profile-container--main mdc-image-list__image";var r=document.createElement("img");r.src="./img/placeholder.png",r.className="profile-container--main mdc-image-list__image",i.dataset.value=e?i.src=e:(i.data="./img/placeholder.png",""),i.appendChild(r),i.onclick=function(){new Dialog("Photo",i).create().open()},o.appendChild(i),a.appendChild(o);var c=document.createElement("div");c.className="mdc-image-list__supporting";var s=document.createElement("span");return s.textContent=t,s.className="mdc-image-list__label",s.id="label--image",c.appendChild(s),a.appendChild(c),n?a:void 0}function readCameraFile(){if("Android"===native.getName())try{AndroidInterface.startCamera()}catch(e){sendExceptionObject(e,"CATCH Type 11: AndroidInterface.startCamera at readCameraFile",[])}else webkit.messageHandlers.takeImageForAttachment.postMessage("convert image to base 64")}function createActivityCancellation(n){if(n.canEdit){var e=document.createElement("div");if(e.className="status--cancel-cont",!n.hasOwnProperty("create"))if("CANCELLED"!==n.status){if("CANCELLED"!==n.status){if(e.appendChild(createSimpleLi("delete",{text:"CANCEL"})),document.querySelector(".update-create--activity").appendChild(e),!n.canEdit)return;document.querySelector(".delete-activity").addEventListener("click",function(e){var t=new Dialog(n.activityName+" will be deleted","Are you sure you want to delete this activity ? ").create();t.open(),t.listen("MDCDialog:closed",function(e){"accept"===e.detail.action&&isLocationStatusWorking()&&(document.querySelector(".delete-activity").style.display="none",document.querySelector(".status--cancel-cont li").appendChild(loader("cancel-loader")),requestCreator("statusChange",{activityId:n.activityId,status:"CANCELLED"}))})})}}else{e.appendChild(createSimpleLi("undo-deleted",{text:"Cancelled",id:n.activityId})),document.querySelector(".update-create--activity").appendChild(e);new mdc.ripple.MDCRipple.attachTo(document.querySelector(".undo-deleted"))}}}function concatDateWithTime(e,t){var n=moment(e+" "+t);return moment(n).valueOf()}function insertInputsIntoActivity(e,t){for(var n=document.querySelectorAll(".image-preview--attachment  object"),a=0;a<n.length;a++)e.attachment[convertKeyToId(n[a].dataset.photoKey)].value=n[a].dataset.value;for(var o=void 0,i=void 0,r=void 0,c=void 0,s=1;s<e.schedule.length+1;s++)if(o=getInputText(".start--date"+s).value,i=getInputText(".start--time"+s).value,r=getInputText(".end--date"+s).value,c=getInputText(".end--time"+s).value,concatDateWithTime(o,i)||concatDateWithTime(r,c)){if(o&&!i)return void snacks("Please Select a Start Time");if(i&&!o)return void snacks("Please Select a Start Date");if(concatDateWithTime(o,i)&&!r)return void snacks("Please Select a End Date");if(concatDateWithTime(o,i)&&!c)return void snacks("Please Select a End Time");if(concatDateWithTime(r,c)<concatDateWithTime(o,i))return void snacks("The End Date and Time should be greater or equal to the start time");e.schedule[s-1].startTime=concatDateWithTime(o,i)||"",e.schedule[s-1].endTime=concatDateWithTime(r,c)||""}else e.schedule[s-1].startTime=concatDateWithTime(o,i)||"",e.schedule[s-1].endTime=concatDateWithTime(r,c)||"";if(t){var d=[];if(e.customerRecord&&e.customerRecord.attachment.Name.value){var l={share:[],office:e.customerRecord.office,venue:e.customerRecord.venue,schedule:e.customerRecord.schedule,attachment:e.customerRecord.attachment,template:e.customerRecord.template};for(s=0;s<e.customerRecord.venue.length;s++)e.customerRecord.venue[s].geopoint={latitude:e.customerRecord.venue[s].geopoint._latitude||"",longitude:e.customerRecord.venue[s].geopoint._longitude||""};d.push(l)}for(s=0;s<e.venue.length;s++)e.venue[s].geopoint={latitude:e.venue[s].geopoint._latitude||"",longitude:e.venue[s].geopoint._longitude||""};var u=void 0;if(e.hasOwnProperty("create"))u=e.assignees;else{u=[];for(s=0;s<e.assignees.length;s++)"object"===_typeof(e.assignees[s])&&u.push(e.assignees[s].phoneNumber)}var m={share:u,office:e.office,venue:e.venue,schedule:e.schedule,attachment:e.attachment,template:e.template};e.hasOwnProperty("create")||(m.activityId=e.activityId),d.push(m),sendUpdateReq(d,e)}}function sendUpdateReq(t,n){document.querySelector("header").appendChild(progressBar()),document.querySelector("#send-activity").classList.add("hidden"),n.hasOwnProperty("create")?n.customerRecord?hasAnyValueInChildren(n.customerRecord.office,"customer",n.customerRecord.attachment.Name.value).then(function(e){if(!e.length)return requestCreator("create",t);(e[0].attachment.Name.value=n.customerRecord.attachment.Name.value)&&t.shift(),requestCreator("create",t)}):requestCreator("create",t):requestCreator("update",t[0])}function checkSpacesInString(e){return!e.replace(/\s/g,"").length}function formAddressComponent(e){var t="";return e.address_components&&(t=[e.address_components[0]&&e.address_components[0].short_name||"",e.address_components[1]&&e.address_components[1].short_name||"",e.address_components[2]&&e.address_components[2].short_name||""].join(" ")),t}function getSubscription(r,c){return new Promise(function(o){var e=firebase.auth().currentUser.uid,i=indexedDB.open(e);i.onsuccess=function(){var e=i.result.transaction(["subscriptions"]),t=e.objectStore("subscriptions").index("officeTemplate"),n=IDBKeyRange.only([r,c]),a=void 0;t.get(n).onsuccess=function(e){a=e.target.result},e.oncomplete=function(){o(a)}}})}function addNewCustomer(t,n){var a=createElement("div",{className:"customer-form"}),o=createElement("span",{className:"customer-location-error mdc-typography--subtitle1"}),e=new InputField({id:"customer-name",labelText:"Customer Name",className:"filled-background mdc-text-field--fullwidth mdc-text-field"}),i=new InputField({id:"customer-name",labelText:"Customer Address",className:"mdc-text-field--fullwidth filled-background mdc-text-field"}),r=e.withoutLabel();r.value=t.attachment.Name.value,r.input_.placeholder="Customer Name",r.input_.id="customer-name",r.input_.required=!0,n&&t?n.canEdit||(r.root_.classList.add("mdc-text-field--disabled"),r.input_.setAttribute("disabled","true")):t.canEdit||(r.root_.classList.add("mdc-text-field--disabled"),r.input_.setAttribute("disabled","true")),r.input_.oninput=function(e){t.attachment.Name.value=e.target.value,n&&n.customerRecord&&(n.attachment.Customer.value=e.target.value)};var c=i.withoutLabel();c.input_.placeholder="Customer Address",c.input_.id="customer-address",c.value=t.venue[0].address,n&&t?n.canEdit||(c.root_.classList.add("mdc-text-field--disabled"),c.input_.setAttribute("disabled","true")):t.canEdit||(c.root_.classList.add("mdc-text-field--disabled"),c.input_.setAttribute("disabled","true"));var s=!1;s=!(!n||!t)||t.canEdit,a.appendChild(r.root_),a.appendChild(c.root_);var d=createElement("div",{id:"customer-address-map"}),l=new AppendMap(d);l.setZoom(18);var u=void 0;t.venue[0].location&&(l.setLocation({lat:t.venue[0].geopoint._latitude,lng:t.venue[0].geopoint._longitude}),a.style.minHeight="400px",s?(u=l.getMarker({draggable:!0}),google.maps.event.addListener(u,"dragend",function(){geocodePosition(u.getPosition()).then(function(e){c.value=e.formatted_address,t.venue[0]=createVenueObjectWithGeoCode(t.venue[0].venueDescriptor,e),document.querySelector("#send-activity")&&document.querySelector("#send-activity").classList.remove("hidden")})})):u=l.getMarker());var m=new google.maps.places.Autocomplete(c.input_,{componentRestrictions:{country:"in"}});return m.addListener("place_changed",function(){var e=m.getPlace();document.querySelector("#send-activity")&&document.querySelector("#send-activity").classList.remove("hidden"),l.setLocation({lat:e.geometry.location.lat(),lng:e.geometry.location.lng()}),t.venue[0]=createVenueObjectWithAutoComplete(t.venue[0].venueDescriptor,e),a.style.minHeight="400px",s?(u=l.getMarker({draggable:!0}),google.maps.event.addListener(u,"dragend",function(){geocodePosition(u.getPosition()).then(function(e){c.value=e.formatted_address,t.venue[0]=createVenueObjectWithGeoCode(t.venue[0].venueDescriptor,e),document.querySelector("#send-activity")&&document.querySelector("#send-activity").classList.remove("hidden")}).catch(function(e){handleError({message:"geocode Error in autocomplete listener for"+n.template,body:JSON.stringify(e)}),o.textContent="Failed to detect your current Location. Search For A new Location or choose existing"})})):u=l.getMarker()}),a.appendChild(d),a.appendChild(o),a}function geocodePosition(e,t){return new Promise(function(n){(new google.maps.Geocoder).geocode({latLng:e},function(e){if(e&&0<e.length){var t=e[0];return n(t)}return n(!1)},function(e){reject(e)})})}function modifyVenueRecordWithGeocode(e,t){var n=createVenueObjectWithGeoCode(t);return"customer"===e.template?(n.venueDescriptor=e.venue[0].venueDescriptor,e.venue[0]=n):(n.venueDescriptor=e.customerRecord.venue[0].venueDescriptor,e.customerRecord.venue[0]=n),e}function createVenueObjectWithGeoCode(e,t){return{location:t?t.formatted_address:"",address:t?t.formatted_address:"",geopoint:{_latitude:t?t.geometry.location.lat():"",_longitude:t?t.geometry.location.lng():""},venueDescriptor:e}}function createVenueObjectWithAutoComplete(e,t){return{location:t?t.name:"",address:t?formAddressComponent(t):"",geopoint:{_latitude:t?t.geometry.location.lat():"",_longitude:t?t.geometry.location.lng():""},venueDescriptor:e}}var appKey=new AppKeys,ui=void 0,native={setFCMToken:function(e){localStorage.setItem("token",e)},getFCMToken:function(){return localStorage.getItem("token")},setName:function(e){localStorage.setItem("deviceType",e)},getName:function(){return localStorage.getItem("deviceType")},setIosInfo:function(e){var t=new URLSearchParams(e),n={};t.forEach(function(e,t){n[t]="appVersion"===t?Number(e):e}),localStorage.setItem("deviceInfo",JSON.stringify(n))},getIosInfo:function(){return localStorage.getItem("deviceInfo")},getInfo:function(){if(!this.getName())return!1;if("Android"!==this.getName())return this.getIosInfo();var t=void 0;try{t=getDeviceInfomation(),localStorage.setItem("deviceInfo",t)}catch(e){sendExceptionObject(e,"Catch Type 3: AndroidInterface.getDeviceId in native.getInfo()",[]),t=JSON.stringify({baseOs:this.getName(),deviceBrand:"",deviceModel:"",appVersion:10,osVersion:"",id:""}),localStorage.setItem("deviceInfo",t)}return t}};function isNewDay(){var e=localStorage.getItem("today");return e?!moment(moment().format("YYYY-MM-DD")).isSame(moment(e))&&(localStorage.setItem("today",moment().format("YYYY-MM-DD")),!0):(localStorage.setItem("today",moment().format("YYYY-MM-DD")),!0)}function getDeviceInfomation(){return JSON.stringify({id:AndroidInterface.getId(),deviceBrand:AndroidInterface.getDeviceBrand(),deviceModel:AndroidInterface.getDeviceModel(),osVersion:AndroidInterface.getOsVersion(),baseOs:AndroidInterface.getBaseOs(),radioVersion:AndroidInterface.getRadioVersion(),appVersion:Number(AndroidInterface.getAppVersion())})}function backNav(){history.back()}function resetScroll(){scroll_namespace.count=0,scroll_namespace.size=20,scroll_namespace.skip=!1}function firebaseUiConfig(t){return{callbacks:{signInSuccessWithAuthResult:function(e){if(t)return updateEmail(e.user,t),!1},signInFailure:function(e){return handleUIError(e)},uiShown:function(){}},signInFlow:"popup",signInOptions:[{provider:firebase.auth.PhoneAuthProvider.PROVIDER_ID,recaptchaParameters:{type:"image",size:"normal",badge:"bottomleft"},defaultCountry:"IN",defaultNationalNumber:t?firebase.auth().currentUser.phoneNumber:""}]}}function userSignedOut(){var e=document.createElement("div");e.id="login-container",document.body.appendChild(e),ui||(ui=new firebaseui.auth.AuthUI(firebase.auth())),ui.start("#login-container",firebaseUiConfig())}function startApp(e){firebase.auth().onAuthStateChanged(function(t){if(!t)return document.getElementById("start-loader").classList.add("hidden"),document.getElementById("main-layout-app").style.display="none",void userSignedOut();if(localStorage.getItem("error")||localStorage.setItem("error",JSON.stringify({})),e){var n=window.indexedDB.open(t.uid,4),a=void 0;n.onupgradeneeded=function(e){((a=n.result).onerror=function(){handleError({message:a.error.message+" from startApp on upgradeneeded"})},e.oldVersion)?e.oldVersion<4&&n.transaction.objectStore("subscriptions").createIndex("status","status"):createObjectStores(a,t.uid)},n.onsuccess=function(){a=n.result,document.getElementById("main-layout-app").style.display="block",localStorage.setItem("dbexist",t.uid),resetScroll(),listView(),requestCreator("now",{device:native.getInfo(),from:"",registerToken:native.getFCMToken()}),runAppChecks(),"Android"!==native.getName?webkit.messageHandlers.locationService.postMessage("start"):manageLocation().then(console.log).catch(function(e){handleError(e)})},n.onerror=function(){handleError({message:n.error.message+" from startApp"})}}})}function getEmployeeDetails(){return new Promise(function(o,i){var r=firebase.auth().currentUser,c=indexedDB.open(r.uid);c.onsuccess=function(){var e=c.result.transaction(["children"]),t=e.objectStore("children"),n=void 0,a=IDBKeyRange.bound(["employee","CONFIRMED"],["employee","PENDING"]);t.index("templateStatus").openCursor(a).onsuccess=function(e){var t=e.target.result;t&&(t.value.attachment["Employee Contact"].value===r.phoneNumber&&(n=t.value),t.continue())},e.oncomplete=function(){o(n)},e.onerror=function(){i({message:e.error.message+" from getEmployeeDetails"})}},c.onerror=function(){i({message:c.error.message+" from getEmployeeDetails"})}})}function isEmployeeOnLeave(){return new Promise(function(r,c){getEmployeeDetails().then(function(o){if(!o)return r(!1);o.onLeave=!1;var i=indexedDB.open(firebase.auth().currentUser.uid);i.onsuccess=function(){var e=i.result.transaction(["calendar"]),t=e.objectStore("calendar"),n=IDBKeyRange.bound(["leave","CONFIRMED",o.office],["leave","PENDING",o.office]),a=!1;t.index("onLeave").openCursor(n).onsuccess=function(e){var t=e.target.result;t&&(moment(moment().format("YYYY-MM-DD")).isBetween(t.value.start,t.value.end,null,"[]")?a=!0:t.continue())},e.oncomplete=function(){r(a)},e.onerror=function(){c({message:e.error.message+" from isEmployeeOnLeave"})}},i.onerror=function(){c({message:i.error.message+" from isEmployeeOnLeave"})}}).catch(function(e){c(e)})})}function createObjectStores(e,t){var n=e.createObjectStore("activity",{keyPath:"activityId"});n.createIndex("timestamp","timestamp"),n.createIndex("office","office"),n.createIndex("hidden","hidden");var a=e.createObjectStore("list",{keyPath:"activityId"});a.createIndex("timestamp","timestamp"),a.createIndex("status","status");var o=e.createObjectStore("users",{keyPath:"mobile"});o.createIndex("displayName","displayName"),o.createIndex("isUpdated","isUpdated"),o.createIndex("count","count"),e.createObjectStore("addendum",{autoIncrement:!0}).createIndex("activityId","activityId");var i=e.createObjectStore("subscriptions",{autoIncrement:!0});i.createIndex("office","office"),i.createIndex("template","template"),i.createIndex("officeTemplate",["office","template"]),i.createIndex("status","status");var r=e.createObjectStore("calendar",{autoIncrement:!0});r.createIndex("activityId","activityId"),r.createIndex("timestamp","timestamp"),r.createIndex("start","start"),r.createIndex("end","end"),r.createIndex("urgent",["status","hidden"]),r.createIndex("onLeave",["template","status","office"]);var c=e.createObjectStore("map",{autoIncrement:!0});c.createIndex("activityId","activityId"),c.createIndex("location","location"),c.createIndex("latitude","latitude"),c.createIndex("longitude","longitude"),c.createIndex("nearby",["status","hidden"]),c.createIndex("byOffice",["office","location"]);var s=e.createObjectStore("children",{keyPath:"activityId"});s.createIndex("template","template"),s.createIndex("office","office"),s.createIndex("templateStatus",["template","status"]),e.createObjectStore("root",{keyPath:"uid"}).put({uid:t,fromTime:0,location:""})}function redirect(){firebase.auth().signOut().then(function(){window.location="https://www.growthfile.com"}).catch(function(e){console.log(e),window.location="https://www.growthfile.com",handleError({message:e+" from redirect"})})}function initLocation(){manageLocation().then(console.log).catch(function(e){handleError(e)})}function runAppChecks(){window.addEventListener("suggestCheckIn",function(e){e.detail&&isEmployeeOnLeave().then(function(e){e||"listView"===history.state[0]&&getUniqueOfficeCount().then(function(t){if(t.length){var e=new Dialog("Check-In Reminder","Do you want to create a Check-In ?").create();e.open(),e.listen("MDCDialog:closed",function(e){console.log(e),"accept"===e.detail.action&&isLocationStatusWorking()&&(1!==t.length?selectorUI({store:"subscriptions"}):createTempRecord(t[0],"check-in"))}),resetScroll(),listView()}})}).catch(handleError)},!0)}function getUniqueOfficeCount(){return new Promise(function(t,n){var a=indexedDB.open(firebase.auth().currentUser.uid),o=[];a.onsuccess=function(){var e=a.result.transaction(["activity"]);e.objectStore("activity").index("office").openCursor(null,"nextunique").onsuccess=function(e){var t=e.target.result;t&&(o.push(t.value.office),t.continue())},e.oncomplete=function(){return t(o)},e.onerror=function(){return n({message:e.error.message,body:JSON.stringify(e.error)})}},a.onerror=function(){return n({message:a.error.message})}})}window.onpopstate=function(e){if(e.state){if("listView"!==e.state[0])return window[e.state[0]](e.state[1],!1);var t=scroll_namespace.count;t&&(scroll_namespace.size=t),scroll_namespace.count=0,window[e.state[0]]()}},window.addEventListener("load",function(){firebase.initializeApp(appKey.getKeys()),"production"!==appKey.getMode()||native.getInfo()?("serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js").then(function(e){console.log("sw registered with scope :",e.scope)},function(e){console.log("sw registeration failed :",e)}),new mdc.topAppBar.MDCTopAppBar(document.querySelector(".mdc-top-app-bar")),moment.updateLocale("en",{calendar:{lastDay:"[yesterday]",sameDay:"hh:mm",nextDay:"[Tomorrow at] LT",lastWeek:"dddd",nextWeek:"dddd [at] LT",sameElse:"L"},longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YY"},months:["January","February","March","April","May","June","July","August","September","October","November","December"]}),(window.Worker||window.indexedDB)&&startApp(!0)):redirect()});var scroll_namespace={count:0,size:20,skip:!1};function resetScroll(){scroll_namespace.count=0,scroll_namespace.size=20,scroll_namespace.skip=!0}function initDomLoad(){document.querySelector(".init-loader")&&document.querySelector(".init-loader").remove(),document.querySelector(".mdc-linear-progress")&&document.querySelector(".mdc-linear-progress").remove(),document.body.classList.remove("mdc-dialog-scroll-lock"),listPanel(),creatListHeader("Activities"),createActivityIcon()}function listView(){history.pushState(["listView"],null,null),initDomLoad(),getCountOfStore("list").then(function(t){if(!t)return document.getElementById("start-loader")&&document.getElementById("start-loader").remove(),void appendTextContentInListView("No activities Found");20<t&&window.addEventListener("scroll",handleScroll,!1),getRootRecord().then(function(e){t&&t<=20?loadActivitiesFromListStore(e.location):startCursor(e.location)})})}function appendTextContentInListView(e){var t=document.createElement("p");t.textContent=e,t.className="no-activity",document.getElementById("activity-list-main").appendChild(t),document.getElementById("activity-list-main").style.boxShadow="none"}function getCountOfStore(o){return new Promise(function(t,n){var a=indexedDB.open(firebase.auth().currentUser.uid);a.onsuccess=function(){var e=a.result.transaction([o]).objectStore(o).count();e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}},a.onerror=function(){n(a.error)}})}function updateEl(n,r){var a=indexedDB.open(firebase.auth().currentUser.uid);a.onsuccess=function(){var e=a.result.transaction(["list","activity"]),o=e.objectStore("activity"),t=e.objectStore("list"),i=document.getElementById("activity--list");n.forEach(function(a){document.querySelector(".no-activity")&&document.querySelector(".no-activity").remove(),t.get(a.activityId).onsuccess=function(e){var t=e.target.result,n=document.querySelector('[data-id="'+a.activityId+'"]');n&&n.remove(),t&&(r.location?getActivityDataForList(o,t,r.location).then(function(e){i&&i.insertBefore(e,i.childNodes[0])}):getActivityDataForList(o,t).then(function(e){i&&i.insertBefore(e,i.childNodes[0])}))}})}}function handleScroll(e){getRootRecord().then(function(e){if(window.innerHeight+window.scrollY===document.body.scrollHeight){if(!document.getElementById("activity--list"))return;startCursor(e.location)}})}function loadActivitiesFromListStore(o){var i=indexedDB.open(firebase.auth().currentUser.uid);i.onsuccess=function(){var e=i.result.transaction(["list","activity","root"]),n=e.objectStore("activity"),t=e.objectStore("list").index("timestamp"),a=document.createDocumentFragment();t.openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;t&&(getActivityDataForList(n,t.value,o).then(function(e){a.appendChild(e)}),t.continue())},e.oncomplete=function(){var e=document.getElementById("activity--list");document.getElementById("start-loader")&&document.getElementById("start-loader").remove(),e&&(e.innerHTML="",e.appendChild(a),scrollToActivity())}}}function startCursor(r){var c=indexedDB.open(firebase.auth().currentUser.uid);c.onsuccess=function(){var e=c.result.transaction(["list","activity","root"]),n=e.objectStore("activity"),t=e.objectStore("list").index("timestamp"),a=0,o=scroll_namespace.count,i=document.createDocumentFragment();t.openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;t&&(o?scroll_namespace.skip?(getActivityDataForList(n,t.value,r).then(function(e){i.appendChild(e),a++}),runCursor(t,a)):(scroll_namespace.skip=!0,t.advance(o)):(getActivityDataForList(n,t.value,r).then(function(e){i.appendChild(e),a++}),runCursor(t,a)))},e.oncomplete=function(){var e=document.getElementById("activity--list");document.getElementById("start-loader").classList.add("hidden"),e&&(e.appendChild(i),scroll_namespace.count=scroll_namespace.count+scroll_namespace.size,scroll_namespace.skip=!1,scroll_namespace.size=20,scrollToActivity())}}}function runCursor(e,t){t<scroll_namespace.size&&e.continue()}function getActivityDataForList(t,l,u){return new Promise(function(r,e){var c=document.createElement("div");c.style.marginTop="10px";var s=document.createElement("span");s.className="mdc-list-item__secondary-text venue-secondline";var d=document.createElement("span");d.className="mdc-list-item__secondary-text",t.get(l.activityId).onsuccess=function(e){var t=e.target.result;if(t){var n=t.schedule,a=t.venue,o=void 0,i=generateLastestSchedule(n,l.createdTime);u&&(o=generateLatestVenue(a,u)),o&&!i?(s.textContent=o,s.style.maxWidth="70%"):i&&!o?d.textContent=i:i&&o&&(s.textContent=o,d.textContent=" | "+i),c.appendChild(s),c.appendChild(d),r(new mdc.ripple.MDCRipple.attachTo(activityListUI(l,c)).root_)}}})}function generateLastestSchedule(e,t){var n=removeEmptyObjects(e,"startTime","endTime");if(!n.length)return formatCreatedTime(t);var a=Date.now();return getTimeTypeForMultipleSchedule(a,sortDatesInAscendingOrderWithPivot(a,n))}function removeEmptyObjects(e,t,n){return e.length?e.filter(function(e){if(e[t]&&e[n])return e}):e}function sortDatesInAscendingOrderWithPivot(e,t){var n=t.slice();return n.push(e),n.sort(function(e,t){return e-t})}function getTimeTypeForMultipleSchedule(e,t){var n=t.slice().indexOf(e);return n==t.length-1?moment(t[t.length-2]).format("D, MMM").replace(",",""):moment(t[n+1]).format("D, MMM").replace(",","")}function formatCreatedTime(e){return e?isToday(e)?moment(e).format("hh:mm"):moment(e).format("D, MMM").replace(",",""):""}function isToday(e){return(new Date).setHours(0,0,0,0)==new Date(e).setHours(0,0,0,0)}function generateLatestVenue(e,n){var t=removeEmptyObjects(e,"location","address"),a=t.length;if(!a)return"";if(1==a)return t[0].location;var o=[];return e.forEach(function(e){var t={latitude:e.geopoint._latitude,longitude:e.geopoint._longitude};o.push({distance:calculateDistanceBetweenTwoPoints(t,n),location:e.location})}),sortNearestLocation(o)[0].location}function sortNearestLocation(e){return e.slice().sort(function(e,t){return e.distance-t.distance})}function activityListUI(e,t){var n=document.createElement("li");n.dataset.id=e.activityId,n.onclick=function(){localStorage.setItem("clickedActivity",this.dataset.id),conversation(this.dataset.id,!0)},n.classList.add("mdc-list-item","activity--list-item","mdc-elevation--z1");var a=document.createElement("object");a.data=e.creator.photo||"./img/empty-user.jpg",a.type="image/jpeg",a.className="mdc-list-item__graphic material-icons";var o=document.createElement("img");o.src="./img/empty-user.jpg",o.className="empty-user-list",a.appendChild(o);var i=document.createElement("span");i.classList.add("mdc-list-item__text");var r=document.createElement("span");r.className="mdc-list-item__primary-text bigBlackBold",r.textContent=e.activityName,i.appendChild(r),i.appendChild(t);var c=document.createElement("div");c.className="mdc-meta__custom-text",c.style.width="76px",isToday(e.timestamp)&&(c.style.marginTop="4px"),c.textContent=moment(e.timestamp).calendar();var s=document.createElement("span");return s.classList.add("mdc-list-item__meta"),s.appendChild(c),s.appendChild(generateIconByCondition(e,n)),n.appendChild(a),n.appendChild(i),n.appendChild(s),n}function generateIconByCondition(e,t){if(e.count){var n=document.createElement("span");return n.textContent=e.count,n.className="count mdc-meta__custom-text",t.classList.add("count-active"),n}var a=document.createElement("i");a.classList.add("status-cancel","material-icons",""+e.status),a.textContent="clear";var o=document.createElement("i");o.classList.add("status-confirmed","material-icons",""+e.status),o.textContent="check";var i=document.createElement("i");return i.classList.add("status-pending","material-icons",""+e.status),i.textContent="","CONFIRMED"===e.status?o:"CANCELLED"===e.status?a:i}function appendActivityListToDom(e){var t=document.getElementById("activity--list");t&&t.appendChild(e)}function getRootRecord(){return new Promise(function(t,n){var a=void 0,o=firebase.auth().currentUser.uid,i=indexedDB.open(o);i.onsuccess=function(){var e=i.result.transaction(["root"],"readwrite");e.objectStore("root").get(o).onsuccess=function(e){var t=e.target.result;a=t},e.oncomplete=function(){t(a)},e.onerror=function(){n({message:e.error.message+" from getRootRecord"})}},i.onerror=function(){n({message:i.error+" from getRootRecord"})}})}function createActivityIcon(){getCountOfStore("subscriptions").then(function(e){e&&createActivityIconDom()}).catch(handleError)}function createActivityIconDom(){var e=new Fab("add").getButton();e.root_.classList.add("create-activity"),e.root_.id="create-activity--icon",e.root_.onclick=function(){selectorUI({store:"subscriptions",suggestCheckIn:!1})},document.getElementById("create-activity--icon")||document.getElementById("activity-list-main").appendChild(e.root_)}function listPanel(){if(!document.getElementById("activity-list-main")){var e=document.createElement("div");e.className="mdc-card panel-card",e.id="activity-list-main";var t=document.createElement("ul");t.className="mdc-list mdc-list--two-line mdc-list--avatar-list",t.id="activity--list",e.appendChild(t),document.getElementById("app-current-panel").innerHTML=e.outerHTML}}function creatListHeader(i){var e=indexedDB.open(firebase.auth().currentUser.uid);e.onsuccess=function(){getUserRecord(e.result,firebase.auth().currentUser.phoneNumber).then(function(e){var t=document.getElementById("section-start"),n=document.createElement("object");n.className="list-photo-header",n.type="image/jpeg",n.data=e.photoURL||"./img/empty-user.jpg",n.onclick=function(){profileView(!0)};var a=document.createElement("img");a.src="./img/empty-user.jpg",a.className="list-photo-header",n.appendChild(a);var o=document.createElement("span");o.textContent=i,o.className="mdc-top-app-bar__title mdc-typography--headline5",t.innerHTML="",t.appendChild(n),t.appendChild(o)})}}function scrollToActivity(){var e=localStorage.getItem("clickedActivity");if(document.querySelector('[data-id="'+e+'"]'))return document.querySelector('[data-id="'+e+'"]').scrollIntoView({behavior:"instant",block:"center",inline:"center"}),void localStorage.removeItem("clickedActivity")}function modifyHeader(e){e.left&&(document.getElementById(e.id+"view-type").innerHTML=e.left);e.right&&(document.getElementById(e.id+"action-data").innerHTML=e.right)}function headerBackIcon(e){var t=document.createElement("i");return t.className="material-icons mdc-top-app-bar__navigation-icon",t.textContent="arrow_back",t.onclick=function(){if(!e)return backNav();"subscriptions"===e?(resetScroll(),listView()):updateCreateActivity(history.state[1],!0)},t}function profileView(e){e&&history.pushState(["profileView"],null,null),window.addEventListener&&window.removeEventListener("scroll",handleScroll,!1);var t=document.getElementById("section-start");t.innerHTML="",t.appendChild(headerBackIcon()),document.getElementById("app-current-panel").innerHTML="";var i=firebase.auth().currentUser.uid,r=indexedDB.open(i);r.onsuccess=function(){var n=r.result,a=n.transaction(["root"],"readwrite"),o=a.objectStore("root");o.get(i).onsuccess=function(e){var t=e.target.result;o.put(t),a.oncomplete=function(){createProfilePanel(n).then(function(e){document.getElementById("app-current-panel")&&document.getElementById("app-current-panel").appendChild(baseCard())})}}}}function baseCard(){var e=createElement("div",{className:"mdc-card demo-card"}),t=createElement("div",{className:"mdc-card__primary-action demo-card__primary-action"}),n=createElement("div",{className:"mdc-card__media mdc-card__media--16-9 demo-card__media"});n.style.backgroundImage="url("+firebase.auth().currentUser.photoURL+")";var a=iconButton({id:"edit-profile",className:"without-icon-edit",label:"edit-profile-button",initialState:"edit",finalState:"check"}),o=createElement("div",{className:"demo-card__primary p-10"}),i=createElement("div",{className:"mdc-typography mdc-typography--body2 p-10 hidden",id:"card-body-edit"});return t.appendChild(n),t.appendChild(a.root_),o.appendChild(profileBasicInfo()),t.appendChild(o),t.appendChild(i),e.appendChild(t),e}function profileBasicInfo(){var e=createElement("div",{className:"basic-info seperator"}),t=createElement("h1",{className:"mdc-typography--headline5 mb-0 mt-0",id:"view-name",textContent:firebase.auth().currentUser.displayName}),n=createElement("h1",{className:"mdc-typography--headline6 mb-0 mt-0"}),a=createElement("i",{className:"material-icons meta-icon",textContent:"email"}),o=createElement("span",{textContent:firebase.auth().currentUser.email});n.appendChild(a),n.appendChild(o);var i=createElement("h1",{className:"mdc-typography--headline6 mt-0"}),r=createElement("i",{className:"material-icons meta-icon",textContent:"phone"}),c=createElement("span",{className:"mdc-typography--headline6",textContent:firebase.auth().currentUser.phoneNumber});return i.appendChild(r),i.appendChild(c),e.appendChild(t),e.appendChild(n),e.appendChild(i),e}function createOfficeDetailView(){var n=createElement("div",{className:"office-info seperator"});getEmployeeDetails().then(function(e){var t=e.attachment;Object.keys(t).forEach(function(e){n.appendChild(createElement("h1",{className:"mdc-typography--subtitle1 mt-0",textContent:t[e].value}))}),n.appendChild(createElement("h1",{className:"mdc-typography--subtitle1 mt-0",textContent:firebase.auth().meta.lastSignInTime}))})}function createProfilePanel(e){return new Promise(function(v){getUserRecord(e,firebase.auth().currentUser.phoneNumber).then(function(e){var t=document.createElement("div");t.id="profile-view--container",t.className="mdc-top-app-bar--fixed-adjust mdc-theme--background";var n=document.createElement("button");n.className="mdc-fab","Android"===native.getName()&&(n.id="uploadProfileImage");var a=document.createElement("label");a.setAttribute("for","uploadProfileImage");var o=document.createElement("span");o.className="mdc-fab__icon material-icons",o.textContent="add_a_photo",a.appendChild(o),n.appendChild(a);var i=void 0;"Android"!==native.getName()&&((i=document.createElement("input")).type="file",i.style.display="none",i.id="uploadProfileImage",i.accept="image/jpeg;");var r=document.createElement("div");r.id="profile--image-container",r.className="profile-container--main";var c=document.createElement("object");c.type="image/jpeg",c.data=e.photoURL||"./img/empty-user-big.jpg",c.id="user-profile--image";var s=document.createElement("img");s.src="./img/empty-user-big.jpg",s.className="empty-user-profile",c.appendChild(s);var d=document.createElement("div");d.className="insert-overlay",r.appendChild(c),r.appendChild(d),r.appendChild(n),"Android"!==native.getName()&&a.appendChild(i);var l=document.createElement("div");l.id="name--change-container",l.className="profile-psuedo-card";var u=document.createElement("button");u.className="mdc-icon-button material-icons hidden",u.id="edit--name",u.setAttribute("aria-hidden","true"),u.setAttribute("aria-pressed","false"),u.textContent="check";var m=firebase.auth().currentUser.displayName;l.innerHTML='<div class="mdc-text-field" id=\'name-change-field\'>\n        <input autocomplete="off" type="text"  placeholder="'+(m?"":"Enter Your Name")+'"  id="pre-filled-name" class="mdc-text-field__input" value="'+(m||"")+'">\n        <label class="mdc-floating-label mdc-floating-label--float-above" for="pre-filled-name">\n         Your Name\n        </label>\n        <div class="mdc-line-ripple"></div>\n      </div>\n      ',l.appendChild(u);var p=document.createElement("div");p.id="email--change-container",p.className="profile-psuedo-card";var h=document.createElement("button");h.className="mdc-icon-button material-icons hidden",h.id="edit--email",h.setAttribute("aria-hidden","true"),h.setAttribute("aria-pressed","false"),h.textContent="check";var f=firebase.auth().currentUser.email;p.innerHTML='<div class="mdc-text-field" id=\'email-change-field\'>\n        <input  autocomplete="off" type="text" id="pre-filled-email" class="mdc-text-field__input" value="'+(f||"")+'" placeholder="'+(f?"":"Enter your Email")+'">\n        <label class="mdc-floating-label mdc-floating-label--float-above" for="pre-filled-email">\n         Your Email\n        </label>\n        <div class="mdc-line-ripple"></div>\n      </div>\n      ',p.appendChild(h),t.appendChild(r),t.appendChild(l),t.appendChild(p),v(t)})})}function timeDiff(e){var t=moment().format("YYY-MM-DD HH:mm"),n=moment(e).format("YYY-MM-DD HH:mm");return moment(t).diff(moment(n),"minutes")}function newSignIn(t){var n=new Dialog("",createElement("div",{id:"refresh-login"})).create();n.open(),n.listen("MDCDialog:opened",function(e){ui||(ui=new firebaseui.auth.AuthUI(firebase.auth())),ui.start("#refresh-login",firebaseUiConfig(t)),n.container_.querySelector("footer").remove(),n.container_.querySelector("h2").remove(),setTimeout(function(){document.querySelector(".firebaseui-id-phone-number").disabled=!0,document.querySelector(".firebaseui-label").remove(),document.querySelector(".firebaseui-title").textContent="Verify your phone Number to Update your Email address"},500)})}function readUploadedFile(e){if("Android"!==native.getName()){var t=document.getElementById("uploadProfileImage").files[0],n=new FileReader;n.addEventListener("load",function(){sendBase64ImageToBackblaze(n.result)},!1),t&&n.readAsDataURL(t)}else sendBase64ImageToBackblaze(e)}function sendBase64ImageToBackblaze(e){var t=document.getElementById("user-profile--image"),n=document.getElementById("profile--image-container"),a="data:image/jpeg;base64,";t&&(t.data=a+e),n&&document.getElementById("profile--image-container").appendChild(loader("profile--loader")),requestCreator("backblaze",{imageBase64:a+e})}function authUpdatedError(e){document.querySelector(".init-loader")&&document.querySelector(".init-loader").remove(),snacks(e.message)}function changeDisplayName(){var e=document.getElementById("name-change-field"),t=new mdc.textField.MDCTextField(e),n=document.getElementById("edit--name");firebase.auth().currentUser.displayName;e.addEventListener("click",function(){document.getElementById("pre-filled-name").placeholder="",n.classList.remove("hidden"),e.classList.add("short")}),e.addEventListener("keydown",function(e){13==e.keyCode&&updateName(t.value)}),n.addEventListener("click",function(){updateName(t.value)})}function updateName(e){e?firebase.auth().currentUser.updateProfile({displayName:e}).then(successDialog).catch(function(e){snacks("Please Try again later"),handleError({message:e+" at updateProfile in changeDisplayName"})}):snacks("Please Enter a Name")}function changeEmailAddress(){var e=document.getElementById("email-change-field"),t=new mdc.textField.MDCTextField(e),n=document.getElementById("edit--email");e.addEventListener("click",function(){document.getElementById("pre-filled-email").placeholder="",n.classList.remove("hidden"),e.classList.add("short")}),e.addEventListener("keydown",function(e){13==e.keyCode&&emailValidation(t)}),n.addEventListener("click",function(){emailValidation(t)})}function emailValidation(e){var t=firebase.auth().currentUser,n=e.value;n?n===t.email&&t.emailVerified?snacks("You have already set this as your email address"):timeDiff(t.metadata.lastSignInTime)<=2?updateEmail(t,n):newSignIn(n):snacks("Enter a valid Email Id")}function updateEmail(e,t){document.getElementById("growthfile").appendChild(loader("init-loader")),e.updateEmail(t).then(function(){emailUpdateSuccess(!0)}).catch(authUpdatedError)}function emailUpdateSuccess(e){firebase.auth().currentUser.sendEmailVerification().then(function(){emailVerificationSuccess(e)}).catch(emailVerificationError)}function emailVerificationSuccess(e){e&&successDialog(),snacks("Verification link has been send to your email address")}function emailVerificationError(e){snacks(e.message),document.querySelector(".init-loader")&&document.querySelector(".init-loader").remove()}function initUserSelectorSearch(i,e,r){var t=indexedDB.open(firebase.auth().currentUser.uid);t.onsuccess=function(){var n=t.result,a="",o=document.createDocumentFragment();e.input_.addEventListener("input",function(e){var t=e.target.value;if(isNumber(t))return a=n.transaction("users").objectStore("users"),void searchUsersDB(formatNumber(t),a,o,i,r);o=document.createDocumentFragment(),a=n.transaction("users").objectStore("users").index("displayName"),searchUsersDB(formatName(t),a,o,i,r)})}}function isNumber(e){return!isNaN(e)}function formatNumber(e){var t=e;return"91"===t.substring(0,2)?t="+"+t:"+91"!==t.substring(0,3)&&(t="+91"+t),t}function formatName(e){var t=e.split(" "),n=t.length,a=[],o=0;for(o=0;o<n;o++){var i=t[o];if(i.charAt(0).toUpperCase()===e.charAt(0).toUpperCase)return e;a.push(i.charAt(0).toUpperCase()+i.slice(1))}return a.join(" ")}function checkNumber(e){return/^\+[1-9]\d{11,14}$/.test(e)}function searchUsersDB(e,t,r,c,s){console.log(e);var n=IDBKeyRange.bound(e,e+"￿"),d=document.getElementById("user-selector-list"),a=c.record.assignees,l={};a.forEach(function(e){"string"==typeof e?l[e]=!0:l[e.phoneNumber]=!0}),l[firebase.auth().currentUser.phoneNumber]=!0,t.openCursor(n).onsuccess=function(e){var t=e.target.result;if(!t){if(d.innerHTML="",0!=r.children.length)return void d.appendChild(r);var n=document.createElement("div");n.className="data-not-found";var a=document.createElement("p");return a.textContent="No Contact Found",a.className="mdc-typography--headline5",n.appendChild(a),void(document.querySelector(".data-not-found")||d.appendChild(n))}if(c.attachment){var o=new mdc.radio.MDCRadio(createRadioInput({value:t.value.mobile}));r.appendChild(createSimpleAssigneeLi(t.value,o))}else if(!l.hasOwnProperty(t.value.mobile)){var i=createCheckBox({value:t.value.mobile});i.root_.onclick=function(){s.querySelector("#selector-submit-send").dataset.type="",s.querySelector("#selector-submit-send").textContent="SELECT"},r.appendChild(createSimpleAssigneeLi(t.value,i))}t.continue()}}function selectorUI(a){document.body.style.backgroundColor="white",document.body.classList.remove("mdc-dialog-scroll-lock"),document.getElementById("app-current-panel").innerHTML="";var e=document.getElementById("section-start");e.innerHTML="",e.appendChild(headerBackIcon(a.store));var o=createElement("div",{className:"selector-container"}),t=createElement("span",{className:"selector-warning-text",id:"selector-warning"});o.appendChild(t);var n="SELECT";"users"===a.store&&(n="Add New Number");var i=new Button(n);i.raised(),i.selectorButton();var r=i.getButton();r.root_.id="selector-submit-send","users"===a.store&&(r.root_.dataset.type="add-number"),r.root_.onclick=function(){if(isLocationStatusWorking()){var e=o.querySelector("#selector-warning"),t=getSelectedList(".mdc-radio");if(t.length){e.textContent="";var n=JSON.parse(t[0].value);if("subscriptions"===a.store){if("dsr"!==n.template&&"duty roster"!==n.template&&"tour plan"!==n.template||document.querySelector("header").appendChild(progressBar()),!isLocationStatusWorking())return;createTempRecord(n.office,n.template,a)}}else e.textContent="Please Select An Option"}};({users:!0,children:!0,map:!0})[a.store]||o.appendChild(r.root_),window.scrollTo(0,0),{map:mapSelector,users:userSelector,subscriptions:fillSubscriptionInSelector,children:fillChildrenInSelector}[a.store](a,o)}function mapSelector(r,c){var s=document.getElementById("app-current-panel"),e=(new InputField).withLeadingIcon("search","Search Location");e.root_.id="map-selector-search",e.root_.classList.add("search-field"),c.appendChild(e.root_);var t=e.input_;t.placeholder="",autocomplete=new google.maps.places.Autocomplete(t,{componentRestrictions:{country:"in"}}),autocomplete.addListener("place_changed",function(){var e=autocomplete.getPlace();if(e.geometry){var t={location:e.name,address:formAddressComponent(e),latitude:e.geometry.location.lat(),longitude:e.geometry.location.lng()};updateCreateActivity(updateVenue(r,t).record,!0)}else snacks("Please select a valid location")}),console.log(r);var d=indexedDB.open(firebase.auth().currentUser.uid);d.onsuccess=function(){var e=d.result.transaction([r.store],"readonly"),t=e.objectStore("map"),n=r.record.office,a=IDBKeyRange.bound([n,""],[n,"￿"]),o=createElement("ul",{className:"mdc-list mdc-list--avatar-list map-selector-list"});o.setAttribute("role","radiogroup");var i=0;t.index("byOffice").openCursor(a,"nextunique").onsuccess=function(e){var t=e.target.result;if(t)if(t.value.office===r.record.office)if(t.value.location)if(t.value.latitude&&t.value.longitude)if(o.querySelector('[data-name="'+t.value.location+'"]'))t.continue();else{var n=radioList({value:t.value,labelText:t.value.location,index:i});n.dataset.name=t.value.location,new mdc.ripple.MDCRipple.attachTo(n),o.appendChild(n),i++,t.continue()}else t.continue();else t.continue();else t.continue()},e.oncomplete=function(){var e=new mdc.list.MDCList(o);e.singleSelection=!0,e.listen("MDCList:action",function(e){var t=JSON.parse(o.querySelector("#list-radio-item-"+e.detail.index).value);updateCreateActivity(updateVenue(r,t).record,!0)}),c.appendChild(o),s.appendChild(c)}}}function updateVenue(t,n){return t.record.venue.forEach(function(e){e.venueDescriptor===t.key&&(e.address=n.address,e.location=n.location,e.geopoint._latitude=n.latitude,e.geopoint._longitude=n.longitude)}),t}function userSelector(s,d){var e=document.getElementById("app-current-panel"),t=(new InputField).withLeadingIcon("search","Search Assignee");t.root_.id="users-selector-search",t.root_.classList.add("search-field"),d.appendChild(t.root_),e.appendChild(d),initUserSelectorSearch(s,t,d);var l=createElement("ul",{className:"mdc-list mdc-list--avatar-list  mdc-list--two-line",id:"user-selector-list"});l.setAttribute("role","group"),l.setAttribute("aria-label","User List With Check Box"),d.appendChild(l);var n=s.record.assignees,a=new Button("Add New Number");a.raised(),a.selectorButton();var o=a.getButton();o.root_.dataset.type="add-number",o.root_.id="selector-submit-send",o.root_.onclick=function(){if("add-number"!==o.root_.dataset.type){var e=".mdc-radio";s.attachment||(e=".mdc-checkbox");var t=getSelectedList(e);if(t){var n=[];t.forEach(function(e){n.push(JSON.parse(e.value))}),console.log(n),insertNumberIntoRecord(s,n)}else d.querySelector("#selector-warning").textContent="Please Choose An Option"}else addNewNumber(s,d)},d.appendChild(o.root_);var i=indexedDB.open(firebase.auth().currentUser.uid);i.onsuccess=function(){var e=i.result.transaction(["users"]),t=e.objectStore("users"),r=0,c={};n.forEach(function(e){"string"==typeof e?c[e]=!0:c[e.phoneNumber]=!0}),c[firebase.auth().currentUser.phoneNumber]=!0,t.openCursor().onsuccess=function(e){var t=e.target.result;if(t)if(l.querySelector('[data-number="'+t.value.mobile+'"]'))t.continue();else{if(s.attachment){r++;var n=new mdc.radio.MDCRadio(createRadioInput(JSON.stringify(t.value.mobile)));n.root_.onclick=function(){s.record.attachment[s.key].value=JSON.parse(n.value),updateCreateActivity(s.record,!0)};var a=createSimpleAssigneeLi(t.value,n);a.dataset.number=t.value.mobile,l.appendChild(a)}else if(!c.hasOwnProperty(t.value.mobile)){r++;var o=createCheckBox({value:t.value.mobile});o.root_.onclick=function(){d.querySelector("#selector-submit-send").dataset.type="",d.querySelector("#selector-submit-send").textContent="SELECT"};var i=createSimpleAssigneeLi(t.value,o);i.dataset.number=t.value.mobile,l.appendChild(i)}t.continue()}},e.oncomplete=function(){r||(l.appendChild(noSelectorResult("No Contact Found")),document.getElementById("users-selector-search").style.display="none"),document.getElementById("app-current-panel").appendChild(d)}}}function addNewNumber(t,e){document.body.style.backgroundColor="white",removeChildNodes(e);var n=createElement("div",{className:"new-number-container"}),a=createElement("h2",{className:"mdc-typography--headline5 new-contact-headline",textContent:"Add a new Phone Number"}),o=createElement("p",{className:"mdc-typography--subtitle2 message-field",textContent:"Enter new phone contact without country code",id:"helper-message"}),i=new Fab("add").extended("Add Contact");i.root_.id="new-contact";var r=(new InputField).withoutLabel();r.root_.id="number-field",r.root_.type="number",r.input_.placeholder="Enter A New Phone Number",r.input_.setAttribute("maxlength","10"),r.input_.setAttribute("size","10"),r.input_.required=!0,r.input_.onkeypress=function(e){return 48<=e.charCode&&e.charCode<=57},r.input_.oninput=function(){this.value.length>this.maxLength?this.value=this.value.slice(0,this.maxLength):this.value.length===this.maxLength?(o.classList.remove("error-message"),this.classList.add("valid-input"),o.textContent=""):(o.classList.add("error-message"),o.textContent="* Please Enter a valid Number")},i.root_.onclick=function(){var e=formatNumber(r.value);if(!checkNumber(e))return o.classList.add("error-message"),o.textContent="* Please Enter a valid Number",void r.disabled(!0);insertNumberIntoRecord(t,[e])},n.appendChild(a),n.appendChild(r.root_),n.appendChild(o),n.appendChild(i.root_),e.appendChild(n),document.getElementById("app-current-panel").appendChild(e)}function insertNumberIntoRecord(e,t){return e.attachment?(e.record.attachment[e.key].value=t[0],void updateCreateActivity(e.record,!0)):e.record.hasOwnProperty("create")?(e.record.assignees.push.apply(e.record.assignees,t),void updateCreateActivity(e.record,!0)):void shareReq(e,t)}function fillSubscriptionInSelector(a,e){var o=indexedDB.open(firebase.auth().currentUser.uid);o.onsuccess=function(){var e=o.result.transaction([a.store],"readonly"),t=e.objectStore(a.store).index("office"),n=[];t.openCursor(null,"nextunique").onsuccess=function(e){var t=e.target.result;t&&(n.push(t.value.office),t.continue())},e.oncomplete=function(){console.log(n),console.log(tabBar(n)),document.getElementById("app-current-panel").appendChild(tabBar(n).root_)}}}function fillChildrenInSelector(t,e){var a=createElement("ul",{className:"mdc-list"});t.results.forEach(function(e,t){var n=radioList({labelText:e.attachment.Name.value||e.attachment.Number.value,value:e.attachment.Name.value||e.attachment.Number.value,index:t});n.dataset.value=e.attachment.Name.value||e.attachment.Number.value,a.querySelector('[data-value="'+n.dataset.value+'"]')||(a.appendChild(n),new mdc.ripple.MDCRipple.attachTo(n))});var n=new mdc.list.MDCList(a);n.singleSelection=!0,n.listen("MDCList:action",function(e){t.record.attachment[t.key].value=JSON.parse(a.querySelector("#list-radio-item-"+e.detail.index).value),updateCreateActivity(t.record,!0)}),e.appendChild(a),document.getElementById("app-current-panel").appendChild(e)}function getSelectedList(t){return[].map.call(document.querySelectorAll(t),function(e){return".mdc-radio"===t?new mdc.radio.MDCRadio(e):".mdc-checkbox"===t?new mdc.checkbox.MDCCheckbox(e):void 0}).filter(function(e){return e.checked})}function shareReq(e,t){isLocationStatusWorking()&&(document.querySelector("header").appendChild(progressBar()),requestCreator("share",{activityId:e.record.activityId,share:t}))}var apiHandler=new Worker("js/apiHandler.js");function handleError(e){var t=JSON.parse(localStorage.getItem("error"));if(!t.hasOwnProperty(e.message))return t[e.message]=!0,localStorage.setItem("error",JSON.stringify(t)),e.device=JSON.stringify(native.getInfo()),void requestCreator("instant",JSON.stringify(e))}function loader(e){var t=document.createElement("div");return t.className="loader "+e,t}function successDialog(){var e=createElement("div",{className:"success--container",id:"success-animation"}),t=createElement("div",{className:"success--check"});e.appendChild(t),document.body.appendChild(e),setTimeout(function(){document.getElementById("success-animation").remove(),resetScroll(),localStorage.removeItem("clickedActivity"),resetScroll(),listView()},1500)}function progressBar(){var e=document.createElement("div");e.className="mdc-linear-progress mdc-linear-progress--indeterminate progress--update",e.role="progressbar";var t=document.createElement("div");t.className="mdc-linear-progress__buffering-dots";var n=document.createElement("div");n.className="mdc-linear-progress__buffer";var a=document.createElement("div");a.className="mdc-linear-progress__bar mdc-linear-progress__primary-bar";var o=document.createElement("span");o.className="mdc-linear-progress__bar-inner",a.appendChild(o);var i=document.createElement("div");i.className="mdc-linear-progress__bar mdc-linear-progress__secondary-bar";var r=document.createElement("span");return r.className="mdc-linear-progress__bar-inner",i.appendChild(r),e.appendChild(t),e.appendChild(n),e.appendChild(a),e.appendChild(i),e}function snacks(e,t){var n=document.createElement("div");n.className="mdc-snackbar",n.setAttribute("aria-live","assertive"),n.setAttribute("aria-atomic","true"),n.setAttribute("aria-hidden","true"),n.style.zIndex=99999;var a=document.createElement("div");a.className="mdc-snackbar__text mdc-typography--subtitle2";var o=document.createElement("div");o.className="mdc-snackbar__action-wrapper";var i=document.createElement("button");i.className="mdc-snackbar__action-button",o.appendChild(i),n.appendChild(a),n.appendChild(o),document.getElementById("snackbar-container").innerHTML=n.outerHTML;var r={message:e,actionText:"OK",timeout:5e3,actionHandler:function(){}};mdc.snackbar.MDCSnackbar.attachTo(document.querySelector(".mdc-snackbar")).show(r)}function fetchCurrentTime(e){return Date.now()+e}function geolocationApi(o){return new Promise(function(t,n){var a=new XMLHttpRequest;a.open("POST","https://www.googleapis.com/geolocation/v1/geolocate?key="+appKey.getMapKey(),!0),a.setRequestHeader("Content-Type","application/json"),a.onreadystatechange=function(){if(4===a.readyState){if(400<=a.status)return n({message:a.response,body:o});var e=JSON.parse(a.response);if(!e)return n({message:"Response From geolocation Api "+e,body:o});t({latitude:e.location.lat,longitude:e.location.lng,accuracy:e.accuracy,provider:{body:o}})}},a.onerror=function(){n({message:a})},a.send(o)})}function handleRequestBody(e){var t=JSON.parse(e);return t.wifiAccessPoints&&t.wifiAccessPoints.length?(t.cellTowers&&delete t.cellTowers,JSON.stringify(t)):null}function manageLocation(){return new Promise(function(t,n){getLocation().then(function(e){updateLocationInRoot(e),t(e)}).catch(function(e){n(e)})})}function getLocation(){return new Promise(function(n,a){var o={};"Android"!==native.getName()?html5Geolocation().then(function(e){n(e)}).catch(function(e){a(e)}):html5Geolocation().then(function(e){if(e.accuracy<=350)return n(e);o.html5={body:"",result:e},handleGeoLocationApi(o,e).then(function(e){n(e)})}).catch(function(t){handleGeoLocationApi(o).then(function(e){n(e)}).catch(function(e){a({message:"Both HTML and Geolocation failed to fetch location.",body:JSON.stringify({html5:t,geolocation:JSON.stringify(e)}),locationError:!0})})})})}function handleGeoLocationApi(i,r){return new Promise(function(a,t){var e=void 0,o=[];try{e=getCellularInformation()}catch(e){if(r)return void a(r);t(e.message)}if(!Object.keys(JSON.parse(e)).length){if(r)return void a(r);t("empty object from getCellularInformation")}geolocationApi(e).then(function(t){if(t.accuracy<=350)return a(t);i.orignialGeolocationResponse={body:e,result:t};var n=handleRequestBody(e);if(!n)return 1200<=t.accuracy&&handleError({message:"Oringinal CellTower has accuracy more than 1200 and WAP doesnt exist",body:JSON.stringify(i),locationError:!0}),r?t.accuracy<r.accuracy?void a(t):a(r):void a(t);geolocationApi(n).then(function(e){return e.accuracy<=350?a(e):(i.withoutCellTower={body:n,result:e},1200<=e.accuracy&&handleError({message:"html5,originalCellTower,WithoutCellTower",body:JSON.stringify(i),locationError:!0}),Object.keys(i).forEach(function(e){o.push(i[e].result)}),a(sortedByAccuracy(o)))}).catch(function(e){if(1200<=t.accuracy&&(i.withoutCellTower={body:n},handleError({message:"Orinigal CellTower has accuracy more than 1200 and api failure when sending cellTowerObject without cellularTowers",body:JSON.stringify(i),locationError:!0})),r){if(!(t.accuracy<r.accuracy))return a(r);a(t)}else a(t)})}).catch(function(e){r?a(r):t(e)})})}function iosLocationError(e){manageLocation().then(console.log).catch(console.log),handleError(e)}function html5Geolocation(){return new Promise(function(n,t){for(var e=[],a=0;a<2;a++){var o=new Promise(function(t,n){navigator.geolocation.getCurrentPosition(function(e){return t({latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy,provider:"HTML5"})},function(e){n({message:e})},{timeout:5e3,maximumAge:0,enableHighAccuracy:!0})});e.push(o)}Promise.all(e).then(function(e){var t=e.sort(function(e,t){return e.accuracy-t.accuracy});n(t[0])}).catch(function(e){t({message:e.message.message})})})}function updateLocationInRoot(a){var o={latitude:"",longitude:"",accuracy:"",provider:"",lastLocationTime:""},t=firebase.auth().currentUser.uid,i=indexedDB.open(t);i.onsuccess=function(){var e=i.result.transaction(["root"],"readwrite"),n=e.objectStore("root");n.get(t).onsuccess=function(e){var t=e.target.result;t.location&&(o=t.location),t.location=a,t.location.lastLocationTime=Date.now(),n.put(t)},e.oncomplete=function(){if(o.latitude&&o.longitude&&a.latitude&&a.longitude){var e=calculateDistanceBetweenTwoPoints(o,a),t=new CustomEvent("suggestCheckIn",{detail:isLocationMoreThanThreshold(e)||isNewDay()});if(window.dispatchEvent(t),"Ios"===native.getName()){var n=new CustomEvent("iosLocation",{detail:a});window.dispatchEvent(n)}}},e.onerror=function(){handleError({message:e.error.message+" from updateLocationInRoot",body:e.error.name})},i.onerror=function(){handleError({message:i.error.message+" from updateLocationInRoot",body:i.error.name}),window.dispatchEvent(suggestCheckIn)}}}function toRad(e){return e*Math.PI/180}function calculateDistanceBetweenTwoPoints(e,t){var n=toRad(t.latitude-e.latitude),a=toRad(t.longitude-e.longitude),o=toRad(t.latitude),i=toRad(e.latitude),r=Math.sin(n/2)*Math.sin(n/2)+Math.sin(a/2)*Math.sin(a/2)*Math.cos(o)*Math.cos(i);return 6371*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))}function isLocationMoreThanThreshold(e){return 1<=e}function isLocationLessThanThreshold(e){return e<=1}function sortedByAccuracy(e){return e.sort(function(e,t){return e.accuracy-t.accuracy})[0]}function isLocationStatusWorking(){return"Android"!==native.getName()||(AndroidInterface.isLocationPermissionGranted()?"samsung"!==JSON.parse(localStorage.getItem("deviceInfo")).deviceBrand||(!!AndroidInterface.isWifiOn()||void new Dialog("TURN ON YOUR WIFI","Growthfile requires wi-fi access for improving your location accuracy.").open()):void new Dialog("LOCATION PERMISSION","Please Allow Growthfile location access.").open())}function requestCreator(i,r){var t=firebase.auth().currentUser;if(t){var c={type:i,body:"",meta:{user:{token:"",uid:t.uid,displayName:t.displayName,photoURL:t.photoURL,phoneNumber:t.phoneNumber},apiUrl:appKey.getBaseUrl()}};"instant"===i||"now"===i||"Null"===i||"backblaze"===i?t.getIdToken(!1).then(function(e){c.body=r,c.meta.user.token=e,apiHandler.postMessage(c)}).catch(console.log):getRootRecord().then(function(a){var o=a.location,e=isLastLocationOlderThanThreshold(o.lastLocationTime,5),n=[t.getIdToken(!1)];e&&("Android"===native.getName()?n.push(manageLocation()):window.addEventListener("iosLocation",function e(t){n.push(t.detail),window.removeEventListener("iosLocation",e,!0)},!0)),Promise.all(n).then(function(e){var t=e[0];2==e.length&&(o=e[1],console.log(o));var n={latitude:o.latitude,longitude:o.longitude,accuracy:o.accuracy,provider:o.provider};"create"===i?r.forEach(function(e){e.timestamp=fetchCurrentTime(a.serverTime),e.geopoint=n}):(r.timestamp=fetchCurrentTime(a.serverTime),r.geopoint=n),c.body=r,c.meta.user.token=t,sendRequest(o,c)}).catch(function(e){handleError(e)})}),apiHandler.onmessage=messageReceiver,apiHandler.onerror=onErrorMessage}}function sendRequest(e,t){if(e.latitude&&e.longitude&&e.accuracy)apiHandler.postMessage(t);else{var n=new Dialog("Location Error","There was a Problem in detecting your location. Please Try again later").create();n.open(),n.listen("MDCDialog:closed",function(e){getRootRecord().then(function(e){handleError({message:"No Locations Found in indexedDB",body:JSON.stringify({storedLocation:e.location,cellTower:getCellularInformation()})}),resetScroll(),listView()})})}}function isLastLocationOlderThanThreshold(e,t){var n=moment(moment().valueOf()),a=e;return t<moment.duration(n.diff(a)).asSeconds()}var receiverCaller={initFirstLoad:initFirstLoad,"update-app":updateApp,"removed-from-office":officeRemovalSuccess,"revoke-session":revokeSession,notification:successDialog,apiFail:apiFail};function messageReceiver(e){receiverCaller[e.data.type](e.data)}function emailVerify(e){if(!firebase.auth().currentUser.email||!firebase.auth().currentUser.emailVerified){if(firebase.auth().currentUser.email)return emailUpdateSuccess();var t=new Dialog(e.title,e.body);t.open(),t.listen("MDCDialog:closed",function(e){"accept"===e.detail.action&&profileView(!0)})}}function createBlankPayrollDialog(e){var t=createElement("div",{className:"notification-message",textContent:e.body}),n=createElement("ul",{className:"mdc-list",id:"payroll-notification-list"});n.setAttribute("role","radiogroup"),e.data.forEach(function(e,t){n.appendChild(radioList({labelText:e.template,index:t,value:e}))}),t.appendChild(n);var a=new Dialog(e.title,t).create();a.open();var o=new mdc.list.MDCList(n);o.singleSelection=!0,a.listen("MDCDialog:opened",function(e){o.layout(),o.listElements.map(function(e){return new mdc.ripple.MDCRipple.attachTo(e)})}),a.listen("MDCDialog:closed",function(e){if("accept"===e.detail.action&&isLocationStatusWorking()){var t=JSON.parse(document.getElementById("list-radio-item-"+o.selectedIndex).value);createTempRecord(t.office,t.template,{schedule:t.schedule,attachment:t.attachment})}})}function initFirstLoad(t){"listView"===history.state[0]&&(t.msg.hasOwnProperty("activity")&&t.msg.activity.length&&getRootRecord().then(function(e){updateEl(t.msg.activity,e)}),t.msg.hasOwnProperty("template")&&createActivityIcon())}function updateApp(){if("Android"!==native.getName())return webkit.messageHandlers.updateApp.postMessage("Update App");var e=new Dialog("New Update Avaialble","Please Install the Latest version from google play store , to Use Growthfile. Click Okay to Install Lastest Version from Google Play Store.").create();e.open(),e.scrimClickAction="",e.listen("MDCDialog:opened",function(){e.buttons_[0].setAttribute("disabled","true")}),e.listen("MDCDialog:closed",function(e){"accept"===e.detail.action&&AndroidInterface.openGooglePlayStore("com.growthfile.growthfileNew")})}function revokeSession(){firebase.auth().signOut().then(function(){}).catch(function(e){handleError({message:"Sign out error",body:e})})}function apiFail(e){document.getElementById("send-activity")&&(document.getElementById("send-activity").style.display="block"),document.querySelector("header .mdc-linear-progress")&&document.querySelector("header .mdc-linear-progress").remove(),document.querySelector(".loader")&&document.querySelector(".loader").remove(),document.querySelector(".delete-activity")&&(document.querySelector(".delete-activity").style.display="block"),document.querySelector(".undo-delete-loader")&&(document.querySelector(".undo-delete-loader").style.display="block"),document.querySelector(".form-field-status")&&document.querySelector(".form-field-status").classList.contains("hidden")&&document.querySelector(".form-field-status").classList.remove("hidden"),snacks(e.msg.message)}function officeRemovalSuccess(e){var t=new Dialog("Reminder","You have been removed from "+e.msg.join(" & ")).create();t.open(),t.listen("MDCDialog:closed",function(){document.getElementById("app-current-panel").innerHTML="",resetScroll(),listView()})}function onErrorMessage(e){var t={"line-number":e.lineno,file:e.filename,"col-number":e.colno};handleError({message:e.message+" from apiHandler.js at line-number "+e.lineno+" and columne-number "+e.colno,body:t})}function getInputText(e){return mdc.textField.MDCTextField.attachTo(document.querySelector(e))}function runRead(e){if(localStorage.getItem("dbexist"))return e?void setTimeout(function(){e.read?requestCreator("Null",e):e.verifyEmail?emailVerify(JSON.parse(e.verifyEmail)):e.payroll&&createBlankPayrollDialog(JSON.parse(e.payroll))},500):requestCreator("Null",e)}function removeChildNodes(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function jniException(e,t){handleError({message:e,body:t,androidException:!0})}function sendExceptionObject(e,t,n){handleError({message:""+t,body:JSON.stringify({message:e.message,name:e.name,stack:JSON.stringify(e.stack),paramSent:n})})}