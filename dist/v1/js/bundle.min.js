function getCellularInformation(){var e=void 0,t=AndroidInterface.getMobileCountryCode(),n=AndroidInterface.getMobileNetworkCode(),a=AndroidInterface.getRadioType(),o=AndroidInterface.getCarrier(),i=AndroidInterface.getWifiAccessPoints();try{e=AndroidInterface.getCellTowerInformation()}catch(e){console.log(e)}var r=[],c=[];i&&(r=parseQuery(i)),e&&(c=removeFalseCellIds(parseQuery(e)));var s={};return t&&(s.homeMobileCountryCode=Number(t)),n&&(s.homeMobileNetworkCode=Number(n)),o&&(s.carrier=o),a&&(s.radioType=a),r.length&&(s.wifiAccessPoints=r),c.length&&(s.cellTowers=c),r.length&&c.length?s.considerIp=!1:s.considerIp=!0,s}function removeFalseCellIds(e){var t=2147483647;return e.filter(function(e){return 0<e.cellId&&e.cellId<t&&0<e.locationAreaCode&&e.locationAreaCode<t})}function parseQuery(e){var n=[];return e.split(",").forEach(function(e){var t=new URLSearchParams(e);n.push(queryPatramsToObject(t))}),n}function queryPatramsToObject(e){var n={};return e.forEach(function(e,t){n[t]="macAddress"===t?e:Number(e)}),n}function createElement(e,t){var n=document.createElement(e);return Object.keys(t).forEach(function(e){n[e]=t[e]}),n}function Dialog(e,t){this.title=e,this.content=t}function tabBarBase(){var e=createElement("div",{className:"mdc-tab-bar"});e.setAttribute("role","tablist");var t=createElement("div",{className:"mdc-tab-scroller"}),n=createElement("div",{className:"mdc-tab-scroller__scroll-area"}),a=createElement("div",{className:"mdc-tab-scroller__scroll-content"});return n.appendChild(a),t.appendChild(n),e.appendChild(t),e}function addTabs(e){var t=createElement("button",{className:"mdc-tab"});t.setAttribute("role","tab");var n=createElement("span",{className:"mdc-tab-indicator"});n.appendChild(createElement("span",{className:"mdc-tab-indicator__content mdc-tab-indicator__content--underline"})),e.index||(t.setAttribute("aria-selected","true"),t.setAttribute("tabindex","0"),t.classList.add("mdc-tab--active"),n.classList.add("mdc-tab-indicator--active"));var a=createElement("div",{className:"mdc-tab__content"}),o=createElement("span",{className:"mdc-tab__text-label",textContent:e.name});a.appendChild(o);var i=createElement("span",{className:"mdc-tab__ripple"});return t.appendChild(a),t.appendChild(n),t.appendChild(i),t}function InputField(){}function textAreaField(e){var t=createElement("textarea",{className:"text-area-basic mdc-text-field__input",rows:e.rows});return t.value=e.value,e.readonly||t.setAttribute("readonly","true"),t}function selectMenu(e){for(var t=createElement("div",{className:"mdc-select"}),n=createElement("i",{className:"mdc-select__dropdown-icon"}),a=createElement("select",{className:"mdc-select__native-control"}),o=0;o<e.data.length;o++)a.appendChild(createElement("option",{textContent:e.data[o],value:e.data[o],selected:e.data[o]===e.selected}));var i=createElement("label",{className:"mdc-floating-label",textContent:e.labelText});t.appendChild(n),t.appendChild(a),t.appendChild(i);var r=new InputField;return t.appendChild(r.ripple()),new mdc.select.MDCSelect(t)}function notchedOultine(){var e=createElement("div",{className:"mdc-notched-outline"}),t=createElement("div",{className:"mdc-notched-outline__leading"}),n=createElement("div",{className:"mdc-notched-outline__trailing"});return e.appendChild(t),e.appendChild(n),e}function Button(e){this.name=e;var t=createElement("button",{className:"mdc-button"});t.appendChild(createElement("span",{className:"mdc-button__label",textContent:this.name})),this.base=t}function iconButton(e){return this.base=createElement("button",{className:"mdc-icon-button "+e.className,id:e.id}),this.base.setAttribute("aria-label",e.label),this.base.setAttribute("aria-hidden","true"),this.base.setAttribute("aria-pressed","false"),this.base.appendChild(createElement("i",{className:"material-icons mdc-icon-button__icon mdc-icon-button__icon--on",textContent:e.initialState})),this.base.appendChild(createElement("i",{className:"material-icons mdc-icon-button__icon",textContent:e.finalState})),new mdc.iconButton.MDCIconButtonToggle(this.base)}function Fab(e){this.fabName=e;var t=createElement("button",{className:"mdc-fab"});this.span=createElement("span",{className:"mdc-fab__icon material-icons",textContent:this.fabName}),t.appendChild(this.span),this.base=t}function AppendMap(e){this.el=e,this.options={zoom:16,disableDefaultUI:!0},this.location=""}function radioList(e){var t=document.createElement("li");t.className="mdc-list-item",t.setAttribute("role","radio"),e.index&&t.setAttribute("tabindex","0"),e.selected&&t.setAttribute("aria-checked","true");var n=createElement("span",{className:"mdc-list-item__graphic"});n.appendChild(createRadioInput(e)),t.appendChild(n);var a=createElement("label",{className:"mdc-list-item__text",textContent:e.labelText.charAt(0).toUpperCase()+e.labelText.slice(1)});return t.appendChild(a),a.setAttribute("for","list-radio-item-"+e.index),t}function userList(e,t){var n=document.createElement("li");n.className="mdc-list-item",n.dataset.phoneNumber=e.value.mobile,e.index&&n.setAttribute("tabindex","0"),e.selected&&n.setAttribute("aria-checked","true");var a=createElement("object",{className:"mdc-list-item__graphic",data:e.value.photoURL||"./img/empty-user.jpg",type:"image/jpeg"}),o=createElement("img",{className:"empty-user-assignee",src:"./img/empty-user.jpg"});a.appendChild(o),n.appendChild(a);var i=createElement("span",{className:"mdc-list-item__text"});if(i.appendChild(createElement("span",{className:"mdc-list-item__primary-text",textContent:e.value.displayName||e.value.mobile})),i.appendChild(createElement("span",{className:"mdc-list-item__secondary-text",textContent:e.value.mobile})),n.appendChild(i),t){var r=createElement("span",{className:"mdc-list-item__meta"});e.singleSelection?(n.setAttribute("role","radio"),r.appendChild(createRadioInput(e))):(n.setAttribute("role","checkbox"),e.disabled=!0,r.appendChild(createCheckBox(e))),n.appendChild(r)}return n}function createRadioInput(e){var t=createElement("div",{className:"mdc-radio"}),n=createElement("input",{className:"mdc-radio__native-control"});n.setAttribute("name","listDemoRadioGroup"),n.type="radio",n.value=JSON.stringify(e.value),n.id="list-radio-item-"+e.index;var a=createElement("div",{className:"mdc-radio__background"}),o=createElement("div",{className:"mdc-radio__outer-circle"}),i=createElement("div",{className:"mdc-radio__inner-circle"});return a.appendChild(o),a.appendChild(i),t.appendChild(n),t.appendChild(a),t}function createCheckBox(e){var t=createElement("div",{className:"mdc-checkbox mdc-list-item__meta"});e.disabled&&t.classList.add("mdc-checkbox--disabled");var n=createElement("input",{className:"mdc-checkbox__native-control",type:"checkbox",value:JSON.stringify(e.value)});n.setAttribute("tabindex","-1");var a=createElement("div",{className:"mdc-checkbox__background"});return a.innerHTML='<svg class="mdc-checkbox__checkmark"\n      viewBox="0 0 24 24">\n      <path class="mdc-checkbox__checkmark-path"\n      fill="none"\n      d="M1.73,12.91 8.1,19.28 22.79,4.59"/>\n      </svg>\n      <div class="mdc-checkbox__mixedmark"></div>',t.appendChild(n),t.appendChild(a),t}function chipSet(e,t){var n=createElement("div",{className:"mdc-chip-set"}),a=createElement("div",{className:"mdc-chip mdc-chip--selected"}),o=createElement("div",{className:"mdc-chip__text chip-text",textContent:e});if(a.appendChild(o),t){var i=createElement("i",{className:"material-icons mdc-chip__icon mdc-chip__icon--trailing",textContent:"cancel"});i.setAttribute("tabindex","0"),i.setAttribute("role","button"),a.appendChild(i)}return n.appendChild(a),n}function AppKeys(){this.mode="dev"}Dialog.prototype.create=function(){var e=createElement("div",{className:"mdc-dialog",role:"alertDialog"});e.setAttribute("aria-modal","true"),e.setAttribute("aria-labelledby","Title"),e.setAttribute("aria-describedby","content");var t=createElement("div",{className:"mdc-dialog__container"}),n=createElement("div",{className:"mdc-dialog__surface"}),a=createElement("h2",{className:"mdc-dialog__title "+(this.title?"":"hidden"),textContent:this.title}),o=createElement("div",{className:"mdc-dialog__content"});this.content instanceof HTMLElement?o.appendChild(this.content):o.textContent=this.content;var i=createElement("footer",{className:"mdc-dialog__actions"}),r=createElement("button",{className:"mdc-button mdc-dialog__button",type:"button",textContent:"cancel"});r.setAttribute("data-mdc-dialog-action","close");var c=createElement("button",{className:"mdc-button mdc-dialog__button",type:"button",textContent:"Create"});c.setAttribute("data-mdc-dialog-action","accept"),i.appendChild(r),i.appendChild(c),n.appendChild(a),n.appendChild(o),n.appendChild(i),t.appendChild(n),e.appendChild(t),e.appendChild(createElement("div",{className:"mdc-dialog__scrim"}));var s=document.getElementById("dialog-container");return s.innerHTML="",s.appendChild(e),new mdc.dialog.MDCDialog(e)},InputField.prototype.base=function(){return createElement("div",{className:"mdc-text-field filled-background  mdc-text-field--fullwidth"})},InputField.prototype.input=function(){return createElement("input",{className:"mdc-text-field__input"})},InputField.prototype.ripple=function(){return createElement("div",{className:"mdc-line-ripple"})},InputField.prototype.label=function(e){return createElement("label",{className:"mdc-floating-label",textContent:e})},InputField.prototype.withoutLabel=function(){var e=this.base(),t=this.input();return e.appendChild(t),e.appendChild(this.ripple()),new mdc.textField.MDCTextField(e)},InputField.prototype.withLabel=function(e){var t=this.base(),n=this.input();return t.appendChild(n),t.appendChild(this.label(e)),t.appendChild(this.ripple()),new mdc.textField.MDCTextField(t)},InputField.prototype.withLeadingIcon=function(e,t){var n=this.base();n.classList.remove("data--value-list","mdc-text-field--fullwidth"),n.classList.add("mdc-text-field--with-leading-icon");var a=createElement("i",{className:"material-icons mdc-text-field__icon",textContent:e});return n.appendChild(a),n.appendChild(this.input()),n.appendChild(this.label(t)),n.appendChild(this.ripple()),new mdc.textField.MDCTextField(n)},Button.prototype.getButton=function(){return new mdc.ripple.MDCRipple(this.base)},Button.prototype.disabled=function(e){this.base.disabled=e},Button.prototype.raised=function(){this.base.classList.add("mdc-button--raised")},Button.prototype.shaped=function(){this.base.classList.add("shaped")},Button.prototype.selectorButton=function(){this.base.classList.add("selector-send","selector-submit--button")},Fab.prototype=Object.create(new Button),Fab.prototype.extended=function(e){this.base.classList.add("mdc-fab--extended");var t=createElement("label",{className:"mdc-fab__label",textContent:e});return this.base.appendChild(t),this.getButton()},AppendMap.prototype.setLocation=function(e){this.options.center=e,this.location=e},AppendMap.prototype.setZoom=function(e){this.options.zoom=e},AppendMap.prototype.map=function(){return new google.maps.Map(this.el,this.options)},AppendMap.prototype.withCustomControl=function(){var e=document.createElement("div");new MapsCustomControl(e,map,this.location.lat,this.location.lng);e.index=1,map.controls[google.maps.ControlPosition.TOP_LEFT].push(e)},AppendMap.prototype.getMarker=function(t){var n={position:this.location,map:this.map()};return t&&Object.keys(t).forEach(function(e){n[e]=t[e]}),this.el.style.height="400px",new google.maps.Marker(n)},AppendMap.prototype.geocodeCustomerMarker=function(n){return new Promise(function(e,t){google.maps.event.addListener(n,"dragend",function(){geocodePosition(n.getPosition(),data).then(function(e){e.customerRecord?addressField.value=e.customerRecord.venue[0].address:addressField.value=e.venue[0].address}).catch(function(e){handleError({message:"geocode Error in autocomplete listener for"+data.template,body:JSON.stringify(e)}),locationErrorText.textContent="Failed to detect your current Location. Search For A new Location or choose existing"})})})},AppKeys.prototype.getMode=function(){return this.mode},AppKeys.prototype.getMapKey=function(){return"production"===this.mode?"AIzaSyA4s7gp7SFid_by1vLVZDmcKbkEcsStBAo":"AIzaSyCadBqkHUJwdcgKT11rp_XWkbQLFAy80JQ"},AppKeys.prototype.getKeys=function(){return"production"===this.mode?{apiKey:this.getMapKey(),authDomain:"growthfile-207204.firebaseapp.com",databaseURL:"https://growthfile-207204.firebaseio.com",projectId:"growthfile-207204",storageBucket:"growthfile-207204.appspot.com",messagingSenderId:"701025551237"}:{apiKey:this.getMapKey(),authDomain:"growthfilev2-0.firebaseapp.com",projectId:"growthfilev2-0",messagingSenderId:"1011478688238"}},AppKeys.prototype.getBaseUrl=function(){return"production"===this.mode?"https://api2.growthfile.com/api/":"https://us-central1-growthfilev2-0.cloudfunctions.net/api/"};var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function conversation(e,t){document.body.classList.remove("mdc-dialog-scroll-lock"),window.removeEventListener("scroll",handleScroll,!1),checkIfRecordExists("activity",e).then(function(e){e?(t&&history.pushState(["conversation",e],null,null),fetchAddendumForComment(e)):(resetScroll(),listView())}).catch(handleError)}function checkIfRecordExists(o,i){return new Promise(function(n,e){var t=firebase.auth().currentUser,a=window.indexedDB.open(t.uid);a.onsuccess=function(){a.result.transaction(o).objectStore(o).get(i).onsuccess=function(e){var t=e.target.result;n(!!t&&i)}},a.onerror=function(){e({message:a.error.message+" from checkIfRecordExists"})}})}function fetchAddendumForComment(o){if(o){var i=firebase.auth().currentUser,r=window.indexedDB.open(i.uid);r.onsuccess=function(){var n=r.result,e=n.transaction(["addendum"],"readonly"),t=e.objectStore("addendum").index("activityId");createHeaderContent(n,o),commentPanel(o),statusChange(n,o),reinitCount(n,o);var a=document.getElementById("chat-container");t.openCursor(o).onsuccess=function(e){var t=e.target.result;t&&(document.getElementById(t.value.addendumId)||createComment(n,t.value,i).then(function(e){a&&a.appendChild(new mdc.ripple.MDCRipple(e).root_)}),t.continue())},e.oncomplete=function(){a&&(console.log(a.scrollHeight),window.scrollTo(0,a.scrollHeight))}}}}function commentPanel(t){if(document.body.style.backgroundColor="white",!document.querySelector(".activity--chat-card-container")){var e=document.createElement("div");e.id="chat-container";var n=createElement("div",{className:"chat-bottom-action"}),a=document.createElement("div");a.className="status--change-cont",n.appendChild(a);var o=createElement("div",{className:"chat-input-container"}),i=document.createElement("div");i.id="write--comment";var r=document.createElement("input");r.className="comment-field mdc-elevation--z4",r.type="text",i.appendChild(r),o.appendChild(i);var c=document.createElement("button");c.classList.add("mdc-fab","mdc-fab--mini","hidden"),c.id="send-chat--input";var s=document.createElement("span");s.classList.add("mdc-fac__icon","material-icons"),s.textContent="send",c.appendChild(s),o.appendChild(c),n.appendChild(o),document.getElementById("app-current-panel").innerHTML=e.outerHTML+n.outerHTML,document.querySelector(".comment-field").oninput=function(e){toggleCommentButton(e.target.value&&e.target.value.replace(/\s/g,"").length)},document.getElementById("send-chat--input").onclick=function(){if(isLocationStatusWorking()){progressBar.foundation_.open();var e=document.querySelector(".comment-field").value;requestCreator("comment",{activityId:t,comment:e}),document.querySelector(".comment-field").value="",toggleCommentButton(!1)}}}}function toggleCommentButton(e){var t=document.getElementById("send-chat--input"),n=document.getElementById("write--comment"),a=document.querySelector(".status--change-cont");a.style.opacity=e?(t.classList.remove("hidden"),n.style.width="80%","0"):(t.classList.add("hidden"),n.style.width="100%",n.style.transition="0.3s ease",a.style.transition="0.3s ease","1")}function statusChange(e,t){var d=document.createElement("label");d.setAttribute("for","toggle-status"),d.textContent="Done",e.transaction("activity").objectStore("activity").get(t).onsuccess=function(e){var t=document.querySelector(".status--change-cont"),n=e.target.result;if(!n.canEdit||"CANCELLED"===n.status){var a=document.createElement("span"),o=e.target.result;return a.textContent="Activity "+o.status.toLowerCase(),void(t&&(t.innerHTML=a.outerHTML,t.style.textAlign="center"))}if(0!=n.editable){if(!document.querySelector(".status-check")){var i=document.createElement("div");i.className="mdc-form-field form-field-status";var r=document.createElement("div");r.className="mdc-checkbox status-check";var c=document.createElement("input");c.className="mdc-checkbox__native-control",c.id="toggle-status",c.type="checkbox";var s=document.createElement("div");s.className="mdc-checkbox__background";document.createElement("div").className="mdc-checkbox__mixedmark",s.innerHTML='<svg class="mdc-checkbox__checkmark"\n      viewBox="0 0 24 24">\n      <path class="mdc-checkbox__checkmark-path"\n      fill="none"\n      d="M1.73,12.91 8.1,19.28 22.79,4.59"/>\n      </svg>\n      <div class="mdc-checkbox__mixedmark"></div>',r.appendChild(c),r.appendChild(s),i.appendChild(r),t&&(t.innerHTML=i.outerHTML+d.outerHTML)}document.querySelector(".mdc-checkbox")&&(switchControl=new mdc.checkbox.MDCCheckbox.attachTo(document.querySelector(".mdc-checkbox")),"CONFIRMED"===n.status&&(switchControl.checked=!0),document.querySelector(".mdc-checkbox").onclick=function(){isLocationStatusWorking()?changeStatusRequest(switchControl,n):"CONFIRMED"===n.status?switchControl.checked=!0:switchControl.checked=!1})}else t&&(t.innerHTML=d.outerHTML+loader("status-loader").outerHTML)}}function changeStatusRequest(e,t){document.querySelector(".form-field-status").classList.add("hidden"),document.querySelector(".status--change-cont").appendChild(loader("status-loader")),e.checked?requestCreator("statusChange",{activityId:t.activityId,status:"CONFIRMED"}):requestCreator("statusChange",{activityId:t.activityId,status:"PENDING"})}function createComment(e,u,t){var m=!1;return new Promise(function(c){var s=document.createElement("div");s.classList.add("comment-box","talk-bubble","tri-right","round","btm-left"),t.phoneNumber===u.user?s.classList.add("current-user--comment","secondary-color-light"):s.classList.add("other-user--comment","mdc-theme--primary-bg"),s.id=u.addendumId;var d=document.createElement("div");d.classList.add("talktext");var l=document.createElement("p");l.classList.add("user-name--comment","mdc-typography--subtitle2"),getUserRecord(e,u.user).then(function(e){e.displayName?l.textContent=e.displayName:l.textContent=e.mobile;var t=document.createElement("p");t.classList.add("comment","mdc-typography--subtitle2"),t.textContent=u.comment;var n=document.createElement("span");n.className="comment--info";var a=document.createElement("span");a.textContent=moment(u.timestamp).format("DD-MM-YY H:mm"),a.classList.add("comment-date","mdc-typography--caption");var o=document.createElement("div"),i=document.createElement("i");i.classList.add("user-map--span","material-icons"),i.appendChild(document.createTextNode("location_on")),i.dataset.latitude=u.location._latitude,i.dataset.longitude=u.location._longitude,o.appendChild(i);var r=document.createElement("div");r.className="map-convo",o.onclick=function(e){if(hasMapsApiLoaded()){m=!m;var t={lat:u.location._latitude,lng:u.location._longitude},n=new AppendMap(r);n.setLocation(t),n.setZoom(18),n.getMarker(),i.textContent=m?(r.style.height="200px","arrow_drop_down"):(r.style.height="0px","location_on")}},n.appendChild(a),n.appendChild(o),d.appendChild(l),d.appendChild(t),d.appendChild(n),s.appendChild(d),s.appendChild(r),c(s)})})}function hasMapsApiLoaded(){try{return"object"===("undefined"==typeof google?"undefined":_typeof(google))&&"object"===_typeof(google.maps)}catch(e){return!1}}function createHeaderContent(t,e){var c=document.getElementById("section-start");c.innerHTML="";var n=t.transaction("activity").objectStore("activity"),s=headerBackIcon();n.get(e).onsuccess=function(e){var r=e.target.result;getUserRecord(t,r.creator).then(function(e){var t=document.createElement("object");t.data=e.photoURL||"./img/empty-user.jpg",t.className="header--icon-creator",t.type="image/jpeg";var n=document.createElement("img");n.src="./img/empty-user.jpg",n.className="header--icon-creator",t.appendChild(n);var a=document.createElement("div");a.className="mdc-top-app-bar__title mdc-typography--subtitle2";var o=document.createElement("span");o.textContent=r.activityName,o.className="",a.onclick=function(){checkIfRecordExists("activity",r.activityId).then(function(e){e?updateCreateActivity(r):(resetScroll(),listView())}).catch(handleError)};var i=document.createElement("span");i.textContent="Click here to see details",c.appendChild(s),c.appendChild(t),a.appendChild(o),a.appendChild(document.createElement("br")),a.appendChild(i),c.appendChild(a)})}}function reinitCount(e,t){var n=e.transaction(["list"],"readwrite"),a=n.objectStore("list");a.get(t).onsuccess=function(e){var t=e.target.result;t&&(t.count=0,a.put(t))},n.oncomplete=function(){}}function noSelectorResult(e){var t=document.createElement("div");t.className="data-not-found";var n=document.createElement("p");return n.className="mdc-typography--headline5",n.textContent=e,t.appendChild(n),t}function checkMapStoreForNearByLocation(c,s){return new Promise(function(o,i){var r=indexedDB.open(firebase.auth().currentUser.uid);r.onsuccess=function(){var a=[],e=r.result.transaction(["map"]),t=e.objectStore("map").index("byOffice"),n=IDBKeyRange.bound([c,""],[c,"￿"]);t.openCursor(n).onsuccess=function(e){var t=e.target.result;t&&(t.value.location&&t.value.latitude&&t.value.longitude&&isLocationLessThanThreshold(calculateDistanceBetweenTwoPoints(t.value,s))&&a.push(t.value),t.continue())},e.oncomplete=function(){var t={};a.forEach(function(e){t[e.location]=e});var n=[];Object.keys(t).forEach(function(e){n.push(t[e])});var e=n.sort(function(e,t){return e.accuracy-t.accuracy});o(e)},e.onerror=function(){i(e.error)}}})}function createTempRecord(n,r,c){var e=firebase.auth().currentUser.uid,a=indexedDB.open(e);a.onsuccess=function(){var e=a.result.transaction(["subscriptions"]).objectStore("subscriptions").index("officeTemplate"),t=IDBKeyRange.only([n,r]);e.get(t).onsuccess=function(e){var a=e.target.result;if(a){var n=void 0;c.schedule?n=c.schedule:(n=[],a.schedule.forEach(function(e){var t={};t.name=e,t.startTime="",t.endTime="",n.push(t)})),c.attachment&&Object.keys(c.attachment).forEach(function(e){a.attachment[e]=c.attachment[e]});var o={office:a.office,template:a.template,venue:"",schedule:n,attachment:a.attachment,timestamp:Date.now(),canEdit:!0,assignees:[],activityName:a.template.toUpperCase(),create:!0},i=[];"check-in"!==r?(a.venue.forEach(function(e){var t={};t.venueDescriptor=e,t.location="",t.address="",t.geopoint={_latitude:"",_longitude:""},i.push(t)}),o.venue=i,"tour plan"!==r&&"dsr"!==r&&"duty roster"!==r&&"customer"!==r?updateCreateActivity(o):manageLocation().then(function(e){geocodePosition({lat:e.latitude,lng:e.longitude}).then(function(e){return createBlendedCustomerRecord(o,e)})}).catch(function(e){return handleError(e),createBlendedCustomerRecord(o)})):getRootRecord().then(function(e){var t={};t.venueDescriptor=a.venue[0],t.location="",t.address="",t.geopoint={_latitude:"",_longitude:""},o.venue=[t];var n=isLastLocationOlderThanThreshold(e.location.lastLocationTime,5);if(e.location&&!n)return updateCreateActivity(o);manageLocation().then(function(e){updateCreateActivity(o)}).catch(locationErrorDialog)})}}}}function createBlendedCustomerRecord(t,n){if("customer"===t.template){var e=[createVenueObjectWithGeoCode(t.venue[0].venueDescriptor,n)];return t.venue=e,updateCreateActivity(t)}getSubscription(t.office,"customer").then(function(e){if(!e)return t.customerRecord=!1,updateCreateActivity(t);e.venue=[createVenueObjectWithGeoCode(e.venue[0],n)],t.customerRecord=e,updateCreateActivity(t)})}function hasAnyValueInChildren(o,i,r){var e=firebase.auth().currentUser.uid,c=indexedDB.open(e),s=[];return new Promise(function(a){c.onsuccess=function(){var e=c.result.transaction(["children"]),t=e.objectStore("children").index("templateStatus"),n=IDBKeyRange.bound([i,"CONFIRMED"],[i,"PENDING"]);t.openCursor(n).onsuccess=function(e){var t=e.target.result;t&&(t.value.office===o&&(r&&"customer"===i?t.value.attachment.Name.value===r&&s.push(t.value):s.push(t.value)),t.continue())},e.oncomplete=function(){a(s)}}})}function convertKeyToId(e){return e.replace(/-/g,"--").replace(/\s/g,"-")}function convertIdToKey(e){return e.replace(/-/g," ").replace("  ","-")}function updateCreateContainer(e,t){document.body.style.backgroundColor="#eeeeee",document.body.classList.remove("mdc-dialog-scroll-lock");var n=document.createElement("span");n.textContent=e.activityName,n.className="mdc-top-app-bar__title";var a=headerBackIcon(),o=document.getElementById("section-start");o.innerHTML="",o.appendChild(a),o.appendChild(n);var i=document.createElement("div");i.className="update-create--activity";for(var r=["office","venue","schedule","attachment","assignees"],c=0;c<5;c++){var s=document.createElement("ul");s.className="mdc-list custom--list-margin";var d=document.createElement("div");switch(r[c]){case"office":s.classList.remove("custom--list-margin");break;case"schedule":d.className="mdc-list-group__subheader",d.id="schedule--group";break;case"venue":"check-in"===e.template?e.canEdit&&((s=document.createElement("div")).style.marginTop="30px",s.style.paddingTop="0px",s.style.paddingBottom="0px",s.style.backgroundColor="white"):s.classList.add("mdc-list--two-line","mdc-list--avatar-list");break;case"assignees":s.classList.add("mdc-list--two-line","mdc-list--avatar-list")}"schedule"===r[c]?i.appendChild(d):(s.id=r[c]+"--list",i.appendChild(s))}if(e.canEdit){var l=document.createElement("button");l.setAttribute("aria-label","Send"),e.create?l.className="":t||(l.className="hidden"),l.id="send-activity",l.textContent="SUBMIT",i.appendChild(l)}return i}function updateCreateActivity(a,o){progressBar.foundation_.close(),"updateCreateActivity"===history.state[0]?history.replaceState(["updateCreateActivity",a],null,null):history.pushState(["updateCreateActivity",a],null,null),console.log(a);var e=firebase.auth().currentUser.uid,i=indexedDB.open(e);i.onsuccess=function(){var e=i.result;document.getElementById("app-current-panel").innerHTML=updateCreateContainer(a,o).outerHTML,document.getElementById("office--list").appendChild(createSimpleLi("Office",{office:a.office,showLabel:!0})),createVenueSection(a),createScheduleTable(a),createAttachmentContainer(a),createAssigneeList(a,e),createActivityCancellation(a),window.scrollTo(0,0),document.getElementById("send-activity")&&document.getElementById("send-activity").addEventListener("click",function(){isLocationStatusWorking()&&(this.dataset.progress=!0,insertInputsIntoActivity(a,!0))});for(var t=document.querySelectorAll(".update-create--activity input"),n=0;n<t.length;n++)t[n].addEventListener("input",function(e){document.getElementById("send-activity").dataset.progress||document.getElementById("send-activity").classList.contains("hidden")&&document.getElementById("send-activity").classList.remove("hidden")})}}function createSimpleLi(e,t){var n=document.createElement("li");n.className="mdc-list-item mdc-ripple-upgraded";var a=document.createElement("span");a.className="detail--static-text";document.createElement("span");var o=document.createElement("span");if("Office"===e&&(o.className="data--value-list",o.textContent=t.office,a.textContent=e,n.appendChild(a),n.appendChild(o)),"delete"===e&&(o.className="mdc-list-item__graphic material-icons",o.textContent=e,a.classList.remove("detail--static-text"),a.classList.add("delete-activity"),a.textContent=t.text,n.appendChild(o),n.appendChild(a)),"empty"===e&&(n.dataset.prop="delete"),"undo-deleted"===e){o.className="mdc-list-item__graphic material-icons",o.textContent="delete",a.classList.remove("detail--static-text"),a.classList.add("delete-activity"),a.textContent=t.text,n.appendChild(o),n.appendChild(a),n.classList.add("undo-delete-activity");var i=document.createElement("button");i.style.color="white",i.className="mdc-button mdc-ripple-upgraded mdc-list-item__meta undo-deleted",i.textContent="Undo",i.onclick=function(){isLocationStatusWorking()&&(document.querySelector(".undo-deleted").style.display="none",n.appendChild(loader("undo-delete-loader")),requestCreator("statusChange",{activityId:t.id,status:"PENDING"}))},n.appendChild(i)}return n}function createVenueSection(r){if("customer"!==r.template&&0!==r.venue.length){var c=document.getElementById("venue--list");"check-in"===r.template&&r.canEdit?getRootRecord().then(function(e){checkMapStoreForNearByLocation(r.office,e.location).then(function(e){if(e.length){var a=createElement("ul",{className:"mdc-list"});a.setAttribute("role","radiogroup"),a.style.marginTop="0px";var t=document.createElement("div"),n=createElement("span",{textContent:r.venue[0].venueDescriptor});t.appendChild(n);var o=new Fab("clear").getButton();o.root_.classList.add("add--assignee-icon"),o.root_.style.marginTop="-5px",t.appendChild(o.root_),t.className="detail--static-text check-in-desc",c.appendChild(t),e.forEach(function(e,t){t||(r.venue[0].location=e.location,r.venue[0].address=e.address,r.venue[0].geopoint._latitude=e.latitude,r.venue[0].geopoint._longitude=e.longitude);var n=new mdc.ripple.MDCRipple(radioList({value:e,index:t,selected:!t,labelText:e.location}));a.appendChild(n.root_)});var i=new mdc.list.MDCList(a);i.singleSelection=!0,i.listen("MDCList:action",function(e){var t=i.listElements[e.detail.index],n=JSON.parse(t.querySelector(".mdc-radio__native-control").value);r.venue[0].location=n.location,r.venue[0].address=n.address,r.venue[0].geopoint._latitude=n.latitude,r.venue[0].geopoint._longitude=n.longitude}),c.appendChild(a),o.root_.onclick=function(){var e=i.listElements[i.selectedIndex];new mdc.radio.MDCRadio(e.querySelector(".mdc-radio")).checked=!1,r.venue[0].location="",r.venue[0].address="",r.venue[0].geopoint._latitude="",r.venue[0].geopoint._longitude=""}}})}):(c.classList.add("mdc-list--two-line"),r.venue.forEach(function(e){var t=createVenueLi(e,!0,r);if(t){c.appendChild(t);var n=document.createElement("div");n.className="map-detail "+convertKeyToId(e.venueDescriptor),c.appendChild(n)}}))}}function setCheckinVenue(){}function createVenueLi(o,e,t,n){if("check-in"!==t.template||o.location){var i=!1,a=document.createElement("li");a.className="mdc-list-item mdc-ripple-upgraded",a.id=convertKeyToId(o.venueDescriptor);var r=document.createElement("div");r.className="mdc-list-item__text link--span";var c=document.createElement("span");c.className="mdc-list-item__primary-text";var s=document.createElement("span");s.className="mdc-list-item__meta";var d=new Fab("add_location").getButton();if(d.root_.classList.add("add--assignee-icon","attachment-selector-label"),e){var l=document.createElement("span");l.className="detail--static-text",l.textContent=o.venueDescriptor;var u=document.createElement("span");u.className="data--value-list",u.textContent=o.location,u.dataset.primary="",c.appendChild(l),c.appendChild(u),r.appendChild(c),r.onclick=function(e){if(hasMapsApiLoaded()&&o.geopoint._latitude&&o.geopoint._longitude){i=!i;var t={lat:o.geopoint._latitude,lng:o.geopoint._longitude},n=document.querySelector(".map-detail."+convertKeyToId(o.venueDescriptor)),a=new AppendMap(n);a.setZoom(18),a.setLocation(t),a.getMarker(),n.style.height=i?"200px":"0px"}},t.canEdit&&(s.setAttribute("aria-hidden","true"),s.appendChild(d.root_),d.root_.onclick=function(e){insertInputsIntoActivity(t),history.replaceState(["updateCreateActivity",t],null,null),selectorUI({record:t,store:"map",key:o.venueDescriptor})})}else c.textContent=o.location,r.appendChild(c);var m=document.createElement("span");m.className="mdc-list-item__meta material-icons",n&&(m.appendChild(createRadioInput()),a.onclick=function(){checkRadioInput(this,{location:o.location,address:o.address,geopoint:{_latitude:o.latitude,_longitude:o.longitude},venueDesc:o.venueDescriptor})});var p=document.createElement("span");return p.className="mdc-list-item__secondary-text",p.textContent=o.address,p.dataset.secondary="",r.appendChild(p),a.appendChild(r),n?a.appendChild(m):a.appendChild(s),a}}function createScheduleTable(s){s.schedule.length||(document.getElementById("schedule--group").style.display="none");var d=0;s.schedule.forEach(function(e){d++;var t=document.createElement("h5");t.className="mdc-list-group__subheader label--text",t.textContent=e.name;var n=document.createElement("ul");n.className="mdc-list mdc-list--dense";var a=document.createElement("li");a.className="mdc-list-item";var o=document.createElement("div");o.className="mdc-text-field start--date"+d;var i=document.createElement("input");i.value=moment(e.startTime||new Date).format("YYYY-MM-DD"),i.type="date",i.disabled=!s.canEdit,i.className="mdc-text-field__input",o.appendChild(i);var r=document.createElement("div");r.className="mdc-text-field end--date"+d;var c=document.createElement("input");c.value=moment(e.endTime||moment().add(1,"days")).format("YYYY-MM-DD"),c.type="date",c.disabled=!s.canEdit,c.className="mdc-text-field__input",r.appendChild(c),"leave"===s.template&&(i.onchange=function(e){var t=document.getElementById("Number-Of-Days");if(t){var n=moment(c.value).diff(moment(i.value),"days")+1;0<=n&&(t.querySelector("textarea").value=n)}},c.onchange=function(e){var t=document.getElementById("Number-Of-Days");if(t){var n=moment(c.value).diff(moment(i.value),"days")+1;0<=n&&(t.querySelector("textarea").value=n)}}),a.appendChild(o),a.appendChild(r),n.appendChild(a),document.getElementById("schedule--group").appendChild(t),document.getElementById("schedule--group").appendChild(n)})}function createAttachmentContainer(y){["Name","Number","Template","email","phoneNumber","HHMM","weekday","number","base64","string"].forEach(function(e){var t=document.createElement("div");t.className=e+"--group",document.getElementById("attachment--list").appendChild(t)});var b={phoneNumber:"",weekday:"","HH:MM":"",string:"",base64:"",number:"",email:""};Object.keys(y.attachment).forEach(function(n){var a=document.createElement("div");"HH:MM"===y.attachment[n].type?a.className="attachment-field HHMM":a.className="attachment-field  "+y.attachment[n].type,a.id=convertKeyToId(n),y.canEdit&&a.classList.add("editable--true");var e=createElement("label",{className:"label--text",textContent:n});if("string"===y.attachment[n].type)if("Name"===n||"Number"===n)if("customer"!==y.template){a.appendChild(e);var t=(new InputField).withoutLabel();t.root_.id=n,t.disabled=!y.canEdit,t.value=y.attachment[n].value,t.input_.required=!0,t.input_.placeholder="Enter Value",t.input_.oninput=function(e){y.attachment[n].value=e.target.value},a.appendChild(t.root_)}else{a.appendChild(e);var o=addNewCustomer(y);o.style.marginTop="0px",a.appendChild(o)}else{a.appendChild(e);var i=textAreaField({value:y.attachment[n].value,readonly:y.canEdit,rows:2});i.oninput=function(e){y.attachment[n].value=e.target.value,document.getElementById("send-activity").dataset.progress||document.getElementById("send-activity").classList.remove("hidden")},a.appendChild(i)}if("number"===y.attachment[n].type){if(a.appendChild(e),console.log(y),"Number Of Days"===n){var r=document.querySelector("#schedule--group .start--date1 input"),c=document.querySelector("#schedule--group .end--date1 input");y.attachment[n].value=moment(c.value).diff(r.value,"days")+1,console.log(moment(c.value).diff(r.value,"days")+1)}var s=(new InputField).withoutLabel();s.input_.type="number",s.value=y.attachment[n].value,y.canEdit?s.input_.oninput=function(e){y.attachment[n].value=Number(e.target.value)}:s.disabled=!0,a.appendChild(s.root_)}if("email"===y.attachment[n].type){a.appendChild(e);var d=(new InputField).withoutLabel();d.value=y.attachment[n].value,canEdit?d.input_.oninput=function(e){y.attachment[n].value=e.target.value}:d.disabled=!0,d.input_.type="email",a.appendChild(d.root_)}if("phoneNumber"===y.attachment[n].type){if(a.appendChild(e),a.classList.add("selector--margin","mdc-form-field"),y.attachment[n].value){a.style.padding="5px 15px 5px 15px";var l=new mdc.chips.MDCChip(chipSet(y.attachment[n].value,y.canEdit));l.listen("MDCChip:removal",function(e){y.attachment[n].value="",document.querySelector("#send-activity")&&document.querySelector("#send-activity").classList.remove("hidden")}),l.root_.classList.add("label--text"),l.root_.dataset.primary="",a.appendChild(l.root_)}if(y.canEdit){var u=new Fab("person_add").getButton();u.root_.classList.add("add--assignee-icon","attachment-selector-label"),a.appendChild(u.root_),u.root_.onclick=function(e){insertInputsIntoActivity(y),history.replaceState(["updateCreateActivity",y],null,null),selectorUI({record:y,store:"users",attachment:!0,key:n})}}}if("HH:MM"==y.attachment[n].type){a.appendChild(e);var m=(new InputField).withoutLabel();m.value=y.attachment[n].value||moment("24","HH:mm").format("HH:mm"),y.canEdit?m.input_.oninput=function(e){y.attachment[n].value=e.target.value}:m.disabled=!0,m.input_.type="time",a.appendChild(m.root_)}if("weekday"===y.attachment[n].type){var p=selectMenu({data:["sunday","tuesday","wednesday","thursday","friday","saturday","monday"],selected:y.attachment[n].value,labelText:n});console.log(p),y.canEdit?p.listen("change",function(e){document.getElementById("send-activity").dataset.progress||document.getElementById("send-activity").classList.remove("hidden"),y.attachment[n].value=e.target.value}):(p.root_.classList.add("mdc-select--disabled"),p.nativeControl_.setAttribute("disabled","true")),a.appendChild(p.root_)}if("base64"===y.attachment[n].type){var h=createElement("ul",{className:"image-preview--attachment mdc-image-list standard-image-list mdc-image-list--with-text-protection"});if(h.appendChild(setFilePath(y.attachment[n].value,n,!0)),y.canEdit){var f=new Fab("add_a_photo").getButton();f.root_.classList.add("attachment-selector-label","add--assignee-icon"),a.appendChild(f.root_),f.root_.onclick=function(){readCameraFile()}}a.appendChild(h)}if(!b.hasOwnProperty(y.attachment[n].type)){a.classList.add("mdc-form-field");a.appendChild(e);var v=document.createElement("span");if(y.attachment[n].value){var g=new mdc.chips.MDCChip(chipSet(y.attachment[n].value,y.canEdit));a.appendChild(g.root_),g.listen("MDCChip:removal",function(e){y.attachment[n].value="",document.querySelector("#send-activity")&&document.querySelector("#send-activity").classList.remove("hidden"),"Customer"===n&&y.hasOwnProperty("create")&&(y.customerRecord&&(manageLocation().then(function(e){geocodePosition({lat:e.latitude,lng:e.longitude}).then(function(e){y.customerRecord.venue=[createVenueObjectWithGeoCode(y.customerRecord.venue[0].venueDescriptor,e)]})}).catch(function(e){y.customerRecord.venue=[createVenueObjectWithGeoCode(y.customerRecord.venue[0].venueDescriptor)]}),y.customerRecord.attachment.Name.value=""),g.root_.parentNode.replaceChild(addNewCustomerButton(y,a).root_,g.root_))})}else"Customer"===n&&y.hasOwnProperty("create")&&y.customerRecord&&a.appendChild(addNewCustomerButton(y,a).root_);hasAnyValueInChildren(y.office,y.attachment[n].type).then(function(t){if(t.length&&y.canEdit){var e=new Fab("add").getButton();e.root_.classList.add("mdc-typography--subtitle2","mdc-button--dense","add--assignee-icon","attachment-selector-label"),e.root_.id="customer-selection-btn",a.appendChild(e.root_),a.classList.add("selector--margin"),e.root_.onclick=function(e){v.dataset.primary="",insertInputsIntoActivity(y),history.replaceState(["updateCreateActivity",y],null,null),selectorUI({record:y,store:"children",key:n,results:t})}}})}"HH:MM"===y.attachment[n].type?document.querySelector(".HHMM--group").appendChild(a):"Name"===n?document.querySelector(".Name--group").appendChild(a):b.hasOwnProperty(y.attachment[n].type)?document.querySelector("."+y.attachment[n].type+"--group").appendChild(a):document.querySelector(".Template--group").appendChild(a)})}function addNewCustomerButton(e,t){var n=new Button("Create New");n.shaped(),n.raised();var a=n.getButton();a.root_.classList.add("create-new-customer-btn");var o=!1;return a.root_.onclick=function(){o=!o,this.style.marginRight=o?(showCustomerContainer(e,t),this.textContent="Cancel",this.style.float="right","0px"):(hideCustomerContainer(e,t,this),this.textContent="Create New","15px")},a}function showCustomerContainer(e,t){t.classList.remove("mdc-form-field"),e.customerRecord?t.appendChild(addNewCustomer(e.customerRecord,e)):t.appendChild(addNewCustomer(e)),t.querySelector("#customer-selection-btn")&&t.querySelector("#customer-selection-btn").classList.add("hidden")}function hideCustomerContainer(t,e){e.classList.add("mdc-form-field"),document.querySelector(".customer-form")&&document.querySelector(".customer-form").remove(),t.customerRecord&&(manageLocation().then(function(e){geocodePosition({lat:e.latitude,lng:e.longitude}).then(function(e){t.customerRecord.venue=[createVenueObjectWithGeoCode(t.customerRecord.venue[0].venueDescriptor,e)]})}).catch(function(e){t.customerRecord.venue=[createVenueObjectWithGeoCode(t.customerRecord.venue[0].venueDescriptor)]}),t.customerRecord.attachment.Name.value=""),e.querySelector("#customer-selection-btn")&&e.querySelector("#customer-selection-btn").classList.remove("hidden")}function createAssigneeList(t,n){var a=document.getElementById("assignees--list"),e=createElement("li",{className:"mdc-list-item label--text add--assignee-loader",textContent:"Assignees"});if(t.canEdit){var o=createElement("span",{className:"mdc-list-item__meta"}),i=new Fab("person_add").getButton();i.root_.classList.add("add--assignee-icon"),i.root_.onclick=function(e){insertInputsIntoActivity(t),history.replaceState(["updateCreateActivity",t],null,null),selectorUI({record:t,store:"users"})},o.appendChild(i.root_),e.appendChild(o)}a.appendChild(e),t.assignees.forEach(function(e,t){getUserRecord(n,e).then(function(e){a.appendChild(new mdc.ripple.MDCRipple(userList({index:t,value:e},!1)).root_)})})}function checkRadioInput(e,t){document.getElementById("selector-submit-send").textContent="SELECT",[].concat(_toConsumableArray(document.querySelectorAll(".radio-selected"))).forEach(function(e){e.classList.remove("radio-selected")});var n=e;if(n){var a=new mdc.radio.MDCRadio(n.querySelector(".radio-control-selector"));a.root_.classList.add("radio-selected"),document.getElementById("selector-submit-send").dataset.type="",a.value=JSON.stringify(t)}}function setFilePath(e,t,n){if(document.querySelector(".image--list-li"))return document.getElementById("attachment-picture").data="data:image/jpg;base64,"+e,document.getElementById("attachment-picture").dataset.value="data:image/jpg;base64,"+e,void(document.getElementById("send-activity").dataset.progress||document.getElementById("send-activity").classList.remove("hidden"));var a=document.createElement("li");a.className="mdc-image-list__item image--list-li";var o=document.createElement("div"),i=document.createElement("object");i.data=e||"./img/placeholder.png",i.type="image/jpeg",i.id="attachment-picture",i.dataset.photoKey=t,i.className="profile-container--main mdc-image-list__image";var r=document.createElement("img");r.src="./img/placeholder.png",r.className="profile-container--main mdc-image-list__image",i.dataset.value=e?i.src=e:(i.data="./img/placeholder.png",""),i.appendChild(r),i.onclick=function(){var e=new Dialog("Photo",i).create();e.open(),e.listen("MDCDialog:closed",function(e){o.appendChild(i)})},o.appendChild(i),a.appendChild(o);var c=document.createElement("div");c.className="mdc-image-list__supporting";var s=document.createElement("span");return s.textContent=t,s.className="mdc-image-list__label",s.id="label--image",c.appendChild(s),a.appendChild(c),n?a:void 0}function readCameraFile(){if("Android"===native.getName())try{AndroidInterface.startCamera()}catch(e){sendExceptionObject(e,"CATCH Type 11: AndroidInterface.startCamera at readCameraFile",[])}else webkit.messageHandlers.takeImageForAttachment.postMessage("convert image to base 64")}function createActivityCancellation(n){if(n.canEdit){var e=document.createElement("div");if(e.className="status--cancel-cont",!n.hasOwnProperty("create"))if("CANCELLED"!==n.status){if("CANCELLED"!==n.status){if(e.appendChild(createSimpleLi("delete",{text:"CANCEL"})),document.querySelector(".update-create--activity").appendChild(e),!n.canEdit)return;document.querySelector(".delete-activity").addEventListener("click",function(e){var t=new Dialog(n.activityName+" will be deleted","Are you sure you want to delete this activity ? ").create();t.open(),t.listen("MDCDialog:closed",function(e){"accept"===e.detail.action&&isLocationStatusWorking()&&(document.querySelector(".delete-activity").style.display="none",document.querySelector(".status--cancel-cont li").appendChild(loader("cancel-loader")),requestCreator("statusChange",{activityId:n.activityId,status:"CANCELLED"}))})})}}else{e.appendChild(createSimpleLi("undo-deleted",{text:"Cancelled",id:n.activityId})),document.querySelector(".update-create--activity").appendChild(e);new mdc.ripple.MDCRipple.attachTo(document.querySelector(".undo-deleted"))}}}function concatDateWithTime(e,t){var n=moment(e+" "+t);return moment(n).valueOf()}function insertInputsIntoActivity(e,t){for(var n=document.querySelectorAll(".image-preview--attachment  object"),a=0;a<n.length;a++)e.attachment[convertKeyToId(n[a].dataset.photoKey)].value=n[a].dataset.value;for(var o=void 0,i=void 0,r=1;r<e.schedule.length+1;r++){if(o=moment(getInputText(".start--date"+r).value).valueOf(),i=moment(getInputText(".end--date"+r).value).valueOf(),o&&!i)return void snacks("Please Select a End Time");if(i&&!o)return void snacks("Please Select a Start Date");if(i<o)return void snacks("The End Date should be greater or equal to the start Date");e.schedule[r-1].startTime=o||"",e.schedule[r-1].endTime=i||""}if(t){var c=[];if(e.customerRecord&&e.customerRecord.attachment.Name.value){var s={share:[],office:e.customerRecord.office,venue:e.customerRecord.venue,schedule:e.customerRecord.schedule,attachment:e.customerRecord.attachment,template:e.customerRecord.template};for(r=0;r<e.customerRecord.venue.length;r++)e.customerRecord.venue[r].geopoint={latitude:e.customerRecord.venue[r].geopoint._latitude||"",longitude:e.customerRecord.venue[r].geopoint._longitude||""};c.push(s)}for(r=0;r<e.venue.length;r++)e.venue[r].geopoint={latitude:e.venue[r].geopoint._latitude||"",longitude:e.venue[r].geopoint._longitude||""};var d=void 0;if(e.hasOwnProperty("create"))d=e.assignees;else{d=[];for(r=0;r<e.assignees.length;r++)"object"===_typeof(e.assignees[r])&&d.push(e.assignees[r].phoneNumber)}var l={share:d,office:e.office,venue:e.venue,schedule:e.schedule,attachment:e.attachment,template:e.template};e.hasOwnProperty("create")||(l.activityId=e.activityId),c.push(l),sendUpdateReq(c,e)}}function sendUpdateReq(t,n){progressBar.foundation_.open(),document.querySelector("#send-activity").classList.add("hidden"),n.hasOwnProperty("create")?n.customerRecord?hasAnyValueInChildren(n.customerRecord.office,"customer",n.customerRecord.attachment.Name.value).then(function(e){if(!e.length)return requestCreator("create",t);(e[0].attachment.Name.value=n.customerRecord.attachment.Name.value)&&t.shift(),requestCreator("create",t)}):requestCreator("create",t):requestCreator("update",t[0])}function checkSpacesInString(e){return!e.replace(/\s/g,"").length}function formAddressComponent(e){var t="";return e.address_components&&(t=[e.address_components[0]&&e.address_components[0].short_name||"",e.address_components[1]&&e.address_components[1].short_name||"",e.address_components[2]&&e.address_components[2].short_name||""].join(" ")),t}function getSubscription(r,c){return new Promise(function(o){var e=firebase.auth().currentUser.uid,i=indexedDB.open(e);i.onsuccess=function(){var e=i.result.transaction(["subscriptions"]),t=e.objectStore("subscriptions").index("officeTemplate"),n=IDBKeyRange.only([r,c]),a=void 0;t.get(n).onsuccess=function(e){e.target.result&&"CANCELLED"!==e.target.result.status&&(a=e.target.result)},e.oncomplete=function(){return o(a)}}})}function addNewCustomer(t,n){var a=createElement("div",{className:"customer-form"}),o=createElement("span",{className:"customer-location-error mdc-typography--subtitle1"}),e=new InputField({id:"customer-name",labelText:"Customer Name",className:"filled-background mdc-text-field--fullwidth mdc-text-field"}),i=new InputField({id:"customer-name",labelText:"Customer Address",className:"mdc-text-field--fullwidth filled-background mdc-text-field"}),r=e.withoutLabel();r.value=t.attachment.Name.value,r.input_.placeholder="Customer Name",r.input_.id="customer-name",r.input_.required=!0,n&&t?n.canEdit||(r.root_.classList.add("mdc-text-field--disabled"),r.input_.setAttribute("disabled","true")):t.canEdit||(r.root_.classList.add("mdc-text-field--disabled"),r.input_.setAttribute("disabled","true")),r.input_.oninput=function(e){t.attachment.Name.value=e.target.value,n&&n.customerRecord&&(n.attachment.Customer.value=e.target.value)};var c=i.withoutLabel();c.input_.placeholder="Customer Address",c.input_.id="customer-address",c.value=t.venue[0].address,n&&t?n.canEdit||(c.root_.classList.add("mdc-text-field--disabled"),c.input_.setAttribute("disabled","true")):t.canEdit||(c.root_.classList.add("mdc-text-field--disabled"),c.input_.setAttribute("disabled","true"));var s=!1;s=!(!n||!t)||t.canEdit,a.appendChild(r.root_),a.appendChild(c.root_);var d=createElement("div",{id:"customer-address-map"}),l=new AppendMap(d);l.setZoom(18);var u=void 0;t.venue[0].location&&(l.setLocation({lat:t.venue[0].geopoint._latitude,lng:t.venue[0].geopoint._longitude}),a.style.minHeight="400px",s?(u=l.getMarker({draggable:!0}),google.maps.event.addListener(u,"dragend",function(){geocodePosition(u.getPosition()).then(function(e){c.value=e.formatted_address,t.venue[0]=createVenueObjectWithGeoCode(t.venue[0].venueDescriptor,e),document.querySelector("#send-activity")&&document.querySelector("#send-activity").classList.remove("hidden")})})):u=l.getMarker());var m=new google.maps.places.Autocomplete(c.input_,{componentRestrictions:{country:"in"}});return m.addListener("place_changed",function(){var e=m.getPlace();document.querySelector("#send-activity")&&document.querySelector("#send-activity").classList.remove("hidden"),l.setLocation({lat:e.geometry.location.lat(),lng:e.geometry.location.lng()}),t.venue[0]=createVenueObjectWithAutoComplete(t.venue[0].venueDescriptor,e),a.style.minHeight="400px",s?(u=l.getMarker({draggable:!0}),google.maps.event.addListener(u,"dragend",function(){geocodePosition(u.getPosition()).then(function(e){c.value=e.formatted_address,t.venue[0]=createVenueObjectWithGeoCode(t.venue[0].venueDescriptor,e),document.querySelector("#send-activity")&&document.querySelector("#send-activity").classList.remove("hidden")}).catch(function(e){handleError({message:"geocode Error in autocomplete listener for"+n.template,body:JSON.stringify(e)}),o.textContent="Failed to detect your current Location. Search For A new Location or choose existing"})})):u=l.getMarker()}),a.appendChild(d),a.appendChild(o),a}function geocodePosition(e,t){return new Promise(function(n){(new google.maps.Geocoder).geocode({latLng:e},function(e){if(e&&0<e.length){var t=e[0];return n(t)}return n(!1)},function(e){reject(e)})})}function modifyVenueRecordWithGeocode(e,t){var n=createVenueObjectWithGeoCode(t);return"customer"===e.template?(n.venueDescriptor=e.venue[0].venueDescriptor,e.venue[0]=n):(n.venueDescriptor=e.customerRecord.venue[0].venueDescriptor,e.customerRecord.venue[0]=n),e}function createVenueObjectWithGeoCode(e,t){return{location:t?t.formatted_address:"",address:t?t.formatted_address:"",geopoint:{_latitude:t?t.geometry.location.lat():"",_longitude:t?t.geometry.location.lng():""},venueDescriptor:e}}function createVenueObjectWithAutoComplete(e,t){return{location:t?t.name:"",address:t?formAddressComponent(t):"",geopoint:{_latitude:t?t.geometry.location.lat():"",_longitude:t?t.geometry.location.lng():""},venueDescriptor:e}}var appKey=new AppKeys,progressBar=void 0,snackBar=void 0,ui=void 0,drawer=void 0,topAppBar=void 0,native={setFCMToken:function(e){localStorage.setItem("token",e)},getFCMToken:function(){return localStorage.getItem("token")},setName:function(e){localStorage.setItem("deviceType",e)},getName:function(){return localStorage.getItem("deviceType")},setIosInfo:function(e){var t=new URLSearchParams(e),n={};t.forEach(function(e,t){n[t]="appVersion"===t?Number(e):e}),localStorage.setItem("deviceInfo",JSON.stringify(n))},getIosInfo:function(){return localStorage.getItem("deviceInfo")},getInfo:function(){if(!this.getName())return!1;if("Android"!==this.getName())return this.getIosInfo();var t=void 0;try{t=getDeviceInfomation(),localStorage.setItem("deviceInfo",t)}catch(e){sendExceptionObject(e,"Catch Type 3: AndroidInterface.getDeviceId in native.getInfo()",[]),t=JSON.stringify({baseOs:this.getName(),deviceBrand:"",deviceModel:"",appVersion:10,osVersion:"",id:""}),localStorage.setItem("deviceInfo",t)}return t}};function isNewDay(e){var t=localStorage.getItem("today");return t?!moment(moment().format("YYYY-MM-DD")).isSame(moment(t))&&(e&&localStorage.setItem("today",moment().format("YYYY-MM-DD")),!0):(e&&localStorage.setItem("today",moment().format("YYYY-MM-DD")),!0)}function getDeviceInfomation(){return JSON.stringify({id:AndroidInterface.getId(),deviceBrand:AndroidInterface.getDeviceBrand(),deviceModel:AndroidInterface.getDeviceModel(),osVersion:AndroidInterface.getOsVersion(),baseOs:AndroidInterface.getBaseOs(),radioVersion:AndroidInterface.getRadioVersion(),appVersion:Number(AndroidInterface.getAppVersion())})}function backNav(){history.back()}function resetScroll(){scroll_namespace.count=0,scroll_namespace.size=20,scroll_namespace.skip=!1}function firebaseUiConfig(t){return{callbacks:{signInSuccessWithAuthResult:function(e){if(t)return updateEmail(e.user,t),!1},signInFailure:function(e){return handleUIError(e)},uiShown:function(){}},signInFlow:"popup",signInOptions:[{provider:firebase.auth.PhoneAuthProvider.PROVIDER_ID,recaptchaParameters:{type:"image",size:"normal",badge:"bottomleft"},defaultCountry:"IN",defaultNationalNumber:t?firebase.auth().currentUser.phoneNumber:""}]}}function userSignedOut(){var e=document.createElement("div");e.id="login-container",document.body.appendChild(e),ui||(ui=new firebaseui.auth.AuthUI(firebase.auth())),ui.start("#login-container",firebaseUiConfig())}function startApp(e){firebase.auth().onAuthStateChanged(function(t){if(!t)return document.getElementById("start-loader").classList.add("hidden"),document.getElementById("main-layout-app").style.display="none",void userSignedOut();if("production"!==appKey.getMode()||native.getInfo()){if(localStorage.getItem("error")&&!isNewDay()||localStorage.setItem("error",JSON.stringify({})),e){var n=window.indexedDB.open(t.uid,5),a=void 0;n.onupgradeneeded=function(e){if((a=n.result).onerror=function(){handleError({message:a.error.message+" from startApp on upgradeneeded"})},e.oldVersion){if(e.oldVersion<4)n.transaction.objectStore("subscriptions").createIndex("status","status");if(e.oldVersion<5)n.transaction.objectStore("map").createIndex("bounds",["latitude","longitude"])}else createObjectStores(a,t.uid)},n.onsuccess=function(){a=n.result,document.getElementById("main-layout-app").style.display="block",localStorage.setItem("dbexist",t.uid),ga("set","userId",JSON.parse(native.getInfo()).id),mapView(),requestCreator("now",{device:native.getInfo(),from:"",registerToken:native.getFCMToken()})},n.onerror=function(){handleError({message:n.error.message+" from startApp"})}}}else redirect()})}function getEmployeeDetails(){return new Promise(function(o,i){var r=firebase.auth().currentUser,c=indexedDB.open(r.uid);c.onsuccess=function(){var e=c.result.transaction(["children"]),t=e.objectStore("children"),n=void 0,a=IDBKeyRange.bound(["employee","CONFIRMED"],["employee","PENDING"]);t.index("templateStatus").openCursor(a).onsuccess=function(e){var t=e.target.result;t&&(t.value.attachment["Employee Contact"].value===r.phoneNumber&&(n=t.value),t.continue())},e.oncomplete=function(){o(n)},e.onerror=function(){i({message:e.error.message+" from getEmployeeDetails"})}},c.onerror=function(){i({message:c.error.message+" from getEmployeeDetails"})}})}function isEmployeeOnLeave(){return new Promise(function(r,c){getEmployeeDetails().then(function(o){if(!o)return r(!1);o.onLeave=!1;var i=indexedDB.open(firebase.auth().currentUser.uid);i.onsuccess=function(){var e=i.result.transaction(["calendar"]),t=e.objectStore("calendar"),n=IDBKeyRange.bound(["leave","CONFIRMED",o.office],["leave","PENDING",o.office]),a=!1;t.index("onLeave").openCursor(n).onsuccess=function(e){var t=e.target.result;t&&(moment(moment().format("YYYY-MM-DD")).isBetween(t.value.start,t.value.end,null,"[]")?a=!0:t.continue())},e.oncomplete=function(){r(a)},e.onerror=function(){c({message:e.error.message+" from isEmployeeOnLeave"})}},i.onerror=function(){c({message:i.error.message+" from isEmployeeOnLeave"})}}).catch(function(e){c(e)})})}function createObjectStores(e,t){var n=e.createObjectStore("activity",{keyPath:"activityId"});n.createIndex("timestamp","timestamp"),n.createIndex("office","office"),n.createIndex("hidden","hidden");var a=e.createObjectStore("list",{keyPath:"activityId"});a.createIndex("timestamp","timestamp"),a.createIndex("status","status");var o=e.createObjectStore("users",{keyPath:"mobile"});o.createIndex("displayName","displayName"),o.createIndex("isUpdated","isUpdated"),o.createIndex("count","count"),e.createObjectStore("addendum",{autoIncrement:!0}).createIndex("activityId","activityId");var i=e.createObjectStore("subscriptions",{autoIncrement:!0});i.createIndex("office","office"),i.createIndex("template","template"),i.createIndex("officeTemplate",["office","template"]),i.createIndex("status","status");var r=e.createObjectStore("calendar",{autoIncrement:!0});r.createIndex("activityId","activityId"),r.createIndex("timestamp","timestamp"),r.createIndex("start","start"),r.createIndex("end","end"),r.createIndex("urgent",["status","hidden"]),r.createIndex("onLeave",["template","status","office"]);var c=e.createObjectStore("map",{autoIncrement:!0});c.createIndex("activityId","activityId"),c.createIndex("location","location"),c.createIndex("latitude","latitude"),c.createIndex("longitude","longitude"),c.createIndex("nearby",["status","hidden"]),c.createIndex("byOffice",["office","location"]),c.createIndex("bounds",["latitude","longitude"]);var s=e.createObjectStore("children",{keyPath:"activityId"});s.createIndex("template","template"),s.createIndex("office","office"),s.createIndex("templateStatus",["template","status"]),e.createObjectStore("root",{keyPath:"uid"}).put({uid:t,fromTime:0,location:""})}function redirect(){firebase.auth().signOut().then(function(){window.location="https://www.growthfile.com"}).catch(function(e){console.log(e),window.location="https://www.growthfile.com",handleError({message:e+" from redirect"})})}function runAppChecks(a){getUniqueOfficeCount().then(function(n){console.log(n);var t=[];n.length&&(n.forEach(function(e){t.push(getSubscription(e,"check-in"))}),Promise.all(t).then(function(e){if(e.length){var t=e.filter(function(e){return null!=e});checkInDialog(t,a,n),console.log(t)}}).catch(console.log))})}function checkInDialog(a,o,i){var e=void 0,r=void 0;if(1==i.length)e=new Dialog("Check-In Reminder","Do You want to create a Check-in ?").create();else{document.createElement("div");var n=createElement("ul",{className:"mdc-list"});n.setAttribute("role","radiogroup"),a.forEach(function(e,t){n.appendChild(radioList({labelText:e.office,index:t,value:e}))}),(r=new mdc.list.MDCList(n)).singleSelection=!0,(e=new Dialog("Check-In Reminder",n).create()).listen("MDCDialog:opened",function(e){r.layout(),r.listElements.map(function(e){return new mdc.ripple.MDCRipple.attachTo(e)})})}e.listen("MDCDialog:closed",function(e){var n=void 0;if("accept"===e.detail.action){if(1==i.length)n=a[0];else{var t=document.getElementById("list-radio-item-"+r.selectedIndex).value;if(!t)return;n=JSON.parse(t)}checkMapStoreForNearByLocation(n.office,o).then(function(e){var t={geopoint:{latitude:"",longitude:""},address:"",location:"",venueDescriptor:n.venue[0]};if(!e.length)return n.venue=[t],n.share=[],void requestCreator("create",[n]);t.location=e[0].location,t.address=e[0].address,t.geopoint.latitude=e[0].latitude,t.geopoint.longitude=e[0].longitude,n.venue=[t],n.share=[],console.log(n),requestCreator("create",[n])})}}),e.open()}function getUniqueOfficeCount(){return new Promise(function(t,n){var a=indexedDB.open(firebase.auth().currentUser.uid),o=[];a.onsuccess=function(){var e=a.result.transaction(["activity"]);e.objectStore("activity").index("office").openCursor(null,"nextunique").onsuccess=function(e){var t=e.target.result;t&&(o.push(t.value.office),t.continue())},e.oncomplete=function(){return t(o)},e.onerror=function(){return n({message:e.error.message,body:JSON.stringify(e.error)})}},a.onerror=function(){return n({message:a.error.message})}})}function checkMapStoreForNearByLocation(c,s){return new Promise(function(o,i){var r=indexedDB.open(firebase.auth().currentUser.uid);r.onsuccess=function(){var a=[],e=r.result.transaction(["map"]),t=e.objectStore("map").index("byOffice"),n=IDBKeyRange.bound([c,""],[c,"￿"]);t.openCursor(n).onsuccess=function(e){var t=e.target.result;t&&(t.value.location&&t.value.latitude&&t.value.longitude&&isLocationLessThanThreshold(calculateDistanceBetweenTwoPoints(t.value,s))&&a.push(t.value),t.continue())},e.oncomplete=function(){var t={};a.forEach(function(e){t[e.location]=e});var n=[];Object.keys(t).forEach(function(e){n.push(t[e])});var e=n.sort(function(e,t){return e.accuracy-t.accuracy});o(e)},e.onerror=function(){i(e.error)}}})}function mapView(){history.pushState(["mapView"],null,null),document.getElementById("section-start").innerHTML=' <a href="#" class="demo-menu material-icons mdc-top-app-bar__navigation-icon">menu</a>',(topAppBar=new mdc.topAppBar.MDCTopAppBar(document.querySelector(".mdc-top-app-bar"))).setScrollTarget(document.getElementById("main-content")),topAppBar.root_.classList.add("transparent"),document.getElementById("growthfile").classList.remove("mdc-top-app-bar--fixed-adjust");manageLocation().then(function(t){document.getElementById("start-loader").classList.add("hidden");var n={lat:t.latitude,lng:t.longitude},a=new google.maps.Map(document.getElementById("app-current-panel"),{center:n,zoom:20,disableDefaultUI:!0,gestureHandling:"greedy"});new google.maps.Marker({position:n,icon:"https://www.robotwoods.com/dev/misc/bluecircle.png"}).setMap(a);new google.maps.Circle({strokeColor:"#0399f4",strokeOpacity:.8,strokeWeight:2,fillColor:"#0399f4",fillOpacity:.35,map:a,center:n,radius:t.accuracy});google.maps.event.addListenerOnce(a,"idle",function(){console.log("idle_once");var e=document.createElement("div");new CenterControl(e,a,n);e.index=1,a.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(e),topAppBar.listen("MDCTopAppBar:nav",function(){drawer.open=!drawer.open,[].map.call(document.querySelectorAll(".mdc-drawer .mdc-list-item"),function(e){new mdc.ripple.MDCRipple(e)}),document.getElementById("drawer-icon").src=firebase.auth().currentUser.photoURL,document.getElementById("drawer-title").textContent=firebase.auth().currentUser.displayName||irebase.auth().currentUser.phoneNumber,document.getElementById("drawer-icon").onclick=function(){profileView()}}),runAppChecks(t)}),google.maps.event.addListener(a,"idle",function(){document.querySelector("#recenter-action span")&&(document.querySelector("#recenter-action span").style.color="black");var n=performance.now();loadNearByLocations(getMapBounds(a),a).then(function(e){var t=performance.now();console.log(t-n)})})}).catch(function(e){console.log(e),document.getElementById("growthfile").classList.add("mdc-top-app-bar--fixed-adjust"),document.getElementById("start-loader").classList.add("hidden"),document.getElementById("app-current-panel").innerHTML='<div><p>Failed To Detect You Location</p><button class="mdc-button" onclick=mapView()>Try Again</button></div>'})}function CenterControl(e,t,n){var a=new Fab("my_location").getButton();a.root_.id="recenter-action",a.root_.classList.add("custom-center-map"),console.log(a),e.appendChild(a.root_),a.root_.addEventListener("click",function(){a.root_.querySelector("span").style.color="#0399f4",t.setZoom(20),t.panTo(n)})}function getMapBounds(e){var t=e.getBounds().getNorthEast(),n=e.getBounds().getSouthWest();return{ne:[t.lat(),t.lng()],sw:[n.lat(),n.lng()]}}function loadNearByLocations(i,l){return new Promise(function(a,e){var c=new google.maps.InfoWindow({disableAutoPan:!0}),s=[],o=indexedDB.open(firebase.auth().currentUser.uid),d=void 0;console.log(i),o.onsuccess=function(){var e=o.result.transaction(["map"]),t=e.objectStore("map").index("bounds"),n=IDBKeyRange.bound(i.sw,i.ne);t.openCursor(n).onsuccess=function(e){var t=e.target.result;if(t)if(t.value.location&&t.value.latitude&&t.value.longitude){var n,a,o,i=new google.maps.Marker({position:{lat:t.value.latitude,lng:t.value.longitude},id:t.value.activityId,title:t.value.location});if(console.log(t.value.latitude,t.value.longitude),l.getBounds().contains(i.getPosition())){var r="<span>"+t.value.location+"</span>";google.maps.event.addListener(i,"click",(n=i,a=r,o=c,function(){d&&d.close(),o.setContent(a),o.open(l,n),d=o})),i.setMap(l),s.push(i)}t.continue()}else t.continue()},e.oncomplete=function(){return a(s)}}})}window.onpopstate=function(e){if(e.state){if("listView"!==e.state[0])return window[e.state[0]](e.state[1],!1);var t=scroll_namespace.count;t&&(scroll_namespace.size=t),scroll_namespace.count=0,window[e.state[0]]()}},window.addEventListener("load",function(){(firebase.initializeApp(appKey.getKeys()),progressBar=new mdc.linearProgress.MDCLinearProgress(document.querySelector(".mdc-linear-progress")),snackBar=new mdc.snackbar.MDCSnackbar(document.querySelector(".mdc-snackbar")),drawer=new mdc.drawer.MDCDrawer(document.querySelector(".mdc-drawer")),navigator,moment.updateLocale("en",{calendar:{lastDay:"[yesterday]",sameDay:"hh:mm",nextDay:"[Tomorrow at] LT",lastWeek:"dddd",nextWeek:"dddd [at] LT",sameElse:"L"},longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YY"},months:["January","February","March","April","May","June","July","August","September","October","November","December"]}),window.Worker||window.indexedDB)?startApp(!0):new Dialog("App Incompatiblity","Growthfile is incompatible with this device").create().open()});var scroll_namespace={count:0,size:20,skip:!1};function resetScroll(){scroll_namespace.count=0,scroll_namespace.size=20,scroll_namespace.skip=!0}function initDomLoad(){document.getElementById("start-loader").classList.remove("hidden"),progressBar.foundation_.close(),document.body.classList.remove("mdc-dialog-scroll-lock"),listPanel(),creatListHeader("Activities"),createActivityIcon()}function listView(){history.pushState(["listView"],null,null),initDomLoad(),getCountOfStore("list").then(function(t){if(!t)return document.getElementById("start-loader").classList.add("hidden"),void appendTextContentInListView("No activities Found");20<t&&window.addEventListener("scroll",handleScroll,!1),getRootRecord().then(function(e){t&&t<=20?loadActivitiesFromListStore(e.location):startCursor(e.location)})})}function appendTextContentInListView(e){var t=document.createElement("p");t.textContent=e,t.className="no-activity",document.getElementById("activity-list-main").appendChild(t),document.getElementById("activity-list-main").style.boxShadow="none"}function getCountOfStore(o){return new Promise(function(t,n){var a=indexedDB.open(firebase.auth().currentUser.uid);a.onsuccess=function(){var e=a.result.transaction([o]).objectStore(o).count();e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}},a.onerror=function(){n(a.error)}})}function updateEl(n,r){var a=indexedDB.open(firebase.auth().currentUser.uid);a.onsuccess=function(){var e=a.result.transaction(["list","activity"]),o=e.objectStore("activity"),t=e.objectStore("list"),i=document.getElementById("activity--list");n.forEach(function(a){document.querySelector(".no-activity")&&document.querySelector(".no-activity").remove(),t.get(a.activityId).onsuccess=function(e){var t=e.target.result,n=document.querySelector('[data-id="'+a.activityId+'"]');n&&n.remove(),t&&(r.location?getActivityDataForList(o,t,r.location).then(function(e){i&&i.insertBefore(e,i.childNodes[0])}):getActivityDataForList(o,t).then(function(e){i&&i.insertBefore(e,i.childNodes[0])}))}})}}function handleScroll(e){getRootRecord().then(function(e){if(window.innerHeight+window.scrollY===document.body.scrollHeight){if(!document.getElementById("activity--list"))return;startCursor(e.location)}})}function loadActivitiesFromListStore(o){var i=indexedDB.open(firebase.auth().currentUser.uid);i.onsuccess=function(){var e=i.result.transaction(["list","activity","root"]),n=e.objectStore("activity"),t=e.objectStore("list").index("timestamp"),a=document.createDocumentFragment();t.openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;t&&(getActivityDataForList(n,t.value,o).then(function(e){a.appendChild(e)}),t.continue())},e.oncomplete=function(){var e=document.getElementById("activity--list");document.getElementById("start-loader").classList.add("hidden"),e&&(e.innerHTML="",e.appendChild(a),scrollToActivity())}}}function startCursor(r){var c=indexedDB.open(firebase.auth().currentUser.uid);c.onsuccess=function(){var e=c.result.transaction(["list","activity","root"]),n=e.objectStore("activity"),t=e.objectStore("list").index("timestamp"),a=0,o=scroll_namespace.count,i=document.createDocumentFragment();t.openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;t&&(o?scroll_namespace.skip?(getActivityDataForList(n,t.value,r).then(function(e){i.appendChild(e),a++}),runCursor(t,a)):(scroll_namespace.skip=!0,t.advance(o)):(getActivityDataForList(n,t.value,r).then(function(e){i.appendChild(e),a++}),runCursor(t,a)))},e.oncomplete=function(){var e=document.getElementById("activity--list");document.getElementById("start-loader").classList.add("hidden"),e&&(e.appendChild(i),scroll_namespace.count=scroll_namespace.count+scroll_namespace.size,scroll_namespace.skip=!1,scroll_namespace.size=20,scrollToActivity())}}}function runCursor(e,t){t<scroll_namespace.size&&e.continue()}function getActivityDataForList(t,l,u){return new Promise(function(r,e){var c=document.createElement("div");c.style.marginTop="10px";var s=document.createElement("span");s.className="mdc-list-item__secondary-text venue-secondline";var d=document.createElement("span");d.className="mdc-list-item__secondary-text",t.get(l.activityId).onsuccess=function(e){var t=e.target.result;if(t){var n=t.schedule,a=t.venue,o=void 0,i=generateLastestSchedule(n,l.createdTime);u&&(o=generateLatestVenue(a,u)),o&&!i?(s.textContent=o,s.style.maxWidth="70%"):i&&!o?d.textContent=i:i&&o&&(s.textContent=o,d.textContent=" | "+i),c.appendChild(s),c.appendChild(d),r(new mdc.ripple.MDCRipple.attachTo(activityListUI(l,c)).root_)}}})}function generateLastestSchedule(e,t){var n=removeEmptyObjects(e,"startTime","endTime");if(!n.length)return formatCreatedTime(t);var a=Date.now();return getTimeTypeForMultipleSchedule(a,sortDatesInAscendingOrderWithPivot(a,n))}function removeEmptyObjects(e,t,n){return e.length?e.filter(function(e){if(e[t]&&e[n])return e}):e}function sortDatesInAscendingOrderWithPivot(e,t){var n=t.slice();return n.push(e),n.sort(function(e,t){return e-t})}function getTimeTypeForMultipleSchedule(e,t){var n=t.slice().indexOf(e);return n==t.length-1?moment(t[t.length-2]).format("D, MMM").replace(",",""):moment(t[n+1]).format("D, MMM").replace(",","")}function formatCreatedTime(e){return e?isToday(e)?moment(e).format("hh:mm"):moment(e).format("D, MMM").replace(",",""):""}function isToday(e){return(new Date).setHours(0,0,0,0)==new Date(e).setHours(0,0,0,0)}function generateLatestVenue(e,n){var t=removeEmptyObjects(e,"location","address"),a=t.length;if(!a)return"";if(1==a)return t[0].location;var o=[];return e.forEach(function(e){var t={latitude:e.geopoint._latitude,longitude:e.geopoint._longitude};o.push({distance:calculateDistanceBetweenTwoPoints(t,n),location:e.location})}),sortNearestLocation(o)[0].location}function sortNearestLocation(e){return e.slice().sort(function(e,t){return e.distance-t.distance})}function activityListUI(e,t){var n=document.createElement("li");n.dataset.id=e.activityId,n.onclick=function(){localStorage.setItem("clickedActivity",this.dataset.id),conversation(this.dataset.id,!0)},n.classList.add("mdc-list-item","activity--list-item","mdc-elevation--z1");var a=document.createElement("object");a.data=e.creator.photo||"./img/empty-user.jpg",a.type="image/jpeg",a.className="mdc-list-item__graphic material-icons";var o=document.createElement("img");o.src="./img/empty-user.jpg",o.className="empty-user-list",a.appendChild(o);var i=document.createElement("span");i.classList.add("mdc-list-item__text");var r=document.createElement("span");r.className="mdc-list-item__primary-text bigBlackBold",r.textContent=e.activityName,i.appendChild(r),i.appendChild(t);var c=document.createElement("div");c.className="mdc-meta__custom-text",c.style.width="76px",isToday(e.timestamp)&&(c.style.marginTop="4px"),c.textContent=moment(e.timestamp).calendar();var s=document.createElement("span");return s.classList.add("mdc-list-item__meta"),s.appendChild(c),s.appendChild(generateIconByCondition(e,n)),n.appendChild(a),n.appendChild(i),n.appendChild(s),n}function generateIconByCondition(e,t){if(e.count){var n=document.createElement("span");return n.textContent=e.count,n.className="count mdc-meta__custom-text",t.classList.add("count-active"),n}var a=document.createElement("i");a.classList.add("status-cancel","material-icons",""+e.status),a.textContent="clear";var o=document.createElement("i");o.classList.add("status-confirmed","material-icons",""+e.status),o.textContent="check";var i=document.createElement("i");return i.classList.add("status-pending","material-icons",""+e.status),i.textContent="","CONFIRMED"===e.status?o:"CANCELLED"===e.status?a:i}function appendActivityListToDom(e){var t=document.getElementById("activity--list");t&&t.appendChild(e)}function createActivityIcon(){getCountOfStore("subscriptions").then(function(e){e&&createActivityIconDom()}).catch(handleError)}function createActivityIconDom(){var e=new Fab("add").getButton();e.root_.classList.add("create-activity"),e.root_.id="create-activity--icon",e.root_.onclick=function(){ga("send",{hitType:"event",eventCategory:"SubscriptionSelector",eventAction:"click",eventLabel:"Choose Subscription"}),isLocationStatusWorking()&&selectorUI({store:"subscriptions",suggestCheckIn:!1})},document.getElementById("create-activity--icon")||document.getElementById("activity-list-main").appendChild(e.root_)}function listPanel(){if(!document.getElementById("activity-list-main")){var e=document.createElement("div");e.id="activity-list-main";var t=document.createElement("ul");t.className="mdc-list mdc-list--two-line mdc-list--avatar-list",t.id="activity--list",e.appendChild(t),document.getElementById("app-current-panel").innerHTML=e.outerHTML}}function creatListHeader(i){var e=indexedDB.open(firebase.auth().currentUser.uid);e.onsuccess=function(){getUserRecord(e.result,firebase.auth().currentUser.phoneNumber).then(function(e){var t=document.getElementById("section-start"),n=document.createElement("object");n.className="list-photo-header",n.type="image/jpeg",n.data=e.photoURL||"./img/empty-user.jpg",n.onclick=function(){profileView(!0)};var a=document.createElement("img");a.src="./img/empty-user.jpg",a.className="list-photo-header",n.appendChild(a);var o=document.createElement("span");o.textContent=i,o.className="mdc-top-app-bar__title mdc-typography--headline5",t.innerHTML="",t.appendChild(n),t.appendChild(o)})}}function scrollToActivity(){var e=localStorage.getItem("clickedActivity");if(document.querySelector('[data-id="'+e+'"]'))return document.querySelector('[data-id="'+e+'"]').scrollIntoView({behavior:"instant",block:"center",inline:"center"}),void localStorage.removeItem("clickedActivity")}function profileView(e){drawer.open=!1,history.pushState(["profileView"],null,null),topAppBar.root_.classList.remove("transparent"),document.body.style.backgroundColor="#eeeeee";var t=document.getElementById("section-start");t.innerHTML="",t.appendChild(headerBackIcon());var n=indexedDB.open(firebase.auth().currentUser.uid);n.onsuccess=function(){getUserRecord(n.result,firebase.auth().currentUser.phoneNumber).then(function(e){document.getElementById("app-current-panel")&&(document.getElementById("app-current-panel").innerHTML=createProfilePanel(e).outerHTML,"Android"===native.getName()?document.getElementById("uploadProfileImage").addEventListener("click",function(){try{AndroidInterface.openImagePicker()}catch(e){sendExceptionObject(e,"CATCH Type 10:AndroidInterface.openImagePicker at profileview",[])}}):document.getElementById("uploadProfileImage").addEventListener("change",function(){readUploadedFile()}),changeDisplayName(),changeEmailAddress())})}}function createProfilePanel(e){var t=document.createElement("div");t.id="profile-view--container",t.className="mdc-top-app-bar--fixed-adjust mdc-theme--background";var n=document.createElement("button");n.className="mdc-fab","Android"===native.getName()&&(n.id="uploadProfileImage");var a=document.createElement("label");a.setAttribute("for","uploadProfileImage");var o=document.createElement("span");o.className="mdc-fab__icon material-icons",o.textContent="add_a_photo",a.appendChild(o),n.appendChild(a);var i=void 0;"Android"!==native.getName()&&((i=document.createElement("input")).type="file",i.style.display="none",i.id="uploadProfileImage",i.accept="image/jpeg;");var r=document.createElement("div");r.id="profile--image-container",r.className="profile-container--main";var c=document.createElement("object");c.type="image/jpeg",c.data=e.photoURL||"./img/empty-user-big.jpg",c.id="user-profile--image";var s=document.createElement("img");s.src="./img/empty-user-big.jpg",s.className="empty-user-profile",c.appendChild(s);var d=document.createElement("div");d.className="insert-overlay",r.appendChild(c),r.appendChild(d),r.appendChild(n),"Android"!==native.getName()&&a.appendChild(i);var l=document.createElement("div");l.id="name--change-container",l.className="profile-psuedo-card";var u=document.createElement("button");u.className="mdc-icon-button material-icons hidden",u.id="edit--name",u.setAttribute("aria-hidden","true"),u.setAttribute("aria-pressed","false"),u.textContent="check";var m=firebase.auth().currentUser.displayName;l.innerHTML='<div class="mdc-text-field" id=\'name-change-field\'>\n        <input autocomplete="off" type="text"  placeholder="'+(m?"":"Enter Your Name")+'"  id="pre-filled-name" class="mdc-text-field__input" value="'+(m||"")+'">\n        <label class="mdc-floating-label mdc-floating-label--float-above" for="pre-filled-name">\n         Your Name\n        </label>\n        <div class="mdc-line-ripple"></div>\n      </div>\n      ',l.appendChild(u);var p=document.createElement("div");p.id="email--change-container",p.className="profile-psuedo-card";var h=document.createElement("button");h.className="mdc-icon-button material-icons hidden",h.id="edit--email",h.setAttribute("aria-hidden","true"),h.setAttribute("aria-pressed","false"),h.textContent="check";var f=firebase.auth().currentUser.email;return p.innerHTML='<div class="mdc-text-field" id=\'email-change-field\'>\n        <input  autocomplete="off" type="text" id="pre-filled-email" class="mdc-text-field__input" value="'+(f||"")+'" placeholder="'+(f?"":"Enter your Email")+'">\n        <label class="mdc-floating-label mdc-floating-label--float-above" for="pre-filled-email">\n         Your Email\n        </label>\n        <div class="mdc-line-ripple"></div>\n      </div>\n      ',p.appendChild(h),t.appendChild(r),t.appendChild(l),t.appendChild(p),t}function timeDiff(e){var t=moment().format("YYY-MM-DD HH:mm"),n=moment(e).format("YYY-MM-DD HH:mm");return moment(t).diff(moment(n),"minutes")}function newSignIn(t,e){var n=new Dialog("",createElement("div",{id:"refresh-login"})).create();n.open(),n.listen("MDCDialog:opened",function(e){try{ui||(ui=new firebaseui.auth.AuthUI(firebase.auth())),ui.start("#refresh-login",firebaseUiConfig(t)),setTimeout(function(){document.querySelector(".firebaseui-id-phone-number").disabled=!0,document.querySelector(".firebaseui-label").remove(),document.querySelector(".firebaseui-title").textContent="Verify your phone Number to Update your Email address"},500)}catch(e){console.log(e),handleError({message:e.message+" from newSignIn function during email updation"}),snacks("Please try again later")}})}function readUploadedFile(e){if("Android"!==native.getName()){var t=document.getElementById("uploadProfileImage").files[0],n=new FileReader;n.addEventListener("load",function(){sendBase64ImageToBackblaze(n.result)},!1),t&&n.readAsDataURL(t)}else sendBase64ImageToBackblaze(e)}function sendBase64ImageToBackblaze(e){var t=document.getElementById("user-profile--image"),n=document.getElementById("profile--image-container"),a="data:image/jpeg;base64,";t&&(t.data=a+e),n&&document.getElementById("profile--image-container").appendChild(loader("profile--loader")),requestCreator("backblaze",{imageBase64:a+e})}function authUpdatedError(e){progressBar.foundation_.close(),snacks(e.message)}function changeDisplayName(){var e=document.getElementById("name-change-field"),t=new mdc.textField.MDCTextField(e),n=document.getElementById("edit--name");firebase.auth().currentUser.displayName;e.addEventListener("click",function(){document.getElementById("pre-filled-name").placeholder="",n.classList.remove("hidden"),e.classList.add("short")}),e.addEventListener("keydown",function(e){13==e.keyCode&&updateName(t.value)}),n.addEventListener("click",function(){updateName(t.value)})}function updateName(e){e?(progressBar.foundation_.open(),firebase.auth().currentUser.updateProfile({displayName:e}).then(successDialog).catch(function(e){progressBar.foundation_.close(),snacks("Please Try again later"),handleError({message:e+" at updateProfile in changeDisplayName"})})):snacks("Please Enter a Name")}function changeEmailAddress(){var e=document.getElementById("email-change-field"),t=new mdc.textField.MDCTextField(e),n=document.getElementById("edit--email");e.addEventListener("click",function(){document.getElementById("pre-filled-email").placeholder="",n.classList.remove("hidden"),e.classList.add("short")}),e.addEventListener("keydown",function(e){13==e.keyCode&&emailValidation(t)}),n.addEventListener("click",function(){emailValidation(t)})}function emailValidation(e){var t=firebase.auth().currentUser,n=e.value;n?n===t.email&&t.emailVerified?snacks("You have already set this as your email address"):timeDiff(t.metadata.lastSignInTime)<=2?updateEmail(t,n):newSignIn(n,e):snacks("Enter a valid Email Id")}function updateEmail(e,t){progressBar.foundation_.open(),e.updateEmail(t).then(function(){emailUpdateSuccess(!0)}).catch(authUpdatedError)}function emailUpdateSuccess(e){firebase.auth().currentUser.sendEmailVerification().then(function(){emailVerificationSuccess(e)}).catch(emailVerificationError)}function emailVerificationSuccess(e){e&&(successDialog(),document.getElementById("dialog-container").innerHTML=""),snacks("Verification link has been send to your email address")}function emailVerificationError(e){snacks(e.message),progressBar.foundation_.close()}function initUserSelectorSearch(o,e,i){var t=indexedDB.open(firebase.auth().currentUser.uid);t.onsuccess=function(){var n=t.result,a="";e.input_.addEventListener("input",function(e){var t=e.target.value;if(i.listElements.forEach(function(e){e.classList.add("hidden")}),isNumber(t))return a=n.transaction("users").objectStore("users"),void searchUsersDB(formatNumber(t),a,o);frag=document.createDocumentFragment(),a=n.transaction("users").objectStore("users").index("displayName"),searchUsersDB(formatName(t),a,o)})}}function isNumber(e){return!isNaN(e)}function formatNumber(e){var t=e;return"91"===t.substring(0,2)?t="+"+t:"+91"!==t.substring(0,3)&&(t="+91"+t),t}function formatName(e){var t=e.split(" "),n=t.length,a=[],o=0;for(o=0;o<n;o++){var i=t[o];if(i.charAt(0).toUpperCase()===e.charAt(0).toUpperCase)return e;a.push(i.charAt(0).toUpperCase()+i.slice(1))}return a.join(" ")}function checkNumber(e){return/^\+[1-9]\d{11,14}$/.test(e)}function searchUsersDB(e,t,n){console.log(e);var a=IDBKeyRange.bound(e,e+"￿"),o=n.record.assignees,i={};o.forEach(function(e){"string"==typeof e?i[e]=!0:i[e.phoneNumber]=!0}),i[firebase.auth().currentUser.phoneNumber]=!0,t.openCursor(a).onsuccess=function(e){var t=e.target.result;if(t){var n=document.querySelector('[data-phone-number="'+t.value.mobile+'"]');n&&(n.classList.contains("hidden")?n.classList.remove("hidden"):n.classList.add("hidden")),t.continue()}}}function selectorUI(a){document.body.style.backgroundColor="white",document.body.classList.remove("mdc-dialog-scroll-lock"),document.getElementById("app-current-panel").innerHTML="";var e=document.getElementById("section-start");e.innerHTML="",e.appendChild(headerBackIcon(a.store));var o=createElement("div",{className:"selector-container"}),t=createElement("span",{className:"selector-warning-text",id:"selector-warning"});o.appendChild(t);var n="SELECT";"users"===a.store&&(n="Add New Number");var i=new Button(n);i.raised(),i.selectorButton();var r=i.getButton();r.root_.id="selector-submit-send","users"===a.store&&(r.root_.dataset.type="add-number"),r.root_.onclick=function(){if(isLocationStatusWorking()){var e=o.querySelector("#selector-warning"),t=getSelectedList(".mdc-radio");if(t.length){e.textContent="";var n=JSON.parse(t[0].value);if("subscriptions"===a.store){if("dsr"!==n.template&&"duty roster"!==n.template&&"tour plan"!==n.template||document.querySelector("header").appendChild(progressBar()),!isLocationStatusWorking())return;createTempRecord(n.office,n.template,a)}}else e.textContent="Please Select An Option"}};({users:!0,children:!0,map:!0})[a.store]||o.appendChild(r.root_),window.scrollTo(0,0),{map:mapSelector,users:userSelector,subscriptions:fillSubscriptionInSelector,children:fillChildrenInSelector}[a.store](a,o)}function mapSelector(r,c){var s=document.getElementById("app-current-panel"),e=(new InputField).withLeadingIcon("search","Search Location");e.root_.id="map-selector-search",e.root_.classList.add("search-field"),c.appendChild(e.root_);var t=e.input_;t.placeholder="",autocomplete=new google.maps.places.Autocomplete(t,{componentRestrictions:{country:"in"}}),autocomplete.addListener("place_changed",function(){var e=autocomplete.getPlace();if(e.geometry){var t={location:e.name,address:formAddressComponent(e),latitude:e.geometry.location.lat(),longitude:e.geometry.location.lng()};updateCreateActivity(updateVenue(r,t).record,!0)}else snacks("Please select a valid location")}),console.log(r);var d=indexedDB.open(firebase.auth().currentUser.uid);d.onsuccess=function(){var e=d.result.transaction([r.store],"readonly"),t=e.objectStore("map"),n=r.record.office,a=IDBKeyRange.bound([n,""],[n,"￿"]),o=createElement("ul",{className:"mdc-list mdc-list--avatar-list map-selector-list"});o.setAttribute("role","radiogroup");var i=0;t.index("byOffice").openCursor(a,"nextunique").onsuccess=function(e){var t=e.target.result;if(t)if(t.value.office===r.record.office)if(t.value.location)if(t.value.latitude&&t.value.longitude)if(o.querySelector('[data-name="'+t.value.location+'"]'))t.continue();else{var n=radioList({value:t.value,labelText:t.value.location,index:i});n.dataset.name=t.value.location,new mdc.ripple.MDCRipple.attachTo(n),o.appendChild(n),i++,t.continue()}else t.continue();else t.continue();else t.continue()},e.oncomplete=function(){var e=new mdc.list.MDCList(o);e.singleSelection=!0,e.listen("MDCList:action",function(e){var t=JSON.parse(o.querySelector("#list-radio-item-"+e.detail.index).value);updateCreateActivity(updateVenue(r,t).record,!0)}),c.appendChild(o),s.appendChild(c)}}}function updateVenue(t,n){return t.record.venue.forEach(function(e){e.venueDescriptor===t.key&&(e.address=n.address,e.location=n.location,e.geopoint._latitude=n.latitude,e.geopoint._longitude=n.longitude)}),t}function userSelector(i,r){var c=document.getElementById("app-current-panel");document.getElementById("start-loader").classList.remove("hidden");var s=createElement("ul",{className:"mdc-list mdc-list--avatar-list  mdc-list--two-line",id:"user-selector-list"});s.setAttribute("aria-label","User List With Check Box");var a=i.record.assignees,d=indexedDB.open(firebase.auth().currentUser.uid);d.onsuccess=function(){var e=d.result.transaction(["users"]),t=e.objectStore("users"),o=0,n={};a.forEach(function(e){"string"==typeof e?n[e]=!0:n[e.phoneNumber]=!0}),n[firebase.auth().currentUser.phoneNumber]=!0,t.openCursor().onsuccess=function(e){var t=e.target.result;t&&(s.querySelector('[data-number="'+t.value.mobile+'"]')||(o++,i.attachment?(s.setAttribute("role","radiogroup"),s.appendChild(new mdc.ripple.MDCRipple(userList({value:t.value,index:o,singleSelection:!0},!0)).root_)):n.hasOwnProperty(t.value.mobile)||(s.setAttribute("role","group"),s.appendChild(new mdc.ripple.MDCRipple(userList({value:t.value,index:o,singleSelection:!1},!0)).root_))),t.continue())},e.oncomplete=function(){if(!o)return s.appendChild(noSelectorResult("No Contact Found")),void(document.getElementById("users-selector-search").style.display="none");var e=new Button("Add New Number");e.raised(),e.selectorButton();var n=e.getButton();n.root_.dataset.type="add-number",n.root_.id="selector-submit-send",n.root_.onclick=function(){if("add-number"!==n.root_.dataset.type){var t=[];a.selectedIndex.forEach(function(e){t.push(JSON.parse(a.listElements[e].querySelector(".mdc-checkbox__native-control").value).mobile)}),insertNumberIntoRecord(i,t)}else addNewNumber(i,r)};var a=new mdc.list.MDCList(s);i.attachment&&(a.singleSelection=!0),a.listen("MDCList:action",function(e){if(i.attachment){var t=JSON.parse(a.listElements[e.detail.index].querySelector(".mdc-radio__native-control").value);return i.record.attachment[i.key].value=t.mobile,void updateCreateActivity(i.record,!0)}a.selectedIndex.length?(n.root_.dataset.type="",n.root_.textContent="SELECT"):(n.root_.dataset.type="add-number",n.root_.textContent="Add new Number")});var t=(new InputField).withLeadingIcon("search","Search Assignee");t.root_.id="users-selector-search",t.root_.classList.add("search-field"),r.appendChild(t.root_),initUserSelectorSearch(i,t,a),r.appendChild(s),r.appendChild(n.root_),c.appendChild(r),document.getElementById("start-loader").classList.add("hidden")}}}function addNewNumber(t,e){document.body.style.backgroundColor="white",removeChildNodes(e);var n=createElement("div",{className:"new-number-container"}),a=createElement("h2",{className:"mdc-typography--headline5 new-contact-headline",textContent:"Add a new Phone Number"}),o=createElement("p",{className:"mdc-typography--subtitle2 message-field",textContent:"Enter new phone contact without country code",id:"helper-message"}),i=new Fab("add").extended("Add Contact");i.root_.id="new-contact";var r=(new InputField).withoutLabel();r.root_.id="number-field",r.root_.type="number",r.input_.placeholder="Enter A New Phone Number",r.input_.setAttribute("maxlength","10"),r.input_.setAttribute("size","10"),r.input_.required=!0,r.input_.onkeypress=function(e){return 48<=e.charCode&&e.charCode<=57},r.input_.oninput=function(){this.value.length>this.maxLength?this.value=this.value.slice(0,this.maxLength):this.value.length===this.maxLength?(o.classList.remove("error-message"),this.classList.add("valid-input"),o.textContent=""):(o.classList.add("error-message"),o.textContent="* Please Enter a valid Number")},i.root_.onclick=function(){var e=formatNumber(r.value);if(!checkNumber(e))return o.classList.add("error-message"),o.textContent="* Please Enter a valid Number",void r.disabled(!0);insertNumberIntoRecord(t,[e])},n.appendChild(a),n.appendChild(r.root_),n.appendChild(o),n.appendChild(i.root_),e.appendChild(n),document.getElementById("app-current-panel").appendChild(e)}function insertNumberIntoRecord(e,t){return e.attachment?(e.record.attachment[e.key].value=t[0],void updateCreateActivity(e.record,!0)):e.record.hasOwnProperty("create")?(e.record.assignees.push.apply(e.record.assignees,t),void updateCreateActivity(e.record,!0)):void shareReq(e,t)}function fillSubscriptionInSelector(n,e){var c=document.getElementById("app-current-panel"),a=indexedDB.open(firebase.auth().currentUser.uid),s=0;a.onsuccess=function(){var e=a.result.transaction([n.store],"readonly"),t=e.objectStore(n.store).index("status"),o={},i=tabBarBase(),r=void 0;c.appendChild(i),t.openCursor(IDBKeyRange.bound("CONFIRMED","PENDING")).onsuccess=function(e){var t=e.target.result;if(t){o[t.value.office]?r=c.querySelector('[data-office="'+t.value.office+'"]'):(i.querySelector(".mdc-tab-scroller__scroll-content").appendChild(addTabs({name:t.value.office,index:s})),(r=createElement("ul",{className:"content mdc-list"})).setAttribute("role","radiogroup"),r.dataset.office=t.value.office,0==s&&r.classList.add("content--active"),c.appendChild(r),o[t.value.office]=!0);var n=t.value;if(n.key=t.primaryKey,!r.querySelector('[data-template="'+n.template+'"]')){var a=radioList({index:s,labelText:n.template,value:n});a.dataset.template=n.template,r.appendChild(a),s++}t.continue()}},e.oncomplete=function(){var e=new mdc.tabBar.MDCTabBar(i),t=document.querySelectorAll(".content");e.listen("MDCTabBar:activated",function(e){document.querySelector(".content--active").classList.remove("content--active"),t[event.detail.index].classList.add("content--active")}),[].map.call(document.querySelectorAll(".mdc-list"),function(e){var t=new mdc.list.MDCList(e);t.singleSelection=!0,t.listElements.map(function(e){return e.onclick=function(){progressBar.foundation_.open();var e=JSON.parse(this.querySelector(".mdc-radio__native-control").value);ga("send",{hitType:"event",eventCategory:"SubscriptionSelector",eventAction:"click",eventLabel:e.template+" choosen"}),setCountForTemplate(e.key).then(console.log).catch(handleError),createTempRecord(e.office,e.template,n)},new mdc.ripple.MDCRipple(e)})})}}}function setCountForTemplate(o){return new Promise(function(t,n){var a=indexedDB.open(firebase.auth().currentUser.uid);a.onsuccess=function(){var e=a.result.transaction(["subscriptions"],"readwrite");e.objectStore("subscriptions").openCursor(o).onsuccess=function(e){var t=e.target.result;if(t){var n=t.value;n.count?n.count=n.count+1:n.count=1,t.update(n)}},e.oncomplete=function(){return t("success")},e.onerror=function(){n({message:e.error.message,body:""})}},a.onerror=function(){n({message:a.error.message,body:""})}})}function fillChildrenInSelector(t,e){var a=createElement("ul",{className:"mdc-list"});t.results.forEach(function(e,t){var n=radioList({labelText:e.attachment.Name.value||e.attachment.Number.value,value:e.attachment.Name.value||e.attachment.Number.value,index:t});n.dataset.value=e.attachment.Name.value||e.attachment.Number.value,a.querySelector('[data-value="'+n.dataset.value+'"]')||(a.appendChild(n),new mdc.ripple.MDCRipple.attachTo(n))});var n=new mdc.list.MDCList(a);n.singleSelection=!0,n.listen("MDCList:action",function(e){t.record.attachment[t.key].value=JSON.parse(a.querySelector("#list-radio-item-"+e.detail.index).value),updateCreateActivity(t.record,!0)}),e.appendChild(a),document.getElementById("app-current-panel").appendChild(e)}function getSelectedList(t){return[].map.call(document.querySelectorAll(t),function(e){return".mdc-radio"===t?new mdc.radio.MDCRadio(e):".mdc-checkbox"===t?new mdc.checkbox.MDCCheckbox(e):void 0}).filter(function(e){return e.checked})}function shareReq(e,t){isLocationStatusWorking()&&(progressBar.foundation_.open(),requestCreator("share",{activityId:e.record.activityId,share:t}))}var apiHandler=new Worker("js/apiHandler.js");function handleError(e){var t=JSON.parse(localStorage.getItem("error"));t.hasOwnProperty(e.message)||(t[e.message]=!0,localStorage.setItem("error",JSON.stringify(t)),requestCreator("instant",JSON.stringify(e)))}function loader(e){var t=document.createElement("div");return t.className="loader "+e,t}function successDialog(){if("mapView"!==history.state[0]){progressBar.foundation_.close();var e=document.getElementById("success-animation"),t=document.getElementById("growthfile");return e.classList.remove("hidden"),t.style.opacity="0.37",setTimeout(function(){e.classList.add("hidden"),t.style.opacity="1"},1500),void mapView()}snackBar.labelText="Check-In Created",snackBar.open()}function snacks(e,t){snackBar.labelText=e,snackBar.open(),snackBar.timeoutMs=1e4,snackBar.actionButtonText="okay"}function fetchCurrentTime(e){return Date.now()+e}function geolocationApi(o){return new Promise(function(t,n){var a=new XMLHttpRequest;a.open("POST","https://www.googleapis.com/geolocation/v1/geolocate?key="+appKey.getMapKey(),!0),a.setRequestHeader("Content-Type","application/json"),a.onreadystatechange=function(){if(4===a.readyState){if(400<=a.status)return n({message:a.response,body:JSON.parse(o)});var e=JSON.parse(a.response);if(!e)return n({message:"Response From geolocation Api "+e,body:JSON.parse(o)});t({latitude:e.location.lat,longitude:e.location.lng,accuracy:e.accuracy,provider:o})}},a.onerror=function(){n({message:a})},a.send(o)})}function manageLocation(){return new Promise(function(t,n){getLocation().then(function(e){updateLocationInRoot(e),t(e)}).catch(function(e){n(e)})})}function getLocation(){return new Promise(function(n,a){if("Android"!==native.getName())try{webkit.messageHandlers.locationService.postMessage("start"),window.addEventListener("iosLocation",function e(t){n(t.detail),window.removeEventListener("iosLocation",e,!0)},!0)}catch(e){html5Geolocation().then(function(e){n(e)}).catch(function(e){a(e)})}else html5Geolocation().then(function(t){if(t.accuracy<=350)return n(t);handleGeoLocationApi().then(function(e){return t.accuracy<e.accuracy?n(t):n(e)}).catch(function(e){return n(t)})}).catch(function(t){handleGeoLocationApi().then(function(e){return n(e)}).catch(function(e){return a({message:"Both HTML and Geolocation failed to fetch location",body:{html5:t,geolocation:e},locationError:!0})})})})}function handleGeoLocationApi(){return new Promise(function(t,n){var e=void 0;try{e=getCellularInformation()}catch(e){n(e.message)}Object.keys(e).length||n("empty object from getCellularInformation"),geolocationApi(JSON.stringify(e)).then(function(e){return t(e)}).catch(function(e){n(e)})})}function logWifi(e){for(var a={message:"Wi-fi Change Log",body:{main:e}},t=function(e){var n;n=e,setTimeout(function(){if(3!=n){var t=void 0,e=void 0;1==n&&(e="first wifi at "+moment().format("hh:mm:ss")),2==n&&(e="second wifi at "+moment().format("hh:mm:ss"));try{t=getCellularInformation()}catch(e){t=e.message}a.body[e]=t}else handleError(a)},2e3*e)},n=1;n<=3;n++)t(n)}function iosLocationError(e){html5Geolocation().then(function(e){updateLocationInRoot(e)}).catch(function(e){reject(e)}),handleError(e)}function html5Geolocation(){return new Promise(function(t,n){navigator.geolocation.getCurrentPosition(function(e){return t({latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy,provider:"HTML5"})},function(e){n({message:e.message})},{maximumAge:5e3,timeout:5e3})})}function updateLocationInRoot(a){var o={latitude:"",longitude:"",accuracy:"",provider:"",lastLocationTime:""},t=firebase.auth().currentUser.uid,i=indexedDB.open(t);i.onsuccess=function(){var e=i.result.transaction(["root"],"readwrite"),n=e.objectStore("root");n.get(t).onsuccess=function(e){var t=e.target.result;t.location&&(o=t.location),t.location=a,t.location.lastLocationTime=Date.now(),n.put(t)},e.oncomplete=function(){if(o.latitude&&o.longitude&&a.latitude&&a.longitude){var e=calculateDistanceBetweenTwoPoints(o,a),t=new CustomEvent("suggestCheckIn",{detail:{newDay:isNewDay(!0),locationChanged:isLocationMoreThanThreshold(e)}});if(window.dispatchEvent(t),"Ios"===native.getName()){var n=new CustomEvent("iosLocation",{detail:a});window.dispatchEvent(n)}}},e.onerror=function(){handleError({message:e.error.message+" from updateLocationInRoot",body:e.error.name})},i.onerror=function(){handleError({message:i.error.message+" from updateLocationInRoot",body:i.error.name}),window.dispatchEvent(suggestCheckIn)}}}function toRad(e){return e*Math.PI/180}function calculateDistanceBetweenTwoPoints(e,t){var n=toRad(t.latitude-e.latitude),a=toRad(t.longitude-e.longitude),o=toRad(t.latitude),i=toRad(e.latitude),r=Math.sin(n/2)*Math.sin(n/2)+Math.sin(a/2)*Math.sin(a/2)*Math.cos(o)*Math.cos(i);return 6371*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))}function isLocationMoreThanThreshold(e){return 1<=e}function isLocationLessThanThreshold(e){return e<=1}function sortedByAccuracy(e){return e.sort(function(e,t){return e.accuracy-t.accuracy})[0]}function isLocationStatusWorking(){return"Android"!==native.getName()||(AndroidInterface.isLocationPermissionGranted()?!{samsung:!0,OnePlus:!0}[JSON.parse(localStorage.getItem("deviceInfo")).deviceBrand]||(!!AndroidInterface.isWifiOn()||void new Dialog("TURN ON YOUR WIFI","Growthfile requires wi-fi access for improving your location accuracy.").create().open()):void new Dialog("LOCATION PERMISSION","Please Allow Growthfile location access.").create().open())}function requestCreator(o,i){var e=firebase.auth().currentUser;if(e){var r={type:o,body:"",meta:{user:{token:"",uid:e.uid,displayName:e.displayName,photoURL:e.photoURL,phoneNumber:e.phoneNumber},apiUrl:appKey.getBaseUrl()}};e.getIdToken(!1).then(function(a){"instant"===o||"now"===o||"Null"===o||"backblaze"===o?(r.body=i,r.meta.user.token=a,apiHandler.postMessage(r)):getRootRecord().then(function(t){var e=t.location,n=!0;e&&(n=isLastLocationOlderThanThreshold(e.lastLocationTime,5)),r.meta.user.token=a,n?manageLocation().then(function(e){createRequestBody(o,i,r,t.serverTime,e)}).catch(locationErrorDialog):createRequestBody(o,i,r,t.serverTime,t.location)})}).catch(console.log),apiHandler.onmessage=messageReceiver,apiHandler.onerror=onErrorMessage}}function createRequestBody(e,t,n,a,o){"create"===e?t.forEach(function(e){e.timestamp=fetchCurrentTime(a),e.geopoint=o}):(t.timestamp=fetchCurrentTime(a),t.geopoint=o),n.body=t,apiHandler.postMessage(n)}function locationErrorDialog(t){var e=new Dialog("Location Error","There was a problem in detecting your location. Please try again later").create();e.open(),e.listen("MDCDialog:closed",function(e){resetScroll(),listView(),handleError(t)})}function isLastLocationOlderThanThreshold(e,t){if(!e)return!0;var n=moment(moment().valueOf());return t<moment.duration(n.diff(e)).asSeconds()}var receiverCaller={initFirstLoad:initFirstLoad,"update-app":updateApp,"removed-from-office":officeRemovalSuccess,"revoke-session":revokeSession,notification:successDialog,apiFail:apiFail};function messageReceiver(e){receiverCaller[e.data.type](e.data)}function emailVerify(e){if(!firebase.auth().currentUser.email||!firebase.auth().currentUser.emailVerified){if(firebase.auth().currentUser.email)return emailUpdateSuccess();var t=new Dialog(e.title,e.body).create();t.open(),t.listen("MDCDialog:closed",function(e){"accept"===e.detail.action&&profileView(!0)})}}function templateDialog(e,o,i){var t=createElement("div",{className:"notification-message",textContent:e.body}),n=createElement("ul",{className:"mdc-list",id:"payroll-notification-list"});n.setAttribute("role","radiogroup"),e.data.forEach(function(e,t){n.appendChild(radioList({labelText:e.template,index:t,value:e}))}),t.appendChild(n);var a=new Dialog(e.title,t).create();a.open();var r=new mdc.list.MDCList(n);r.singleSelection=!0,a.listen("MDCDialog:opened",function(e){r.layout(),r.listElements.map(function(e){return new mdc.ripple.MDCRipple.attachTo(e)})}),a.listen("MDCDialog:closed",function(e){if("accept"===e.detail.action&&isLocationStatusWorking()){var t=document.getElementById("list-radio-item-"+r.selectedIndex).value;if(t){var n=JSON.parse(t),a={schedule:"",attachment:""};if(o||(a.schedule=n.schedule,a.attachment=n.attachment),!i)return ga("send",{hitType:"event",eventCategory:"suggestion",eventAction:"click",eventLabel:n.template+" suggestion selected"}),void createTempRecord(n.office,n.template,a);selectorUI({store:"subscriptions"})}}})}function initFirstLoad(e){}function updateApp(){if("Android"!==native.getName())return webkit.messageHandlers.updateApp.postMessage("Update App");var e=new Dialog("New Update Avaialble","Please Install the Latest version from google play store , to Use Growthfile. Click Okay to Install Lastest Version from Google Play Store.").create();e.open(),e.scrimClickAction="",e.listen("MDCDialog:opened",function(){e.buttons_[0].setAttribute("disabled","true")}),e.listen("MDCDialog:closed",function(e){"accept"===e.detail.action&&AndroidInterface.openGooglePlayStore("com.growthfile.growthfileNew")})}function revokeSession(){firebase.auth().signOut().then(function(){}).catch(function(e){handleError({message:"Sign out error",body:e})})}function apiFail(e){document.getElementById("send-activity")&&(document.getElementById("send-activity").style.display="block"),document.querySelector(".loader")&&document.querySelector(".loader").remove(),document.querySelector(".delete-activity")&&(document.querySelector(".delete-activity").style.display="block"),document.querySelector(".undo-delete-loader")&&(document.querySelector(".undo-delete-loader").style.display="block"),document.querySelector(".form-field-status")&&document.querySelector(".form-field-status").classList.contains("hidden")&&document.querySelector(".form-field-status").classList.remove("hidden"),snacks(e.msg.message)}function officeRemovalSuccess(e){var t=new Dialog("Reminder","You have been removed from "+e.msg.join(" & ")).create();t.open(),t.listen("MDCDialog:closed",function(){document.getElementById("app-current-panel").innerHTML="",resetScroll(),listView()})}function onErrorMessage(e){var t={"line-number":e.lineno,file:e.filename,"col-number":e.colno};handleError({message:e.message+" from apiHandler.js at line-number "+e.lineno+" and columne-number "+e.colno,body:t})}function getInputText(e){return mdc.textField.MDCTextField.attachTo(document.querySelector(e))}function runRead(e){if(localStorage.getItem("dbexist"))return e?void(e.read?requestCreator("Null",e):setTimeout(function(){e.verifyEmail?emailVerify(JSON.parse(e.verifyEmail)):e.payroll&&templateDialog(JSON.parse(e.payroll))},500)):requestCreator("Null",e)}function removeChildNodes(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function getRootRecord(){return new Promise(function(t,n){var a=void 0,o=firebase.auth().currentUser.uid,i=indexedDB.open(o);i.onsuccess=function(){var e=i.result.transaction(["root"],"readwrite");e.objectStore("root").get(o).onsuccess=function(e){var t=e.target.result;a=t},e.oncomplete=function(){t(a)},e.onerror=function(){n({message:e.error.message+" from getRootRecord"})}},i.onerror=function(){n({message:i.error+" from getRootRecord"})}})}function headerBackIcon(e){var t=document.createElement("i");return t.className="material-icons mdc-top-app-bar__navigation-icon",t.textContent="arrow_back",t.onclick=function(){if(!e)return backNav()},t}function getUserRecord(o,i){return new Promise(function(n,e){var t=o.transaction("users").objectStore("users"),a=void 0;a="string"==typeof i?i:i.phoneNumber,t.get(a).onsuccess=function(e){var t=e.target.result;return n(t||{displayName:"",mobile:a,photoURL:""})}})}function getSubscription(r,c){return new Promise(function(o){var e=firebase.auth().currentUser.uid,i=indexedDB.open(e);i.onsuccess=function(){var e=i.result.transaction(["subscriptions"]),t=e.objectStore("subscriptions").index("officeTemplate"),n=IDBKeyRange.only([r,c]),a=void 0;t.get(n).onsuccess=function(e){e.target.result&&"CANCELLED"!==e.target.result.status&&(a=e.target.result)},e.oncomplete=function(){return o(a)}}})}