function AppKeys(){this.mode="production"}AppKeys.prototype.getMode=function(){return this.mode},AppKeys.prototype.getMapKey=function(){return"production"===this.mode?"AIzaSyA4s7gp7SFid_by1vLVZDmcKbkEcsStBAo":"AIzaSyCadBqkHUJwdcgKT11rp_XWkbQLFAy80JQ"},AppKeys.prototype.getKeys=function(){return"production"===this.mode?{apiKey:this.getMapKey(),authDomain:"growthfile-207204.firebaseapp.com",databaseURL:"https://growthfile-207204.firebaseio.com",projectId:"growthfile-207204",storageBucket:"growthfile-207204.appspot.com",messagingSenderId:"701025551237"}:{apiKey:this.getMapKey(),authDomain:"growthfilev2-0.firebaseapp.com",projectId:"growthfilev2-0",messagingSenderId:"1011478688238"}},AppKeys.prototype.getBaseUrl=function(){return"production"===this.mode?"https://api2.growthfile.com/api/":"https://us-central1-growthfilev2-0.cloudfunctions.net/api/"};var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function conversation(e,t){window.removeEventListener("scroll",handleScroll,!1),checkIfRecordExists("activity",e).then(function(e){e?(t&&history.pushState(["conversation",e],null,null),fetchAddendumForComment(e)):listView()}).catch(handleError)}function checkIfRecordExists(o,c){return new Promise(function(n,e){var t=firebase.auth().currentUser,a=window.indexedDB.open(t.uid);a.onsuccess=function(){a.result.transaction(o).objectStore(o).get(c).onsuccess=function(e){var t=e.target.result;n(!!t&&c)}},a.onerror=function(){e({message:a.error.message+" from checkIfRecordExists"})}})}function fetchAddendumForComment(a){if(a){var o=firebase.auth().currentUser,c=window.indexedDB.open(o.uid);c.onsuccess=function(){var n=c.result,e=n.transaction(["addendum"],"readonly"),t=e.objectStore("addendum").index("activityId");createHeaderContent(n,a),commentPanel(a),statusChange(n,a),reinitCount(n,a),t.openCursor(a).onsuccess=function(e){var t=e.target.result;t&&(document.getElementById(t.value.addendumId)||createComment(n,t.value,o).then(function(e){document.getElementById("chat-container")&&document.getElementById("chat-container").appendChild(e)}),t.continue())},e.oncomplete=function(){document.querySelector(".activity--chat-card-container")&&(document.querySelector(".activity--chat-card-container").scrollTop=document.querySelector(".activity--chat-card-container").scrollHeight)}}}}function commentPanel(t){if(!document.querySelector(".activity--chat-card-container")){var e=document.createElement("div");e.className="activity--chat-card-container  mdc-top-app-bar--fixed-adjust panel-card";var n=document.createElement("div");n.id="chat-container",n.className="mdc-card reverser-parent";var a=document.createElement("div");a.className="user-comment--container";var o=document.createElement("div");o.className="status--change-cont";var c=document.createElement("div");c.className="comment--container";var i=document.createElement("div");i.className="input--text-padding mdc-text-field mdc-text-field--dense",i.id="write--comment",i.style.width="100%";var r=document.createElement("input");r.className="mdc-text-field__input comment-field mdc-elevation--z4",r.type="text",i.appendChild(r),c.appendChild(i);var d=document.createElement("button");d.classList.add("mdc-fab","mdc-fab--mini","hidden"),d.id="send-chat--input";var s=document.createElement("span");s.classList.add("mdc-fac__icon","material-icons"),s.textContent="send",d.appendChild(s),c.appendChild(d),e.appendChild(n),a.appendChild(c),document.getElementById("app-current-panel").innerHTML=e.outerHTML+o.outerHTML+a.outerHTML,document.querySelector(".comment-field").oninput=function(e){e.target.value&&e.target.value.replace(/\s/g,"").length?toggleCommentButton(!0):toggleCommentButton(!1)},document.getElementById("send-chat--input").onclick=function(){if(isLocationStatusWorking()){var e=document.querySelector(".comment-field").value;requestCreator("comment",{activityId:t,comment:e}),document.querySelector(".comment-field").value="",toggleCommentButton(!1)}}}}function toggleCommentButton(e){var t=document.getElementById("send-chat--input"),n=document.getElementById("write--comment"),a=document.querySelector(".status--change-cont");a.style.opacity=e?(t.classList.remove("hidden"),n.style.width="80%","0"):(t.classList.add("hidden"),n.style.width="100%",n.style.transition="0.3s ease",a.style.transition="0.3s ease","1")}function statusChange(e,t){var s=document.createElement("label");s.setAttribute("for","toggle-status"),s.textContent="Done",e.transaction("activity").objectStore("activity").get(t).onsuccess=function(e){var t=document.querySelector(".status--change-cont"),n=e.target.result;if(!n.canEdit||"CANCELLED"===n.status){var a=document.createElement("span"),o=e.target.result;return a.textContent="Activity "+o.status.toLowerCase(),void(t&&(t.innerHTML=a.outerHTML,t.style.textAlign="center"))}if(0!=n.editable){if(!document.querySelector(".status-check")){var c=document.createElement("div");c.className="mdc-form-field form-field-status";var i=document.createElement("div");i.className="mdc-checkbox status-check";var r=document.createElement("input");r.className="mdc-checkbox__native-control",r.id="toggle-status",r.type="checkbox";var d=document.createElement("div");d.className="mdc-checkbox__background";document.createElement("div").className="mdc-checkbox__mixedmark",d.innerHTML='<svg class="mdc-checkbox__checkmark"\n      viewBox="0 0 24 24">\n      <path class="mdc-checkbox__checkmark-path"\n      fill="none"\n      d="M1.73,12.91 8.1,19.28 22.79,4.59"/>\n      </svg>\n      <div class="mdc-checkbox__mixedmark"></div>',i.appendChild(r),i.appendChild(d),c.appendChild(i),t&&(t.innerHTML=c.outerHTML+s.outerHTML)}document.querySelector(".mdc-checkbox")&&(switchControl=new mdc.checkbox.MDCCheckbox.attachTo(document.querySelector(".mdc-checkbox")),"CONFIRMED"===n.status&&(switchControl.checked=!0),document.querySelector(".mdc-checkbox").onclick=function(){isLocationStatusWorking()?changeStatusRequest(switchControl,n):resetStatusConfirmation(switchControl,n)})}else t&&(t.innerHTML=s.outerHTML+loader("status-loader").outerHTML)}}function resetStatusConfirmation(e,t){"CONFIRMED"===t.status?e.checked=!0:e.checked=!1}function changeStatusRequest(e,t){document.querySelector(".form-field-status").classList.add("hidden"),document.querySelector(".status--change-cont").appendChild(loader("status-loader")),e.checked?requestCreator("statusChange",{activityId:t.activityId,status:"CONFIRMED"}):requestCreator("statusChange",{activityId:t.activityId,status:"PENDING"})}function createComment(e,u,t){var m=!1;return new Promise(function(r){var d=document.createElement("div");d.classList.add("comment-box","talk-bubble","tri-right","round","btm-left"),t.phoneNumber===u.user?d.classList.add("current-user--comment","secondary-color-light"):d.classList.add("other-user--comment","mdc-theme--primary-bg"),d.id=u.addendumId;var s=document.createElement("div");s.classList.add("talktext");var l=document.createElement("p");l.classList.add("user-name--comment","mdc-typography--subtitle2"),getUserRecord(e,u.user).then(function(e){e.displayName?l.textContent=e.displayName:l.textContent=e.mobile;var t=document.createElement("p");t.classList.add("comment","mdc-typography--subtitle2"),t.textContent=u.comment;var n=document.createElement("span");n.className="comment--info";var a=document.createElement("span");a.textContent=moment(u.timestamp).format("DD-MM-YY H:mm"),a.classList.add("comment-date","mdc-typography--caption");var o=document.createElement("div"),c=document.createElement("i");c.classList.add("user-map--span","material-icons"),c.appendChild(document.createTextNode("location_on")),c.dataset.latitude=u.location._latitude,c.dataset.longitude=u.location._longitude,o.appendChild(c);var i=document.createElement("div");i.className="map-convo",o.onclick=function(e){hasMapsApiLoaded()&&(m=!m,appendMap({lat:u.location._latitude,lng:u.location._longitude},i),c.textContent=m?(i.style.height="200px","arrow_drop_down"):(i.style.height="0px","location_on"))},n.appendChild(a),n.appendChild(o),s.appendChild(l),s.appendChild(t),s.appendChild(n),d.appendChild(s),d.appendChild(i),r(d)})})}function getUserRecord(o,c){return new Promise(function(n,e){var t=o.transaction("users").objectStore("users"),a=void 0;a="string"==typeof c?c:c.phoneNumber,t.get(a).onsuccess=function(e){var t=e.target.result;return n(t||{displayName:"",mobile:a,photoURL:""})}})}function hasMapsApiLoaded(){return"object"===("undefined"==typeof google?"undefined":_typeof(google))&&"object"===_typeof(google.maps)}function appendMap(e,t){var n=new google.maps.Map(t,{zoom:16,center:e,disableDefaultUI:!0}),a=document.createElement("div");new MapsCustomControl(a,n,e.lat,e.lng);a.index=1,n.controls[google.maps.ControlPosition.TOP_LEFT].push(a);new google.maps.Marker({position:e,map:n})}function MapsCustomControl(e,t,n,a){var o=document.createElement("div");o.style.backgroundColor="#fff",o.style.border="2px solid #fff",o.style.borderRadius="3px",o.style.boxShadow="0 2px 6px rgba(0,0,0,.3)",o.style.cursor="pointer",o.style.marginBottom="22px",o.style.textAlign="center",o.style.padding="0px 5px 0px 5px",e.appendChild(o);var c=document.createElement("a");c.href="https://www.google.com/maps?q="+n+","+a,c.className="material-icons",c.style.color="rgb(25,25,25)",c.style.fontSize="16px",c.style.lineHeight="38px",c.style.paddingLeft="5px",c.style.paddingRight="5px",c.style.textDecoration="none",c.innerHTML="open_in_new",o.appendChild(c)}function createHeaderContent(t,e){var r=document.getElementById("section-start");r.innerHTML="";var n=t.transaction("activity").objectStore("activity"),d=headerBackIcon();n.get(e).onsuccess=function(e){var i=e.target.result;getUserRecord(t,i.creator).then(function(e){var t=document.createElement("object");t.data=e.photoURL||"./img/empty-user.jpg",t.className="header--icon-creator",t.type="image/jpeg";var n=document.createElement("img");n.src="./img/empty-user.jpg",n.className="header--icon-creator",t.appendChild(n);var a=document.createElement("div");a.className="mdc-top-app-bar__title mdc-typography--subtitle2";var o=document.createElement("span");o.textContent=i.activityName,o.className="",a.onclick=function(){checkIfRecordExists("activity",i.activityId).then(function(e){e?updateCreateActivity(i):listView()}).catch(handleError)};var c=document.createElement("span");c.textContent="Click here to see details",r.appendChild(d),r.appendChild(t),a.appendChild(o),a.appendChild(document.createElement("br")),a.appendChild(c),r.appendChild(a)})}}function reinitCount(e,t){var n=e.transaction(["list"],"readwrite"),a=n.objectStore("list");a.get(t).onsuccess=function(e){var t=e.target.result;t&&(t.count=0,a.put(t))},n.oncomplete=function(){}}function fillUsersInSelector(c){var i=document.getElementById("data-list--container"),r=c.record.assignees,d=indexedDB.open(firebase.auth().currentUser.uid);d.onsuccess=function(){var e=d.result.transaction(["users"]),t=e.objectStore("users");document.querySelector(".selector-send").classList.remove("hidden");var n=document.getElementById("selector-submit-send");n.textContent="Add New Number",n.dataset.type="add-number";var a=0,o={};r.forEach(function(e){"string"==typeof e?o[e]=!0:o[e.phoneNumber]=!0}),o[firebase.auth().currentUser.phoneNumber]=!0,t.openCursor().onsuccess=function(e){var t=e.target.result;t&&(c.attachment.present?(a++,i.appendChild(createSimpleAssigneeLi(t.value,!0,!1))):o.hasOwnProperty(t.value.mobile)||(a++,i.appendChild(createSimpleAssigneeLi(t.value,!0,!0))),t.continue())},e.oncomplete=function(){a||(i.appendChild(noSelectorResult("No Contact Found")),document.getElementById("users-selector-search").style.display="none"),n.onclick=function(){if("add-number"===n.dataset.type)return document.getElementById("users-selector-search").style.display="none",removeChildNodes(i),n.remove(),void addNewNumber(c);if(c.attachment.present){var e=document.querySelector(".mdc-radio.radio-selected");if(!e)return void(document.getElementById("selector-warning").textContent="* Please Select A Contact");var t=new mdc.radio.MDCRadio(e);updateDomFromIDB(c.record,{hash:"",key:c.attachment.key},{primary:JSON.parse(t.value)}).then(function(e){updateCreateActivity(e,!0)}).catch(handleError)}else c.record.hasOwnProperty("create")?resetSelectedContacts().then(function(e){e.length?updateDomFromIDB(c.record,{hash:"addOnlyAssignees"},{primary:e}).then(function(e){document.body.classList.remove("mdc-dialog-scroll-lock"),updateCreateActivity(e,!0)}).catch(handleError):document.getElementById("selector-warning").textContent="* Please Select A Contact"}):isLocationStatusWorking()&&shareReq(c)},document.querySelectorAll('[data-selected="true"]').forEach(function(e){e&&(new mdc.checkbox.MDCCheckbox.attachTo(e).checked=!0,e.children[1].style.animation="none",e.children[1].children[0].children[0].style.animation="none")})}}}function noSelectorResult(e){var t=document.createElement("div");t.className="data-not-found";var n=document.createElement("p");return n.className="mdc-typography--headline5",n.textContent=e,t.appendChild(n),t}function shareReq(n){resetSelectedContacts().then(function(e){var t={activityId:n.record.activityId,share:e};document.querySelector("header").appendChild(progressBar()),requestCreator("share",t)})}function addNewNumber(n){var e=document.createElement("div");e.className="custom-number--container";var t=document.createElement("input");t.className="mdc-text-field__input",t.id="number-field",t.type="number",t.setAttribute("maxlength","10"),t.setAttribute("size","10"),t.required=!0,t.onkeypress=function(e){return 48<=e.charCode&&e.charCode<=57},t.oninput=function(){this.value.length>this.maxLength?this.value=this.value.slice(0,this.maxLength):this.value.length===this.maxLength?(document.querySelector(".message-field").classList.remove("error-message"),this.classList.add("valid-input"),document.querySelector(".message-field").textContent="",document.getElementById("new-contact").disabled=!1):(document.querySelector(".message-field").classList.add("error-message"),document.querySelector(".message-field").textContent="* Please Enter a valid Number",document.getElementById("new-contact").disabled=!0)};var a=document.createElement("button");a.className="mdc-button",a.textContent="Add Contact",a.id="new-contact",a.onclick=function(){var t=formatNumber(document.getElementById("number-field").value);checkNumber(t)?numberNotExist(t).then(function(e){if(e)return document.getElementById("new-contact").disabled=!0,document.querySelector(".message-field").classList.add("error-message"),void(document.querySelector(".message-field").textContent="* Contact already exist");n.attachment.present?updateDomFromIDB(n.record,{hash:"",key:n.attachment.key},{primary:t}).then(function(e){console.log(e),updateCreateActivity(e,!0)}).catch(handleError):n.record.hasOwnProperty("create")?updateDomFromIDB(n.record,{hash:"addOnlyAssignees"},{primary:[t]}).then(function(e){updateCreateActivity(e,!0)}).catch(handleError):isLocationStatusWorking()&&newNumberReq(n,t)}):(document.querySelector(".message-field").classList.add("error-message"),document.querySelector(".message-field").textContent="* Please Enter a valid Number",document.getElementById("new-contact").disabled=!0)};var o=document.createElement("p");o.className="mdc-typography--subtitle2 message-field",o.textContent="Enter new phone contact without country code",o.id="helper-message",e.appendChild(t),e.appendChild(o),e.appendChild(a),document.querySelector("#data-list--container").appendChild(e);new mdc.ripple.MDCRipple.attachTo(document.getElementById("new-contact"))}function newNumberReq(e,t){document.querySelector("header").appendChild(progressBar()),requestCreator("share",{activityId:e.record.activityId,share:[t]})}function numberNotExist(a){return new Promise(function(n){var e=firebase.auth().currentUser.uid,t=indexedDB.open(e);t.onsuccess=function(){t.result.transaction("users").objectStore("users").get(a).onsuccess=function(e){var t=e.target.result;n(!!t)}}})}function resetSelectedContacts(){return new Promise(function(a){var o=[],e=firebase.auth().currentUser.uid,t=indexedDB.open(e);t.onsuccess=function(){var n=t.result.transaction(["users"],"readwrite").objectStore("users");n.openCursor().onsuccess=function(e){var t=e.target.result;t?(t.value.isSelected&&(o.push(t.value.mobile),t.value.isSelected=!1,n.put(t.value)),t.continue()):a(o)}}})}function checkMapStoreForNearByLocation(r,d){return new Promise(function(o,c){var i=indexedDB.open(firebase.auth().currentUser.uid);i.onsuccess=function(){var a=[],e=i.result.transaction(["map"]),t=e.objectStore("map").index("byOffice"),n=IDBKeyRange.bound([r,""],[r,"￿"]);t.openCursor(n).onsuccess=function(e){var t=e.target.result;t&&(t.value.location&&t.value.latitude&&t.value.longitude&&isLocationLessThanThreshold(calculateDistanceBetweenTwoPoints(t.value,d))&&a.push(t.value),t.continue())},e.oncomplete=function(){var t={};a.forEach(function(e){t[e.location]=e});var n=[];Object.keys(t).forEach(function(e){n.push(t[e])}),o(n)},e.onerror=function(){c(e.error)}}})}function createTempRecord(n,o,c){var e=firebase.auth().currentUser.uid,a=indexedDB.open(e);a.onsuccess=function(){var e=a.result.transaction(["subscriptions"]).objectStore("subscriptions").index("officeTemplate"),t=IDBKeyRange.only([n,o]);e.get(t).onsuccess=function(e){var i=e.target.result;if(i){var n=void 0;c.schedule?n=c.schedule:(n=[],i.schedule.forEach(function(e){var t={};t.name=e,t.startTime="",t.endTime="",n.push(t)})),c.attachment&&Object.keys(c.attachment).forEach(function(e){i.attachment[e]=c.attachment[e]});var r={office:i.office,template:i.template,venue:"",schedule:n,attachment:i.attachment,timestamp:Date.now(),canEdit:!0,assignees:[],activityName:i.template.toUpperCase(),create:!0},a=[];"check-in"!==o?(i.venue.forEach(function(e){var t={};t.venueDescriptor=e,t.location="",t.address="",t.geopoint={_latitude:"",_longitude:""},a.push(t)}),r.venue=a,updateCreateActivity(r)):getRootRecord().then(function(e){var t={};t.venueDescriptor=i.venue[0],t.location="",t.address="",t.geopoint={_latitude:"",_longitude:""},r.venue=[t];var n=isLastLocationOlderThanThreshold(e.location.lastLocationTime,5);if(e.location&&!n)return updateCreateActivity(r);var a=void 0;a="Android"===native.getName()?"Make Sure you have set Location Mode to High Accuracy":"Please wait.";var o=document.createElement("span");o.className="mdc-typography--body1",o.textContent=a,document.getElementById("dialog-container").innerHTML=dialog({id:"location-fetch-dialog",content:o,headerText:"Fetching Location"}).outerHTML;var c=document.getElementById("location-fetch-dialog");new mdc.dialog.MDCDialog(c).show(),"Ios"!==native.getName()?manageLocation().then(function(e){c.remove(),updateCreateActivity(r)}).catch(function(e){var t="There was a problem in detecting your location";"Android"===native.getName()&&(t+=". Make sure you have set Location Mode to high accuracy"),c.querySelector(".mdc-dialog__header__title").textContent="Failed To Get Current Location",c.querySelector("section span").textContent=t,setTimeout(function(){c.remove()},3e3),listView(),handleError(e)}):window.addEventListener("iosLocation",function e(t){c.remove(),updateCreateActivity(r),window.removeEventListener("iosLocation",e,!0)},!0)})}}}}function hasAnyValueInChildren(o,c,i){var e=firebase.auth().currentUser.uid,t=indexedDB.open(e);return new Promise(function(a){t.onsuccess=function(){var e=t.result.transaction("children").objectStore("children"),n=0;e.openCursor().onsuccess=function(e){var t=e.target.result;t?(t.value.template===c&&t.value.office===o&&"CANCELLED"!=i&&n++,t.continue()):a(0!==n)}}})}function updateDomFromIDB(c,i,r){return new Promise(function(n,a){var e=firebase.auth().currentUser.uid,o=indexedDB.open(e);o.onsuccess=function(){var e=o.result,t=c;if("venue"!==i.hash){if("addOnlyAssignees"===i.hash){if(!r.primary.length)return;return r.primary.forEach(function(e){-1<t.assignees.indexOf(e)||t.assignees.push(e)}),void n(t)}"weekday"!==i.hash&&i.hasOwnProperty("key")&&(t.attachment[i.key].value=r.primary,updateLocalRecord(t,e).then(function(e){n(t)}).catch(function(e){a(e)}))}else updateLocalRecord(t=updateVenue(t,i,r),e).then(function(e){n(t)}).catch(function(e){console.log(e),a(e)})}})}function updateLocalRecord(c,i){return new Promise(function(e,t){var n=i.transaction(["activity"],"readwrite"),a=n.objectStore("activity"),o=c;o.hasOwnProperty("create")||a.put(o),n.oncomplete=function(){e("activity object store updated with value")},n.onerror=function(){t({message:n.error.message+" from updateLocalRecord"})}})}function updateVenue(e,t,n){return e.venue.forEach(function(e){e.venueDescriptor===t.key&&(e.location=n.primary,e.address=n.secondary.address,e.geopoint._latitude=n.secondary.geopoint._latitude,e.geopoint._longitude=n.secondary.geopoint._longitude)}),e}function convertKeyToId(e){return e.replace(/-/g,"--").replace(/\s/g,"-")}function convertIdToKey(e){return e.replace(/-/g," ").replace("  ","-")}function updateCreateContainer(e,t){document.body.style.backgroundColor="#eeeeee",document.body.classList.remove("mdc-dialog-scroll-lock");var n=document.createElement("span");n.textContent=e.activityName,n.className="mdc-top-app-bar__title";var a=headerBackIcon(),o=document.getElementById("section-start");o.innerHTML="",o.appendChild(a),o.appendChild(n);var c=document.createElement("div");c.className="mdc-top-app-bar--fixed-adjust update-create--activity";for(var i=["office","venue","schedule","attachment","assignees"],r=0;r<5;r++){var d=document.createElement("ul");d.className="mdc-list custom--list-margin";var s=document.createElement("div");switch(i[r]){case"office":d.classList.remove("custom--list-margin");break;case"schedule":s.className="mdc-list-group__subheader",s.id="schedule--group";break;case"venue":case"assignees":d.classList.add("mdc-list--two-line","mdc-list--avatar-list")}"schedule"===i[r]?c.appendChild(s):(d.id=i[r]+"--list",c.appendChild(d))}if(e.canEdit){var l=document.createElement("button");l.setAttribute("aria-label","Send"),e.create?l.className="":t||(l.className="hidden"),l.id="send-activity",l.textContent="SUBMIT",c.appendChild(l)}return c}function updateCreateActivity(o,c){"updateCreateActivity"===history.state[0]?history.replaceState(["updateCreateActivity",o],null,null):history.pushState(["updateCreateActivity",o],null,null);var e=firebase.auth().currentUser.uid,i=indexedDB.open(e);i.onsuccess=function(){var e=i.result;document.getElementById("app-current-panel").innerHTML=updateCreateContainer(o,c).outerHTML,document.getElementById("office--list").appendChild(createSimpleLi("Office",{office:o.office,showLabel:!0})),createVenueSection(o),createScheduleTable(o),createAttachmentContainer(o),createAssigneeList(o,!0,e),createActivityCancellation(o),window.scrollTo(0,0),document.getElementById("send-activity")&&document.getElementById("send-activity").addEventListener("click",function(){isLocationStatusWorking()&&(this.dataset.progress=!0,sendActivity(o))});for(var t=document.querySelectorAll(".update-create--activity input"),n=0;n<t.length;n++)t[n].addEventListener("input",function(e){document.getElementById("send-activity").dataset.progress||document.getElementById("send-activity").classList.contains("hidden")&&document.getElementById("send-activity").classList.remove("hidden")});if(document.querySelector(".mdc-select")){var a=new mdc.select.MDCSelect(document.querySelector(".mdc-select"));a.listen("change",function(){updateDomFromIDB(o,{hash:"weekday",key:a.root_.dataset.value},{primary:a.value}).then(function(e){document.getElementById("send-activity").dataset.progress||document.getElementById("send-activity").classList.contains("hidden")&&document.getElementById("send-activity").classList.remove("hidden")}).catch(handleError)})}}}function createCheckInVenue(e,t){var n=document.createElement("div");n.className="mdc-radio checkin",n.value=JSON.stringify(e);var a=document.createElement("input");a.className="mdc-radio__native-control",a.type="radio",a.setAttribute("name","radios"),t&&a.setAttribute("checked","true");var o=document.createElement("div");o.className="mdc-radio__background";var c=document.createElement("div");c.className="mdc-radio__outer-circle";var i=document.createElement("div");i.className="mdc-radio__inner-circle",o.appendChild(c),o.appendChild(i),n.appendChild(a),n.appendChild(o);return n}function createSimpleLi(e,t){var n=document.createElement("li");n.className="mdc-list-item mdc-ripple-upgraded";var a=document.createElement("span");a.className="detail--static-text";document.createElement("span");var o=document.createElement("span");if("Office"===e&&(o.className="data--value-list",o.textContent=t.office,a.textContent=e,n.appendChild(a),n.appendChild(o)),"children"===e){var c=document.createElement("span");c.className="mdc-list-item__meta",c.appendChild(createRadioInput()),n.textContent=t,n.appendChild(c),n.onclick=function(){checkRadioInput(this,{name:t})}}if("delete"===e&&(o.className="mdc-list-item__graphic material-icons",o.textContent=e,a.classList.remove("detail--static-text"),a.classList.add("delete-activity"),a.textContent=t.text,n.appendChild(o),n.appendChild(a)),"empty"===e&&(n.dataset.prop="delete"),"undo-deleted"===e){o.className="mdc-list-item__graphic material-icons",o.textContent="delete",a.classList.remove("detail--static-text"),a.classList.add("delete-activity"),a.textContent=t.text,n.appendChild(o),n.appendChild(a),n.classList.add("undo-delete-activity");var i=document.createElement("button");i.className="mdc-button mdc-ripple-upgraded mdc-list-item__meta undo-deleted",i.textContent="Undo",i.onclick=function(){isLocationStatusWorking()&&(document.querySelector(".undo-deleted").style.display="none",n.appendChild(loader("undo-delete-loader")),requestCreator("statusChange",{activityId:t.id,status:"PENDING"}))},n.appendChild(i)}return n}function createVenueSection(r){var d=document.getElementById("venue--list");"check-in"===r.template&&r.hasOwnProperty("create")?getRootRecord().then(function(e){checkMapStoreForNearByLocation(r.office,e.location).then(function(e){if(e.length){var o=!1,t=document.createElement("li");t.className="mdc-list-item label--text",t.textContent=r.venue[0].venueDescriptor,t.style.height="50px",t.style.paddingRight="11px";var n=document.createElement("span");n.className="mdc-list-item__meta";var a=document.createElement("label");a.id="uncheck-checkin",a.className="mdc-fab add--assignee-icon";var c=document.createElement("span");c.className="mdc-fab__icon material-icons",c.textContent="clear",a.appendChild(c),n.appendChild(a),t.appendChild(n),d.appendChild(t),1==e.length&&(o=!0),e.forEach(function(e){var t=document.createElement("div");t.className="mdc-form-field check-in-form";var n=document.createElement("label");n.setAttribute("for","check-in-radio"),n.textContent=e.location,t.appendChild(n),t.appendChild(createCheckInVenue(e,o)),d.appendChild(t);var a=document.createElement("div");a.id="map-detail-check-in-create"+convertKeyToId(e.venueDescriptor),d.appendChild(a)});var i=document.getElementById("uncheck-checkin");i&&i.addEventListener("click",function(){document.querySelectorAll(".mdc-radio.checkin").forEach(function(e){new mdc.radio.MDCRadio(e).checked=!1})})}})}):(r.venue.forEach(function(e){d.appendChild(createVenueLi(e,!0,r));var t=document.createElement("div");t.className="map-detail "+convertKeyToId(e.venueDescriptor),d.appendChild(t)}),"check-in"===r.template&&(r.venue[0].location&&r.venue[0].address||(document.getElementById("venue--list").style.display="none")),0===r.venue.length&&(document.getElementById("venue--list").style.display="none"))}function createVenueLi(a,e,t,n){var o=!1,c=document.createElement("li");c.className="mdc-list-item mdc-ripple-upgraded",c.id=convertKeyToId(a.venueDescriptor);var i=document.createElement("div");i.className="mdc-list-item__text link--span";var r=document.createElement("span");r.className="mdc-list-item__primary-text";var d=document.createElement("span");d.className="mdc-list-item__meta";var s=document.createElement("label");s.className="mdc-fab add--assignee-icon attachment-selector-label";var l=document.createElement("span");if(l.className="mdc-fab__icon material-icons",l.textContent="add_location",s.appendChild(l),e){var u=document.createElement("span");u.className="detail--static-text",u.textContent=a.venueDescriptor;var m=document.createElement("span");m.className="data--value-list",m.textContent=a.location,m.dataset.primary="",r.appendChild(u),r.appendChild(m),i.appendChild(r),i.onclick=function(e){if(hasMapsApiLoaded()&&a.geopoint._latitude&&a.geopoint._longitude){o=!o;var t={lat:a.geopoint._latitude,lng:a.geopoint._longitude},n=document.querySelector(".map-detail."+convertKeyToId(a.venueDescriptor));appendMap(t,n),n.style.height=o?"200px":"0px"}},t.canEdit&&(d.setAttribute("aria-hidden","true"),d.appendChild(s),s.onclick=function(e){insertInputsIntoActivity(t),history.replaceState(["updateCreateActivity",t],null,null),selectorUI({record:t,store:"map",attachment:{present:!1},key:a.venueDescriptor})})}else r.textContent=a.location,i.appendChild(r);var p=document.createElement("span");p.className="mdc-list-item__meta material-icons",n&&(p.appendChild(createRadioInput()),c.onclick=function(){checkRadioInput(this,{location:a.location,address:a.address,geopoint:{_latitude:a.latitude,_longitude:a.longitude},venueDesc:a.venueDescriptor})});var h=document.createElement("span");return h.className="mdc-list-item__secondary-text",h.textContent=a.address,h.dataset.secondary="",i.appendChild(h),c.appendChild(i),n?c.appendChild(p):c.appendChild(d),c}function createScheduleTable(v){v.schedule.length||(document.getElementById("schedule--group").style.display="none");var g=0;v.schedule.forEach(function(e){g++;var t=document.createElement("h5");t.className="mdc-list-group__subheader label--text",t.textContent=e.name;var n=document.createElement("ul");n.className="mdc-list mdc-list--dense";var a=document.createElement("li");a.className="mdc-list-divider",a.setAttribute("role","separator");var o=document.createElement("li");o.className="mdc-list-item schedule-start-li";var c=document.createElement("div");c.className="mdc-text-field start--date"+g;var i=document.createElement("input");i.value=moment(e.startTime||new Date).format("YYYY-MM-DD"),i.type="date",i.disabled=!v.canEdit,i.className="mdc-text-field__input",c.appendChild(i);var r=document.createElement("span");r.className="mdc-list-item__meta";var d=document.createElement("div");d.className="mdc-text-field start--time"+g;var s=document.createElement("input");e.startTime?s.value=moment(e.startTime).format("HH:mm"):s.value=moment("24","HH:mm").format("HH:mm"),s.type="time",s.className="time--input",s.disabled=!v.canEdit,s.className="mdc-text-field__input",d.appendChild(s),r.appendChild(d);var l=document.createElement("li");l.className="mdc-list-item schedule-end-li";var u=document.createElement("div");u.className="mdc-text-field end--date"+g;var m=document.createElement("input");m.value=moment(e.endTime||moment().add(1,"days")).format("YYYY-MM-DD"),m.type="date",m.disabled=!v.canEdit,m.className="mdc-text-field__input",u.appendChild(m),"leave"===v.template&&(i.onchange=function(e){var t=document.getElementById("Number-Of-Days");if(t){var n=moment(m.value).diff(moment(i.value),"days")+1;0<=n&&(t.querySelector("input").value=n)}},m.onchange=function(e){var t=document.getElementById("Number-Of-Days");if(t){var n=moment(m.value).diff(moment(i.value),"days")+1;0<=n&&(t.querySelector("input").value=n)}});var p=document.createElement("span");p.className="mdc-list-item__meta";var h=document.createElement("div");h.className="mdc-text-field end--time"+g;var f=document.createElement("input");e.endTime?f.value=moment(e.endTime||new Date).format("HH:mm"):f.value=moment("24","HH:mm").format("HH:mm"),f.type="time",f.disabled=!v.canEdit,f.className="mdc-text-field__input",h.appendChild(f),p.appendChild(h),o.appendChild(c),o.appendChild(r),l.appendChild(u),l.appendChild(p),n.appendChild(o),n.appendChild(a),n.appendChild(l),document.getElementById("schedule--group").appendChild(t),document.getElementById("schedule--group").appendChild(n)})}function createAttachmentContainer(v){["Name","Number","Template","email","phoneNumber","HHMM","weekday","number","base64","string"].forEach(function(e){var t=document.createElement("div");t.className=e+"--group",document.getElementById("attachment--list").appendChild(t)});var g={phoneNumber:"",weekday:"","HH:MM":"",string:"",base64:"",number:"",email:""};Object.keys(v.attachment).forEach(function(t){var n=document.createElement("div");"HH:MM"===v.attachment[t].type?n.className="attachment-field HHMM":n.className="attachment-field "+v.attachment[t].type,n.id=convertKeyToId(t),v.canEdit&&n.classList.add("editable--true");var e=document.createElement("span");if(e.className="label--text","Name"===(e.textContent=t)||"Number"===t){n.appendChild(e);n.appendChild(createSimpleInput(v.attachment[t].value,v.canEdit,"",t,!0))}else"string"===v.attachment[t].type&&(console.log(v.canEdit),n.appendChild(e),n.appendChild(createSimpleInput(v.attachment[t].value,v.canEdit,"",t)));if("number"===v.attachment[t].type){n.appendChild(e),console.log(v);var a=v.canEdit;if("Number Of Days"===t){var o=document.querySelector("#schedule--group .start--date1 input"),c=document.querySelector("#schedule--group .end--date1 input");v.attachment[t].value=moment(c.value).diff(o.value,"days")+1,console.log(moment(c.value).diff(o.value,"days")+1),a=!1}n.appendChild(createNumberInput(v.attachment[t].value,a))}if("email"===v.attachment[t].type&&(n.appendChild(e),n.appendChild(createEmailInput(v.attachment[t].value,v.canEdit))),"phoneNumber"===v.attachment[t].type){n.classList.add("selector--margin");var i=document.createElement("label");i.className="mdc-fab add--assignee-icon attachment-selector-label";var r=document.createElement("span");r.className="mdc-fab__icon material-icons",r.textContent="person_add",i.appendChild(r);var d=document.createElement("span");d.className="data--value-list",d.dataset.primary="",v.canEdit&&(n.appendChild(i),i.onclick=function(e){insertInputsIntoActivity(v),history.replaceState(["updateCreateActivity",v],null,null),selectorUI({record:v,store:"users",attachment:{present:!0,key:t}})}),n.appendChild(e),d.textContent=v.attachment[t].value,n.appendChild(d)}if("HH:MM"==v.attachment[t].type&&(n.appendChild(e),n.appendChild(createTimeInput(v.attachment[t].value,v.canEdit,{simple:!1,type:"time"}))),"weekday"===v.attachment[t].type&&(n.appendChild(e),n.appendChild(createSelectMenu(t,v.attachment[t].value,v.canEdit))),"base64"===v.attachment[t].type){var s=document.createElement("label");s.className="mdc-fab attachment-selector-label add--assignee-icon",s.id="start-camera";var l=document.createElement("span");l.className="mdc-fab__icon material-icons",l.textContent="add_a_photo",s.appendChild(l);var u=document.createElement("ul");u.className="image-preview--attachment mdc-image-list standard-image-list mdc-image-list--with-text-protection",u.appendChild(setFilePath(v.attachment[t].value,t,!0)),n.appendChild(u),v.canEdit&&(n.appendChild(s),n.appendChild(u),s.onclick=function(){readCameraFile()})}if(!g.hasOwnProperty(v.attachment[t].type)){var m=document.createElement("label");m.className="mdc-fab add--assignee-icon attachment-selector-label";var p=document.createElement("span");p.className="mdc-fab__icon material-icons",p.textContent="add",m.appendChild(p),n.appendChild(e);var h=document.createElement("span");h.textContent=v.attachment[t].value,h.className="data--value-list",n.appendChild(h),v.canEdit&&hasAnyValueInChildren(v.office,v.attachment[t].type,v.status).then(function(e){e&&(n.appendChild(m),n.classList.add("selector--margin"),m.onclick=function(e){h.dataset.primary="",insertInputsIntoActivity(v),history.replaceState(["updateCreateActivity",v],null,null),selectorUI({record:v,store:"children",attachment:{present:!0,key:t,office:v.office,template:v.attachment[t].type,status:v.status}})})})}var f=document.createElement("hr");f.className="attachment--divider","HH:MM"===v.attachment[t].type?(document.querySelector(".HHMM--group").appendChild(n),document.querySelector(".HHMM--group").appendChild(f)):"Name"===t?(document.querySelector(".Name--group").appendChild(n),document.querySelector(".Name--group").appendChild(f)):g.hasOwnProperty(v.attachment[t].type)?(document.querySelector("."+v.attachment[t].type+"--group").appendChild(n),document.querySelector("."+v.attachment[t].type+"--group").appendChild(f)):(document.querySelector(".Template--group").appendChild(n),document.querySelector(".Template--group").appendChild(f))})}function createAssigneeList(t,e,n){var a=document.getElementById("assignees--list");if(e){var o=document.createElement("li");o.className="mdc-list-item label--text add--assignee-loader",o.textContent="Assignees";var c=document.createElement("span");c.className="mdc-list-item__meta";var i=document.createElement("div");i.className="mdc-fab add--assignee-icon",i.onclick=function(e){insertInputsIntoActivity(t),history.replaceState(["updateCreateActivity",t],null,null),selectorUI({record:t,store:"users",attachment:{present:!1}})};var r=document.createElement("span");r.className="mdc-fab__icon material-icons",r.textContent="person_add",i.appendChild(r),c.appendChild(i),t.canEdit&&o.appendChild(c),a.appendChild(o)}t.assignees.forEach(function(e){getUserRecord(n,e).then(function(e){a.appendChild(createSimpleAssigneeLi(e))})})}function createSimpleAssigneeLi(e,t,n){var a=document.createElement("li");if(a.classList.add("mdc-list-item","assignee-li"),!e)return a;a.dataset.value=e.mobile;var o=document.createElement("object");o.data=e.photoURL||"./img/empty-user.jpg",o.type="image/jpeg",o.className="mdc-list-item__graphic";var c=document.createElement("img");c.src="./img/empty-user.jpg",c.className="empty-user-assignee",o.appendChild(c);var i=document.createElement("span");i.classList.add("mdc-list-item__text");var r=document.createElement("span");r.className="mdc-list-item__primary-text";var d=document.createElement("span");d.classList.add("mdc-list-item__secondary-text"),e.displayName?(r.textContent=e.displayName,d.textContent=e.mobile):r.textContent=e.mobile,i.appendChild(r),i.appendChild(d);var s=document.createElement("span");return s.className="mdc-list-item__meta material-icons",t&&(n?s.appendChild(createCheckBox(e)):(s.appendChild(createRadioInput()),a.onclick=function(){checkRadioInput(this,a.dataset.value)})),a.appendChild(o),a.appendChild(i),a.appendChild(s),a}function createRadioInput(){var e=document.createElement("div");e.className="mdc-radio radio-control-selector";var t=document.createElement("input");t.className="mdc-radio__native-control",t.type="radio",t.name="radio";var n=document.createElement("div");n.className="mdc-radio__background";var a=document.createElement("div");a.className="mdc-radio__outer-circle";var o=document.createElement("div");return o.className="mdc-radio__inner-circle",n.appendChild(a),n.appendChild(o),e.appendChild(t),e.appendChild(n),e}function createCheckBox(t){var e=document.createElement("div");e.className="mdc-checkbox status-check",e.dataset.selected=t.isSelected;var n=document.createElement("input");n.className="mdc-checkbox__native-control",n.type="checkbox",n.onclick=function(e){checkCheckboxInput(e,t)};var a=document.createElement("div");a.className="mdc-checkbox__background";return document.createElement("div").className="mdc-checkbox__mixedmark",a.innerHTML='<svg class="mdc-checkbox__checkmark"\n    viewBox="0 0 24 24">\n    <path class="mdc-checkbox__checkmark-path"\n    fill="none"\n    d="M1.73,12.91 8.1,19.28 22.79,4.59"/>\n    </svg>\n    <div class="mdc-checkbox__mixedmark"></div>',e.appendChild(n),e.appendChild(a),e}function checkCheckboxInput(t,n){var e=firebase.auth().currentUser.uid,a=indexedDB.open(e);a.onsuccess=function(){var e=a.result.transaction("users","readwrite").objectStore("users");n.hasOwnProperty("isSelected")&&n.isSelected?(t.target.parentNode.dataset.selected=!1,n.isSelected=!1):(t.target.parentNode.dataset.selected=!0,n.isSelected=!0),e.put(n),document.querySelectorAll('[data-selected="true"]').length&&(document.querySelector(".selector-send").dataset.type="",document.querySelector(".selector-send").textContent="SELECT")}}function checkRadioInput(e,t){document.getElementById("selector-submit-send").textContent="SELECT",[].concat(_toConsumableArray(document.querySelectorAll(".radio-selected"))).forEach(function(e){e.classList.remove("radio-selected")});var n=e;if(n){var a=new mdc.radio.MDCRadio(n.querySelector(".radio-control-selector"));a.root_.classList.add("radio-selected"),document.getElementById("selector-submit-send").dataset.type="",a.value=JSON.stringify(t)}}function setFilePath(e,t,n){if(document.querySelector(".image--list-li"))return document.getElementById("attachment-picture").data="data:image/jpg;base64,"+e,document.getElementById("attachment-picture").dataset.value="data:image/jpg;base64,"+e,void(document.getElementById("send-activity").dataset.progress||document.getElementById("send-activity").classList.remove("hidden"));var a=document.createElement("li");a.className="mdc-image-list__item image--list-li";var o=document.createElement("div"),c=document.createElement("object");c.data=e||"./img/placeholder.png",c.type="image/jpeg",c.id="attachment-picture",c.dataset.photoKey=t,c.className="profile-container--main mdc-image-list__image";var i=document.createElement("img");i.src="./img/placeholder.png",i.className="profile-container--main mdc-image-list__image",c.dataset.value=e?c.src=e:(c.data="./img/placeholder.png",""),c.appendChild(i),c.onclick=function(){openImage(this.data)},o.appendChild(c),a.appendChild(o);var r=document.createElement("div");r.className="mdc-image-list__supporting";var d=document.createElement("span");return d.textContent=t,d.className="mdc-image-list__label",d.id="label--image",r.appendChild(d),a.appendChild(r),n?a:void 0}function readCameraFile(){if("Android"===native.getName())try{AndroidInterface.startCamera()}catch(e){sendExceptionObject(e,"CATCH Type 11: AndroidInterface.startCamera at readCameraFile",[])}else webkit.messageHandlers.takeImageForAttachment.postMessage("convert image to base 64")}function openImage(e){if(e){var t=document.createElement("img");t.src=e,t.style.width="100%",document.getElementById("dialog-container").innerHTML=dialog({id:"viewImage--dialog-component",headerText:"Photo",content:t,showCancel:!0,showAccept:!0}).outerHTML;var n=document.querySelector("#viewImage--dialog-component"),a=new mdc.dialog.MDCDialog.attachTo(n);a.listen("MDCDialog:accept",function(e){n.remove()}),a.listen("MDCDialog:cancel",function(e){n.remove()}),a.show()}}function createActivityCancellation(o){if(o.canEdit){var e=document.createElement("div");if(e.className="status--cancel-cont",!o.hasOwnProperty("create"))if("CANCELLED"!==o.status){if("CANCELLED"!==o.status){if(e.appendChild(createSimpleLi("delete",{text:"CANCEL"})),document.querySelector(".update-create--activity").appendChild(e),!o.canEdit)return;document.querySelector(".delete-activity").addEventListener("click",function(e){var t=document.createElement("span");t.className="mdc-typography--body1",t.textContent="Are you sure you want to delete this activity ? ",document.getElementById("dialog-container").innerHTML=dialog({id:"cancel-alert",headerText:o.activityName+" will be deleted",showCancel:!0,showAccept:!0,content:t}).outerHTML;var n=document.querySelector("#cancel-alert"),a=new mdc.dialog.MDCDialog(n);a.lastFocusedTarget=e.target,a.show(),a.listen("MDCDialog:cancel",function(){n.remove()}),a.listen("MDCDialog:accept",function(){isLocationStatusWorking()&&(document.querySelector(".delete-activity").style.display="none",document.querySelector(".status--cancel-cont li").appendChild(loader("cancel-loader")),requestCreator("statusChange",{activityId:o.activityId,status:"CANCELLED"}),n.remove())})})}}else{e.appendChild(createSimpleLi("undo-deleted",{text:"Cancelled",id:o.activityId})),document.querySelector(".update-create--activity").appendChild(e);new mdc.ripple.MDCRipple.attachTo(document.querySelector(".undo-deleted"))}}}function sendActivity(t){if(t.hasOwnProperty("create"))insertInputsIntoActivity(t,!0);else{var e=firebase.auth().currentUser.uid,n=indexedDB.open(e);n.onsuccess=function(e){n.result.transaction("activity","readwrite").objectStore("activity").get(t.activityId).onsuccess=function(e){insertInputsIntoActivity(e.target.result,!0)}}}}function concatDateWithTime(e,t){var n=moment(e+" "+t);return moment(n).valueOf()}function insertInputsIntoActivity(n,e){for(var t=document.querySelectorAll(".string"),a=0;a<t.length;a++){var o=t[a].querySelector(".mdc-text-field__input").value;if(t[a].querySelector(".mdc-text-field__input").required&&checkSpacesInString(o))return void(e&&snacks("Please provide an input for the field “Name” "));n.attachment[convertIdToKey(t[a].id)].value=o}var c=document.querySelectorAll(".number");for(a=0;a<c.length;a++){var i=Number(c[a].querySelector(".mdc-text-field__input").value);n.attachment[convertIdToKey(c[a].id)].value=i}var r=document.querySelectorAll(".email");for(a=0;a<r.length;a++){var d=r[a].querySelector(".mdc-text-field__input").value;n.attachment[convertIdToKey(r[a].id)].value=d}var s=document.querySelectorAll(".HHMM");for(a=0;a<s.length;a++){var l=s[a].querySelector(".mdc-text-field__input").value;n.attachment[convertIdToKey(s[a].id)].value=l}for(var u=document.querySelectorAll(".image-preview--attachment  object"),m=0;m<u.length;m++)n.attachment[convertKeyToId(u[m].dataset.photoKey)].value=u[m].dataset.value;var p=void 0,h=void 0,f=void 0,v=void 0;for(a=1;a<n.schedule.length+1;a++)if(p=getInputText(".start--date"+a).value,h=getInputText(".start--time"+a).value,f=getInputText(".end--date"+a).value,v=getInputText(".end--time"+a).value,concatDateWithTime(p,h)||concatDateWithTime(f,v)){if(p&&!h)return void snacks("Please Select a Start Time");if(h&&!p)return void snacks("Please Select a Start Date");if(concatDateWithTime(p,h)&&!f)return void snacks("Please Select a End Date");if(concatDateWithTime(p,h)&&!v)return void snacks("Please Select a End Time");if(concatDateWithTime(f,v)<concatDateWithTime(p,h))return void snacks("The End Date and Time should be greater or equal to the start time");n.schedule[a-1].startTime=concatDateWithTime(p,h)||"",n.schedule[a-1].endTime=concatDateWithTime(f,v)||""}else n.schedule[a-1].startTime=concatDateWithTime(p,h)||"",n.schedule[a-1].endTime=concatDateWithTime(f,v)||"";if("check-in"===n.template)document.querySelectorAll(".mdc-radio.checkin").forEach(function(e){if(new mdc.radio.MDCRadio(e).checked){var t=JSON.parse(e.value);n.venue[0].geopoint={latitude:t.latitude,longitude:t.longitude},n.venue[0].location=t.location,n.venue[0].address=t.address}}),n.venue[0].location&&n.venue[0].address||(n.venue[0].geopoint={latitude:"",longitude:""});else for(a=0;a<n.venue.length;a++)n.venue[a].geopoint={latitude:n.venue[a].geopoint._latitude||"",longitude:n.venue[a].geopoint._longitude||""},n.venue[a].hasOwnProperty("showIcon")&&delete n.venue[a].showIcon;var g={venue:n.venue,schedule:n.schedule,attachment:n.attachment};e&&sendUpdateReq(g,n)}function sendUpdateReq(e,t){if(!t.hasOwnProperty("create"))return e.activityId=t.activityId,document.querySelector("header").appendChild(progressBar()),document.querySelector("#send-activity").classList.add("hidden"),void requestCreator("update",e);e.office=t.office,e.template=t.template,e.share=t.assignees,document.querySelector("header").appendChild(progressBar()),document.querySelector("#send-activity").classList.add("hidden"),requestCreator("create",e)}function checkSpacesInString(e){return!e.replace(/\s/g,"").length}function initializeAutocompleteGoogle(a,o){a.addListener("place_changed",function(){var e=a.getPlace();if(e.geometry){var t="";e.address_components&&(t=[e.address_components[0]&&e.address_components[0].short_name||"",e.address_components[1]&&e.address_components[1].short_name||"",e.address_components[2]&&e.address_components[2].short_name||""].join(" "));var n={primary:e.name,secondary:{address:t,geopoint:{_latitude:e.geometry.location.lat(),_longitude:e.geometry.location.lng()}}};updateDomFromIDB(o.record,{hash:"venue",key:o.key},n).then(function(e){updateCreateActivity(e,!0)}).catch(handleError)}else snacks("Please select a valid location")})}function createSimpleInput(e,t,n,a,o){if(!t){var c=document.createElement("span");return c.className="data--value-list",c.textContent=e,c}var i=document.createElement("div");a&&a.length<15?i.className="mdc-text-field data--value-list":i.className="mdc-text-field data--value-list-small";var r=document.createElement("input");r.className="mdc-text-field__input input--value--update",r.style.paddingTop="0px",r.value=e,r.required=o;var d=document.createElement("div");if(d.className="mdc-line-ripple",n&&(i.id="search--bar--field",r.id="search--bar-selector",i.classList.add("field-input")),i.appendChild(r),i.appendChild(d),i)new mdc.textField.MDCTextField.attachTo(i);return i}function createNumberInput(e,t){var n=document.createElement("div");n.className="mdc-text-field data--value-list";var a=document.createElement("input");a.className="mdc-text-field__input input--type-number",a.type="number",a.style.paddingTop="0px",a.value=e,t||a.setAttribute("readonly","true"),a.setAttribute("onkeypress","return event.charCode >= 48 && event.charCode <= 57");var o=document.createElement("div");return o.className="mdc-line-ripple",n.appendChild(a),n.appendChild(o),n}function createEmailInput(e,t){if(!t){var n=document.createElement("span");return n.className="data--value-list",n.textContent=e,n}var a=document.createElement("div");a.className="mdc-text-field data--value-list";var o=document.createElement("input");o.className="mdc-text-field__input input--type-email",o.type="email",o.placeholder="johndoe@example.com",o.style.paddingTop="0px",o.value=e;var c=document.createElement("div");return c.className="mdc-line-ripple",a.appendChild(o),a.appendChild(c),a}function createTimeInput(e,t,n){if(!t){var a=document.createElement("span");return a.className="data--value-list","date"===n.type&&(a.textContent=e?moment(e).calendar():""),a}var o=document.createElement("div");o.className="mdc-text-field";var c=document.createElement("input");c.className="mdc-text-field__input input--type-time",c.type=n.type,c.style.borderBottom="none","date"===n.type?c.value=moment(e).format("DD-MM-YYYY"):c.value=e,"time"===n.type&&(o.classList.add("data--value-list"),c.style.width="100%",c.value=e||moment("24","HH:mm").format("HH:mm"));var i=document.createElement("div");return i.className="mdc-line-ripple",o.appendChild(c),o.appendChild(i),n.simple?(c.classList.remove("mdc-text-field__input"),c):o}function createSelectMenu(e,t,n){if(!n){var a=document.createElement("span");return a.className="data--value-list",a.textContent=t,a}var o=document.createElement("div");o.className="mdc-select data--value-list",o.style.height="32%;",o.id=convertKeyToId(e),o.dataset.value=e,o.dataset.primary="";var c=document.createElement("select");c.className="mdc-select__native-control",c.style.paddingRight="0px";for(var i=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],r=0;r<i.length;r++){var d=document.createElement("option");d.value=i[r],d.textContent=i[r],t===i[r]&&d.setAttribute("selected","true"),c.appendChild(d)}var s=document.createElement("label");s.className="mdc-floating-label",s.textContent="";var l=document.createElement("div");return l.className="mdc-line-ripple",o.appendChild(s),o.appendChild(c),o.appendChild(l),o}function getRecipient(){return new Promise(function(a){var e=firebase.auth().currentUser.uid,o=indexedDB.open(e);o.onsuccess=function(){var e=o.result.transaction(["children"]),t=e.objectStore("children").index("template"),n=[];t.openCursor("recipient").onsuccess=function(e){var t=e.target.result;t&&("CANCELLED"!==t.status&&n.push(t.value),t.continue())},e.oncomplete=function(){a(n)}}})}var appKey=new AppKeys,ui=void 0,native={setFCMToken:function(e){localStorage.setItem("token",e)},getFCMToken:function(){return localStorage.getItem("token")},setName:function(e){localStorage.setItem("deviceType",e)},getName:function(){return localStorage.getItem("deviceType")},setIosInfo:function(e){var t=e.split("&"),n={baseOs:t[0],deviceBrand:t[1],deviceModel:t[2],appVersion:Number(t[3]),osVersion:t[4],id:t[5],initConnection:t[6]};localStorage.setItem("iosUUID",JSON.stringify(n))},getIosInfo:function(){return localStorage.getItem("iosUUID")},getInfo:function(){if(!this.getName())return!1;if("Android"===this.getName())try{return AndroidInterface.getDeviceId()}catch(e){return sendExceptionObject(e,"Catch Type 3: AndroidInterface.getDeviceId in native.getInfo()",[]),JSON.stringify({baseOs:this.getName(),deviceBrand:"",deviceModel:"",appVersion:7,osVersion:"",id:""})}return this.getIosInfo()}},app={today:function(e){return e?moment().format(e):moment()},tomorrow:function(){return moment(this.today()).add(1,"day")},isNewDay:function(e){var t=localStorage.getItem("today");return t?!moment(moment().format("YYYY-MM-DD")).isSame(moment(t))&&(localStorage.setItem("today",moment().format("YYYY-MM-DD")),!0):(localStorage.setItem("today",moment().format("YYYY-MM-DD")),!0)}};function backNav(){history.back()}function firebaseUiConfig(t){return{callbacks:{signInSuccessWithAuthResult:function(e){if(t)return document.querySelector("#updateEmailDialog")&&document.querySelector("#updateEmailDialog").remove(),updateEmail(e.user,t),!1},signInFailure:function(e){return handleUIError(e)},uiShown:function(){}},signInFlow:"popup",signInOptions:[{provider:firebase.auth.PhoneAuthProvider.PROVIDER_ID,recaptchaParameters:{type:"image",size:"normal",badge:"bottomleft"},defaultCountry:"IN",defaultNationalNumber:t?firebase.auth().currentUser.phoneNumber:""}]}}function userSignedOut(){var e=document.createElement("div");e.id="login-container",document.body.appendChild(e),ui||(ui=new firebaseui.auth.AuthUI(firebase.auth())),ui.start("#login-container",firebaseUiConfig())}function layoutGrid(){var e=document.createElement("div");e.classList.add("mdc-layout-grid","mdc-typography","app"),e.id="main-layout-app";var t=document.createElement("div");t.className="mdc-layout-grid__inner cell-space";var n=document.createElement("div");n.id="app-current-panel",n.className="mdc-layout-grid__cell--span-12";var a=document.createElement("div");a.id="snackbar-container";var o=document.createElement("div");o.id="dialog-container",t.appendChild(n),t.appendChild(a),e.appendChild(t),e.appendChild(o),document.getElementById("growthfile").innerHTML=e.outerHTML,new mdc.topAppBar.MDCTopAppBar(document.querySelector(".mdc-top-app-bar"))}function startApp(e){firebase.auth().onAuthStateChanged(function(n){if(!n)return document.getElementById("main-layout-app").style.display="none",void userSignedOut();if("production"!==appKey.getMode()||native.getInfo()){if(localStorage.getItem("error")||localStorage.setItem("error",JSON.stringify({})),e){var t=indexedDB.open(n.uid,3),a=void 0;t.onupgradeneeded=function(e){(a=t.result).onerror=function(){handleError({message:a.error.message+" from startApp on upgradeneeded"})},createObjectStores(a,n.uid)},t.onsuccess=function(){document.getElementById("main-layout-app").style.display="block",localStorage.setItem("dbexist",n.uid);var t=!1;if("Android"!==native.getName())try{webkit.messageHandlers.startLocationService.postMessage("start fetchin location")}catch(e){sendExceptionObject(e,"Catch Type 2: webkit.messageHandlers.startLocationService",["start fetchin location"]),t=!0}else t=!0;listView(),requestCreator("now",{device:native.getInfo(),from:"",registerToken:native.getFCMToken()}),runAppChecks(),t&&manageLocation().then(console.log).catch(function(e){handleError(e)})},t.onerror=function(){handleError({message:t.error.message+" from startApp"})}}}else redirect()})}function getEmployeeDetails(){return new Promise(function(o,c){var i=firebase.auth().currentUser,r=indexedDB.open(i.uid);r.onsuccess=function(){var e=r.result.transaction(["children"]),t=e.objectStore("children"),n=void 0,a=IDBKeyRange.bound(["employee","CONFIRMED"],["employee","PENDING"]);t.index("templateStatus").openCursor(a).onsuccess=function(e){var t=e.target.result;t&&(t.value.attachment["Employee Contact"].value===i.phoneNumber&&(n=t.value),t.continue())},e.oncomplete=function(){o(n)},e.onerror=function(){c({message:e.error.message+" from getEmployeeDetails"})}},r.onerror=function(){c({message:r.error.message+" from getEmployeeDetails"})}})}function isEmployeeOnLeave(){return new Promise(function(i,r){getEmployeeDetails().then(function(o){if(!o)return i(!1);o.onLeave=!1;var c=indexedDB.open(firebase.auth().currentUser.uid);c.onsuccess=function(){var e=c.result.transaction(["calendar"]),t=e.objectStore("calendar"),n=IDBKeyRange.bound(["leave","CONFIRMED",o.office],["leave","PENDING",o.office]),a=!1;t.index("onLeave").openCursor(n).onsuccess=function(e){var t=e.target.result;t&&(moment(moment().format("YYYY-MM-DD")).isBetween(t.value.start,t.value.end,null,"[]")?a=!0:t.continue())},e.oncomplete=function(){i(a)},e.onerror=function(){r({message:e.error.message+" from isEmployeeOnLeave"})}},c.onerror=function(){r({message:c.error.message+" from isEmployeeOnLeave"})}}).catch(function(e){r(e)})})}function createObjectStores(e,t){var n=e.createObjectStore("activity",{keyPath:"activityId"});n.createIndex("timestamp","timestamp"),n.createIndex("office","office"),n.createIndex("hidden","hidden");var a=e.createObjectStore("list",{keyPath:"activityId"});a.createIndex("timestamp","timestamp"),a.createIndex("status","status");var o=e.createObjectStore("users",{keyPath:"mobile"});o.createIndex("displayName","displayName"),o.createIndex("isUpdated","isUpdated"),o.createIndex("count","count"),e.createObjectStore("addendum",{autoIncrement:!0}).createIndex("activityId","activityId");var c=e.createObjectStore("subscriptions",{autoIncrement:!0});c.createIndex("office","office"),c.createIndex("template","template"),c.createIndex("officeTemplate",["office","template"]);var i=e.createObjectStore("calendar",{autoIncrement:!0});i.createIndex("activityId","activityId"),i.createIndex("timestamp","timestamp"),i.createIndex("start","start"),i.createIndex("end","end"),i.createIndex("urgent",["status","hidden"]),i.createIndex("onLeave",["template","status","office"]);var r=e.createObjectStore("map",{autoIncrement:!0});r.createIndex("activityId","activityId"),r.createIndex("location","location"),r.createIndex("latitude","latitude"),r.createIndex("longitude","longitude"),r.createIndex("nearby",["status","hidden"]),r.createIndex("byOffice",["office","location"]);var d=e.createObjectStore("children",{keyPath:"activityId"});d.createIndex("template","template"),d.createIndex("office","office"),d.createIndex("templateStatus",["template","status"]),e.createObjectStore("root",{keyPath:"uid"}).put({uid:t,fromTime:0,location:""})}function redirect(){firebase.auth().signOut().then(function(){window.location="https://www.growthfile.com"}).catch(function(e){window.location="https://www.growthfile.com",handleError({message:e+" from redirect"})})}function initLocation(){manageLocation().then(console.log).catch(function(e){handleError(e)})}function runAppChecks(){window.addEventListener("suggestCheckIn",function(t){isEmployeeOnLeave().then(function(e){if(!e&&t.detail&&"listView"===history.state[0])try{getRootRecord().then(function(e){if(e.offices&&e.offices.length){var t=e.offices,n=document.createElement("h1");n.className="mdc-typography--body1 mt-10",n.textContent="Do you want to create a Check-In ?",document.getElementById("dialog-container").innerHTML=dialog({id:"suggest-checkIn-dialog",headerText:"Check-In Reminder",content:n,showCancel:!0,showAccept:!0}).outerHTML;var a=document.querySelector("#suggest-checkIn-dialog"),o=new mdc.dialog.MDCDialog(a);o.show(),o.listen("MDCDialog:accept",function(e){isLocationStatusWorking()&&(1!==t.length?selectorUI({record:"",store:"subscriptions",suggestCheckIn:!0}):createTempRecord(t[0],"check-in",{suggestCheckIn:!0}))}),o.listen("MDCDialog:cancel",function(){a.remove()}),listView()}})}catch(e){console.log(e)}}).catch(handleError)},!0)}window.addEventListener("load",function(){layoutGrid(),firebase.initializeApp(appKey.getKeys());var t="Device Incompatibility",n="Your Device is Incompatible with Growthfile. Please Upgrade your Android Version";if(window.Worker||window.indexedDB)moment.updateLocale("en",{calendar:{lastDay:"[yesterday]",sameDay:"hh:mm",nextDay:"[Tomorrow at] LT",lastWeek:"dddd",nextWeek:"dddd [at] LT",sameElse:"L"},longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YY"},months:["January","February","March","April","May","June","July","August","September","October","November","December"]}),window.onpopstate=function(e){if(e.state){if("listView"!==e.state[0])return window[e.state[0]](e.state[1],!1);var t=scroll_namespace.count;t&&(scroll_namespace.size=t),scroll_namespace.count=0,window[e.state[0]]()}},startApp(!0);else try{AndroidInterface.showDialog(t,n)}catch(e){var a=document.createElement("span");a.textContent=n,a.className="mdc-typography--body1",sendExceptionObject(e,"Catch Type 1: AndroidInterface.showDialog at window.onload",[t,n]),document.getElementById("dialog-container").innerHTML=dialog({id:"device-incompatibility-dialog",headerText:t,content:a}).outerHTML,new mdc.dialog.MDCDialog(document.getElementById("device-incompatibility-dialog")).show()}});var scroll_namespace={count:0,size:20,skip:!1};function initDomLoad(){document.querySelector(".init-loader")&&document.querySelector(".init-loader").remove(),document.querySelector(".mdc-linear-progress")&&document.querySelector(".mdc-linear-progress").remove(),listPanel(),creatListHeader("Activities"),createActivityIcon()}function listView(){history.pushState(["listView"],null,null),initDomLoad(),getSizeOfListStore().then(function(t){t?(20<t&&window.addEventListener("scroll",handleScroll,!1),getRootRecord().then(function(e){t&&t<=20?loadActivitiesFromListStore(e.location):startCursor(e.location)})):appendTextContentInListView("No activities Found")})}function appendTextContentInListView(e){var t=document.createElement("p");t.textContent=e,t.className="no-activity",document.getElementById("activity-list-main").appendChild(t),document.getElementById("activity-list-main").style.boxShadow="none"}function getSizeOfListStore(){return new Promise(function(t,n){var a=indexedDB.open(firebase.auth().currentUser.uid);a.onsuccess=function(){var e=a.result.transaction(["list"]).objectStore("list").count();e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}},a.onerror=function(){n(a.error)}})}function updateEl(n,i){var a=indexedDB.open(firebase.auth().currentUser.uid);a.onsuccess=function(){var e=a.result.transaction(["list","activity"]),o=e.objectStore("activity"),t=e.objectStore("list"),c=document.getElementById("activity--list");n.forEach(function(a){document.querySelector(".no-activity")&&document.querySelector(".no-activity").remove(),t.get(a.activityId).onsuccess=function(e){var t=e.target.result,n=document.querySelector('[data-id="'+a.activityId+'"]');n&&n.remove(),t&&(i.location?getActivityDataForList(o,t,i.location).then(function(e){c&&c.insertBefore(e,c.childNodes[0])}):getActivityDataForList(o,t).then(function(e){c&&c.insertBefore(e,c.childNodes[0])}))}})}}function handleScroll(e){getRootRecord().then(function(e){if(window.innerHeight+window.scrollY===document.body.scrollHeight){if(!document.getElementById("activity--list"))return;startCursor(e.location)}})}function loadActivitiesFromListStore(o){var c=indexedDB.open(firebase.auth().currentUser.uid);c.onsuccess=function(){var e=c.result.transaction(["list","activity","root"]),n=e.objectStore("activity"),t=e.objectStore("list").index("timestamp"),a=document.createDocumentFragment();t.openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;t&&(getActivityDataForList(n,t.value,o).then(function(e){a.appendChild(e)}),t.continue())},e.oncomplete=function(){var e=document.getElementById("activity--list");e&&(e.innerHTML="",e.appendChild(a),scrollToActivity())}}}function startCursor(i){console.log(i);var r=indexedDB.open(firebase.auth().currentUser.uid);r.onsuccess=function(){var e=r.result.transaction(["list","activity","root"]),n=e.objectStore("activity"),t=e.objectStore("list").index("timestamp"),a=0,o=scroll_namespace.count,c=document.createDocumentFragment();t.openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;t&&(o?scroll_namespace.skip?(getActivityDataForList(n,t.value,i).then(function(e){c.appendChild(e),a++}),runCursor(t,a)):(scroll_namespace.skip=!0,t.advance(o)):(getActivityDataForList(n,t.value,i).then(function(e){c.appendChild(e),a++}),runCursor(t,a)))},e.oncomplete=function(){var e=document.getElementById("activity--list");e&&(e.appendChild(c),scroll_namespace.count=scroll_namespace.count+scroll_namespace.size,scroll_namespace.skip=!1,scroll_namespace.size=20,scrollToActivity())}}}function runCursor(e,t){t<scroll_namespace.size&&e.continue()}function getActivityDataForList(t,l,u){return new Promise(function(i,e){var r=document.createElement("div");r.style.marginTop="10px";var d=document.createElement("span");d.className="mdc-list-item__secondary-text venue-secondline";var s=document.createElement("span");s.className="mdc-list-item__secondary-text",t.get(l.activityId).onsuccess=function(e){var t=e.target.result;if(t){var n=t.schedule,a=t.venue,o=void 0,c=generateLastestSchedule(n,l.createdTime);u&&(o=generateLatestVenue(a,u)),o&&!c?(d.textContent=o,d.style.maxWidth="70%"):c&&!o?s.textContent=c:c&&o&&(d.textContent=o,s.textContent=" | "+c),r.appendChild(d),r.appendChild(s),i(activityListUI(l,r))}}})}function generateLastestSchedule(e,t){var n=removeEmptyObjects(e,"startTime","endTime");if(!n.length)return formatCreatedTime(t);var a=Date.now();return getTimeTypeForMultipleSchedule(a,sortDatesInAscendingOrderWithPivot(a,n))}function removeEmptyObjects(e,t,n){return e.length?e.filter(function(e){if(e[t]&&e[n])return e}):e}function sortDatesInAscendingOrderWithPivot(e,t){var n=t.slice();return n.push(e),n.sort(function(e,t){return e-t})}function getTimeTypeForMultipleSchedule(e,t){var n=t.slice().indexOf(e);return n==t.length-1?moment(t[t.length-2]).format("D, MMM").replace(",",""):moment(t[n+1]).format("D, MMM").replace(",","")}function formatCreatedTime(e){return e?isToday(e)?moment(e).format("hh:mm"):moment(e).format("D, MMM").replace(",",""):""}function isToday(e){return(new Date).setHours(0,0,0,0)==new Date(e).setHours(0,0,0,0)}function generateLatestVenue(e,n){var t=removeEmptyObjects(e,"location","address"),a=t.length;if(!a)return"";if(1==a)return t[0].location;var o=[];return e.forEach(function(e){var t={latitude:e.geopoint._latitude,longitude:e.geopoint._longitude};o.push({distance:calculateDistanceBetweenTwoPoints(t,n),location:e.location})}),sortNearestLocation(o)[0].location}function sortNearestLocation(e){return e.slice().sort(function(e,t){return e.distance-t.distance})}function activityListUI(e,t){var n=document.createElement("li");n.dataset.id=e.activityId,n.onclick=function(){localStorage.setItem("clickedActivity",this.dataset.id),conversation(this.dataset.id,!0)},n.classList.add("mdc-list-item","activity--list-item","mdc-elevation--z1");var a=document.createElement("object");a.data=e.creator.photo||"./img/empty-user.jpg",a.type="image/jpeg",a.className="mdc-list-item__graphic material-icons";var o=document.createElement("img");o.src="./img/empty-user.jpg",o.className="empty-user-list",a.appendChild(o);var c=document.createElement("span");c.classList.add("mdc-list-item__text");var i=document.createElement("span");i.className="mdc-list-item__primary-text bigBlackBold",i.textContent=e.activityName,c.appendChild(i),c.appendChild(t);var r=document.createElement("div");r.className="mdc-meta__custom-text",r.style.width="76px",isToday(e.timestamp)&&(r.style.marginTop="4px"),r.textContent=moment(e.timestamp).calendar();var d=document.createElement("span");return d.classList.add("mdc-list-item__meta"),d.appendChild(r),d.appendChild(generateIconByCondition(e,n)),n.appendChild(a),n.appendChild(c),n.appendChild(d),n}function generateIconByCondition(e,t){if(e.count){var n=document.createElement("span");return n.textContent=e.count,n.className="count mdc-meta__custom-text",t.classList.add("count-active"),n}var a=document.createElement("i");a.classList.add("status-cancel","material-icons",""+e.status),a.textContent="clear";var o=document.createElement("i");o.classList.add("status-confirmed","material-icons",""+e.status),o.textContent="check";var c=document.createElement("i");return c.classList.add("status-pending","material-icons",""+e.status),c.textContent="","CONFIRMED"===e.status?o:"CANCELLED"===e.status?a:c}function appendActivityListToDom(e){var t=document.getElementById("activity--list");t&&t.appendChild(e)}function getRootRecord(){return new Promise(function(t,n){var a=void 0,o=firebase.auth().currentUser.uid,c=indexedDB.open(o);c.onsuccess=function(){var e=c.result.transaction(["root"],"readwrite");e.objectStore("root").get(o).onsuccess=function(e){var t=e.target.result;a=t},e.oncomplete=function(){t(a)},e.onerror=function(){n({message:e.error.message+" from getRootRecord"})}},c.onerror=function(){n({message:c.error+" from getRootRecord"})}})}function createActivityIcon(){document.getElementById("create-activity")||getCountOfTemplates().then(function(e){e&&createActivityIconDom()}).catch(handleError)}function getCountOfTemplates(){return new Promise(function(t,n){var a=0,o=indexedDB.open(firebase.auth().currentUser.uid);o.onsuccess=function(){var e=o.result.transaction(["subscriptions"],"readonly");e.objectStore("subscriptions").index("office").openCursor(null,"nextunique").onsuccess=function(e){var t=e.target.result;t&&(a++,t.continue())},e.oncomplete=function(){t(a)},e.onerror=function(){n({message:e.error.message+" from getCountOfTemplates"})}},o.onerror=function(){n({message:o.error.message+" from getCountOfTemplates"})}})}function createActivityIconDom(){var e=document.getElementById("create-activity--parent"),t=document.createElement("button");t.className="mdc-fab create-activity",t.id="create-activity",t.setAttribute("aria-label","Add");var n=document.createElement("span");n.className="mdc-fab_icon material-icons",n.id="activity-create--icon",n.textContent="add",t.appendChild(n),e.innerHTML=t.outerHTML,document.querySelector(".create-activity").addEventListener("click",function(e){selectorUI({record:"",store:"subscriptions",suggestCheckIn:!1})})}function listPanel(){if(!document.getElementById("activity-list-main")){var e=document.createElement("div");e.className="mdc-card panel-card mdc-top-app-bar--fixed-adjust",e.id="activity-list-main";var t=document.createElement("ul");t.className="mdc-list mdc-list--two-line mdc-list--avatar-list",t.id="activity--list",e.appendChild(t);var n=document.createElement("div");n.id="create-activity--parent",e.appendChild(n),document.getElementById("app-current-panel").innerHTML=e.outerHTML}}function creatListHeader(c){var t=indexedDB.open(firebase.auth().currentUser.uid);t.onsuccess=function(){var e=t.result,o=document.getElementById("section-start");o.innerHTML="",getUserRecord(e,firebase.auth().currentUser.phoneNumber).then(function(e){var t=document.createElement("object");t.className="list-photo-header",t.type="image/jpeg",t.data=e.photoURL||"./img/empty-user.jpg",t.onclick=function(){profileView(!0)};var n=document.createElement("img");n.src="./img/empty-user.jpg",n.className="list-photo-header",t.appendChild(n);var a=document.createElement("span");a.textContent=c,a.className="mdc-top-app-bar__title mdc-typography--headline5",o.appendChild(t),o.appendChild(a)})}}function scrollToActivity(){var e=localStorage.getItem("clickedActivity");if(document.querySelector('[data-id="'+e+'"]'))return document.querySelector('[data-id="'+e+'"]').scrollIntoView({behavior:"instant",block:"center",inline:"center"}),void localStorage.removeItem("clickedActivity")}function modifyHeader(e){e.left&&(document.getElementById(e.id+"view-type").innerHTML=e.left);e.right&&(document.getElementById(e.id+"action-data").innerHTML=e.right)}function headerBackIcon(e){var t=document.createElement("i");return t.className="material-icons mdc-top-app-bar__navigation-icon",t.textContent="arrow_back",t.onclick=function(){if(!e)return backNav();"subscriptions"===e?listView():updateCreateActivity(history.state[1],!0)},t}function profileView(e){e&&history.pushState(["profileView"],null,null),window.addEventListener&&window.removeEventListener("scroll",handleScroll,!1),document.body.style.backgroundColor="#eeeeee";var t=document.getElementById("section-start");t.innerHTML="",t.appendChild(headerBackIcon());var c=firebase.auth().currentUser,i=c.uid,r=indexedDB.open(i);r.onsuccess=function(){var n=r.result,a=n.transaction(["root"],"readwrite"),o=a.objectStore("root");o.get(i).onsuccess=function(e){var t=e.target.result;o.put(t),a.oncomplete=function(){createProfilePanel(n).then(function(e){document.getElementById("app-current-panel")&&(document.getElementById("app-current-panel").innerHTML=e.outerHTML,"Android"===native.getName()?document.getElementById("uploadProfileImage").addEventListener("click",function(){try{AndroidInterface.openImagePicker()}catch(e){sendExceptionObject(e,"CATCH Type 10:AndroidInterface.openImagePicker at profileview",[])}}):document.getElementById("uploadProfileImage").addEventListener("change",function(){readUploadedFile()}),changeDisplayName(c),changeEmailAddress(c))})}}}}function createProfilePanel(e){return new Promise(function(v){getUserRecord(e,firebase.auth().currentUser.phoneNumber).then(function(e){var t=document.createElement("div");t.id="profile-view--container",t.className="mdc-top-app-bar--fixed-adjust mdc-theme--background";var n=document.createElement("button");n.className="mdc-fab","Android"===native.getName()&&(n.id="uploadProfileImage");var a=document.createElement("label");a.setAttribute("for","uploadProfileImage");var o=document.createElement("span");o.className="mdc-fab__icon material-icons",o.textContent="add_a_photo",a.appendChild(o),n.appendChild(a);var c=void 0;"Android"!==native.getName()&&((c=document.createElement("input")).type="file",c.style.display="none",c.id="uploadProfileImage",c.accept="image/jpeg;");var i=document.createElement("div");i.id="profile--image-container",i.className="profile-container--main";var r=document.createElement("object");r.type="image/jpeg",r.data=e.photoURL||"./img/empty-user-big.jpg",r.id="user-profile--image";var d=document.createElement("img");d.src="./img/empty-user-big.jpg",d.className="empty-user-profile",r.appendChild(d);var s=document.createElement("div");s.className="insert-overlay",i.appendChild(r),i.appendChild(s),i.appendChild(n),"Android"!==native.getName()&&a.appendChild(c);var l=document.createElement("div");l.id="name--change-container",l.className="profile-psuedo-card";var u=document.createElement("button");u.className="mdc-icon-button material-icons hidden",u.id="edit--name",u.setAttribute("aria-hidden","true"),u.setAttribute("aria-pressed","false"),u.textContent="check";var m=firebase.auth().currentUser.displayName;l.innerHTML='<div class="mdc-text-field" id=\'name-change-field\'>\n        <input autocomplete="off" type="text"  placeholder="'+(m?"":"Enter Your Name")+'"  id="pre-filled-name" class="mdc-text-field__input" value="'+(m||"")+'">\n        <label class="mdc-floating-label mdc-floating-label--float-above" for="pre-filled-name">\n         Your Name\n        </label>\n        <div class="mdc-line-ripple"></div>\n      </div>\n      ',l.appendChild(u);var p=document.createElement("div");p.id="email--change-container",p.className="profile-psuedo-card";var h=document.createElement("button");h.className="mdc-icon-button material-icons hidden",h.id="edit--email",h.setAttribute("aria-hidden","true"),h.setAttribute("aria-pressed","false"),h.textContent="check";var f=firebase.auth().currentUser.email;p.innerHTML='<div class="mdc-text-field" id=\'email-change-field\'>\n        <input  autocomplete="off" type="text" id="pre-filled-email" class="mdc-text-field__input" value="'+(f||"")+'" placeholder="'+(f?"":"Enter your Email")+'">\n        <label class="mdc-floating-label mdc-floating-label--float-above" for="pre-filled-email">\n         Your Email\n        </label>\n        <div class="mdc-line-ripple"></div>\n      </div>\n      ',p.appendChild(h),t.appendChild(i),t.appendChild(l),t.appendChild(p),v(t)})})}function timeDiff(e){var t=moment().format("YYY-MM-DD HH:mm"),n=moment(e).format("YYY-MM-DD HH:mm");return moment(t).diff(moment(n),"minutes")}function newSignIn(e,t){document.getElementById("dialog-container").innerHTML=dialog({id:"updateEmailDialog",showCancel:!0,showAccept:!1,headerText:!1,content:!1}).outerHTML;var n=document.querySelector("#updateEmailDialog");n.querySelector("section").id="refresh-login";var a=new mdc.dialog.MDCDialog(n);a.listen("MDCDialog:cancel",function(e){n.remove()}),a.show();try{ui||(ui=new firebaseui.auth.AuthUI(firebase.auth())),ui.start("#refresh-login",firebaseUiConfig(e)),setTimeout(function(){document.querySelector(".firebaseui-id-phone-number").disabled=!0,document.querySelector(".firebaseui-label").remove(),document.querySelector(".firebaseui-title").textContent="Verify your phone Number to Update your Email address"},500),a.listen("MDCDialog:cancel",function(){t.value=firebase.auth().currentUser.email,n.remove()})}catch(e){n.remove(),console.log(e),handleError({message:e.message+" from newSignIn function during email updation"}),snacks("Please try again later")}}function readUploadedFile(e){if("Android"!==native.getName()){var t=document.getElementById("uploadProfileImage").files[0],n=new FileReader;n.addEventListener("load",function(){sendBase64ImageToBackblaze(n.result)},!1),t&&n.readAsDataURL(t)}else sendBase64ImageToBackblaze(e)}function sendBase64ImageToBackblaze(e){var t=document.getElementById("user-profile--image"),n=document.getElementById("profile--image-container"),a="data:image/jpeg;base64,";t&&(t.data=a+e),n&&document.getElementById("profile--image-container").appendChild(loader("profile--loader")),requestCreator("backblaze",{imageBase64:a+e})}function authUpdatedError(e){"auth/invalid-email"!==e.message&&handleError({message:e.message+" from authUpdatedError"}),document.querySelector(".init-loader")&&document.querySelector(".init-loader").remove(),snacks(e.message)}function changeDisplayName(){var e=document.getElementById("name-change-field"),t=new mdc.textField.MDCTextField(e),n=document.getElementById("edit--name");firebase.auth().currentUser.displayName;e.addEventListener("click",function(){document.getElementById("pre-filled-name").placeholder="",n.classList.remove("hidden"),e.classList.add("short")}),e.addEventListener("keydown",function(e){13==e.keyCode&&updateName(t.value)}),n.addEventListener("click",function(){updateName(t.value)})}function updateName(e){e?firebase.auth().currentUser.updateProfile({displayName:e}).then(successDialog).catch(function(e){snacks("Please Try again later"),handleError({message:e+" at updateProfile in changeDisplayName"})}):snacks("Please Enter a Name")}function changeEmailAddress(){var e=document.getElementById("email-change-field"),t=new mdc.textField.MDCTextField(e),n=document.getElementById("edit--email");e.addEventListener("click",function(){document.getElementById("pre-filled-email").placeholder="",n.classList.remove("hidden"),e.classList.add("short")}),e.addEventListener("keydown",function(e){13==e.keyCode&&emailValidation(t)}),n.addEventListener("click",function(){emailValidation(t)})}function emailValidation(e){var t=firebase.auth().currentUser,n=e.value;n?n===t.email&&t.emailVerified?snacks("You have already set this as your email address"):timeDiff(t.metadata.lastSignInTime)<=2?updateEmail(t,n):newSignIn(n,e):snacks("Enter a valid Email Id")}function updateEmail(e,t){document.getElementById("growthfile").appendChild(loader("init-loader")),e.updateEmail(t).then(function(){emailUpdateSuccess(!0)}).catch(authUpdatedError)}function emailUpdateSuccess(e){firebase.auth().currentUser.sendEmailVerification().then(function(){emailVerificationSuccess(e)}).catch(emailVerificationError)}function emailVerificationSuccess(e){e&&successDialog(),snacks("Verification link has been send to your email address")}function emailVerificationError(e){snacks(e.message),document.querySelector(".init-loader")&&document.querySelector(".init-loader").remove(),handleError({message:e.message+" from emailVerificationError"})}function initUserSelectorSearch(c,t){var i=indexedDB.open(firebase.auth().currentUser.uid);i.onsuccess=function(){var n=i.result,e=t.input_,a=e.value="",o=document.createDocumentFragment();e.addEventListener("input",function(e){var t=e.target.value;if(isNumber(t))return a=n.transaction("users").objectStore("users"),void searchUsersDB(formatNumber(t),a,o,c);o=document.createDocumentFragment(),a=n.transaction("users").objectStore("users").index("displayName"),searchUsersDB(formatName(t),a,o,c)})}}function isNumber(e){return!isNaN(e)}function formatNumber(e){var t=e;return"91"===t.substring(0,2)?t="+"+t:"+91"!==t.substring(0,3)&&(t="+91"+t),t}function formatName(e){var t=e.split(" "),n=t.length,a=[],o=0;for(o=0;o<n;o++){var c=t[o];if(c.charAt(0).toUpperCase()===e.charAt(0).toUpperCase)return e;a.push(c.charAt(0).toUpperCase()+c.slice(1))}return a.join(" ")}function checkNumber(e){return/^\+[1-9]\d{11,14}$/.test(e)}function searchUsersDB(e,t,o,c){console.log(e);var n=IDBKeyRange.bound(e,e+"￿"),i=document.getElementById("data-list--container"),a=c.record.assignees,r={};a.forEach(function(e){"string"==typeof e?r[e]=!0:r[e.phoneNumber]=!0}),r[firebase.auth().currentUser.phoneNumber]=!0,t.openCursor(n).onsuccess=function(e){var t=e.target.result;if(!t){if(i.innerHTML="",0!=o.children.length)return i.appendChild(o),void document.querySelectorAll('[data-selected="true"]').forEach(function(e){new mdc.checkbox.MDCCheckbox.attachTo(e).checked=!0,e.children[1].style.animation="none",e.children[1].children[0].children[0].style.animation="none"});var n=document.createElement("div");n.className="data-not-found";var a=document.createElement("p");return a.textContent="No Contact Found",a.className="mdc-typography--headline5",n.appendChild(a),void(document.querySelector(".data-not-found")||i.appendChild(n))}c.attachment.present?o.appendChild(createSimpleAssigneeLi(t.value,!0,!1)):r.hasOwnProperty(t.value.mobile)||o.appendChild(createSimpleAssigneeLi(t.value,!0,!0)),t.continue()}}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function selectorUI(i){var e=document.getElementById("app-current-panel"),t=document.getElementById("section-start");t.innerHTML="",t.appendChild(headerBackIcon(i.store));var n=document.createElement("div");n.className="selector-container mdc-top-app-bar--fixed-adjust","map"===i.store&&n.appendChild(createSeachInput("map-selector-search","Search For Location")),"users"===i.store&&n.appendChild(createSeachInput("users-selector-search","Search Users"));var a=document.createElement("ul");a.id="data-list--container",a.className="mdc-list",n.appendChild(a);var o=document.createElement("span");o.className="selector-warning-text",o.id="selector-warning",n.appendChild(o);var c=document.createElement("button");c.textContent="SELECT",c.id="selector-submit-send",c.className="mdc-button selector-submit--button selector-send",n.appendChild(c),e.innerHTML=n.outerHTML,window.scrollTo(0,0);i.record;var r=firebase.auth().currentUser.uid,d=indexedDB.open(r);d.onsuccess=function(){var e=d.result;if("map"===i.store){var t=new mdc.textField.MDCTextField.attachTo(document.querySelector("#map-selector-search")),n=e.transaction([i.store]),a=t.input_;autocomplete=new google.maps.places.Autocomplete(a,{componentRestrictions:{country:"in"}}),a.placeholder="",initializeAutocompleteGoogle(autocomplete,i),getLocationForMapSelector(n,i).then(function(e){e||(document.getElementById("map-selector-search").style.display="none",document.getElementById("selector-submit-send").textContent="CANCEL",document.getElementById("data-list--container").appendChild(noSelectorResult("No Location Found"))),handleClickListnersForMap(i,e)}).catch(console.log)}if("subscriptions"===i.store&&fillSubscriptionInSelector(e,i),"users"===i.store){e.transaction(i.store).objectStore(i.store);var o=new mdc.textField.MDCTextField.attachTo(document.getElementById("users-selector-search"));initUserSelectorSearch(i,o),resetSelectedContacts().then(function(){fillUsersInSelector(i)})}if("children"===i.store){var c=e.transaction([i.store]);fillChildrenInSelector(c.objectStore(i.store).index("templateStatus"),i,c)}}}function getLocationForMapSelector(r,d){return new Promise(function(e,t){var n=0,a=document.getElementById("data-list--container"),o=r.objectStore("map"),c=d.record.office,i=IDBKeyRange.bound([c,""],[c,"￿"]);o.index("byOffice").openCursor(i,"nextunique").onsuccess=function(e){var t=e.target.result;t&&(t.value.office===d.record.office&&t.value.location&&(n++,a.appendChild(createVenueLi(t.value,!1,d.record,!0))),t.continue())},r.oncomplete=function(){e(n)},r.onerror=function(){t(r.error)}})}function createSeachInput(e,t){var n=document.createElement("div");n.id=e,n.className="mdc-text-field mdc-text-field--with-leading-icon search-field";var a=document.createElement("i");a.className="material-icons mdc-text-field__icon",a.textContent="search";var o=document.createElement("input");o.className="mdc-text-field__input";var c=document.createElement("div");c.className="mdc-line-ripple";var i=document.createElement("label");return i.className="mdc-floating-label",i.textContent=t,n.appendChild(a),n.appendChild(o),n.appendChild(c),n.appendChild(i),n}function handleClickListnersForMap(a,o){document.querySelector("#selector-submit-send").onclick=function(){if(o){var e=document.querySelector(".mdc-radio.radio-selected");if(e){var t=new mdc.radio.MDCRadio(e),n=JSON.parse(t.value);updateDomFromIDB(a.record,{hash:"venue",key:a.key},{primary:n.location,secondary:{address:n.address,geopoint:n.geopoint}}).then(function(e){updateCreateActivity(e,!0)}).catch(function(e){console.log(e)})}else document.getElementById("selector-warning").textContent="* Please Choose A Location"}else updateCreateActivity(a.record,!0)}}function fillChildrenInSelector(e,a,t){var n=document.getElementById("data-list--container"),o=IDBKeyRange.bound([a.attachment.template,"CONFIRMED"],[a.attachment.template,"PENDING"]),c=0;e.openCursor(o).onsuccess=function(e){var t=e.target.result;t&&(a.attachment.office===t.value.office&&(t.value.attachment.Name&&(c++,n.appendChild(createSimpleLi("children",t.value.attachment.Name.value))),t.value.attachment.Number&&(c++,n.appendChild(createSimpleLi("children",t.value.attachment.Number.value)))),t.continue())},t.oncomplete=function(){var e=document.getElementById("selector-submit-send");if(!c)return n.appendChild(noSelectorResult("No Values Found")),e.textContent="CANCEL",void(e.onclick=function(){updateCreateActivity(a.record,!0)});document.getElementById("selector-submit-send").onclick=function(){var e=document.querySelector(".mdc-radio.radio-selected");if(e){var t=new mdc.radio.MDCRadio(e),n=JSON.parse(t.value);updateDomFromIDB(a.record,{hash:"children",key:a.attachment.key},{primary:n.name}).then(function(e){updateCreateActivity(e,!0)}).catch(function(e){console.log(e)})}else document.getElementById("selector-warning").textContent="* Please Select a Value"}}}function fillSubscriptionInSelector(e,o){var c=document.getElementById("data-list--container"),i=document.createElement("div");i.className="mdc-list-group";var r=[],t=e.transaction(["subscriptions"]);t.objectStore("subscriptions").index("office").openCursor(null,"nextunique").onsuccess=function(e){var t=e.target.result;if(t){var n=document.createElement("h3");n.className="mdc-list-group__subheader subheader--group-small",n.textContent=t.value.office,n.dataset.groupOffice=t.value.office;var a=document.createElement("ul");a.className="mdc-list",a.dataset.selection=t.value.office,a.setAttribute("aria-orientation","vertical"),r.push(t.value.office),i.appendChild(n),i.appendChild(a),t.continue()}},t.oncomplete=function(){if(o.suggestCheckIn){var e=document.getElementById("data-list--container"),t=document.createElement("div");t.className="suggest-checkin--view";var n=document.createElement("span");n.className="material-icons suggestion-icon",n.textContent="add_alert",t.appendChild(n);var a=document.createElement("span");a.textContent="Check-In ?",a.className="suggest-checkin--text",t.appendChild(n),t.appendChild(a),e.insertBefore(t,e.childNodes[0])}insertTemplateByOffice(r,o.suggestCheckIn),c.appendChild(i),document.getElementById("selector-submit-send").onclick=function(){if(isLocationStatusWorking())if(document.querySelector(".mdc-radio.radio-selected")){document.getElementById("selector-warning").textContent="";var e=new mdc.radio.MDCRadio(document.querySelector(".mdc-radio.radio-selected")),t=JSON.parse(e.value);document.getElementById("app-current-panel").dataset.view="create",createTempRecord(t.office,t.template,o)}else document.getElementById("selector-warning").textContent="Please Select a Template"}}}function insertTemplateByOffice(e,n){var t=indexedDB.open(firebase.auth().currentUser.uid),a=(document.createDocumentFragment(),[]);t.onsuccess=function(){var e=t.result.transaction(["subscriptions"],"readonly");e.objectStore("subscriptions").index("office").openCursor().onsuccess=function(e){var t=e.target.result;if(t)if("CANCELLED"!==t.value.status)if(document.querySelector('[data-selection="'+t.value.office+'"] [data-template="'+t.value.template+'"]'))t.continue();else{if(n&&"check-in"===t.value.template)return a.push(_defineProperty({},t.value.office,createGroupList(t.value.office,t.value.template))),void t.continue();document.querySelector('[data-selection="'+t.value.office+'"]').appendChild(createGroupList(t.value.office,t.value.template)),t.continue()}else t.continue()},e.oncomplete=function(){a.forEach(function(n){Object.keys(n).forEach(function(e){var t=document.querySelector('[data-selection="'+e+'"]');t.insertBefore(n[e],t.childNodes[0])})}),document.querySelector(".selector-send").classList.remove("hidden")}}}function createGroupList(e,t){var n=document.createElement("li");n.className="mdc-list-item transition-ease",n.dataset.template=t;var a=document.createElement("span");a.className="mdc-list-item__text",a.textContent=t.toUpperCase();var o=document.createElement("span");return o.className="mdc-list-item__meta",o.appendChild(createRadioInput()),n.onclick=function(){checkRadioInput(this,{office:e,template:t})},n.appendChild(a),n.appendChild(o),n}var apiHandler=new Worker("js/apiHandler.js");function handleError(e){var t=JSON.parse(localStorage.getItem("error"));if(!t.hasOwnProperty(e.message))return t[e.message]=!0,localStorage.setItem("error",JSON.stringify(t)),e.device=native.getInfo(),void requestCreator("instant",JSON.stringify(e))}function loader(e){var t=document.createElement("div");return t.className="loader "+e,t}function dialog(e){var t=document.createElement("aside");t.id=e.id,t.className="mdc-dialog dialog-custom-backdrop",t.role="alertdialog";var n=document.createElement("div");if(n.className="mdc-dialog__surface",e.headerText){var a=document.createElement("header");a.className="mdc-dialog__header";var o=document.createElement("h2");o.className="mdc-dialog__header__title",o.textContent=e.headerText,a.appendChild(o),n.appendChild(a)}var c=document.createElement("section");c.className="mdc-dialog__content",e.content&&c.appendChild(e.content),n.appendChild(c);var i=document.createElement("footer");if(i.className="mdc-dialog__footer",e.showCancel){var r=document.createElement("button");r.type="button",r.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--cancel",r.textContent="cancel",r.style.backgroundColor="#3498db",i.appendChild(r)}if(e.showAccept){var d=document.createElement("button");d.type="button",d.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--accept",d.textContent="Okay",d.style.backgroundColor="#3498db",i.appendChild(d)}return n.appendChild(i),t.appendChild(n),t}function successDialog(){var e=document.createElement("div");e.className="success--container";var t=document.createElement("div");t.className="success--check",e.appendChild(t),document.getElementById("dialog-container").innerHTML=dialog({id:"success-dialog",headerText:"",showCancel:!1,showAccept:!1,content:e}).outerHTML;var n=document.querySelector("#success-dialog");new mdc.dialog.MDCDialog(n).show(),setTimeout(function(){n.remove(),document.body.classList.remove("mdc-dialog-scroll-lock")},1e3),scroll_namespace.count=0,scroll_namespace.size=20,localStorage.removeItem("clickedActivity"),listView()}function progressBar(){var e=document.createElement("div");e.className="mdc-linear-progress mdc-linear-progress--indeterminate progress--update",e.role="progressbar";var t=document.createElement("div");t.className="mdc-linear-progress__buffering-dots";var n=document.createElement("div");n.className="mdc-linear-progress__buffer";var a=document.createElement("div");a.className="mdc-linear-progress__bar mdc-linear-progress__primary-bar";var o=document.createElement("span");o.className="mdc-linear-progress__bar-inner",a.appendChild(o);var c=document.createElement("div");c.className="mdc-linear-progress__bar mdc-linear-progress__secondary-bar";var i=document.createElement("span");return i.className="mdc-linear-progress__bar-inner",c.appendChild(i),e.appendChild(t),e.appendChild(n),e.appendChild(a),e.appendChild(c),e}function snacks(e,t){var n=document.createElement("div");n.className="mdc-snackbar",n.setAttribute("aria-live","assertive"),n.setAttribute("aria-atomic","true"),n.setAttribute("aria-hidden","true"),n.style.zIndex=99999;var a=document.createElement("div");a.className="mdc-snackbar__text mdc-typography--subtitle2";var o=document.createElement("div");o.className="mdc-snackbar__action-wrapper";var c=document.createElement("button");c.className="mdc-snackbar__action-button",o.appendChild(c),n.appendChild(a),n.appendChild(o),document.getElementById("snackbar-container").innerHTML=n.outerHTML;var i={message:e,actionText:"OK",timeout:5e3,actionHandler:function(){}};mdc.snackbar.MDCSnackbar.attachTo(document.querySelector(".mdc-snackbar")).show(i)}function fetchCurrentTime(e){return Date.now()+e}function geolocationApi(o){return new Promise(function(t,n){var a=new XMLHttpRequest;a.open("POST","https://www.googleapis.com/geolocation/v1/geolocate?key="+appKey.getMapKey(),!0),a.setRequestHeader("Content-Type","application/json"),a.onreadystatechange=function(){if(4===a.readyState){if(400<=a.status)return n({message:a.response,body:o});var e=JSON.parse(a.response);if(!e)return n({message:"Response From geolocation Api "+e,body:o});t({latitude:e.location.lat,longitude:e.location.lng,accuracy:e.accuracy,provider:{body:o}})}},a.onerror=function(){n({message:a})},a.send(o)})}function handleRequestBody(e){var t=JSON.parse(e);return t.wifiAccessPoints&&t.wifiAccessPoints.length?(t.cellTowers&&delete t.cellTowers,JSON.stringify(t)):null}function manageLocation(){return new Promise(function(t,n){getLocation().then(function(e){updateLocationInRoot(e),t(e)}).catch(function(e){n(e)})})}function getLocation(){return new Promise(function(n,a){var o={};"Android"!==native.getName()?html5Geolocation().then(function(e){n(e)}).catch(function(e){a(e)}):html5Geolocation().then(function(e){if(e.accuracy<=350)return n(e);o.html5={body:"",result:e},handleGeoLocationApi(o,e).then(function(e){n(e)})}).catch(function(t){handleGeoLocationApi(o).then(function(e){n(e)}).catch(function(e){a({message:"Both HTML and Geolocation failed to fetch location.",body:JSON.stringify({html5:t,geolocation:JSON.stringify(e)}),locationError:!0})})})})}function handleGeoLocationApi(c,i){return new Promise(function(a,t){var e=void 0,o=[];try{e=AndroidInterface.getCellularData()}catch(e){return i?void a(i):(sendExceptionObject(e,"CATCH Type 4 : AndroidInterface.getCellularData at handleGeolocationApi",[]),void t("CATCH Type 4 : AndroidInterface.getCellularData at handleGeolocationApi"))}if(""===e){if(i)return void a(i);t("empty string from AndroidInterface.getCellularData")}if(!Object.keys(JSON.parse(e)).length)return i?a(i):t("Empty Object returned from getCellularData method");geolocationApi(e).then(function(t){if(t.accuracy<=350)return a(t);c.orignialGeolocationResponse={body:e,result:t};var n=handleRequestBody(e);if(!n)return 1200<=t.accuracy&&handleError({message:"Oringinal CellTower has accuracy more than 1200 and WAP doesnt exist",body:JSON.stringify(c),locationError:!0}),i?t.accuracy<i.accuracy?void a(t):a(i):void a(t);geolocationApi(n).then(function(e){return e.accuracy<=350?a(e):(c.withoutCellTower={body:n,result:e},1200<=e.accuracy&&handleError({message:"html5,originalCellTower,WithoutCellTower",body:JSON.stringify(c),locationError:!0}),Object.keys(c).forEach(function(e){o.push(c[e].result)}),a(sortedByAccuracy(o)))}).catch(function(e){if(1200<=t.accuracy&&(c.withoutCellTower={body:n},handleError({message:"Orinigal CellTower has accuracy more than 1200 and api failure when sending cellTowerObject without cellularTowers",body:JSON.stringify(c),locationError:!0})),i){if(!(t.accuracy<i.accuracy))return a(i);a(t)}else a(t)})}).catch(function(e){i?a(i):t(e)})})}function iosLocationError(e){manageLocation().then(console.log).catch(console.log),handleError(e)}function html5Geolocation(){return new Promise(function(n,t){for(var e=[],a=0;a<2;a++){var o=new Promise(function(t,n){navigator.geolocation.getCurrentPosition(function(e){return t({latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy,provider:"HTML5"})},function(e){n({message:e})},{timeout:5e3,maximumAge:0,enableHighAccuracy:!0})});e.push(o)}Promise.all(e).then(function(e){var t=e.sort(function(e,t){return e.accuracy-t.accuracy});n(t[0])}).catch(function(e){t({message:e.message.message})})})}function updateLocationInRoot(a){var o={latitude:"",longitude:"",accuracy:"",provider:"",lastLocationTime:""},t=firebase.auth().currentUser.uid,c=indexedDB.open(t);c.onsuccess=function(){var e=c.result.transaction(["root"],"readwrite"),n=e.objectStore("root");n.get(t).onsuccess=function(e){var t=e.target.result;t.location&&(o=t.location),t.location=a,t.location.lastLocationTime=Date.now(),n.put(t)},e.oncomplete=function(){if(o.latitude&&o.longitude&&a.latitude&&a.longitude){var e=calculateDistanceBetweenTwoPoints(o,a),t=new CustomEvent("suggestCheckIn",{detail:isLocationMoreThanThreshold(e)||app.isNewDay()});if(window.dispatchEvent(t),"Ios"===native.getName()){var n=new CustomEvent("iosLocation",{detail:a});window.dispatchEvent(n)}}},e.onerror=function(){handleError({message:e.error.message+" from updateLocationInRoot",body:e.error.name})},c.onerror=function(){handleError({message:c.error.message+" from updateLocationInRoot",body:c.error.name}),window.dispatchEvent(suggestCheckIn)}}}function toRad(e){return e*Math.PI/180}function calculateDistanceBetweenTwoPoints(e,t){var n=toRad(t.latitude-e.latitude),a=toRad(t.longitude-e.longitude),o=toRad(t.latitude),c=toRad(e.latitude),i=Math.sin(n/2)*Math.sin(n/2)+Math.sin(a/2)*Math.sin(a/2)*Math.cos(o)*Math.cos(c);return 6371*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))}function isLocationMoreThanThreshold(e){return 1<=e}function isLocationLessThanThreshold(e){return e<=1}function sortedByAccuracy(e){return e.sort(function(e,t){return e.accuracy-t.accuracy})[0]}function createAndroidDialog(t,n){try{AndroidInterface.showDialog(t,n)}catch(e){sendExceptionObject(e,"CATCH Type 1:AndroidInterface.showDialog at createAndroidDialog ",[t,n]);var a=document.createElement("span");a.className="mdc-typography--body1",a.textContent=n,document.getElementById("dialog-container").innerHTML=dialog({id:"alert-dialog",showCancel:!1,showAccept:!0,content:a,headerText:t}).outerHTML;var o=document.querySelector("#alert-dialog"),c=new mdc.dialog.MDCDialog(o);c.listen("MDCDialog:accept",function(){o.remove(),listView()}),c.show()}}function isLocationStatusWorking(){if("Android"!==native.getName())return!0;try{if(!AndroidInterface.isLocationPermissionGranted())return void createAndroidDialog("Location Permission","Please Allow Growthfile location access.")}catch(e){return sendExceptionObject(e,"CATCH Type 6: AndroidInterface.isLocationPermissionGranted at locationPermission",[]),!0}try{if(!AndroidInterface.isConnectionActive())return void createAndroidDialog("No Connectivity","Please Check your Internet Connectivity")}catch(e){return sendExceptionObject(e,"CATCH Type 7: AndroidInterface.isConnectionActive  at isLocationStatusWorking",[]),!0}return!0}function requestCreator(e,c){var t=firebase.auth().currentUser;if(t){var i={type:e,body:"",meta:{user:{token:"",uid:t.uid,displayName:t.displayName,photoURL:t.photoURL,phoneNumber:t.phoneNumber},apiUrl:appKey.getBaseUrl()}};"instant"===e||"now"===e||"Null"===e||"backblaze"===e?t.getIdToken(!1).then(function(e){i.body=c,i.meta.user.token=e,apiHandler.postMessage(i)}).catch(function(e){handleError({message:e.code})}):getRootRecord().then(function(a){var o=a.location,e=isLastLocationOlderThanThreshold(o.lastLocationTime,5),n=[t.getIdToken(!1)];e&&("Android"===native.getName()?n.push(manageLocation()):window.addEventListener("iosLocation",function e(t){n.push(t.detail),window.removeEventListener("iosLocation",e,!0)},!0)),Promise.all(n).then(function(e){var t=e[0];2==e.length&&(o=e[1],console.log(o));var n={latitude:o.latitude,longitude:o.longitude,accuracy:o.accuracy,provider:o.provider};c.timestamp=fetchCurrentTime(a.serverTime),c.geopoint=n,i.body=c,i.meta.user.token=t,sendRequest(o,i)}).catch(function(e){handleError(e)})}),apiHandler.onmessage=messageReceiver,apiHandler.onerror=onErrorMessage}}function sendRequest(e,t){if(e.latitude&&e.longitude&&e.accuracy)apiHandler.postMessage(t);else{var n=document.createElement("span");n.className="mdc-typography--body1",n.textContent="There was a Problem in detecting your location. Please Try again later",document.getElementById("dialog-container").innerHTML=dialog({id:"location-fetch-dialog",content:n}).outerHTML;var a=document.getElementById("location-fetch-dialog");new mdc.dialog.MDCDialog(a).show(),getRootRecord().then(function(e){var t=void 0;try{t=AndroidInterface.getCellularData()}catch(e){t=e.message,sendExceptionObject(e,"CATCH Type 4: AndroidInterface.getCullarData at sendRequest",[])}var n={deviceInfo:native.getInfo(),storedLocation:e.location,cellTower:t};handleError({message:"No Locations Found in indexedDB",body:JSON.stringify(n)}),setTimeout(function(){a.remove(),listView()},5e3)})}}function isLastLocationOlderThanThreshold(e,t){var n=moment(moment().valueOf()),a=e;return t<moment.duration(n.diff(a)).asSeconds()}var receiverCaller={initFirstLoad:initFirstLoad,"update-app":updateApp,"removed-from-office":officeRemovalSuccess,"revoke-session":revokeSession,notification:successDialog,"android-stop-refreshing":androidStopRefreshing,apiFail:apiFail};function messageReceiver(e){receiverCaller[e.data.type](e.data)}function emailVerify(e){if(firebase.auth().currentUser.email)return emailUpdateSuccess();var t=document.createElement("h1");t.className="mdc-typography--body1",t.textContent=e.body,document.getElementById("dialog-container").innerHTML=dialog({id:"email-update-dialog",showCancel:!0,showAccept:!0,headerText:e.title,content:t}).outerHTML;var n=document.getElementById("email-update-dialog"),a=new mdc.dialog.MDCDialog(n);a.listen("MDCDialog:accept",function(){n.remove(),profileView(!0)}),a.listen("MDCDialog:cancel",function(){n.remove()}),a.show()}function radioList(e){var t=document.createElement("li");t.className="mdc-list-item mdc-ripple-surface--secondary",t.setAttribute("role","radio");var n=document.createElement("span");n.className="mdc-list-item__graphic";var a=document.createElement("div");a.className="mdc-radio";var o=document.createElement("input");o.className="mdc-radio__native-control",o.setAttribute("type","radio"),o.setAttribute("id",e.id),o.setAttribute("name","list-radio-item-group"),o.setAttribute("value",e.value),e.selected?(t.setAttribute("aria-checked","true"),t.classList.add("mdc-list-item--selected"),o.setAttribute("checked","true")):t.setAttribute("aria-checked","false");var c=document.createElement("div");c.className="mdc-radio__background";var i=document.createElement("div");i.className="mdc-radio__outer-circle";var r=document.createElement("div");r.className="mdc-radio__inner-circle",c.appendChild(i),c.appendChild(r),a.appendChild(o),a.appendChild(c),n.appendChild(a);var d=document.createElement("label");return d.textContent=e.labelText.charAt(0).toUpperCase()+e.labelText.slice(1),d.style.padding="8px 0px 8px 0px",d.style.width="-webkit-fill-available",d.style.display="contents",d.className="mdc-list-item__text",d.setAttribute("for",e.id),t.appendChild(n),t.appendChild(d),t}function createBlankPayrollDialog(n){var e=document.createElement("div");e.style.marginTop="10px",e.className="notification-message",e.textContent=n.body;var a=document.createElement("ul");a.className="mdc-list",a.id="payroll-notification-list",a.setAttribute("role","radiogroup"),e.appendChild(a),n.data.forEach(function(e){var t=!1;"leave"===e.template&&(t=!0),a.appendChild(radioList({labelText:e.template,id:convertKeyToId(e.template),value:e.template,selected:t}))}),document.getElementById("dialog-container").innerHTML=dialog({id:"blank-payroll-dialog",showAccept:!0,showCancel:!0,headerText:n.title,content:e}).outerHTML;var t=document.getElementById("blank-payroll-dialog"),o=new mdc.dialog.MDCDialog(t);new mdc.list.MDCList(document.querySelector("#payroll-notification-list.mdc-list")).singleSelection=!0;var c=[].map.call(document.querySelectorAll("#payroll-notification-list .mdc-radio"),function(e){return new mdc.radio.MDCRadio(e)});o.listen("MDCDialog:accept",function(e){c.forEach(function(t){t.checked&&n.data.forEach(function(e){e.template!==t.value||createTempRecord(e.office,t.value,{schedule:e.schedule,attachment:e.attachment})})}),t.remove()}),o.listen("MDCDialog:cancel",function(e){t.remove()}),o.show()}function initFirstLoad(t){"listView"===history.state[0]&&(t.msg.hasOwnProperty("activity")&&t.msg.activity.length&&getRootRecord().then(function(e){updateEl(t.msg.activity,e)}),t.msg.hasOwnProperty("template")&&createActivityIcon())}function updateApp(t){if("Android"!==native.getName())webkit.messageHandlers.updateApp.postMessage("Update App");else{try{AndroidInterface.updateApp(t.msg)}catch(e){var n=JSON.parse(t.msg).message,a=document.createElement("span");a.className="mdc-typography--body1",a.textContent="Please Install the Latest version from google play store , to Use Growthfile. After Updating the App, close Growthfile and open again ",document.getElementById("dialog-container").innerHTML=dialog({id:"app-update-dialog",showCancel:!1,showAccept:!0,headerText:n,content:a}).outerHTML;var o=document.getElementById("app-update-dialog"),c=new mdc.dialog.MDCDialog(o);c.show(),c.listen("MDCDialog:accept",function(){7===JSON.parse(native.getInfo()).appVersion?(setTimeout(function(){c.show()},500),listView(),requestCreator("now",{device:native.getInfo(),from:"",registerToken:native.getFCMToken()})):(o.remove(),listView())})}sendExceptionObject(e,"CATCH Type 8: AndroidInterface.updateApp at updateApp",[JSON.stringify(t.msg)])}}function revokeSession(){firebase.auth().signOut().then(function(){}).catch(function(e){handleError({message:"Sign out error",body:e})})}function apiFail(e){document.getElementById("send-activity")&&(document.getElementById("send-activity").style.display="block"),document.querySelector("header .mdc-linear-progress")&&document.querySelector("header .mdc-linear-progress").remove(),document.querySelector(".loader")&&document.querySelector(".loader").remove(),document.querySelector(".delete-activity")&&(document.querySelector(".delete-activity").style.display="block"),document.querySelector(".undo-delete-loader")&&(document.querySelector(".undo-delete-loader").style.display="block"),document.querySelector(".form-field-status")&&document.querySelector(".form-field-status").classList.contains("hidden")&&document.querySelector(".form-field-status").classList.remove("hidden"),snacks(e.msg.message)}function officeRemovalSuccess(e){var t=document.createElement("span");t.className="mdc-typography--body1",t.textContent="You have been removed from "+e.msg.join(" & "),document.getElementById("dialog-container").innerHTML=dialog({id:"office-removal-dialog",showAccept:!0,showCancel:!1,headerText:"Reminder",content:t}).outerHTML;var n=document.getElementById("office-removal-dialog"),a=new mdc.dialog.MDCDialog(n);a.listen("MDCDialog:accept",function(){n.remove(),document.getElementById("app-current-panel").innerHTML="",listView()}),a.show()}function androidStopRefreshing(){if("Android"===native.getName()){var e=JSON.parse(native.getInfo());if(console.log(e),!(8<=e.appVersion))try{AndroidInterface.stopRefreshing(!0)}catch(e){sendExceptionObject(e,"CATCH Type 9:AndroidInterface.stopRefreshing at androidStopRefreshing",[!0])}}}function onErrorMessage(e){var t={"line-number":e.lineno,file:e.filename,"col-number":e.colno};handleError({message:e.message+" from apiHandler.js at line-number "+e.lineno+" and columne-number "+e.colno,body:t})}function getInputText(e){return mdc.textField.MDCTextField.attachTo(document.querySelector(e))}function runRead(c){if(localStorage.getItem("dbexist")){if(!c)return requestCreator("Null",c);Object.keys(c).forEach(function(t){if("verifyEmail"!==t)"read"!==t?"payroll"!==t||getRootRecord().then(function(e){e.offices&&(Array.isArray(e.offices)||e.offices.length&&createBlankPayrollDialog(JSON.parse(c[t])))}):requestCreator("Null",c);else{var e=JSON.parse(c[t]);if(e.title&&e.body)return void emailVerify(e);var n={title:"Reminder",body:""},a={},o={};getRecipient().then(function(e){e.length?(e.forEach(function(e){a[e.office]=!0,o[e.attachment.Name.value]=!0}),n.body="You have been added a Recipient for "+Object.keys(a).join("&")+" . Without Adding Email Address, you will not recieve "+Object.keys(o).join(" , ")+" Reports. Click Okay to set your email address"):n.body="You have not set your email Address. Click Okay to set your email address",emailVerify(n)})}})}}function removeChildNodes(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function jniException(e,t){handleError({message:e,body:t,androidException:!0})}function sendExceptionObject(e,t,n){handleError({message:""+t,body:JSON.stringify({message:e.message,name:e.name,stack:JSON.stringify(e.stack),paramSent:n})})}