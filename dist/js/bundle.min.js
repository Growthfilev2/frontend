function createElement(e,t){var n=document.createElement(e);return Object.keys(t).forEach(function(e){n[e]=t[e]}),n}function InputField(){}function textAreaField(e){var t=createElement("textarea",{className:"text-area-basic mdc-text-field__input",rows:e.rows});return t.value=e.value,e.readonly||t.setAttribute("readonly","true"),t}function selectMenu(e){var t=createElement("div",{className:"mdc-select data--value-list"});t.id=e.id;for(var n=createElement("select",{className:"mdc-select__native-control"}),a=0;a<e.data.length;a++)n.appendChild(createElement("option",{textContent:e.data[a],vale:e.data[a],selected:e.data[a]===e.selected}));var o=createElement("label",{className:"mdc-floating-label"});o.textContent="",t.appendChild(o),t.appendChild(n);var i=new InputField;return t.appendChild(i.ripple()),new mdc.select.MDCSelect(t)}function notchedOultine(){var e=createElement("div",{className:"mdc-notched-outline"}),t=createElement("div",{className:"mdc-notched-outline__leading"}),n=createElement("div",{className:"mdc-notched-outline__trailing"});return e.appendChild(t),e.appendChild(n),e}function Button(e){this.name=e;var t=createElement("button",{className:"mdc-button"});t.appendChild(createElement("span",{className:"mdc-button__label",textContent:this.name})),this.base=t}function Fab(e){this.fabName=e;var t=createElement("button",{className:"mdc-fab"});this.span=createElement("span",{className:"mdc-fab__icon material-icons",textContent:this.fabName}),t.appendChild(this.span),this.base=t}function AppendMap(e){this.el=e,this.options={zoom:16,disableDefaultUI:!0},this.location=""}function radioList(e){var t=document.createElement("li");t.className="mdc-list-item mdc-ripple-surface--secondary",t.setAttribute("role","radio"),t.setAttribute("tabindex","-1");var n=createElement("span",{className:"mdc-list-item__text"}),a=createElement("span",{className:"mdc-list-item__primary-text",textContent:e.labelText.charAt(0).toUpperCase()+e.labelText.slice(1)});return n.appendChild(a),t.appendChild(n),t.appendChild(createRadioInput(JSON.stringify(e.value))),t}function createRadioInput(e){var t=createElement("div",{className:"mdc-radio radio-control-selector mdc-list-item__meta"}),n=createElement("input",{className:"mdc-radio__native-control"});n.setAttribute("tabindex","-1"),n.checked,n.setAttribute("name","listDemoRadioGroup"),n.setAttribute("tabindex","-1"),n.type="radio",n.value=e,n.setAttribute("aria-labelledby","grp1");var a=createElement("div",{className:"mdc-radio__background"}),o=createElement("div",{className:"mdc-radio__outer-circle"}),i=createElement("div",{className:"mdc-radio__inner-circle"});return a.appendChild(o),a.appendChild(i),t.appendChild(n),t.appendChild(a),t}function createCheckBox(e){console.log(e);var t=createElement("div",{className:"mdc-checkbox mdc-list-item__meta"}),n=createElement("input",{className:"mdc-checkbox__native-control",type:"checkbox",value:JSON.stringify(e.value)});n.setAttribute("tabindex","-1");var a=createElement("div",{className:"mdc-checkbox__background"});return a.innerHTML='<svg class="mdc-checkbox__checkmark"\n      viewBox="0 0 24 24">\n      <path class="mdc-checkbox__checkmark-path"\n      fill="none"\n      d="M1.73,12.91 8.1,19.28 22.79,4.59"/>\n      </svg>\n      <div class="mdc-checkbox__mixedmark"></div>',t.appendChild(n),t.appendChild(a),new mdc.checkbox.MDCCheckbox(t)}function chipSet(e,t){var n=createElement("div",{className:"mdc-chip-set"}),a=createElement("div",{className:"mdc-chip mdc-chip--selected"}),o=createElement("div",{className:"mdc-chip__text chip-text",textContent:e});if(a.appendChild(o),t){var i=createElement("i",{className:"material-icons mdc-chip__icon mdc-chip__icon--trailing",textContent:"cancel"});i.setAttribute("tabindex","0"),i.setAttribute("role","button"),a.appendChild(i)}return n.appendChild(a),n}function AppKeys(){this.mode="dev"}InputField.prototype.base=function(){return createElement("div",{className:"mdc-text-field filled-background data--value-list mdc-text-field--fullwidth"})},InputField.prototype.input=function(){return createElement("input",{className:"mdc-text-field__input"})},InputField.prototype.ripple=function(){return createElement("div",{className:"mdc-line-ripple"})},InputField.prototype.label=function(e){return createElement("label",{className:"mdc-floating-label",textContent:e})},InputField.prototype.withoutLabel=function(){var e=this.base(),t=this.input();return e.appendChild(t),e.appendChild(this.ripple()),new mdc.textField.MDCTextField(e)},InputField.prototype.withLabel=function(e){var t=this.base(),n=this.input();return t.appendChild(n),t.appendChild(this.label(e)),t.appendChild(this.ripple()),new mdc.textField.MDCTextField(t)},InputField.prototype.withLeadingIcon=function(e,t){var n=this.base();n.classList.remove("data--value-list","mdc-text-field--fullwidth"),n.classList.add("mdc-text-field--with-leading-icon");var a=createElement("i",{className:"material-icons mdc-text-field__icon",textContent:e});return n.appendChild(a),n.appendChild(this.input()),n.appendChild(this.label(t)),n.appendChild(this.ripple()),new mdc.textField.MDCTextField(n)},Button.prototype.getButton=function(){return new mdc.ripple.MDCRipple(this.base)},Button.prototype.disabled=function(e){this.base.disabled=e},Button.prototype.raised=function(){this.base.classList.add("mdc-button--raised")},Button.prototype.shaped=function(){this.base.classList.add("shaped")},Button.prototype.selectorButton=function(){this.base.classList.add("selector-send","selector-submit--button")},Fab.prototype=Object.create(new Button),Fab.prototype.extended=function(e){this.base.classList.add("mdc-fab--extended");var t=createElement("label",{className:"mdc-fab__label",textContent:e});return this.base.appendChild(t),this.getButton()},AppendMap.prototype.setLocation=function(e){this.options.center=e,this.location=e},AppendMap.prototype.setZoom=function(e){this.options.zoom=e},AppendMap.prototype.map=function(){return new google.maps.Map(this.el,this.options)},AppendMap.prototype.withCustomControl=function(){var e=document.createElement("div");new MapsCustomControl(e,map,this.location.lat,this.location.lng);e.index=1,map.controls[google.maps.ControlPosition.TOP_LEFT].push(e)},AppendMap.prototype.getMarker=function(t){var n={position:this.location,map:this.map()};return t&&Object.keys(t).forEach(function(e){n[e]=t[e]}),this.el.style.height="400px",new google.maps.Marker(n)},AppendMap.prototype.geocodeCustomerMarker=function(n){return new Promise(function(e,t){google.maps.event.addListener(n,"dragend",function(){geocodePosition(n.getPosition(),data).then(function(e){e.customerRecord?addressField.value=e.customerRecord.venue[0].address:addressField.value=e.venue[0].address}).catch(function(e){handleError({message:"geocode Error in autocomplete listener for"+data.template,body:JSON.stringify(e)}),locationErrorText.textContent="Failed to detect your current Location. Search For A new Location or choose existing"})})})},AppKeys.prototype.getMode=function(){return this.mode},AppKeys.prototype.getMapKey=function(){return"production"===this.mode?"AIzaSyA4s7gp7SFid_by1vLVZDmcKbkEcsStBAo":"AIzaSyCadBqkHUJwdcgKT11rp_XWkbQLFAy80JQ"},AppKeys.prototype.getKeys=function(){return"production"===this.mode?{apiKey:this.getMapKey(),authDomain:"growthfile-207204.firebaseapp.com",databaseURL:"https://growthfile-207204.firebaseio.com",projectId:"growthfile-207204",storageBucket:"growthfile-207204.appspot.com",messagingSenderId:"701025551237"}:{apiKey:this.getMapKey(),authDomain:"growthfilev2-0.firebaseapp.com",projectId:"growthfilev2-0",messagingSenderId:"1011478688238"}},AppKeys.prototype.getBaseUrl=function(){return"production"===this.mode?"https://api2.growthfile.com/api/":"https://us-central1-growthfilev2-0.cloudfunctions.net/api/"};var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function conversation(e,t){document.body.classList.remove("mdc-dialog-scroll-lock"),window.removeEventListener("scroll",handleScroll,!1),checkIfRecordExists("activity",e).then(function(e){e?(t&&history.pushState(["conversation",e],null,null),fetchAddendumForComment(e)):(resetScroll(),listView())}).catch(handleError)}function checkIfRecordExists(o,i){return new Promise(function(n,e){var t=firebase.auth().currentUser,a=window.indexedDB.open(t.uid);a.onsuccess=function(){a.result.transaction(o).objectStore(o).get(i).onsuccess=function(e){var t=e.target.result;n(!!t&&i)}},a.onerror=function(){e({message:a.error.message+" from checkIfRecordExists"})}})}function fetchAddendumForComment(a){if(a){var o=firebase.auth().currentUser,i=window.indexedDB.open(o.uid);i.onsuccess=function(){var n=i.result,e=n.transaction(["addendum"],"readonly"),t=e.objectStore("addendum").index("activityId");createHeaderContent(n,a),commentPanel(a),statusChange(n,a),reinitCount(n,a),t.openCursor(a).onsuccess=function(e){var t=e.target.result;t&&(document.getElementById(t.value.addendumId)||createComment(n,t.value,o).then(function(e){document.getElementById("chat-container")&&document.getElementById("chat-container").appendChild(e)}),t.continue())},e.oncomplete=function(){document.querySelector(".activity--chat-card-container")&&(document.querySelector(".activity--chat-card-container").scrollTop=document.querySelector(".activity--chat-card-container").scrollHeight)}}}}function commentPanel(t){if(!document.querySelector(".activity--chat-card-container")){var e=document.createElement("div");e.className="activity--chat-card-container  mdc-top-app-bar--fixed-adjust panel-card";var n=document.createElement("div");n.id="chat-container",n.className="mdc-card reverser-parent";var a=document.createElement("div");a.className="user-comment--container";var o=document.createElement("div");o.className="status--change-cont";var i=document.createElement("div");i.className="comment--container";var r=document.createElement("div");r.className="input--text-padding mdc-text-field mdc-text-field--dense",r.id="write--comment",r.style.width="100%";var c=document.createElement("input");c.className="mdc-text-field__input comment-field mdc-elevation--z4",c.type="text",r.appendChild(c),i.appendChild(r);var d=document.createElement("button");d.classList.add("mdc-fab","mdc-fab--mini","hidden"),d.id="send-chat--input";var s=document.createElement("span");s.classList.add("mdc-fac__icon","material-icons"),s.textContent="send",d.appendChild(s),i.appendChild(d),e.appendChild(n),a.appendChild(i),document.getElementById("app-current-panel").innerHTML=e.outerHTML+o.outerHTML+a.outerHTML,document.querySelector(".comment-field").oninput=function(e){e.target.value&&e.target.value.replace(/\s/g,"").length?toggleCommentButton(!0):toggleCommentButton(!1)},document.getElementById("send-chat--input").onclick=function(){if(isLocationStatusWorking()){var e=document.querySelector(".comment-field").value;requestCreator("comment",{activityId:t,comment:e}),document.querySelector(".comment-field").value="",toggleCommentButton(!1)}}}}function toggleCommentButton(e){var t=document.getElementById("send-chat--input"),n=document.getElementById("write--comment"),a=document.querySelector(".status--change-cont");a.style.opacity=e?(t.classList.remove("hidden"),n.style.width="80%","0"):(t.classList.add("hidden"),n.style.width="100%",n.style.transition="0.3s ease",a.style.transition="0.3s ease","1")}function statusChange(e,t){var s=document.createElement("label");s.setAttribute("for","toggle-status"),s.textContent="Done",e.transaction("activity").objectStore("activity").get(t).onsuccess=function(e){var t=document.querySelector(".status--change-cont"),n=e.target.result;if(!n.canEdit||"CANCELLED"===n.status){var a=document.createElement("span"),o=e.target.result;return a.textContent="Activity "+o.status.toLowerCase(),void(t&&(t.innerHTML=a.outerHTML,t.style.textAlign="center"))}if(0!=n.editable){if(!document.querySelector(".status-check")){var i=document.createElement("div");i.className="mdc-form-field form-field-status";var r=document.createElement("div");r.className="mdc-checkbox status-check";var c=document.createElement("input");c.className="mdc-checkbox__native-control",c.id="toggle-status",c.type="checkbox";var d=document.createElement("div");d.className="mdc-checkbox__background";document.createElement("div").className="mdc-checkbox__mixedmark",d.innerHTML='<svg class="mdc-checkbox__checkmark"\n      viewBox="0 0 24 24">\n      <path class="mdc-checkbox__checkmark-path"\n      fill="none"\n      d="M1.73,12.91 8.1,19.28 22.79,4.59"/>\n      </svg>\n      <div class="mdc-checkbox__mixedmark"></div>',r.appendChild(c),r.appendChild(d),i.appendChild(r),t&&(t.innerHTML=i.outerHTML+s.outerHTML)}document.querySelector(".mdc-checkbox")&&(switchControl=new mdc.checkbox.MDCCheckbox.attachTo(document.querySelector(".mdc-checkbox")),"CONFIRMED"===n.status&&(switchControl.checked=!0),document.querySelector(".mdc-checkbox").onclick=function(){isLocationStatusWorking()?changeStatusRequest(switchControl,n):resetStatusConfirmation(switchControl,n)})}else t&&(t.innerHTML=s.outerHTML+loader("status-loader").outerHTML)}}function resetStatusConfirmation(e,t){"CONFIRMED"===t.status?e.checked=!0:e.checked=!1}function changeStatusRequest(e,t){document.querySelector(".form-field-status").classList.add("hidden"),document.querySelector(".status--change-cont").appendChild(loader("status-loader")),e.checked?requestCreator("statusChange",{activityId:t.activityId,status:"CONFIRMED"}):requestCreator("statusChange",{activityId:t.activityId,status:"PENDING"})}function createComment(e,u,t){var m=!1;return new Promise(function(c){var d=document.createElement("div");d.classList.add("comment-box","talk-bubble","tri-right","round","btm-left"),t.phoneNumber===u.user?d.classList.add("current-user--comment","secondary-color-light"):d.classList.add("other-user--comment","mdc-theme--primary-bg"),d.id=u.addendumId;var s=document.createElement("div");s.classList.add("talktext");var l=document.createElement("p");l.classList.add("user-name--comment","mdc-typography--subtitle2"),getUserRecord(e,u.user).then(function(e){e.displayName?l.textContent=e.displayName:l.textContent=e.mobile;var t=document.createElement("p");t.classList.add("comment","mdc-typography--subtitle2"),t.textContent=u.comment;var n=document.createElement("span");n.className="comment--info";var a=document.createElement("span");a.textContent=moment(u.timestamp).format("DD-MM-YY H:mm"),a.classList.add("comment-date","mdc-typography--caption");var o=document.createElement("div"),i=document.createElement("i");i.classList.add("user-map--span","material-icons"),i.appendChild(document.createTextNode("location_on")),i.dataset.latitude=u.location._latitude,i.dataset.longitude=u.location._longitude,o.appendChild(i);var r=document.createElement("div");r.className="map-convo",o.onclick=function(e){if(hasMapsApiLoaded()){m=!m;var t={lat:u.location._latitude,lng:u.location._longitude},n=new AppendMap(r);n.setLocation(t),n.setZoom(18),n.getMarker(),i.textContent=m?(r.style.height="200px","arrow_drop_down"):(r.style.height="0px","location_on")}},n.appendChild(a),n.appendChild(o),s.appendChild(l),s.appendChild(t),s.appendChild(n),d.appendChild(s),d.appendChild(r),c(d)})})}function getUserRecord(o,i){return new Promise(function(n,e){var t=o.transaction("users").objectStore("users"),a=void 0;a="string"==typeof i?i:i.phoneNumber,t.get(a).onsuccess=function(e){var t=e.target.result;return n(t||{displayName:"",mobile:a,photoURL:""})}})}function hasMapsApiLoaded(){return"object"===("undefined"==typeof google?"undefined":_typeof(google))&&"object"===_typeof(google.maps)}function MapsCustomControl(e,t,n,a){var o=document.createElement("div");o.style.backgroundColor="#fff",o.style.border="2px solid #fff",o.style.borderRadius="3px",o.style.boxShadow="0 2px 6px rgba(0,0,0,.3)",o.style.cursor="pointer",o.style.marginBottom="22px",o.style.textAlign="center",o.style.padding="0px 5px 0px 5px",e.appendChild(o);var i=document.createElement("a");i.href="https://www.google.com/maps?q="+n+","+a,i.className="material-icons",i.style.color="rgb(25,25,25)",i.style.fontSize="16px",i.style.lineHeight="38px",i.style.paddingLeft="5px",i.style.paddingRight="5px",i.style.textDecoration="none",i.innerHTML="open_in_new",o.appendChild(i)}function createHeaderContent(t,e){var c=document.getElementById("section-start");c.innerHTML="";var n=t.transaction("activity").objectStore("activity"),d=headerBackIcon();n.get(e).onsuccess=function(e){var r=e.target.result;getUserRecord(t,r.creator).then(function(e){var t=document.createElement("object");t.data=e.photoURL||"./img/empty-user.jpg",t.className="header--icon-creator",t.type="image/jpeg";var n=document.createElement("img");n.src="./img/empty-user.jpg",n.className="header--icon-creator",t.appendChild(n);var a=document.createElement("div");a.className="mdc-top-app-bar__title mdc-typography--subtitle2";var o=document.createElement("span");o.textContent=r.activityName,o.className="",a.onclick=function(){checkIfRecordExists("activity",r.activityId).then(function(e){e?updateCreateActivity(r):(resetScroll(),listView())}).catch(handleError)};var i=document.createElement("span");i.textContent="Click here to see details",c.appendChild(d),c.appendChild(t),a.appendChild(o),a.appendChild(document.createElement("br")),a.appendChild(i),c.appendChild(a)})}}function reinitCount(e,t){var n=e.transaction(["list"],"readwrite"),a=n.objectStore("list");a.get(t).onsuccess=function(e){var t=e.target.result;t&&(t.count=0,a.put(t))},n.oncomplete=function(){}}function noSelectorResult(e){var t=document.createElement("div");t.className="data-not-found";var n=document.createElement("p");return n.className="mdc-typography--headline5",n.textContent=e,t.appendChild(n),t}function checkMapStoreForNearByLocation(c,d){return new Promise(function(o,i){var r=indexedDB.open(firebase.auth().currentUser.uid);r.onsuccess=function(){var a=[],e=r.result.transaction(["map"]),t=e.objectStore("map").index("byOffice"),n=IDBKeyRange.bound([c,""],[c,"￿"]);t.openCursor(n).onsuccess=function(e){var t=e.target.result;t&&(t.value.location&&t.value.latitude&&t.value.longitude&&isLocationLessThanThreshold(calculateDistanceBetweenTwoPoints(t.value,d))&&a.push(t.value),t.continue())},e.oncomplete=function(){var t={};a.forEach(function(e){t[e.location]=e});var n=[];Object.keys(t).forEach(function(e){n.push(t[e])});var e=n.sort(function(e,t){return e.accuracy-t.accuracy});o(e)},e.onerror=function(){i(e.error)}}})}function createTempRecord(n,o,i){var e=firebase.auth().currentUser.uid,a=indexedDB.open(e);a.onsuccess=function(){var e=a.result.transaction(["subscriptions"]).objectStore("subscriptions").index("officeTemplate"),t=IDBKeyRange.only([n,o]);e.get(t).onsuccess=function(e){var r=e.target.result;if(r){var n=void 0;i.schedule?n=i.schedule:(n=[],r.schedule.forEach(function(e){var t={};t.name=e,t.startTime="",t.endTime="",n.push(t)})),i.attachment&&Object.keys(i.attachment).forEach(function(e){r.attachment[e]=i.attachment[e]});var c={office:r.office,template:r.template,venue:"",schedule:n,attachment:r.attachment,timestamp:Date.now(),canEdit:!0,assignees:[],activityName:r.template.toUpperCase(),create:!0},a=[];"check-in"!==o?(r.venue.forEach(function(e){var t={};t.venueDescriptor=e,t.location="",t.address="",t.geopoint={_latitude:"",_longitude:""},a.push(t)}),c.venue=a,"tour plan"!==o&&"dsr"!==o&&"duty roster"!==o&&"customer"!==o?updateCreateActivity(c):getLocation().then(function(e){geocodePosition({lat:e.latitude,lng:e.longitude}).then(function(e){return createBlendedCustomerRecord(c,e)})}).catch(function(e){return console.log(e),createBlendedCustomerRecord(c)})):getRootRecord().then(function(e){var t={};t.venueDescriptor=r.venue[0],t.location="",t.address="",t.geopoint={_latitude:"",_longitude:""},c.venue=[t];var n=isLastLocationOlderThanThreshold(e.location.lastLocationTime,5);if(e.location&&!n)return updateCreateActivity(c);var a=void 0;a="Android"===native.getName()?"Make Sure you have set Location Mode to High Accuracy":"Please wait.";var o=document.createElement("span");o.className="mdc-typography--body1",o.textContent=a,document.getElementById("dialog-container").innerHTML=dialog({id:"location-fetch-dialog",content:o,headerText:"Fetching Location"}).outerHTML;var i=document.getElementById("location-fetch-dialog");new mdc.dialog.MDCDialog(i).show(),"Ios"!==native.getName()?manageLocation().then(function(e){i.remove(),updateCreateActivity(c)}).catch(function(e){var t="There was a problem in detecting your location";"Android"===native.getName()&&(t+=". Make sure you have set Location Mode to high accuracy"),i.querySelector(".mdc-dialog__header__title").textContent="Failed To Get Current Location",i.querySelector("section span").textContent=t,setTimeout(function(){i.remove()},3e3),resetScroll(),listView(),handleError(e)}):window.addEventListener("iosLocation",function e(t){i.remove(),updateCreateActivity(c),window.removeEventListener("iosLocation",e,!0)},!0)})}}}}function createBlendedCustomerRecord(t,n){if("customer"===t.template){var e=[createVenueObjectWithGeoCode(t.venue[0].venueDescriptor,n)];return t.venue=e,updateCreateActivity(t)}getSubscription(t.office,"customer").then(function(e){if(!e)return updateCreateActivity(t);e.venue=[createVenueObjectWithGeoCode(e.venue[0],n)],t.customerRecord=e,updateCreateActivity(t)})}function hasAnyValueInChildren(o,i,r){var e=firebase.auth().currentUser.uid,c=indexedDB.open(e),d=[];return new Promise(function(a){c.onsuccess=function(){var e=c.result.transaction(["children"]),t=e.objectStore("children").index("templateStatus"),n=IDBKeyRange.bound([i,"CONFIRMED"],[i,"PENDING"]);t.openCursor(n).onsuccess=function(e){var t=e.target.result;t&&(t.value.office===o&&(r&&"customer"===i?t.value.attachment.Name.value===r&&d.push(t.value):d.push(t.value)),t.continue())},e.oncomplete=function(){a(d)}}})}function convertKeyToId(e){return e.replace(/-/g,"--").replace(/\s/g,"-")}function convertIdToKey(e){return e.replace(/-/g," ").replace("  ","-")}function updateCreateContainer(e,t){document.body.style.backgroundColor="#eeeeee",document.body.classList.remove("mdc-dialog-scroll-lock");var n=document.createElement("span");n.textContent=e.activityName,n.className="mdc-top-app-bar__title";var a=headerBackIcon(),o=document.getElementById("section-start");o.innerHTML="",o.appendChild(a),o.appendChild(n);var i=document.createElement("div");i.className="mdc-top-app-bar--fixed-adjust update-create--activity";for(var r=["office","venue","schedule","attachment","assignees"],c=0;c<5;c++){var d=document.createElement("ul");d.className="mdc-list custom--list-margin";var s=document.createElement("div");switch(r[c]){case"office":d.classList.remove("custom--list-margin");break;case"schedule":s.className="mdc-list-group__subheader",s.id="schedule--group";break;case"venue":case"assignees":d.classList.add("mdc-list--two-line","mdc-list--avatar-list")}"schedule"===r[c]?i.appendChild(s):(d.id=r[c]+"--list",i.appendChild(d))}if(e.canEdit){var l=document.createElement("button");l.setAttribute("aria-label","Send"),e.create?l.className="":t||(l.className="hidden"),l.id="send-activity",l.textContent="SUBMIT",i.appendChild(l)}return i}function updateCreateActivity(a,o){document.querySelector(".mdc-linear-progress")&&document.querySelector(".mdc-linear-progress").remove(),"updateCreateActivity"===history.state[0]?history.replaceState(["updateCreateActivity",a],null,null):history.pushState(["updateCreateActivity",a],null,null),console.log(a);var e=firebase.auth().currentUser.uid,i=indexedDB.open(e);i.onsuccess=function(){var e=i.result;document.getElementById("app-current-panel").innerHTML=updateCreateContainer(a,o).outerHTML,document.getElementById("office--list").appendChild(createSimpleLi("Office",{office:a.office,showLabel:!0})),createVenueSection(a),createScheduleTable(a),createAttachmentContainer(a),createAssigneeList(a,e),createActivityCancellation(a),window.scrollTo(0,0),document.getElementById("send-activity")&&document.getElementById("send-activity").addEventListener("click",function(){isLocationStatusWorking()&&(this.dataset.progress=!0,insertInputsIntoActivity(a,!0))});for(var t=document.querySelectorAll(".update-create--activity input"),n=0;n<t.length;n++)t[n].addEventListener("input",function(e){document.getElementById("send-activity").dataset.progress||document.getElementById("send-activity").classList.contains("hidden")&&document.getElementById("send-activity").classList.remove("hidden")})}}function createCheckInVenue(e,t){var n=document.createElement("div");n.className="mdc-radio checkin",n.value=JSON.stringify(e);var a=document.createElement("input");a.className="mdc-radio__native-control",a.type="radio",a.setAttribute("name","radios"),t&&a.setAttribute("checked","true");var o=document.createElement("div");o.className="mdc-radio__background";var i=document.createElement("div");i.className="mdc-radio__outer-circle";var r=document.createElement("div");r.className="mdc-radio__inner-circle",o.appendChild(i),o.appendChild(r),n.appendChild(a),n.appendChild(o);return n}function createSimpleLi(e,t){var n=document.createElement("li");n.className="mdc-list-item mdc-ripple-upgraded";var a=document.createElement("span");a.className="detail--static-text";document.createElement("span");var o=document.createElement("span");if("Office"===e&&(o.className="data--value-list",o.style.marginLeft="15px",o.textContent=t.office,a.textContent=e,n.appendChild(a),n.appendChild(o)),"delete"===e&&(o.className="mdc-list-item__graphic material-icons",o.textContent=e,a.classList.remove("detail--static-text"),a.classList.add("delete-activity"),a.textContent=t.text,n.appendChild(o),n.appendChild(a)),"empty"===e&&(n.dataset.prop="delete"),"undo-deleted"===e){o.className="mdc-list-item__graphic material-icons",o.textContent="delete",a.classList.remove("detail--static-text"),a.classList.add("delete-activity"),a.textContent=t.text,n.appendChild(o),n.appendChild(a),n.classList.add("undo-delete-activity");var i=document.createElement("button");i.style.color="white",i.className="mdc-button mdc-ripple-upgraded mdc-list-item__meta undo-deleted",i.textContent="Undo",i.onclick=function(){isLocationStatusWorking()&&(document.querySelector(".undo-deleted").style.display="none",n.appendChild(loader("undo-delete-loader")),requestCreator("statusChange",{activityId:t.id,status:"PENDING"}))},n.appendChild(i)}return n}function createVenueSection(c){if("customer"!==c.template&&0!==c.venue.length){var d=document.getElementById("venue--list");if("check-in"!==c.template)c.venue.forEach(function(e){d.appendChild(createVenueLi(e,!0,c));var t=document.createElement("div");t.className="map-detail "+convertKeyToId(e.venueDescriptor),d.appendChild(t)});else if(c.hasOwnProperty("create"))getRootRecord().then(function(e){checkMapStoreForNearByLocation(c.office,e.location).then(function(e){if(e.length){var t=document.createElement("li");t.className="mdc-list-item label--text",t.textContent=c.venue[0].venueDescriptor,t.style.height="50px",t.style.paddingRight="11px";var n=document.createElement("span");n.className="mdc-list-item__meta";var a=document.createElement("label");a.id="uncheck-checkin",a.className="mdc-fab add--assignee-icon";var o=document.createElement("span");o.className="mdc-fab__icon material-icons",o.textContent="clear",a.appendChild(o),n.appendChild(a),t.appendChild(n),d.appendChild(t),e.forEach(function(e,t){var n=document.createElement("div");n.className="mdc-form-field check-in-form";var a=document.createElement("label");a.setAttribute("for","check-in-radio"),a.textContent=e.location,n.appendChild(a);var o=new mdc.radio.MDCRadio(createRadioInput(JSON.stringify(e)));if(!t){var i=e;o.checked=!0,c.venue[0].location=i.location,c.venue[0].address=i.address,c.venue[0].geopoint._latitude=i.latitude,c.venue[0].geopoint._longitude=i.longitude}o.root_.querySelector("input").onclick=function(){var e=JSON.parse(this.value);c.venue[0].location=e.location,c.venue[0].address=e.address,c.venue[0].geopoint._latitude=e.latitude,c.venue[0].geopoint._longitude=e.longitude},n.appendChild(o.root_),d.appendChild(n);var r=document.createElement("div");r.id="map-detail-check-in-create"+convertKeyToId(e.venueDescriptor),d.appendChild(r)});var i=document.getElementById("uncheck-checkin");i&&i.addEventListener("click",function(){document.querySelectorAll(".mdc-radio").forEach(function(e){new mdc.radio.MDCRadio(e).checked=!1,c.venue[0].location="",c.venue[0].address="",c.venue[0].geopoint._latitude="",c.venue[0].geopoint._longitude=""})})}})});else{if(!c.venue[0].location||!c.venue[0].address)return;c.venue.forEach(function(e){d.appendChild(createVenueLi(e,!0,c));var t=document.createElement("div");t.className="map-detail "+convertKeyToId(e.venueDescriptor),d.appendChild(t)})}}}function createVenueLi(o,e,t,n){var i=!1,a=document.createElement("li");a.className="mdc-list-item mdc-ripple-upgraded",a.id=convertKeyToId(o.venueDescriptor);var r=document.createElement("div");r.className="mdc-list-item__text link--span";var c=document.createElement("span");c.className="mdc-list-item__primary-text";var d=document.createElement("span");d.className="mdc-list-item__meta";var s=new Fab("add_location").getButton();if(s.root_.classList.add("add--assignee-icon","attachment-selector-label"),e){var l=document.createElement("span");l.className="detail--static-text",l.textContent=o.venueDescriptor;var u=document.createElement("span");u.className="data--value-list",u.textContent=o.location,u.dataset.primary="",c.appendChild(l),c.appendChild(u),r.appendChild(c),r.onclick=function(e){if(hasMapsApiLoaded()&&o.geopoint._latitude&&o.geopoint._longitude){i=!i;var t={lat:o.geopoint._latitude,lng:o.geopoint._longitude},n=document.querySelector(".map-detail."+convertKeyToId(o.venueDescriptor)),a=new AppendMap(n);a.setZoom(18),a.setLocation(t),a.getMarker(),n.style.height=i?"200px":"0px"}},t.canEdit&&(d.setAttribute("aria-hidden","true"),d.appendChild(s.root_),s.root_.onclick=function(e){insertInputsIntoActivity(t),history.replaceState(["updateCreateActivity",t],null,null),selectorUI({record:t,store:"map",key:o.venueDescriptor})})}else c.textContent=o.location,r.appendChild(c);var m=document.createElement("span");m.className="mdc-list-item__meta material-icons",n&&(m.appendChild(createRadioInput()),a.onclick=function(){checkRadioInput(this,{location:o.location,address:o.address,geopoint:{_latitude:o.latitude,_longitude:o.longitude},venueDesc:o.venueDescriptor})});var p=document.createElement("span");return p.className="mdc-list-item__secondary-text",p.textContent=o.address,p.dataset.secondary="",r.appendChild(p),a.appendChild(r),n?a.appendChild(m):a.appendChild(d),a}function createScheduleTable(v){v.schedule.length||(document.getElementById("schedule--group").style.display="none");var g=0;v.schedule.forEach(function(e){g++;var t=document.createElement("h5");t.className="mdc-list-group__subheader label--text",t.textContent=e.name;var n=document.createElement("ul");n.className="mdc-list mdc-list--dense";var a=document.createElement("li");a.className="mdc-list-divider",a.setAttribute("role","separator");var o=document.createElement("li");o.className="mdc-list-item schedule-start-li";var i=document.createElement("div");i.className="mdc-text-field start--date"+g;var r=document.createElement("input");r.value=moment(e.startTime||new Date).format("YYYY-MM-DD"),r.type="date",r.disabled=!v.canEdit,r.className="mdc-text-field__input",i.appendChild(r);var c=document.createElement("span");c.className="mdc-list-item__meta";var d=document.createElement("div");d.className="mdc-text-field start--time"+g;var s=document.createElement("input");e.startTime?s.value=moment(e.startTime).format("HH:mm"):s.value=moment("24","HH:mm").format("HH:mm"),s.type="time",s.className="time--input",s.disabled=!v.canEdit,s.className="mdc-text-field__input",d.appendChild(s),c.appendChild(d);var l=document.createElement("li");l.className="mdc-list-item schedule-end-li";var u=document.createElement("div");u.className="mdc-text-field end--date"+g;var m=document.createElement("input");m.value=moment(e.endTime||moment().add(1,"days")).format("YYYY-MM-DD"),m.type="date",m.disabled=!v.canEdit,m.className="mdc-text-field__input",u.appendChild(m),"leave"===v.template&&(r.onchange=function(e){var t=document.getElementById("Number-Of-Days");if(t){var n=moment(m.value).diff(moment(r.value),"days")+1;0<=n&&(t.querySelector("input").value=n)}},m.onchange=function(e){var t=document.getElementById("Number-Of-Days");if(t){var n=moment(m.value).diff(moment(r.value),"days")+1;0<=n&&(t.querySelector("input").value=n)}});var p=document.createElement("span");p.className="mdc-list-item__meta";var h=document.createElement("div");h.className="mdc-text-field end--time"+g;var f=document.createElement("input");e.endTime?f.value=moment(e.endTime||new Date).format("HH:mm"):f.value=moment("24","HH:mm").format("HH:mm"),f.type="time",f.disabled=!v.canEdit,f.className="mdc-text-field__input",h.appendChild(f),p.appendChild(h),o.appendChild(i),o.appendChild(c),l.appendChild(u),l.appendChild(p),n.appendChild(o),n.appendChild(a),n.appendChild(l),document.getElementById("schedule--group").appendChild(t),document.getElementById("schedule--group").appendChild(n)})}function createAttachmentContainer(C){["Name","Number","Template","email","phoneNumber","HHMM","weekday","number","base64","string"].forEach(function(e){var t=document.createElement("div");t.className=e+"--group",document.getElementById("attachment--list").appendChild(t)});var b={phoneNumber:"",weekday:"","HH:MM":"",string:"",base64:"",number:"",email:""};Object.keys(C.attachment).forEach(function(n){var a=document.createElement("div");"HH:MM"===C.attachment[n].type?a.className="attachment-field HHMM":a.className="attachment-field  "+C.attachment[n].type,a.id=convertKeyToId(n),C.canEdit&&a.classList.add("editable--true");var e=createElement("label",{className:"label--text",textContent:n});if("string"===C.attachment[n].type)if("Name"===n||"Number"===n)if("customer"!==C.template){a.appendChild(e);var t=(new InputField).withoutLabel();t.root_.id=n,t.disabled=!C.canEdit,t.value=C.attachment[n].value,t.input_.required=!0,t.input_.placeholder="Enter Value",t.input_.onchange=function(e){C.attachment[n].value+=e.target.value},a.appendChild(t.root_)}else{a.appendChild(e);var o=addNewCustomer(C,a);o.style.marginTop="0px",a.appendChild(o)}else{a.appendChild(e);var i=textAreaField({value:C.attachment[n].value,readonly:C.canEdit,rows:2});i.onchange=function(e){C.attachment[n].value+=e.target.value},a.appendChild(i)}if("number"===C.attachment[n].type){a.appendChild(e),console.log(C);C.canEdit;if("Number Of Days"===n){var r=document.querySelector("#schedule--group .start--date1 input"),c=document.querySelector("#schedule--group .end--date1 input");C.attachment[n].value=moment(c.value).diff(r.value,"days")+1,console.log(moment(c.value).diff(r.value,"days")+1),!1}var d=(new InputField).withoutLabel();d.input_.type="number",d.value=C.attachment[n].value,C.canEdit?d.input_.onchange=function(e){C.attachment[n].value+=e.target.value}:d.disabled=!0,a.appendChild(d.root_)}if("email"===C.attachment[n].type){a.appendChild(e);var s=(new InputField).withoutLabel();s.value=C.attachment[n].value,canEdit?s.input_.onchange=function(e){C.attachment[n].value+=e.target.value}:s.disabled=!0,s.input_.type="email",a.appendChild(s.root_)}if("phoneNumber"===C.attachment[n].type){if(a.appendChild(e),a.classList.add("selector--margin","mdc-form-field"),C.attachment[n].value){a.style.padding="5px 15px 5px 15px";var l=new mdc.chips.MDCChip(chipSet(C.attachment[n].value,C.canEdit));l.listen("MDCChip:removal",function(e){C.attachment[n].value="",document.querySelector("#send-activity")&&document.querySelector("#send-activity").classList.remove("hidden")}),l.root_.classList.add("data--value-list","label--text"),l.root_.dataset.primary="",a.appendChild(l.root_)}if(C.canEdit){var u=new Fab("person_add").getButton();u.root_.classList.add("add--assignee-icon","attachment-selector-label"),a.appendChild(u.root_),u.root_.onclick=function(e){insertInputsIntoActivity(C),history.replaceState(["updateCreateActivity",C],null,null),selectorUI({record:C,store:"users",attachment:!0,key:n})}}}if("HH:MM"==C.attachment[n].type){a.appendChild(e);var m=(new InputField).withoutLabel();m.value=C.attachment[n].value||moment("24","HH:mm").format("HH:mm"),C.canEdit?m.input_.onchange=function(e){C.attachment[n].value=e.target.value}:m.disabled=!0,m.input_.type="time",a.appendChild(m.root_)}if("weekday"===C.attachment[n].type){a.appendChild(e);var p=C.attachment[n].value,h=selectMenu({id:convertKeyToId(n),data:["sunday","tuesday","wednesday","thursday","friday","saturday","monday"],selected:p});h.listen("change",function(e){document.getElementById("send-activity").dataset.progress||document.getElementById("send-activity").classList.remove("hidden"),C.attachment[n].value=e.target.value}),a.appendChild(h.root_)}if("base64"===C.attachment[n].type){var f=createElement("ul",{className:"image-preview--attachment mdc-image-list standard-image-list mdc-image-list--with-text-protection"});if(f.appendChild(setFilePath(C.attachment[n].value,n,!0)),C.canEdit){var v=new Fab("add_a_photo").getButton();v.root_.classList.add("attachment-selector-label","add--assignee-icon"),a.appendChild(v.root_),v.root_.onclick=function(){readCameraFile()}}a.appendChild(f)}if(!b.hasOwnProperty(C.attachment[n].type)){a.classList.add("mdc-form-field");a.appendChild(e);var g=document.createElement("span");if(C.attachment[n].value){var y=new mdc.chips.MDCChip(chipSet(C.attachment[n].value,C.canEdit));a.appendChild(y.root_),y.listen("MDCChip:removal",function(e){C.attachment[n].value="",document.querySelector("#send-activity")&&document.querySelector("#send-activity").classList.remove("hidden"),"Customer"===n&&C.hasOwnProperty("create")&&(C.customerRecord&&(getLocation().then(function(e){geocodePosition({lat:e.latitude,lng:e.longitude}).then(function(e){C.customerRecord.venue=[createVenueObjectWithGeoCode(C.customerRecord.venue[0].venueDescriptor,e)]})}).catch(function(e){C.customerRecord.venue=[createVenueObjectWithGeoCode(C.customerRecord.venue[0].venueDescriptor)]}),C.customerRecord.attachment.Name.value=""),y.root_.parentNode.replaceChild(addNewCustomerButton(C,a).root_,y.root_))})}else"Customer"===n&&C.hasOwnProperty("create")&&a.appendChild(addNewCustomerButton(C,a).root_);hasAnyValueInChildren(C.office,C.attachment[n].type).then(function(t){if(t.length){var e=new Fab("add").getButton();e.root_.classList.add("mdc-typography--subtitle2","mdc-button--dense","add--assignee-icon","attachment-selector-label"),e.root_.id="customer-selection-btn",a.appendChild(e.root_),a.classList.add("selector--margin"),e.root_.onclick=function(e){g.dataset.primary="",insertInputsIntoActivity(C),history.replaceState(["updateCreateActivity",C],null,null),selectorUI({record:C,store:"children",key:n,results:t})}}})}"HH:MM"===C.attachment[n].type?document.querySelector(".HHMM--group").appendChild(a):"Name"===n?document.querySelector(".Name--group").appendChild(a):b.hasOwnProperty(C.attachment[n].type)?document.querySelector("."+C.attachment[n].type+"--group").appendChild(a):document.querySelector(".Template--group").appendChild(a)})}function addNewCustomerButton(e,t){var n=new Button("Create New");n.shaped(),n.raised();var a=n.getButton();a.root_.classList.add("create-new-customer-btn");var o=!1;return a.root_.onclick=function(){o=!o,this.style.marginRight=o?(showCustomerContainer(e,t),this.textContent="Cancel",this.style.float="right","0px"):(hideCustomerContainer(e,t,this),this.textContent="Create New","15px")},a}function showCustomerContainer(e,t){t.classList.remove("mdc-form-field"),e.customerRecord?t.appendChild(addNewCustomer(e.customerRecord,e)):t.appendChild(addNewCustomer(e)),t.querySelector("#customer-selection-btn")&&t.querySelector("#customer-selection-btn").classList.add("hidden")}function hideCustomerContainer(t,e){e.classList.add("mdc-form-field"),document.querySelector(".customer-form")&&document.querySelector(".customer-form").remove(),t.customerRecord&&(getLocation().then(function(e){geocodePosition({lat:e.latitude,lng:e.longitude}).then(function(e){t.customerRecord.venue=[createVenueObjectWithGeoCode(t.customerRecord.venue[0].venueDescriptor,e)]})}).catch(function(e){t.customerRecord.venue=[createVenueObjectWithGeoCode(t.customerRecord.venue[0].venueDescriptor)]}),t.customerRecord.attachment.Name.value=""),e.querySelector("#customer-selection-btn")&&e.querySelector("#customer-selection-btn").classList.remove("hidden")}function createAssigneeList(t,n){var a=document.getElementById("assignees--list"),e=createElement("li",{className:"mdc-list-item label--text add--assignee-loader",textContent:"Assignees"});if(t.canEdit){var o=createElement("span",{className:"mdc-list-item__meta"}),i=new Fab("person_add").getButton();i.root_.classList.add("add--assignee-icon"),i.root_.onclick=function(e){insertInputsIntoActivity(t),history.replaceState(["updateCreateActivity",t],null,null),selectorUI({record:t,store:"users"})},o.appendChild(i.root_),e.appendChild(o)}a.appendChild(e),t.assignees.forEach(function(e){getUserRecord(n,e).then(function(e){a.appendChild(createSimpleAssigneeLi(e))})})}function createSimpleAssigneeLi(e,t){var n=createElement("li",{className:"mdc-list-item"});if(!e)return n;var a=createElement("object",{className:"mdc-list-item__graphic",data:e.photoURL||"./img/empty-user.jpg",type:"image/jpeg"}),o=createElement("img",{className:"empty-user-assignee",src:"./img/empty-user.jpg"});a.appendChild(o);var i=createElement("span",{className:"mdc-list-item_text"}),r=createElement("span",{className:"mdc-list-item__primary-text"}),c=createElement("span",{className:"mdc-list-item__secondary-text"});return e.displayName?(r.textContent=e.displayName,c.textContent=e.mobile):r.textContent=e.mobile,i.appendChild(r),i.appendChild(c),n.appendChild(a),n.appendChild(i),t&&(n.setAttribute("role","checkbox"),n.appendChild(t.root_)),n}function checkRadioInput(e,t){document.getElementById("selector-submit-send").textContent="SELECT",[].concat(_toConsumableArray(document.querySelectorAll(".radio-selected"))).forEach(function(e){e.classList.remove("radio-selected")});var n=e;if(n){var a=new mdc.radio.MDCRadio(n.querySelector(".radio-control-selector"));a.root_.classList.add("radio-selected"),document.getElementById("selector-submit-send").dataset.type="",a.value=JSON.stringify(t)}}function setFilePath(e,t,n){if(document.querySelector(".image--list-li"))return document.getElementById("attachment-picture").data="data:image/jpg;base64,"+e,document.getElementById("attachment-picture").dataset.value="data:image/jpg;base64,"+e,void(document.getElementById("send-activity").dataset.progress||document.getElementById("send-activity").classList.remove("hidden"));var a=document.createElement("li");a.className="mdc-image-list__item image--list-li";var o=document.createElement("div"),i=document.createElement("object");i.data=e||"./img/placeholder.png",i.type="image/jpeg",i.id="attachment-picture",i.dataset.photoKey=t,i.className="profile-container--main mdc-image-list__image";var r=document.createElement("img");r.src="./img/placeholder.png",r.className="profile-container--main mdc-image-list__image",i.dataset.value=e?i.src=e:(i.data="./img/placeholder.png",""),i.appendChild(r),i.onclick=function(){openImage(this.data)},o.appendChild(i),a.appendChild(o);var c=document.createElement("div");c.className="mdc-image-list__supporting";var d=document.createElement("span");return d.textContent=t,d.className="mdc-image-list__label",d.id="label--image",c.appendChild(d),a.appendChild(c),n?a:void 0}function readCameraFile(){if("Android"===native.getName())try{AndroidInterface.startCamera()}catch(e){sendExceptionObject(e,"CATCH Type 11: AndroidInterface.startCamera at readCameraFile",[])}else webkit.messageHandlers.takeImageForAttachment.postMessage("convert image to base 64")}function openImage(e){if(e){var t=document.createElement("img");t.src=e,t.style.width="100%",document.getElementById("dialog-container").innerHTML=dialog({id:"viewImage--dialog-component",headerText:"Photo",content:t,showCancel:!0,showAccept:!0}).outerHTML;var n=document.querySelector("#viewImage--dialog-component"),a=new mdc.dialog.MDCDialog.attachTo(n);a.listen("MDCDialog:accept",function(e){n.remove()}),a.listen("MDCDialog:cancel",function(e){n.remove()}),a.show()}}function createActivityCancellation(o){if(o.canEdit){var e=document.createElement("div");if(e.className="status--cancel-cont",!o.hasOwnProperty("create"))if("CANCELLED"!==o.status){if("CANCELLED"!==o.status){if(e.appendChild(createSimpleLi("delete",{text:"CANCEL"})),document.querySelector(".update-create--activity").appendChild(e),!o.canEdit)return;document.querySelector(".delete-activity").addEventListener("click",function(e){var t=document.createElement("span");t.className="mdc-typography--body1",t.textContent="Are you sure you want to delete this activity ? ",document.getElementById("dialog-container").innerHTML=dialog({id:"cancel-alert",headerText:o.activityName+" will be deleted",showCancel:!0,showAccept:!0,content:t}).outerHTML;var n=document.querySelector("#cancel-alert"),a=new mdc.dialog.MDCDialog(n);a.lastFocusedTarget=e.target,a.show(),a.listen("MDCDialog:cancel",function(){n.remove()}),a.listen("MDCDialog:accept",function(){isLocationStatusWorking()&&(document.querySelector(".delete-activity").style.display="none",document.querySelector(".status--cancel-cont li").appendChild(loader("cancel-loader")),requestCreator("statusChange",{activityId:o.activityId,status:"CANCELLED"}),n.remove())})})}}else{e.appendChild(createSimpleLi("undo-deleted",{text:"Cancelled",id:o.activityId})),document.querySelector(".update-create--activity").appendChild(e);new mdc.ripple.MDCRipple.attachTo(document.querySelector(".undo-deleted"))}}}function concatDateWithTime(e,t){var n=moment(e+" "+t);return moment(n).valueOf()}function insertInputsIntoActivity(e,t){for(var n=document.querySelectorAll(".image-preview--attachment  object"),a=0;a<n.length;a++)e.attachment[convertKeyToId(n[a].dataset.photoKey)].value=n[a].dataset.value;for(var o=void 0,i=void 0,r=void 0,c=void 0,d=1;d<e.schedule.length+1;d++)if(o=getInputText(".start--date"+d).value,i=getInputText(".start--time"+d).value,r=getInputText(".end--date"+d).value,c=getInputText(".end--time"+d).value,concatDateWithTime(o,i)||concatDateWithTime(r,c)){if(o&&!i)return void snacks("Please Select a Start Time");if(i&&!o)return void snacks("Please Select a Start Date");if(concatDateWithTime(o,i)&&!r)return void snacks("Please Select a End Date");if(concatDateWithTime(o,i)&&!c)return void snacks("Please Select a End Time");if(concatDateWithTime(r,c)<concatDateWithTime(o,i))return void snacks("The End Date and Time should be greater or equal to the start time");e.schedule[d-1].startTime=concatDateWithTime(o,i)||"",e.schedule[d-1].endTime=concatDateWithTime(r,c)||""}else e.schedule[d-1].startTime=concatDateWithTime(o,i)||"",e.schedule[d-1].endTime=concatDateWithTime(r,c)||"";if(t){var s=[];if(e.customerRecord&&e.customerRecord.attachment.Name.value){var l={share:[],office:e.customerRecord.office,venue:e.customerRecord.venue,schedule:e.customerRecord.schedule,attachment:e.customerRecord.attachment,template:e.customerRecord.template};for(d=0;d<e.customerRecord.venue.length;d++)e.customerRecord.venue[d].geopoint={latitude:e.customerRecord.venue[d].geopoint._latitude||"",longitude:e.customerRecord.venue[d].geopoint._longitude||""};s.push(l)}for(d=0;d<e.venue.length;d++)e.venue[d].geopoint={latitude:e.venue[d].geopoint._latitude||"",longitude:e.venue[d].geopoint._longitude||""};var u=void 0;if(e.hasOwnProperty("create"))u=e.assignees;else{u=[];for(d=0;d<e.assignees.length;d++)"object"===_typeof(e.assignees[d])&&u.push(e.assignees[d].phoneNumber)}var m={share:u,office:e.office,venue:e.venue,schedule:e.schedule,attachment:e.attachment,template:e.template};e.hasOwnProperty("create")||(m.activityId=e.activityId),s.push(m),sendUpdateReq(s,e)}}function sendUpdateReq(t,n){document.querySelector("header").appendChild(progressBar()),document.querySelector("#send-activity").classList.add("hidden"),n.hasOwnProperty("create")?n.customerRecord?hasAnyValueInChildren(n.customerRecord.office,"customer",n.customerRecord.attachment.Name.value).then(function(e){if(!e.length)return requestCreator("create",t);(e[0].attachment.Name.value=n.customerRecord.attachment.Name.value)&&t.shift(),requestCreator("create",t)}):requestCreator("create",t):requestCreator("update",t[0])}function checkSpacesInString(e){return!e.replace(/\s/g,"").length}function formAddressComponent(e){var t="";return e.address_components&&(t=[e.address_components[0]&&e.address_components[0].short_name||"",e.address_components[1]&&e.address_components[1].short_name||"",e.address_components[2]&&e.address_components[2].short_name||""].join(" ")),t}function getSubscription(r,c){return new Promise(function(o){var e=firebase.auth().currentUser.uid,i=indexedDB.open(e);i.onsuccess=function(){var e=i.result.transaction(["subscriptions"]),t=e.objectStore("subscriptions").index("officeTemplate"),n=IDBKeyRange.only([r,c]),a=void 0;t.get(n).onsuccess=function(e){a=e.target.result},e.oncomplete=function(){o(a)}}})}function addNewCustomer(t,n){var a=createElement("div",{className:"customer-form"}),o=createElement("span",{className:"customer-location-error mdc-typography--subtitle1"}),e=new InputField({id:"customer-name",labelText:"Customer Name",className:"filled-background mdc-text-field--fullwidth mdc-text-field"}),i=new InputField({id:"customer-name",labelText:"Customer Address",className:"mdc-text-field--fullwidth filled-background mdc-text-field"}),r=e.withoutLabel();r.value=t.attachment.Name.value,r.input_.placeholder="Customer Name",r.input_.id="customer-name",r.input_.required=!0,r.input_.onchange=function(e){t.attachment.Name.value+=e.target.value,n&&n.customerRecord&&(n.attachment.Customer.value+=e.target.value)};var c=i.withoutLabel();c.input_.placeholder="Customer Address",c.input_.id="customer-address",c.value=t.venue[0].address,a.appendChild(r.root_),a.appendChild(c.root_);var d=createElement("div",{id:"customer-address-map"}),s=new AppendMap(d);s.setZoom(18);var l=void 0;t.venue[0].location&&(s.setLocation({lat:t.venue[0].geopoint._latitude,lng:t.venue[0].geopoint._longitude}),l=s.getMarker({draggable:!0}),a.style.minHeight="400px",google.maps.event.addListener(l,"dragend",function(){geocodePosition(l.getPosition()).then(function(e){c.value=e.formatted_address,t.venue[0]=createVenueObjectWithGeoCode(t.venue[0].venueDescriptor,e),document.querySelector("#send-activity")&&document.querySelector("#send-activity").classList.remove("hidden")})}));var u=new google.maps.places.Autocomplete(c.input_,{componentRestrictions:{country:"in"}});return u.addListener("place_changed",function(){var e=u.getPlace();document.querySelector("#send-activity")&&document.querySelector("#send-activity").classList.remove("hidden"),s.setLocation({lat:e.geometry.location.lat(),lng:e.geometry.location.lng()}),l=s.getMarker({draggable:!0}),console.log(t),t.venue[0]=createVenueObjectWithAutoComplete(t.venue[0].venueDescriptor,e),console.log(t),a.style.minHeight="400px",google.maps.event.addListener(l,"dragend",function(){geocodePosition(l.getPosition()).then(function(e){c.value=e.formatted_address,t.venue[0]=createVenueObjectWithGeoCode(t.venue[0].venueDescriptor,e),document.querySelector("#send-activity")&&document.querySelector("#send-activity").classList.remove("hidden")}).catch(function(e){handleError({message:"geocode Error in autocomplete listener for"+n.template,body:JSON.stringify(e)}),o.textContent="Failed to detect your current Location. Search For A new Location or choose existing"})})}),a.appendChild(d),a.appendChild(o),a}function geocodePosition(e,t){return new Promise(function(n){(new google.maps.Geocoder).geocode({latLng:e},function(e){if(e&&0<e.length){var t=e[0];return n(t)}return n(!1)},function(e){reject(e)})})}function modifyVenueRecordWithGeocode(e,t){var n=createVenueObjectWithGeoCode(t);return"customer"===e.template?(n.venueDescriptor=e.venue[0].venueDescriptor,e.venue[0]=n):(n.venueDescriptor=e.customerRecord.venue[0].venueDescriptor,e.customerRecord.venue[0]=n),e}function createVenueObjectWithGeoCode(e,t){return{location:t?t.formatted_address:"",address:t?t.formatted_address:"",geopoint:{_latitude:t?t.geometry.location.lat():"",_longitude:t?t.geometry.location.lng():""},venueDescriptor:e}}function createVenueObjectWithAutoComplete(e,t){return{location:t?t.name:"",address:t?formAddressComponent(t):"",geopoint:{_latitude:t?t.geometry.location.lat():"",_longitude:t?t.geometry.location.lng():""},venueDescriptor:e}}var appKey=new AppKeys,ui=void 0,native={setFCMToken:function(e){localStorage.setItem("token",e)},getFCMToken:function(){return localStorage.getItem("token")},setName:function(e){localStorage.setItem("deviceType",e)},getName:function(){return localStorage.getItem("deviceType")},setIosInfo:function(e){var t=e.split("&"),n={baseOs:t[0],deviceBrand:t[1],deviceModel:t[2],appVersion:Number(t[3]),osVersion:t[4],id:t[5],initConnection:t[6]};localStorage.setItem("iosUUID",JSON.stringify(n))},getIosInfo:function(){return localStorage.getItem("iosUUID")},getInfo:function(){if(!this.getName())return JSON.stringify({baseOs:this.getName(),deviceBrand:"",deviceModel:"",appVersion:7,osVersion:"",id:""});if("Android"===this.getName())try{return AndroidInterface.getDeviceId()}catch(e){return sendExceptionObject(e,"Catch Type 3: AndroidInterface.getDeviceId in native.getInfo()",[]),JSON.stringify({baseOs:this.getName(),deviceBrand:"",deviceModel:"",appVersion:7,osVersion:"",id:""})}return this.getIosInfo()}},app={today:function(e){return e?moment().format(e):moment()},tomorrow:function(){return moment(this.today()).add(1,"day")},isNewDay:function(e){var t=localStorage.getItem("today");return t?!moment(moment().format("YYYY-MM-DD")).isSame(moment(t))&&(localStorage.setItem("today",moment().format("YYYY-MM-DD")),!0):(localStorage.setItem("today",moment().format("YYYY-MM-DD")),!0)}};function backNav(){history.back()}function resetScroll(){scroll_namespace.count=0,scroll_namespace.size=20,scroll_namespace.skip=!1}function firebaseUiConfig(t){return{callbacks:{signInSuccessWithAuthResult:function(e){if(t)return document.querySelector("#updateEmailDialog")&&document.querySelector("#updateEmailDialog").remove(),updateEmail(e.user,t),!1},signInFailure:function(e){return handleUIError(e)},uiShown:function(){}},signInFlow:"popup",signInOptions:[{provider:firebase.auth.PhoneAuthProvider.PROVIDER_ID,recaptchaParameters:{type:"image",size:"normal",badge:"bottomleft"},defaultCountry:"IN",defaultNationalNumber:t?firebase.auth().currentUser.phoneNumber:""}]}}function userSignedOut(){var e=document.createElement("div");e.id="login-container",document.body.appendChild(e),ui||(ui=new firebaseui.auth.AuthUI(firebase.auth())),ui.start("#login-container",firebaseUiConfig())}function layoutGrid(){var e=document.createElement("div");e.classList.add("mdc-layout-grid","mdc-typography","app"),e.id="main-layout-app";var t=document.createElement("div");t.className="mdc-layout-grid__inner cell-space";var n=document.createElement("div");n.id="app-current-panel",n.className="mdc-layout-grid__cell--span-12";var a=document.createElement("div");a.id="snackbar-container";var o=document.createElement("div");o.id="dialog-container",t.appendChild(n),t.appendChild(a),e.appendChild(t),e.appendChild(o),document.getElementById("growthfile").innerHTML=e.outerHTML,new mdc.topAppBar.MDCTopAppBar(document.querySelector(".mdc-top-app-bar"))}function startApp(e){firebase.auth().onAuthStateChanged(function(n){if(!n)return document.getElementById("main-layout-app").style.display="none",void userSignedOut();if("production"!==appKey.getMode()||native.getInfo()){if(localStorage.getItem("error")||localStorage.setItem("error",JSON.stringify({})),e){var t=indexedDB.open(n.uid,3),a=void 0;t.onupgradeneeded=function(e){(a=t.result).onerror=function(){handleError({message:a.error.message+" from startApp on upgradeneeded"})},createObjectStores(a,n.uid)},t.onsuccess=function(){document.getElementById("main-layout-app").style.display="block",localStorage.setItem("dbexist",n.uid);var t=!1;if("Android"!==native.getName())try{webkit.messageHandlers.startLocationService.postMessage("start fetchin location")}catch(e){sendExceptionObject(e,"Catch Type 2: webkit.messageHandlers.startLocationService",["start fetchin location"]),t=!0}else t=!0;resetScroll(),listView(),requestCreator("now",{device:native.getInfo(),from:"",registerToken:native.getFCMToken()}),runAppChecks(),t&&manageLocation().then(console.log).catch(function(e){handleError(e)})},t.onerror=function(){handleError({message:t.error.message+" from startApp"})}}}else redirect()})}function getEmployeeDetails(){return new Promise(function(o,i){var r=firebase.auth().currentUser,c=indexedDB.open(r.uid);c.onsuccess=function(){var e=c.result.transaction(["children"]),t=e.objectStore("children"),n=void 0,a=IDBKeyRange.bound(["employee","CONFIRMED"],["employee","PENDING"]);t.index("templateStatus").openCursor(a).onsuccess=function(e){var t=e.target.result;t&&(t.value.attachment["Employee Contact"].value===r.phoneNumber&&(n=t.value),t.continue())},e.oncomplete=function(){o(n)},e.onerror=function(){i({message:e.error.message+" from getEmployeeDetails"})}},c.onerror=function(){i({message:c.error.message+" from getEmployeeDetails"})}})}function isEmployeeOnLeave(){return new Promise(function(r,c){getEmployeeDetails().then(function(o){if(!o)return r(!1);o.onLeave=!1;var i=indexedDB.open(firebase.auth().currentUser.uid);i.onsuccess=function(){var e=i.result.transaction(["calendar"]),t=e.objectStore("calendar"),n=IDBKeyRange.bound(["leave","CONFIRMED",o.office],["leave","PENDING",o.office]),a=!1;t.index("onLeave").openCursor(n).onsuccess=function(e){var t=e.target.result;t&&(moment(moment().format("YYYY-MM-DD")).isBetween(t.value.start,t.value.end,null,"[]")?a=!0:t.continue())},e.oncomplete=function(){r(a)},e.onerror=function(){c({message:e.error.message+" from isEmployeeOnLeave"})}},i.onerror=function(){c({message:i.error.message+" from isEmployeeOnLeave"})}}).catch(function(e){c(e)})})}function createObjectStores(e,t){var n=e.createObjectStore("activity",{keyPath:"activityId"});n.createIndex("timestamp","timestamp"),n.createIndex("office","office"),n.createIndex("hidden","hidden");var a=e.createObjectStore("list",{keyPath:"activityId"});a.createIndex("timestamp","timestamp"),a.createIndex("status","status");var o=e.createObjectStore("users",{keyPath:"mobile"});o.createIndex("displayName","displayName"),o.createIndex("isUpdated","isUpdated"),o.createIndex("count","count"),e.createObjectStore("addendum",{autoIncrement:!0}).createIndex("activityId","activityId");var i=e.createObjectStore("subscriptions",{autoIncrement:!0});i.createIndex("office","office"),i.createIndex("template","template"),i.createIndex("officeTemplate",["office","template"]);var r=e.createObjectStore("calendar",{autoIncrement:!0});r.createIndex("activityId","activityId"),r.createIndex("timestamp","timestamp"),r.createIndex("start","start"),r.createIndex("end","end"),r.createIndex("urgent",["status","hidden"]),r.createIndex("onLeave",["template","status","office"]);var c=e.createObjectStore("map",{autoIncrement:!0});c.createIndex("activityId","activityId"),c.createIndex("location","location"),c.createIndex("latitude","latitude"),c.createIndex("longitude","longitude"),c.createIndex("nearby",["status","hidden"]),c.createIndex("byOffice",["office","location"]);var d=e.createObjectStore("children",{keyPath:"activityId"});d.createIndex("template","template"),d.createIndex("office","office"),d.createIndex("templateStatus",["template","status"]),e.createObjectStore("root",{keyPath:"uid"}).put({uid:t,fromTime:0,location:""})}function redirect(){firebase.auth().signOut().then(function(){window.location="https://www.growthfile.com"}).catch(function(e){window.location="https://www.growthfile.com",handleError({message:e+" from redirect"})})}function initLocation(){manageLocation().then(console.log).catch(function(e){handleError(e)})}function runAppChecks(){window.addEventListener("suggestCheckIn",function(t){isEmployeeOnLeave().then(function(e){if(!e&&t.detail&&"listView"===history.state[0])try{getRootRecord().then(function(e){if(e.offices&&e.offices.length){var t=e.offices,n=document.createElement("h1");n.className="mdc-typography--body1 mt-10",n.textContent="Do you want to create a Check-In ?",document.getElementById("dialog-container").innerHTML=dialog({id:"suggest-checkIn-dialog",headerText:"Check-In Reminder",content:n,showCancel:!0,showAccept:!0}).outerHTML;var a=document.querySelector("#suggest-checkIn-dialog"),o=new mdc.dialog.MDCDialog(a);o.show(),o.listen("MDCDialog:accept",function(e){isLocationStatusWorking()&&(1!==t.length?selectorUI({record:"",store:"subscriptions",suggestCheckIn:!0}):createTempRecord(t[0],"check-in",{suggestCheckIn:!0}))}),o.listen("MDCDialog:cancel",function(){a.remove()}),resetScroll(),listView()}})}catch(e){console.log(e)}}).catch(handleError)},!0)}window.addEventListener("load",function(){layoutGrid(),firebase.initializeApp(appKey.getKeys());var t="Device Incompatibility",n="Your Device is Incompatible with Growthfile. Please Upgrade your Android Version";if(window.Worker||window.indexedDB)moment.updateLocale("en",{calendar:{lastDay:"[yesterday]",sameDay:"hh:mm",nextDay:"[Tomorrow at] LT",lastWeek:"dddd",nextWeek:"dddd [at] LT",sameElse:"L"},longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YY"},months:["January","February","March","April","May","June","July","August","September","October","November","December"]}),window.onpopstate=function(e){if(e.state){if("listView"!==e.state[0])return window[e.state[0]](e.state[1],!1);var t=scroll_namespace.count;t&&(scroll_namespace.size=t),scroll_namespace.count=0,window[e.state[0]]()}},startApp(!0);else try{AndroidInterface.showDialog(t,n)}catch(e){var a=document.createElement("span");a.textContent=n,a.className="mdc-typography--body1",sendExceptionObject(e,"Catch Type 1: AndroidInterface.showDialog at window.onload",[t,n]),document.getElementById("dialog-container").innerHTML=dialog({id:"device-incompatibility-dialog",headerText:t,content:a}).outerHTML,new mdc.dialog.MDCDialog(document.getElementById("device-incompatibility-dialog")).show()}});var scroll_namespace={count:0,size:20,skip:!1};function resetScroll(){scroll_namespace.count=0,scroll_namespace.size=20,scroll_namespace.skip=!0}function initDomLoad(){document.querySelector(".init-loader")&&document.querySelector(".init-loader").remove(),document.querySelector(".mdc-linear-progress")&&document.querySelector(".mdc-linear-progress").remove(),document.body.classList.remove("mdc-dialog-scroll-lock"),listPanel(),creatListHeader("Activities"),createActivityIcon()}function listView(){history.pushState(["listView"],null,null),initDomLoad(),getSizeOfListStore().then(function(t){t?(20<t&&window.addEventListener("scroll",handleScroll,!1),getRootRecord().then(function(e){t&&t<=20?loadActivitiesFromListStore(e.location):startCursor(e.location)})):appendTextContentInListView("No activities Found")})}function appendTextContentInListView(e){var t=document.createElement("p");t.textContent=e,t.className="no-activity",document.getElementById("activity-list-main").appendChild(t),document.getElementById("activity-list-main").style.boxShadow="none"}function getSizeOfListStore(){return new Promise(function(t,n){var a=indexedDB.open(firebase.auth().currentUser.uid);a.onsuccess=function(){var e=a.result.transaction(["list"]).objectStore("list").count();e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}},a.onerror=function(){n(a.error)}})}function updateEl(n,r){var a=indexedDB.open(firebase.auth().currentUser.uid);a.onsuccess=function(){var e=a.result.transaction(["list","activity"]),o=e.objectStore("activity"),t=e.objectStore("list"),i=document.getElementById("activity--list");n.forEach(function(a){document.querySelector(".no-activity")&&document.querySelector(".no-activity").remove(),t.get(a.activityId).onsuccess=function(e){var t=e.target.result,n=document.querySelector('[data-id="'+a.activityId+'"]');n&&n.remove(),t&&(r.location?getActivityDataForList(o,t,r.location).then(function(e){i&&i.insertBefore(e,i.childNodes[0])}):getActivityDataForList(o,t).then(function(e){i&&i.insertBefore(e,i.childNodes[0])}))}})}}function handleScroll(e){getRootRecord().then(function(e){if(window.innerHeight+window.scrollY===document.body.scrollHeight){if(!document.getElementById("activity--list"))return;startCursor(e.location)}})}function loadActivitiesFromListStore(o){var i=indexedDB.open(firebase.auth().currentUser.uid);i.onsuccess=function(){var e=i.result.transaction(["list","activity","root"]),n=e.objectStore("activity"),t=e.objectStore("list").index("timestamp"),a=document.createDocumentFragment();t.openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;t&&(getActivityDataForList(n,t.value,o).then(function(e){a.appendChild(e)}),t.continue())},e.oncomplete=function(){var e=document.getElementById("activity--list");e&&(e.innerHTML="",e.appendChild(a),scrollToActivity())}}}function startCursor(r){var c=indexedDB.open(firebase.auth().currentUser.uid);c.onsuccess=function(){var e=c.result.transaction(["list","activity","root"]),n=e.objectStore("activity"),t=e.objectStore("list").index("timestamp"),a=0,o=scroll_namespace.count,i=document.createDocumentFragment();t.openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;t&&(o?scroll_namespace.skip?(getActivityDataForList(n,t.value,r).then(function(e){i.appendChild(e),a++}),runCursor(t,a)):(scroll_namespace.skip=!0,t.advance(o)):(getActivityDataForList(n,t.value,r).then(function(e){i.appendChild(e),a++}),runCursor(t,a)))},e.oncomplete=function(){var e=document.getElementById("activity--list");e&&(e.appendChild(i),scroll_namespace.count=scroll_namespace.count+scroll_namespace.size,scroll_namespace.skip=!1,scroll_namespace.size=20,scrollToActivity())}}}function runCursor(e,t){t<scroll_namespace.size&&e.continue()}function getActivityDataForList(t,l,u){return new Promise(function(r,e){var c=document.createElement("div");c.style.marginTop="10px";var d=document.createElement("span");d.className="mdc-list-item__secondary-text venue-secondline";var s=document.createElement("span");s.className="mdc-list-item__secondary-text",t.get(l.activityId).onsuccess=function(e){var t=e.target.result;if(t){var n=t.schedule,a=t.venue,o=void 0,i=generateLastestSchedule(n,l.createdTime);u&&(o=generateLatestVenue(a,u)),o&&!i?(d.textContent=o,d.style.maxWidth="70%"):i&&!o?s.textContent=i:i&&o&&(d.textContent=o,s.textContent=" | "+i),c.appendChild(d),c.appendChild(s),r(activityListUI(l,c))}}})}function generateLastestSchedule(e,t){var n=removeEmptyObjects(e,"startTime","endTime");if(!n.length)return formatCreatedTime(t);var a=Date.now();return getTimeTypeForMultipleSchedule(a,sortDatesInAscendingOrderWithPivot(a,n))}function removeEmptyObjects(e,t,n){return e.length?e.filter(function(e){if(e[t]&&e[n])return e}):e}function sortDatesInAscendingOrderWithPivot(e,t){var n=t.slice();return n.push(e),n.sort(function(e,t){return e-t})}function getTimeTypeForMultipleSchedule(e,t){var n=t.slice().indexOf(e);return n==t.length-1?moment(t[t.length-2]).format("D, MMM").replace(",",""):moment(t[n+1]).format("D, MMM").replace(",","")}function formatCreatedTime(e){return e?isToday(e)?moment(e).format("hh:mm"):moment(e).format("D, MMM").replace(",",""):""}function isToday(e){return(new Date).setHours(0,0,0,0)==new Date(e).setHours(0,0,0,0)}function generateLatestVenue(e,n){var t=removeEmptyObjects(e,"location","address"),a=t.length;if(!a)return"";if(1==a)return t[0].location;var o=[];return e.forEach(function(e){var t={latitude:e.geopoint._latitude,longitude:e.geopoint._longitude};o.push({distance:calculateDistanceBetweenTwoPoints(t,n),location:e.location})}),sortNearestLocation(o)[0].location}function sortNearestLocation(e){return e.slice().sort(function(e,t){return e.distance-t.distance})}function activityListUI(e,t){var n=document.createElement("li");n.dataset.id=e.activityId,n.onclick=function(){localStorage.setItem("clickedActivity",this.dataset.id),conversation(this.dataset.id,!0)},n.classList.add("mdc-list-item","activity--list-item","mdc-elevation--z1");var a=document.createElement("object");a.data=e.creator.photo||"./img/empty-user.jpg",a.type="image/jpeg",a.className="mdc-list-item__graphic material-icons";var o=document.createElement("img");o.src="./img/empty-user.jpg",o.className="empty-user-list",a.appendChild(o);var i=document.createElement("span");i.classList.add("mdc-list-item__text");var r=document.createElement("span");r.className="mdc-list-item__primary-text bigBlackBold",r.textContent=e.activityName,i.appendChild(r),i.appendChild(t);var c=document.createElement("div");c.className="mdc-meta__custom-text",c.style.width="76px",isToday(e.timestamp)&&(c.style.marginTop="4px"),c.textContent=moment(e.timestamp).calendar();var d=document.createElement("span");return d.classList.add("mdc-list-item__meta"),d.appendChild(c),d.appendChild(generateIconByCondition(e,n)),n.appendChild(a),n.appendChild(i),n.appendChild(d),n}function generateIconByCondition(e,t){if(e.count){var n=document.createElement("span");return n.textContent=e.count,n.className="count mdc-meta__custom-text",t.classList.add("count-active"),n}var a=document.createElement("i");a.classList.add("status-cancel","material-icons",""+e.status),a.textContent="clear";var o=document.createElement("i");o.classList.add("status-confirmed","material-icons",""+e.status),o.textContent="check";var i=document.createElement("i");return i.classList.add("status-pending","material-icons",""+e.status),i.textContent="","CONFIRMED"===e.status?o:"CANCELLED"===e.status?a:i}function appendActivityListToDom(e){var t=document.getElementById("activity--list");t&&t.appendChild(e)}function getRootRecord(){return new Promise(function(t,n){var a=void 0,o=firebase.auth().currentUser.uid,i=indexedDB.open(o);i.onsuccess=function(){var e=i.result.transaction(["root"],"readwrite");e.objectStore("root").get(o).onsuccess=function(e){var t=e.target.result;a=t},e.oncomplete=function(){t(a)},e.onerror=function(){n({message:e.error.message+" from getRootRecord"})}},i.onerror=function(){n({message:i.error+" from getRootRecord"})}})}function createActivityIcon(){document.getElementById("create-activity--icon")||getCountOfTemplates().then(function(e){e&&createActivityIconDom()}).catch(handleError)}function getCountOfTemplates(){return new Promise(function(t,n){var a=0,o=indexedDB.open(firebase.auth().currentUser.uid);o.onsuccess=function(){var e=o.result.transaction(["subscriptions"],"readonly");e.objectStore("subscriptions").index("office").openCursor(null,"nextunique").onsuccess=function(e){var t=e.target.result;t&&(a++,t.continue())},e.oncomplete=function(){t(a)},e.onerror=function(){n({message:e.error.message+" from getCountOfTemplates"})}},o.onerror=function(){n({message:o.error.message+" from getCountOfTemplates"})}})}function createActivityIconDom(){var e=new Fab("add").getButton();e.root_.classList.add("create-activity"),e.root_.id="create-activity--icon",e.root_.onclick=function(){selectorUI({store:"subscriptions",suggestCheckIn:!1})},document.getElementById("activity-list-main").appendChild(e.root_)}function listPanel(){if(!document.getElementById("activity-list-main")){var e=document.createElement("div");e.className="mdc-card panel-card mdc-top-app-bar--fixed-adjust",e.id="activity-list-main";var t=document.createElement("ul");t.className="mdc-list mdc-list--two-line mdc-list--avatar-list",t.id="activity--list",e.appendChild(t),document.getElementById("app-current-panel").innerHTML=e.outerHTML}}function creatListHeader(i){var t=indexedDB.open(firebase.auth().currentUser.uid);t.onsuccess=function(){var e=t.result,o=document.getElementById("section-start");o.innerHTML="",getUserRecord(e,firebase.auth().currentUser.phoneNumber).then(function(e){var t=document.createElement("object");t.className="list-photo-header",t.type="image/jpeg",t.data=e.photoURL||"./img/empty-user.jpg",t.onclick=function(){profileView(!0)};var n=document.createElement("img");n.src="./img/empty-user.jpg",n.className="list-photo-header",t.appendChild(n);var a=document.createElement("span");a.textContent=i,a.className="mdc-top-app-bar__title mdc-typography--headline5",o.appendChild(t),o.appendChild(a)})}}function scrollToActivity(){var e=localStorage.getItem("clickedActivity");if(document.querySelector('[data-id="'+e+'"]'))return document.querySelector('[data-id="'+e+'"]').scrollIntoView({behavior:"instant",block:"center",inline:"center"}),void localStorage.removeItem("clickedActivity")}function modifyHeader(e){e.left&&(document.getElementById(e.id+"view-type").innerHTML=e.left);e.right&&(document.getElementById(e.id+"action-data").innerHTML=e.right)}function headerBackIcon(e){var t=document.createElement("i");return t.className="material-icons mdc-top-app-bar__navigation-icon",t.textContent="arrow_back",t.onclick=function(){if(!e)return backNav();"subscriptions"===e?(resetScroll(),listView()):updateCreateActivity(history.state[1],!0)},t}function profileView(e){e&&history.pushState(["profileView"],null,null),window.addEventListener&&window.removeEventListener("scroll",handleScroll,!1),document.body.style.backgroundColor="#eeeeee";var t=document.getElementById("section-start");t.innerHTML="",t.appendChild(headerBackIcon());var i=firebase.auth().currentUser,r=i.uid,c=indexedDB.open(r);c.onsuccess=function(){var n=c.result,a=n.transaction(["root"],"readwrite"),o=a.objectStore("root");o.get(r).onsuccess=function(e){var t=e.target.result;o.put(t),a.oncomplete=function(){createProfilePanel(n).then(function(e){document.getElementById("app-current-panel")&&(document.getElementById("app-current-panel").innerHTML=e.outerHTML,"Android"===native.getName()?document.getElementById("uploadProfileImage").addEventListener("click",function(){try{AndroidInterface.openImagePicker()}catch(e){sendExceptionObject(e,"CATCH Type 10:AndroidInterface.openImagePicker at profileview",[])}}):document.getElementById("uploadProfileImage").addEventListener("change",function(){readUploadedFile()}),changeDisplayName(i),changeEmailAddress(i))})}}}}function createProfilePanel(e){return new Promise(function(v){getUserRecord(e,firebase.auth().currentUser.phoneNumber).then(function(e){var t=document.createElement("div");t.id="profile-view--container",t.className="mdc-top-app-bar--fixed-adjust mdc-theme--background";var n=document.createElement("button");n.className="mdc-fab","Android"===native.getName()&&(n.id="uploadProfileImage");var a=document.createElement("label");a.setAttribute("for","uploadProfileImage");var o=document.createElement("span");o.className="mdc-fab__icon material-icons",o.textContent="add_a_photo",a.appendChild(o),n.appendChild(a);var i=void 0;"Android"!==native.getName()&&((i=document.createElement("input")).type="file",i.style.display="none",i.id="uploadProfileImage",i.accept="image/jpeg;");var r=document.createElement("div");r.id="profile--image-container",r.className="profile-container--main";var c=document.createElement("object");c.type="image/jpeg",c.data=e.photoURL||"./img/empty-user-big.jpg",c.id="user-profile--image";var d=document.createElement("img");d.src="./img/empty-user-big.jpg",d.className="empty-user-profile",c.appendChild(d);var s=document.createElement("div");s.className="insert-overlay",r.appendChild(c),r.appendChild(s),r.appendChild(n),"Android"!==native.getName()&&a.appendChild(i);var l=document.createElement("div");l.id="name--change-container",l.className="profile-psuedo-card";var u=document.createElement("button");u.className="mdc-icon-button material-icons hidden",u.id="edit--name",u.setAttribute("aria-hidden","true"),u.setAttribute("aria-pressed","false"),u.textContent="check";var m=firebase.auth().currentUser.displayName;l.innerHTML='<div class="mdc-text-field" id=\'name-change-field\'>\n        <input autocomplete="off" type="text"  placeholder="'+(m?"":"Enter Your Name")+'"  id="pre-filled-name" class="mdc-text-field__input" value="'+(m||"")+'">\n        <label class="mdc-floating-label mdc-floating-label--float-above" for="pre-filled-name">\n         Your Name\n        </label>\n        <div class="mdc-line-ripple"></div>\n      </div>\n      ',l.appendChild(u);var p=document.createElement("div");p.id="email--change-container",p.className="profile-psuedo-card";var h=document.createElement("button");h.className="mdc-icon-button material-icons hidden",h.id="edit--email",h.setAttribute("aria-hidden","true"),h.setAttribute("aria-pressed","false"),h.textContent="check";var f=firebase.auth().currentUser.email;p.innerHTML='<div class="mdc-text-field" id=\'email-change-field\'>\n        <input  autocomplete="off" type="text" id="pre-filled-email" class="mdc-text-field__input" value="'+(f||"")+'" placeholder="'+(f?"":"Enter your Email")+'">\n        <label class="mdc-floating-label mdc-floating-label--float-above" for="pre-filled-email">\n         Your Email\n        </label>\n        <div class="mdc-line-ripple"></div>\n      </div>\n      ',p.appendChild(h),t.appendChild(r),t.appendChild(l),t.appendChild(p),v(t)})})}function timeDiff(e){var t=moment().format("YYY-MM-DD HH:mm"),n=moment(e).format("YYY-MM-DD HH:mm");return moment(t).diff(moment(n),"minutes")}function newSignIn(e,t){document.getElementById("dialog-container").innerHTML=dialog({id:"updateEmailDialog",showCancel:!0,showAccept:!1,headerText:!1,content:!1}).outerHTML;var n=document.querySelector("#updateEmailDialog");n.querySelector("section").id="refresh-login";var a=new mdc.dialog.MDCDialog(n);a.listen("MDCDialog:cancel",function(e){n.remove()}),a.show();try{ui||(ui=new firebaseui.auth.AuthUI(firebase.auth())),ui.start("#refresh-login",firebaseUiConfig(e)),setTimeout(function(){document.querySelector(".firebaseui-id-phone-number").disabled=!0,document.querySelector(".firebaseui-label").remove(),document.querySelector(".firebaseui-title").textContent="Verify your phone Number to Update your Email address"},500),a.listen("MDCDialog:cancel",function(){t.value=firebase.auth().currentUser.email,n.remove()})}catch(e){n.remove(),console.log(e),handleError({message:e.message+" from newSignIn function during email updation"}),snacks("Please try again later")}}function readUploadedFile(e){if("Android"!==native.getName()){var t=document.getElementById("uploadProfileImage").files[0],n=new FileReader;n.addEventListener("load",function(){sendBase64ImageToBackblaze(n.result)},!1),t&&n.readAsDataURL(t)}else sendBase64ImageToBackblaze(e)}function sendBase64ImageToBackblaze(e){var t=document.getElementById("user-profile--image"),n=document.getElementById("profile--image-container"),a="data:image/jpeg;base64,";t&&(t.data=a+e),n&&document.getElementById("profile--image-container").appendChild(loader("profile--loader")),requestCreator("backblaze",{imageBase64:a+e})}function authUpdatedError(e){document.querySelector(".init-loader")&&document.querySelector(".init-loader").remove(),snacks(e.message)}function changeDisplayName(){var e=document.getElementById("name-change-field"),t=new mdc.textField.MDCTextField(e),n=document.getElementById("edit--name");firebase.auth().currentUser.displayName;e.addEventListener("click",function(){document.getElementById("pre-filled-name").placeholder="",n.classList.remove("hidden"),e.classList.add("short")}),e.addEventListener("keydown",function(e){13==e.keyCode&&updateName(t.value)}),n.addEventListener("click",function(){updateName(t.value)})}function updateName(e){e?firebase.auth().currentUser.updateProfile({displayName:e}).then(successDialog).catch(function(e){snacks("Please Try again later"),handleError({message:e+" at updateProfile in changeDisplayName"})}):snacks("Please Enter a Name")}function changeEmailAddress(){var e=document.getElementById("email-change-field"),t=new mdc.textField.MDCTextField(e),n=document.getElementById("edit--email");e.addEventListener("click",function(){document.getElementById("pre-filled-email").placeholder="",n.classList.remove("hidden"),e.classList.add("short")}),e.addEventListener("keydown",function(e){13==e.keyCode&&emailValidation(t)}),n.addEventListener("click",function(){emailValidation(t)})}function emailValidation(e){var t=firebase.auth().currentUser,n=e.value;n?n===t.email&&t.emailVerified?snacks("You have already set this as your email address"):timeDiff(t.metadata.lastSignInTime)<=2?updateEmail(t,n):newSignIn(n,e):snacks("Enter a valid Email Id")}function updateEmail(e,t){document.getElementById("growthfile").appendChild(loader("init-loader")),e.updateEmail(t).then(function(){emailUpdateSuccess(!0)}).catch(authUpdatedError)}function emailUpdateSuccess(e){firebase.auth().currentUser.sendEmailVerification().then(function(){emailVerificationSuccess(e)}).catch(emailVerificationError)}function emailVerificationSuccess(e){e&&successDialog(),snacks("Verification link has been send to your email address")}function emailVerificationError(e){snacks(e.message),document.querySelector(".init-loader")&&document.querySelector(".init-loader").remove(),handleError({message:e.message+" from emailVerificationError"})}function initUserSelectorSearch(i,e,r){var t=indexedDB.open(firebase.auth().currentUser.uid);t.onsuccess=function(){var n=t.result,a="",o=document.createDocumentFragment();e.input_.addEventListener("input",function(e){var t=e.target.value;if(isNumber(t))return a=n.transaction("users").objectStore("users"),void searchUsersDB(formatNumber(t),a,o,i,r);o=document.createDocumentFragment(),a=n.transaction("users").objectStore("users").index("displayName"),searchUsersDB(formatName(t),a,o,i,r)})}}function isNumber(e){return!isNaN(e)}function formatNumber(e){var t=e;return"91"===t.substring(0,2)?t="+"+t:"+91"!==t.substring(0,3)&&(t="+91"+t),t}function formatName(e){var t=e.split(" "),n=t.length,a=[],o=0;for(o=0;o<n;o++){var i=t[o];if(i.charAt(0).toUpperCase()===e.charAt(0).toUpperCase)return e;a.push(i.charAt(0).toUpperCase()+i.slice(1))}return a.join(" ")}function checkNumber(e){return/^\+[1-9]\d{11,14}$/.test(e)}function searchUsersDB(e,t,r,c,d){console.log(e);var n=IDBKeyRange.bound(e,e+"￿"),s=document.getElementById("user-selector-list"),a=c.record.assignees,l={};a.forEach(function(e){"string"==typeof e?l[e]=!0:l[e.phoneNumber]=!0}),l[firebase.auth().currentUser.phoneNumber]=!0,t.openCursor(n).onsuccess=function(e){var t=e.target.result;if(!t){if(s.innerHTML="",0!=r.children.length)return void s.appendChild(r);var n=document.createElement("div");n.className="data-not-found";var a=document.createElement("p");return a.textContent="No Contact Found",a.className="mdc-typography--headline5",n.appendChild(a),void(document.querySelector(".data-not-found")||s.appendChild(n))}if(c.attachment){var o=new mdc.radio.MDCRadio(createRadioInput({value:t.value.mobile}));r.appendChild(createSimpleAssigneeLi(t.value,o))}else if(!l.hasOwnProperty(t.value.mobile)){var i=createCheckBox({value:t.value.mobile});i.root_.onclick=function(){d.querySelector("#selector-submit-send").dataset.type="",d.querySelector("#selector-submit-send").textContent="SELECT"},r.appendChild(createSimpleAssigneeLi(t.value,i))}t.continue()}}function selectorUI(a){document.body.style.backgroundColor="white",document.body.classList.remove("mdc-dialog-scroll-lock"),document.getElementById("app-current-panel").innerHTML="";var e=document.getElementById("section-start");e.innerHTML="",e.appendChild(headerBackIcon(a.store));var o=createElement("div",{className:"selector-container mdc-top-app-bar--fixed-adjust"}),t=createElement("span",{className:"selector-warning-text",id:"selector-warning"});o.appendChild(t);var n="SELECT";"users"===a.store&&(n="Add New Number");var i=new Button(n);i.raised(),i.selectorButton();var r=i.getButton();r.root_.id="selector-submit-send","users"===a.store&&(r.root_.dataset.type="add-number"),r.root_.onclick=function(){if(isLocationStatusWorking()){var e=o.querySelector("#selector-warning"),t=getSelectedList(".mdc-radio");if(t.length){e.textContent="";var n=JSON.parse(t[0].value);"subscriptions"===a.store&&("dsr"!==n.template&&"duty roster"!==n.template&&"tour plan"!==n.template||document.querySelector("header").appendChild(progressBar()),createTempRecord(n.office,n.template,a))}else e.textContent="Please Select An Option"}};({users:!0,children:!0,map:!0})[a.store]||o.appendChild(r.root_),window.scrollTo(0,0),{map:mapSelector,users:userSelector,subscriptions:fillSubscriptionInSelector,children:fillChildrenInSelector}[a.store](a,o)}function mapSelector(i,r){var c=document.getElementById("app-current-panel"),e=(new InputField).withLeadingIcon("search","Search Location");e.root_.id="map-selector-search",e.root_.classList.add("search-field"),r.appendChild(e.root_);var t=e.input_;t.placeholder="",autocomplete=new google.maps.places.Autocomplete(t,{componentRestrictions:{country:"in"}}),autocomplete.addListener("place_changed",function(){var e=autocomplete.getPlace();if(e.geometry){var t={location:e.name,address:formAddressComponent(e),latitude:e.geometry.location.lat(),longitude:e.geometry.location.lng()};updateCreateActivity(updateVenue(i,t).record,!0)}else snacks("Please select a valid location")}),console.log(i);var d=indexedDB.open(firebase.auth().currentUser.uid);d.onsuccess=function(){var e=d.result.transaction([i.store],"readonly"),t=e.objectStore("map"),n=i.record.office,a=IDBKeyRange.bound([n,""],[n,"￿"]),o=createElement("ul",{className:"mdc-list mdc-list--avatar-list map-selector-list"});o.setAttribute("role","radiogroup"),t.index("byOffice").openCursor(a,"nextunique").onsuccess=function(e){var t=e.target.result;if(t)if(t.value.office===i.record.office)if(t.value.location)if(t.value.latitude&&t.value.longitude)if(o.querySelector('[data-name="'+t.value.location+'"]'))t.continue();else{var n=radioList({value:t.value,labelText:t.value.location});n.dataset.name=t.value.location,n.querySelector(".mdc-radio input").onclick=function(){var e=JSON.parse(this.value);updateCreateActivity(updateVenue(i,e).record,!0)},o.appendChild(n),t.continue()}else t.continue();else t.continue();else t.continue()},e.oncomplete=function(){r.appendChild(o),c.appendChild(r)}}}function updateVenue(t,n){return t.record.venue.forEach(function(e){e.venueDescriptor===t.key&&(e.address=n.address,e.location=n.location,e.geopoint._latitude=n.latitude,e.geopoint._longitude=n.longitude)}),t}function userSelector(d,s){var e=document.getElementById("app-current-panel"),t=(new InputField).withLeadingIcon("search","Search Assignee");t.root_.id="users-selector-search",t.root_.classList.add("search-field"),s.appendChild(t.root_),e.appendChild(s),initUserSelectorSearch(d,t,s);var l=createElement("ul",{className:"mdc-list mdc-list--avatar-list  mdc-list--two-line",id:"user-selector-list"});l.setAttribute("role","group"),l.setAttribute("aria-label","User List With Check Box"),s.appendChild(l);var n=d.record.assignees,a=new Button("Add New Number");a.raised(),a.selectorButton();var o=a.getButton();o.root_.dataset.type="add-number",o.root_.id="selector-submit-send",o.root_.onclick=function(){if("add-number"!==o.root_.dataset.type){var e=".mdc-radio";d.attachment||(e=".mdc-checkbox");var t=getSelectedList(e);if(t){var n=[];t.forEach(function(e){n.push(JSON.parse(e.value))}),console.log(n),insertNumberIntoRecord(d,n)}else s.querySelector("#selector-warning").textContent="Please Choose An Option"}else addNewNumber(d,s)},s.appendChild(o.root_);var i=indexedDB.open(firebase.auth().currentUser.uid);i.onsuccess=function(){var e=i.result.transaction(["users"]),t=e.objectStore("users"),r=0,c={};n.forEach(function(e){"string"==typeof e?c[e]=!0:c[e.phoneNumber]=!0}),c[firebase.auth().currentUser.phoneNumber]=!0,t.openCursor().onsuccess=function(e){var t=e.target.result;if(t)if(l.querySelector('[data-number="'+t.value.mobile+'"]'))t.continue();else{if(d.attachment){r++;var n=new mdc.radio.MDCRadio(createRadioInput(JSON.stringify(t.value.mobile)));n.root_.onclick=function(){d.record.attachment[d.key].value=JSON.parse(n.value),updateCreateActivity(d.record,!0)};var a=createSimpleAssigneeLi(t.value,n);a.dataset.number=t.value.mobile,l.appendChild(a)}else if(!c.hasOwnProperty(t.value.mobile)){r++;var o=createCheckBox({value:t.value.mobile});o.root_.onclick=function(){s.querySelector("#selector-submit-send").dataset.type="",s.querySelector("#selector-submit-send").textContent="SELECT"};var i=createSimpleAssigneeLi(t.value,o);i.dataset.number=t.value.mobile,l.appendChild(i)}t.continue()}},e.oncomplete=function(){r||(l.appendChild(noSelectorResult("No Contact Found")),document.getElementById("users-selector-search").style.display="none"),document.getElementById("app-current-panel").appendChild(s)}}}function addNewNumber(t,e){document.body.style.backgroundColor="white",removeChildNodes(e);var n=createElement("div",{className:"new-number-container"}),a=createElement("h2",{className:"mdc-typography--headline5 new-contact-headline",textContent:"Add a new Phone Number"}),o=createElement("p",{className:"mdc-typography--subtitle2 message-field",textContent:"Enter new phone contact without country code",id:"helper-message"}),i=new Fab("add").extended("Add Contact");i.root_.id="new-contact";var r=(new InputField).withoutLabel();r.root_.id="number-field",r.root_.type="number",r.input_.placeholder="Enter A New Phone Number",r.input_.setAttribute("maxlength","10"),r.input_.setAttribute("size","10"),r.input_.required=!0,r.input_.onkeypress=function(e){return 48<=e.charCode&&e.charCode<=57},r.input_.oninput=function(){this.value.length>this.maxLength?this.value=this.value.slice(0,this.maxLength):this.value.length===this.maxLength?(o.classList.remove("error-message"),this.classList.add("valid-input"),o.textContent=""):(o.classList.add("error-message"),o.textContent="* Please Enter a valid Number")},i.root_.onclick=function(){var e=formatNumber(r.value);if(!checkNumber(e))return o.classList.add("error-message"),o.textContent="* Please Enter a valid Number",void r.disabled(!0);insertNumberIntoRecord(t,[e])},n.appendChild(a),n.appendChild(r.root_),n.appendChild(o),n.appendChild(i.root_),e.appendChild(n),document.getElementById("app-current-panel").appendChild(e)}function insertNumberIntoRecord(e,t){return e.attachment?(e.record.attachment[e.key].value=t[0],void updateCreateActivity(e.record,!0)):e.record.hasOwnProperty("create")?(e.record.assignees.push.apply(e.record.assignees,t),void updateCreateActivity(e.record,!0)):void shareReq(e,t)}function fillSubscriptionInSelector(n,i){var a=indexedDB.open(firebase.auth().currentUser.uid);a.onsuccess=function(){var e=a.result.transaction([n.store],"readonly"),t=e.objectStore(n.store).index("office"),o=createElement("div",{className:"mdc-list-group",id:"data-list--container"});t.openCursor(null,"nextunique").onsuccess=function(e){var t=e.target.result;if(t){var n=createElement("ul",{className:"mdc-list mdc-list--avatar-list subscription-selector"});n.setAttribute("role","radiogroup"),n.dataset.groupName=t.value.office;var a=createElement("h3",{className:"mdc-list-group__subheader subheader--group-small",textContent:t.value.office});o.appendChild(a),o.appendChild(n),i.appendChild(o),t.continue()}},e.oncomplete=function(){document.getElementById("app-current-panel").appendChild(i),insertTemplateByOffice(o)}}}function insertTemplateByOffice(a){var e=indexedDB.open(firebase.auth().currentUser.uid);e.onsuccess=function(){e.result.transaction(["subscriptions"],"readonly").objectStore("subscriptions").index("office").openCursor().onsuccess=function(e){var t=e.target.result;if(t)if("CANCELLED"!==t.value.status)if(a.querySelector('[data-group-name="'+t.value.office+'"] [data-name="'+t.value.template+'"]'))t.continue();else{var n=radioList({value:t.value,labelText:t.value.template});n.dataset.name=t.value.template,a.querySelector('[data-group-name="'+t.value.office+'"]').appendChild(n),t.continue()}else t.continue()}}}function fillChildrenInSelector(a,e){var o=createElement("ul",{className:"mdc-list"});a.results.forEach(function(e){if(!o.querySelector('[data-value="'+radioListEl.dataset.value+'"]')){if(e.attachment.Name){var t=radioList({labelText:e.attachment.Name.value,value:e.attachment.Name.value});t.dataset.value=e.attachment.Name.value,t.querySelector(".mdc-radio input").onclick=function(){a.record.attachment[a.key].value=JSON.parse(this.value),updateCreateActivity(a.record,!0)},o.appendChild(t)}if(e.attachment.Number){var n=radioList({labelText:e.attachment.Number.value,value:e.attachment.Number.value});n.dataset.value=e.attachment.Number.value,o.appendChild(n)}}}),e.appendChild(o),document.getElementById("app-current-panel").appendChild(e)}function getSelectedList(t){return[].map.call(document.querySelectorAll(t),function(e){return".mdc-radio"===t?new mdc.radio.MDCRadio(e):".mdc-checkbox"===t?new mdc.checkbox.MDCCheckbox(e):void 0}).filter(function(e){return e.checked})}function shareReq(e,t){isLocationStatusWorking()&&(document.querySelector("header").appendChild(progressBar()),requestCreator("share",{activityId:e.record.activityId,share:t}))}var apiHandler=new Worker("js/apiHandler.js");function handleError(e){var t=JSON.parse(localStorage.getItem("error"));if(!t.hasOwnProperty(e.message))return t[e.message]=!0,localStorage.setItem("error",JSON.stringify(t)),e.device=native.getInfo(),void requestCreator("instant",JSON.stringify(e))}function loader(e){var t=document.createElement("div");return t.className="loader "+e,t}function dialog(e){var t=document.createElement("aside");t.id=e.id,t.className="mdc-dialog dialog-custom-backdrop",t.role="alertdialog";var n=document.createElement("div");if(n.className="mdc-dialog__surface",e.headerText){var a=document.createElement("header");a.className="mdc-dialog__header";var o=document.createElement("h2");o.className="mdc-dialog__header__title",o.textContent=e.headerText,a.appendChild(o),n.appendChild(a)}var i=document.createElement("section");i.className="mdc-dialog__content",e.content&&i.appendChild(e.content),n.appendChild(i);var r=document.createElement("footer");if(r.className="mdc-dialog__footer",e.showCancel){var c=document.createElement("button");c.type="button",c.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--cancel",c.textContent="cancel",c.style.backgroundColor="#3498db",r.appendChild(c)}if(e.showAccept){var d=document.createElement("button");d.type="button",d.className="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--accept",d.textContent="Okay",d.style.backgroundColor="#3498db",r.appendChild(d)}return n.appendChild(r),t.appendChild(n),t}function successDialog(){var e=document.createElement("div");e.className="success--container";var t=document.createElement("div");t.className="success--check",e.appendChild(t),document.getElementById("dialog-container").innerHTML=dialog({id:"success-dialog",headerText:"",showCancel:!1,showAccept:!1,content:e}).outerHTML;var n=document.querySelector("#success-dialog");new mdc.dialog.MDCDialog(n).show(),setTimeout(function(){n.remove(),document.body.classList.remove("mdc-dialog-scroll-lock")},1e3),resetScroll(),localStorage.removeItem("clickedActivity"),resetScroll(),listView()}function progressBar(){var e=document.createElement("div");e.className="mdc-linear-progress mdc-linear-progress--indeterminate progress--update",e.role="progressbar";var t=document.createElement("div");t.className="mdc-linear-progress__buffering-dots";var n=document.createElement("div");n.className="mdc-linear-progress__buffer";var a=document.createElement("div");a.className="mdc-linear-progress__bar mdc-linear-progress__primary-bar";var o=document.createElement("span");o.className="mdc-linear-progress__bar-inner",a.appendChild(o);var i=document.createElement("div");i.className="mdc-linear-progress__bar mdc-linear-progress__secondary-bar";var r=document.createElement("span");return r.className="mdc-linear-progress__bar-inner",i.appendChild(r),e.appendChild(t),e.appendChild(n),e.appendChild(a),e.appendChild(i),e}function snacks(e,t){var n=document.createElement("div");n.className="mdc-snackbar",n.setAttribute("aria-live","assertive"),n.setAttribute("aria-atomic","true"),n.setAttribute("aria-hidden","true"),n.style.zIndex=99999;var a=document.createElement("div");a.className="mdc-snackbar__text mdc-typography--subtitle2";var o=document.createElement("div");o.className="mdc-snackbar__action-wrapper";var i=document.createElement("button");i.className="mdc-snackbar__action-button",o.appendChild(i),n.appendChild(a),n.appendChild(o),document.getElementById("snackbar-container").innerHTML=n.outerHTML;var r={message:e,actionText:"OK",timeout:5e3,actionHandler:function(){}};mdc.snackbar.MDCSnackbar.attachTo(document.querySelector(".mdc-snackbar")).show(r)}function fetchCurrentTime(e){return Date.now()+e}function geolocationApi(o){return new Promise(function(t,n){var a=new XMLHttpRequest;a.open("POST","https://www.googleapis.com/geolocation/v1/geolocate?key="+appKey.getMapKey(),!0),a.setRequestHeader("Content-Type","application/json"),a.onreadystatechange=function(){if(4===a.readyState){if(400<=a.status)return n({message:a.response,body:o});var e=JSON.parse(a.response);if(!e)return n({message:"Response From geolocation Api "+e,body:o});t({latitude:e.location.lat,longitude:e.location.lng,accuracy:e.accuracy,provider:{body:o}})}},a.onerror=function(){n({message:a})},a.send(o)})}function handleRequestBody(e){var t=JSON.parse(e);return t.wifiAccessPoints&&t.wifiAccessPoints.length?(t.cellTowers&&delete t.cellTowers,JSON.stringify(t)):null}function manageLocation(){return new Promise(function(t,n){getLocation().then(function(e){updateLocationInRoot(e),t(e)}).catch(function(e){n(e)})})}function getLocation(){return new Promise(function(n,a){var o={};"Android"!==native.getName()?html5Geolocation().then(function(e){n(e)}).catch(function(e){a(e)}):html5Geolocation().then(function(e){if(e.accuracy<=350)return n(e);o.html5={body:"",result:e},handleGeoLocationApi(o,e).then(function(e){n(e)})}).catch(function(t){handleGeoLocationApi(o).then(function(e){n(e)}).catch(function(e){a({message:"Both HTML and Geolocation failed to fetch location.",body:JSON.stringify({html5:t,geolocation:JSON.stringify(e)}),locationError:!0})})})})}function handleGeoLocationApi(i,r){return new Promise(function(a,t){var e=void 0,o=[];try{e=AndroidInterface.getCellularData()}catch(e){return r?void a(r):(sendExceptionObject(e,"CATCH Type 4 : AndroidInterface.getCellularData at handleGeolocationApi",[]),void t("CATCH Type 4 : AndroidInterface.getCellularData at handleGeolocationApi"))}if(""===e){if(r)return void a(r);t("empty string from AndroidInterface.getCellularData")}if(!Object.keys(JSON.parse(e)).length)return r?a(r):t("Empty Object returned from getCellularData method");geolocationApi(e).then(function(t){if(t.accuracy<=350)return a(t);i.orignialGeolocationResponse={body:e,result:t};var n=handleRequestBody(e);if(!n)return 1200<=t.accuracy&&handleError({message:"Oringinal CellTower has accuracy more than 1200 and WAP doesnt exist",body:JSON.stringify(i),locationError:!0}),r?t.accuracy<r.accuracy?void a(t):a(r):void a(t);geolocationApi(n).then(function(e){return e.accuracy<=350?a(e):(i.withoutCellTower={body:n,result:e},1200<=e.accuracy&&handleError({message:"html5,originalCellTower,WithoutCellTower",body:JSON.stringify(i),locationError:!0}),Object.keys(i).forEach(function(e){o.push(i[e].result)}),a(sortedByAccuracy(o)))}).catch(function(e){if(1200<=t.accuracy&&(i.withoutCellTower={body:n},handleError({message:"Orinigal CellTower has accuracy more than 1200 and api failure when sending cellTowerObject without cellularTowers",body:JSON.stringify(i),locationError:!0})),r){if(!(t.accuracy<r.accuracy))return a(r);a(t)}else a(t)})}).catch(function(e){r?a(r):t(e)})})}function iosLocationError(e){manageLocation().then(console.log).catch(console.log),handleError(e)}function html5Geolocation(){return new Promise(function(n,t){for(var e=[],a=0;a<2;a++){var o=new Promise(function(t,n){navigator.geolocation.getCurrentPosition(function(e){return t({latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy,provider:"HTML5"})},function(e){n({message:e})},{timeout:5e3,maximumAge:0,enableHighAccuracy:!0})});e.push(o)}Promise.all(e).then(function(e){var t=e.sort(function(e,t){return e.accuracy-t.accuracy});n(t[0])}).catch(function(e){t({message:e.message.message})})})}function updateLocationInRoot(a){var o={latitude:"",longitude:"",accuracy:"",provider:"",lastLocationTime:""},t=firebase.auth().currentUser.uid,i=indexedDB.open(t);i.onsuccess=function(){var e=i.result.transaction(["root"],"readwrite"),n=e.objectStore("root");n.get(t).onsuccess=function(e){var t=e.target.result;t.location&&(o=t.location),t.location=a,t.location.lastLocationTime=Date.now(),n.put(t)},e.oncomplete=function(){if(o.latitude&&o.longitude&&a.latitude&&a.longitude){var e=calculateDistanceBetweenTwoPoints(o,a),t=new CustomEvent("suggestCheckIn",{detail:isLocationMoreThanThreshold(e)||app.isNewDay()});if(window.dispatchEvent(t),"Ios"===native.getName()){var n=new CustomEvent("iosLocation",{detail:a});window.dispatchEvent(n)}}},e.onerror=function(){handleError({message:e.error.message+" from updateLocationInRoot",body:e.error.name})},i.onerror=function(){handleError({message:i.error.message+" from updateLocationInRoot",body:i.error.name}),window.dispatchEvent(suggestCheckIn)}}}function toRad(e){return e*Math.PI/180}function calculateDistanceBetweenTwoPoints(e,t){var n=toRad(t.latitude-e.latitude),a=toRad(t.longitude-e.longitude),o=toRad(t.latitude),i=toRad(e.latitude),r=Math.sin(n/2)*Math.sin(n/2)+Math.sin(a/2)*Math.sin(a/2)*Math.cos(o)*Math.cos(i);return 6371*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))}function isLocationMoreThanThreshold(e){return 1<=e}function isLocationLessThanThreshold(e){return e<=1}function sortedByAccuracy(e){return e.sort(function(e,t){return e.accuracy-t.accuracy})[0]}function createAndroidDialog(t,n){try{AndroidInterface.showDialog(t,n)}catch(e){sendExceptionObject(e,"CATCH Type 1:AndroidInterface.showDialog at createAndroidDialog ",[t,n]);var a=document.createElement("span");a.className="mdc-typography--body1",a.textContent=n,document.getElementById("dialog-container").innerHTML=dialog({id:"alert-dialog",showCancel:!1,showAccept:!0,content:a,headerText:t}).outerHTML;var o=document.querySelector("#alert-dialog"),i=new mdc.dialog.MDCDialog(o);i.listen("MDCDialog:accept",function(){o.remove(),resetScroll(),listView()}),i.show()}}function isLocationStatusWorking(){if("Android"!==native.getName())return!0;try{if(!AndroidInterface.isLocationPermissionGranted())return void createAndroidDialog("Location Permission","Please Allow Growthfile location access.")}catch(e){return sendExceptionObject(e,"CATCH Type 6: AndroidInterface.isLocationPermissionGranted at locationPermission",[]),!0}try{if(!AndroidInterface.isConnectionActive())return void createAndroidDialog("No Connectivity","Please Check your Internet Connectivity")}catch(e){return sendExceptionObject(e,"CATCH Type 7: AndroidInterface.isConnectionActive  at isLocationStatusWorking",[]),!0}return!0}function requestCreator(i,r){var t=firebase.auth().currentUser;if(t){var c={type:i,body:"",meta:{user:{token:"",uid:t.uid,displayName:t.displayName,photoURL:t.photoURL,phoneNumber:t.phoneNumber},apiUrl:appKey.getBaseUrl()}};"instant"===i||"now"===i||"Null"===i||"backblaze"===i?t.getIdToken(!1).then(function(e){c.body=r,c.meta.user.token=e,apiHandler.postMessage(c)}).catch(console.log):getRootRecord().then(function(a){var o=a.location,e=isLastLocationOlderThanThreshold(o.lastLocationTime,5),n=[t.getIdToken(!1)];e&&("Android"===native.getName()?n.push(manageLocation()):window.addEventListener("iosLocation",function e(t){n.push(t.detail),window.removeEventListener("iosLocation",e,!0)},!0)),Promise.all(n).then(function(e){var t=e[0];2==e.length&&(o=e[1],console.log(o));var n={latitude:o.latitude,longitude:o.longitude,accuracy:o.accuracy,provider:o.provider};"create"===i?r.forEach(function(e){e.timestamp=fetchCurrentTime(a.serverTime),e.geopoint=n}):(r.timestamp=fetchCurrentTime(a.serverTime),r.geopoint=n),c.body=r,c.meta.user.token=t,sendRequest(o,c)}).catch(function(e){handleError(e)})}),apiHandler.onmessage=messageReceiver,apiHandler.onerror=onErrorMessage}}function sendRequest(e,t){if(e.latitude&&e.longitude&&e.accuracy)apiHandler.postMessage(t);else{var n=document.createElement("span");n.className="mdc-typography--body1",n.textContent="There was a Problem in detecting your location. Please Try again later",document.getElementById("dialog-container").innerHTML=dialog({id:"location-fetch-dialog",content:n}).outerHTML;var a=document.getElementById("location-fetch-dialog");new mdc.dialog.MDCDialog(a).show(),getRootRecord().then(function(e){var t=void 0;try{t=AndroidInterface.getCellularData()}catch(e){t=e.message,sendExceptionObject(e,"CATCH Type 4: AndroidInterface.getCullarData at sendRequest",[])}var n={deviceInfo:native.getInfo(),storedLocation:e.location,cellTower:t};handleError({message:"No Locations Found in indexedDB",body:JSON.stringify(n)}),setTimeout(function(){a.remove(),resetScroll(),listView()},5e3)})}}function isLastLocationOlderThanThreshold(e,t){var n=moment(moment().valueOf()),a=e;return t<moment.duration(n.diff(a)).asSeconds()}var receiverCaller={initFirstLoad:initFirstLoad,"update-app":updateApp,"removed-from-office":officeRemovalSuccess,"revoke-session":revokeSession,notification:successDialog,"android-stop-refreshing":androidStopRefreshing,apiFail:apiFail};function messageReceiver(e){receiverCaller[e.data.type](e.data)}function emailVerify(e){if(firebase.auth().currentUser.email)return emailUpdateSuccess();var t=document.createElement("h1");t.className="mdc-typography--body1",t.textContent=e.body,document.getElementById("dialog-container").innerHTML=dialog({id:"email-update-dialog",showCancel:!0,showAccept:!0,headerText:e.title,content:t}).outerHTML;var n=document.getElementById("email-update-dialog"),a=new mdc.dialog.MDCDialog(n);a.listen("MDCDialog:accept",function(){n.remove(),profileView(!0)}),a.listen("MDCDialog:cancel",function(){n.remove()}),a.show()}function createBlankPayrollDialog(t){var e=document.createElement("div");e.style.marginTop="10px",e.className="notification-message",e.textContent=t.body;var n=document.createElement("ul");n.className="mdc-list",n.id="payroll-notification-list",n.setAttribute("role","radiogroup"),e.appendChild(n),t.data.forEach(function(e){var t=!1;"leave"===e.template&&(t=!0),n.appendChild(radioList({labelText:e.template,id:convertKeyToId(e.template),value:e.template,selected:t}))}),document.getElementById("dialog-container").innerHTML=dialog({id:"blank-payroll-dialog",showAccept:!0,showCancel:!0,headerText:t.title,content:e}).outerHTML;var a=document.getElementById("blank-payroll-dialog"),o=new mdc.dialog.MDCDialog(a);new mdc.list.MDCList(document.querySelector("#payroll-notification-list.mdc-list")).singleSelection=!0;var i=[].map.call(document.querySelectorAll("#payroll-notification-list .mdc-radio"),function(e){return new mdc.radio.MDCRadio(e)});o.listen("MDCDialog:accept",function(e){i.forEach(function(n){n.checked&&t.data.forEach(function(e){var t=JSON.parse(n.value);e.template!==t||createTempRecord(e.office,t,{schedule:e.schedule,attachment:e.attachment})})}),a.remove()}),o.listen("MDCDialog:cancel",function(e){a.remove()}),o.show()}function initFirstLoad(t){"listView"===history.state[0]&&(t.msg.hasOwnProperty("activity")&&t.msg.activity.length&&getRootRecord().then(function(e){updateEl(t.msg.activity,e)}),t.msg.hasOwnProperty("template")&&createActivityIcon())}function updateApp(t){if("Android"!==native.getName())webkit.messageHandlers.updateApp.postMessage("Update App");else{try{AndroidInterface.updateApp(t.msg)}catch(e){var n=JSON.parse(t.msg).message,a=document.createElement("span");a.className="mdc-typography--body1",a.textContent="Please Install the Latest version from google play store , to Use Growthfile. After Updating the App, close Growthfile and open again ",document.getElementById("dialog-container").innerHTML=dialog({id:"app-update-dialog",showCancel:!1,showAccept:!0,headerText:n,content:a}).outerHTML;var o=document.getElementById("app-update-dialog"),i=new mdc.dialog.MDCDialog(o);i.show(),i.listen("MDCDialog:accept",function(){7===JSON.parse(native.getInfo()).appVersion?(setTimeout(function(){i.show()},500),resetScroll(),listView(),requestCreator("now",{device:native.getInfo(),from:"",registerToken:native.getFCMToken()})):(o.remove(),resetScroll(),listView())})}sendExceptionObject(e,"CATCH Type 8: AndroidInterface.updateApp at updateApp",[JSON.stringify(t.msg)])}}function revokeSession(){firebase.auth().signOut().then(function(){}).catch(function(e){handleError({message:"Sign out error",body:e})})}function apiFail(e){document.getElementById("send-activity")&&(document.getElementById("send-activity").style.display="block"),document.querySelector("header .mdc-linear-progress")&&document.querySelector("header .mdc-linear-progress").remove(),document.querySelector(".loader")&&document.querySelector(".loader").remove(),document.querySelector(".delete-activity")&&(document.querySelector(".delete-activity").style.display="block"),document.querySelector(".undo-delete-loader")&&(document.querySelector(".undo-delete-loader").style.display="block"),document.querySelector(".form-field-status")&&document.querySelector(".form-field-status").classList.contains("hidden")&&document.querySelector(".form-field-status").classList.remove("hidden"),snacks(e.msg.message)}function officeRemovalSuccess(e){var t=document.createElement("span");t.className="mdc-typography--body1",t.textContent="You have been removed from "+e.msg.join(" & "),document.getElementById("dialog-container").innerHTML=dialog({id:"office-removal-dialog",showAccept:!0,showCancel:!1,headerText:"Reminder",content:t}).outerHTML;var n=document.getElementById("office-removal-dialog"),a=new mdc.dialog.MDCDialog(n);a.listen("MDCDialog:accept",function(){n.remove(),document.getElementById("app-current-panel").innerHTML="",resetScroll(),listView()}),a.show()}function androidStopRefreshing(){if("Android"===native.getName()){var e=JSON.parse(native.getInfo());if(console.log(e),!(8<=e.appVersion))try{AndroidInterface.stopRefreshing(!0)}catch(e){sendExceptionObject(e,"CATCH Type 9:AndroidInterface.stopRefreshing at androidStopRefreshing",[!0])}}}function onErrorMessage(e){var t={"line-number":e.lineno,file:e.filename,"col-number":e.colno};handleError({message:e.message+" from apiHandler.js at line-number "+e.lineno+" and columne-number "+e.colno,body:t})}function getInputText(e){return mdc.textField.MDCTextField.attachTo(document.querySelector(e))}function runRead(e){if(localStorage.getItem("dbexist"))return e?void setTimeout(function(){e.read?requestCreator("Null",e):"listView"===history.state[0]&&(e.verifyEmail?emailVerify(JSON.parse(e.verifyEmail)):e.payroll&&createBlankPayrollDialog(JSON.parse(e.payroll)))},200):requestCreator("Null",e)}function removeChildNodes(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function jniException(e,t){handleError({message:e,body:t,androidException:!0})}function sendExceptionObject(e,t,n){handleError({message:""+t,body:JSON.stringify({message:e.message,name:e.name,stack:JSON.stringify(e.stack),paramSent:n})})}